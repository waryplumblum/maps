var bP=Object.create;var Q0=Object.defineProperty,wP=Object.defineProperties,TP=Object.getOwnPropertyDescriptor,EP=Object.getOwnPropertyDescriptors,IP=Object.getOwnPropertyNames,bg=Object.getOwnPropertySymbols,DP=Object.getPrototypeOf,K0=Object.prototype.hasOwnProperty,uE=Object.prototype.propertyIsEnumerable;var cE=(h,d,_)=>d in h?Q0(h,d,{enumerable:!0,configurable:!0,writable:!0,value:_}):h[d]=_,Br=(h,d)=>{for(var _ in d||={})K0.call(d,_)&&cE(h,_,d[_]);if(bg)for(var _ of bg(d))uE.call(d,_)&&cE(h,_,d[_]);return h},il=(h,d)=>wP(h,EP(d));var J0=(h,d)=>{var _={};for(var v in h)K0.call(h,v)&&d.indexOf(v)<0&&(_[v]=h[v]);if(h!=null&&bg)for(var v of bg(h))d.indexOf(v)<0&&uE.call(h,v)&&(_[v]=h[v]);return _};var MP=(h,d)=>()=>(d||h((d={exports:{}}).exports,d),d.exports);var CP=(h,d,_,v)=>{if(d&&typeof d=="object"||typeof d=="function")for(let I of IP(d))!K0.call(h,I)&&I!==_&&Q0(h,I,{get:()=>d[I],enumerable:!(v=TP(d,I))||v.enumerable});return h};var hE=(h,d,_)=>(_=h!=null?bP(DP(h)):{},CP(d||!h||!h.__esModule?Q0(_,"default",{value:h,enumerable:!0}):_,h));var wg=(h,d,_)=>new Promise((v,I)=>{var o=Z=>{try{V(_.next(Z))}catch(me){I(me)}},k=Z=>{try{V(_.throw(Z))}catch(me){I(me)}},V=Z=>Z.done?v(Z.value):Promise.resolve(Z.value).then(o,k);V((_=_.apply(h,d)).next())});var v1=MP((y1,x1)=>{"use strict";(function(h,d){typeof y1=="object"&&typeof x1<"u"?x1.exports=d():typeof define=="function"&&define.amd?define(d):(h=typeof globalThis<"u"?globalThis:h||self,h.mapboxgl=d())})(y1,function(){"use strict";var h,d,_;function v(o,k){if(!h)h=k;else if(!d)d=k;else{var V="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+h+")(sharedChunk); ("+d+")(sharedChunk); self.onerror = null;",Z={};h(Z),_=k(Z),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(_.workerUrl=window.URL.createObjectURL(new Blob([V],{type:"text/javascript"})))}}v(["exports"],function(o){var k="3.5.2";let V,Z={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(V==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{V=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{V=t}}return V},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Z.API_URL)return null;try{let t=new URL(Z.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function me(t){return Z.API_URL_REGEX.test(t)}function ye(t){return t.indexOf("mapbox:")===0}function Ne(t){return Z.API_CDN_URL_REGEX.test(t)}function ot(t){return Z.API_SPRITE_REGEX.test(t)}function et(t){return Z.API_STYLE_REGEX.test(t)&&!ot(t)}let mt={create:"create",load:"load",fullLoad:"fullLoad"},Zt={mark(t){performance.mark(t)},measure(t,e,n){performance.measure(t,e,n)}};function jt(t){let e=t.name.split("?")[0];return Ne(e)&&e.includes("mapbox-gl.js")?"javascript":Ne(e)&&e.includes("mapbox-gl.css")?"css":function(n){return Z.API_FONTS_REGEX.test(n)}(e)?"fontRange":ot(e)?"sprite":et(e)?"style":function(n){return Z.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function Rt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var an={},Ut={};Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.setMatrixArrayType=function(t){Ut.ARRAY_TYPE=mr=t},Ut.toRadian=function(t){return t*Sr},Ut.equals=function(t,e){return Math.abs(t-e)<=pn*Math.max(1,Math.abs(t),Math.abs(e))},Ut.RANDOM=Ut.ARRAY_TYPE=Ut.EPSILON=void 0;var pn=1e-6;Ut.EPSILON=pn;var mr=typeof Float32Array<"u"?Float32Array:Array;Ut.ARRAY_TYPE=mr;var Yn=Math.random;Ut.RANDOM=Yn;var Sr=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var cn={};function Ao(t){return Ao=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ao(t)}Object.defineProperty(cn,"__esModule",{value:!0}),cn.create=function(){var t=new Qt.ARRAY_TYPE(4);return Qt.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},cn.clone=function(t){var e=new Qt.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},cn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},cn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},cn.fromValues=function(t,e,n,i){var s=new Qt.ARRAY_TYPE(4);return s[0]=t,s[1]=e,s[2]=n,s[3]=i,s},cn.set=function(t,e,n,i,s){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t},cn.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},cn.invert=function(t,e){var n=e[0],i=e[1],s=e[2],l=e[3],c=n*l-s*i;return c?(t[0]=l*(c=1/c),t[1]=-i*c,t[2]=-s*c,t[3]=n*c,t):null},cn.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},cn.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},cn.multiply=yl,cn.rotate=function(t,e,n){var i=e[0],s=e[1],l=e[2],c=e[3],p=Math.sin(n),m=Math.cos(n);return t[0]=i*m+l*p,t[1]=s*m+c*p,t[2]=i*-p+l*m,t[3]=s*-p+c*m,t},cn.scale=function(t,e,n){var i=e[1],s=e[2],l=e[3],c=n[0],p=n[1];return t[0]=e[0]*c,t[1]=i*c,t[2]=s*p,t[3]=l*p,t},cn.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t},cn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},cn.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},cn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},cn.LDU=function(t,e,n,i){return t[2]=i[2]/i[0],n[0]=i[0],n[1]=i[1],n[3]=i[3]-t[2]*n[1],[t,e,n]},cn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},cn.subtract=Wc,cn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},cn.equals=function(t,e){var n=t[0],i=t[1],s=t[2],l=t[3],c=e[0],p=e[1],m=e[2],x=e[3];return Math.abs(n-c)<=Qt.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-p)<=Qt.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(s-m)<=Qt.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(l-x)<=Qt.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))},cn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},cn.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},cn.sub=cn.mul=void 0;var Qt=function(t,e){if(t&&t.__esModule)return t;if(t===null||Ao(t)!=="object"&&typeof t!="function")return{default:t};var n=qc(void 0);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var c=s?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(Ut);function qc(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(qc=function(i){return i?n:e})(t)}function yl(t,e,n){var i=e[0],s=e[1],l=e[2],c=e[3],p=n[0],m=n[1],x=n[2],w=n[3];return t[0]=i*p+l*m,t[1]=s*p+c*m,t[2]=i*x+l*w,t[3]=s*x+c*w,t}function Wc(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}cn.mul=yl,cn.sub=Wc;var bn={};function xl(t){return xl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xl(t)}Object.defineProperty(bn,"__esModule",{value:!0}),bn.create=function(){var t=new si.ARRAY_TYPE(6);return si.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},bn.clone=function(t){var e=new si.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},bn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},bn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},bn.fromValues=function(t,e,n,i,s,l){var c=new si.ARRAY_TYPE(6);return c[0]=t,c[1]=e,c[2]=n,c[3]=i,c[4]=s,c[5]=l,c},bn.set=function(t,e,n,i,s,l,c){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t[4]=l,t[5]=c,t},bn.invert=function(t,e){var n=e[0],i=e[1],s=e[2],l=e[3],c=e[4],p=e[5],m=n*l-i*s;return m?(t[0]=l*(m=1/m),t[1]=-i*m,t[2]=-s*m,t[3]=n*m,t[4]=(s*p-l*c)*m,t[5]=(i*c-n*p)*m,t):null},bn.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},bn.multiply=vl,bn.rotate=function(t,e,n){var i=e[0],s=e[1],l=e[2],c=e[3],p=e[4],m=e[5],x=Math.sin(n),w=Math.cos(n);return t[0]=i*w+l*x,t[1]=s*w+c*x,t[2]=i*-x+l*w,t[3]=s*-x+c*w,t[4]=p,t[5]=m,t},bn.scale=function(t,e,n){var i=e[1],s=e[2],l=e[3],c=e[4],p=e[5],m=n[0],x=n[1];return t[0]=e[0]*m,t[1]=i*m,t[2]=s*x,t[3]=l*x,t[4]=c,t[5]=p,t},bn.translate=function(t,e,n){var i=e[0],s=e[1],l=e[2],c=e[3],p=e[4],m=e[5],x=n[0],w=n[1];return t[0]=i,t[1]=s,t[2]=l,t[3]=c,t[4]=i*x+l*w+p,t[5]=s*x+c*w+m,t},bn.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t[4]=0,t[5]=0,t},bn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},bn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},bn.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},bn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},bn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},bn.subtract=is,bn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},bn.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t},bn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},bn.equals=function(t,e){var n=t[0],i=t[1],s=t[2],l=t[3],c=t[4],p=t[5],m=e[0],x=e[1],w=e[2],E=e[3],D=e[4],S=e[5];return Math.abs(n-m)<=si.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(i-x)<=si.EPSILON*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(s-w)<=si.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(l-E)<=si.EPSILON*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(c-D)<=si.EPSILON*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(p-S)<=si.EPSILON*Math.max(1,Math.abs(p),Math.abs(S))},bn.sub=bn.mul=void 0;var si=function(t,e){if(t&&t.__esModule)return t;if(t===null||xl(t)!=="object"&&typeof t!="function")return{default:t};var n=Zc(void 0);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var c=s?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(Ut);function Zc(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Zc=function(i){return i?n:e})(t)}function vl(t,e,n){var i=e[0],s=e[1],l=e[2],c=e[3],p=e[4],m=e[5],x=n[0],w=n[1],E=n[2],D=n[3],S=n[4],A=n[5];return t[0]=i*x+l*w,t[1]=s*x+c*w,t[2]=i*E+l*D,t[3]=s*E+c*D,t[4]=i*S+l*A+p,t[5]=s*S+c*A+m,t}function is(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}bn.mul=vl,bn.sub=is;var fn={};function Ys(t){return Ys=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ys(t)}Object.defineProperty(fn,"__esModule",{value:!0}),fn.create=function(){var t=new wr.ARRAY_TYPE(9);return wr.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},fn.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},fn.clone=function(t){var e=new wr.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fn.fromValues=function(t,e,n,i,s,l,c,p,m){var x=new wr.ARRAY_TYPE(9);return x[0]=t,x[1]=e,x[2]=n,x[3]=i,x[4]=s,x[5]=l,x[6]=c,x[7]=p,x[8]=m,x},fn.set=function(t,e,n,i,s,l,c,p,m,x){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t[4]=l,t[5]=c,t[6]=p,t[7]=m,t[8]=x,t},fn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fn.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},fn.invert=function(t,e){var n=e[0],i=e[1],s=e[2],l=e[3],c=e[4],p=e[5],m=e[6],x=e[7],w=e[8],E=w*c-p*x,D=-w*l+p*m,S=x*l-c*m,A=n*E+i*D+s*S;return A?(t[0]=E*(A=1/A),t[1]=(-w*i+s*x)*A,t[2]=(p*i-s*c)*A,t[3]=D*A,t[4]=(w*n-s*m)*A,t[5]=(-p*n+s*l)*A,t[6]=S*A,t[7]=(-x*n+i*m)*A,t[8]=(c*n-i*l)*A,t):null},fn.adjoint=function(t,e){var n=e[0],i=e[1],s=e[2],l=e[3],c=e[4],p=e[5],m=e[6],x=e[7],w=e[8];return t[0]=c*w-p*x,t[1]=s*x-i*w,t[2]=i*p-s*c,t[3]=p*m-l*w,t[4]=n*w-s*m,t[5]=s*l-n*p,t[6]=l*x-c*m,t[7]=i*m-n*x,t[8]=n*c-i*l,t},fn.determinant=function(t){var e=t[3],n=t[4],i=t[5],s=t[6],l=t[7],c=t[8];return t[0]*(c*n-i*l)+t[1]*(-c*e+i*s)+t[2]*(l*e-n*s)},fn.multiply=Yc,fn.translate=function(t,e,n){var i=e[0],s=e[1],l=e[2],c=e[3],p=e[4],m=e[5],x=e[6],w=e[7],E=e[8],D=n[0],S=n[1];return t[0]=i,t[1]=s,t[2]=l,t[3]=c,t[4]=p,t[5]=m,t[6]=D*i+S*c+x,t[7]=D*s+S*p+w,t[8]=D*l+S*m+E,t},fn.rotate=function(t,e,n){var i=e[0],s=e[1],l=e[2],c=e[3],p=e[4],m=e[5],x=e[6],w=e[7],E=e[8],D=Math.sin(n),S=Math.cos(n);return t[0]=S*i+D*c,t[1]=S*s+D*p,t[2]=S*l+D*m,t[3]=S*c-D*i,t[4]=S*p-D*s,t[5]=S*m-D*l,t[6]=x,t[7]=w,t[8]=E,t},fn.scale=function(t,e,n){var i=n[0],s=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},fn.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fn.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},fn.fromQuat=function(t,e){var n=e[0],i=e[1],s=e[2],l=e[3],c=n+n,p=i+i,m=s+s,x=n*c,w=i*c,E=i*p,D=s*c,S=s*p,A=s*m,R=l*c,O=l*p,z=l*m;return t[0]=1-E-A,t[3]=w-z,t[6]=D+O,t[1]=w+z,t[4]=1-x-A,t[7]=S-R,t[2]=D-O,t[5]=S+R,t[8]=1-x-E,t},fn.normalFromMat4=function(t,e){var n=e[0],i=e[1],s=e[2],l=e[3],c=e[4],p=e[5],m=e[6],x=e[7],w=e[8],E=e[9],D=e[10],S=e[11],A=e[12],R=e[13],O=e[14],z=e[15],W=n*p-i*c,X=n*m-s*c,Y=n*x-l*c,re=i*m-s*p,ne=i*x-l*p,ue=s*x-l*m,de=w*R-E*A,ve=w*O-D*A,Ce=w*z-S*A,Te=E*O-D*R,Le=E*z-S*R,Ue=D*z-S*O,Pe=W*Ue-X*Le+Y*Te+re*Ce-ne*ve+ue*de;return Pe?(t[0]=(p*Ue-m*Le+x*Te)*(Pe=1/Pe),t[1]=(m*Ce-c*Ue-x*ve)*Pe,t[2]=(c*Le-p*Ce+x*de)*Pe,t[3]=(s*Le-i*Ue-l*Te)*Pe,t[4]=(n*Ue-s*Ce+l*ve)*Pe,t[5]=(i*Ce-n*Le-l*de)*Pe,t[6]=(R*ue-O*ne+z*re)*Pe,t[7]=(O*Y-A*ue-z*X)*Pe,t[8]=(A*ne-R*Y+z*W)*Pe,t):null},fn.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},fn.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},fn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},fn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},fn.subtract=Qc,fn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},fn.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t},fn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},fn.equals=function(t,e){var n=t[0],i=t[1],s=t[2],l=t[3],c=t[4],p=t[5],m=t[6],x=t[7],w=t[8],E=e[0],D=e[1],S=e[2],A=e[3],R=e[4],O=e[5],z=e[6],W=e[7],X=e[8];return Math.abs(n-E)<=wr.EPSILON*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(i-D)<=wr.EPSILON*Math.max(1,Math.abs(i),Math.abs(D))&&Math.abs(s-S)<=wr.EPSILON*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(l-A)<=wr.EPSILON*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(c-R)<=wr.EPSILON*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(p-O)<=wr.EPSILON*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(m-z)<=wr.EPSILON*Math.max(1,Math.abs(m),Math.abs(z))&&Math.abs(x-W)<=wr.EPSILON*Math.max(1,Math.abs(x),Math.abs(W))&&Math.abs(w-X)<=wr.EPSILON*Math.max(1,Math.abs(w),Math.abs(X))},fn.sub=fn.mul=void 0;var wr=function(t,e){if(t&&t.__esModule)return t;if(t===null||Ys(t)!=="object"&&typeof t!="function")return{default:t};var n=Xc(void 0);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var c=s?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(Ut);function Xc(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Xc=function(i){return i?n:e})(t)}function Yc(t,e,n){var i=e[0],s=e[1],l=e[2],c=e[3],p=e[4],m=e[5],x=e[6],w=e[7],E=e[8],D=n[0],S=n[1],A=n[2],R=n[3],O=n[4],z=n[5],W=n[6],X=n[7],Y=n[8];return t[0]=D*i+S*c+A*x,t[1]=D*s+S*p+A*w,t[2]=D*l+S*m+A*E,t[3]=R*i+O*c+z*x,t[4]=R*s+O*p+z*w,t[5]=R*l+O*m+z*E,t[6]=W*i+X*c+Y*x,t[7]=W*s+X*p+Y*w,t[8]=W*l+X*m+Y*E,t}function Qc(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}fn.mul=Yc,fn.sub=Qc;var wt={};function Qs(t){return Qs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qs(t)}Object.defineProperty(wt,"__esModule",{value:!0}),wt.create=function(){var t=new Fn.ARRAY_TYPE(16);return Fn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},wt.clone=function(t){var e=new Fn.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},wt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},wt.fromValues=function(t,e,n,i,s,l,c,p,m,x,w,E,D,S,A,R){var O=new Fn.ARRAY_TYPE(16);return O[0]=t,O[1]=e,O[2]=n,O[3]=i,O[4]=s,O[5]=l,O[6]=c,O[7]=p,O[8]=m,O[9]=x,O[10]=w,O[11]=E,O[12]=D,O[13]=S,O[14]=A,O[15]=R,O},wt.set=function(t,e,n,i,s,l,c,p,m,x,w,E,D,S,A,R,O){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t[4]=l,t[5]=c,t[6]=p,t[7]=m,t[8]=x,t[9]=w,t[10]=E,t[11]=D,t[12]=S,t[13]=A,t[14]=R,t[15]=O,t},wt.identity=Jc,wt.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],s=e[3],l=e[6],c=e[7],p=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=l,t[11]=e[14],t[12]=s,t[13]=c,t[14]=p}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},wt.invert=function(t,e){var n=e[0],i=e[1],s=e[2],l=e[3],c=e[4],p=e[5],m=e[6],x=e[7],w=e[8],E=e[9],D=e[10],S=e[11],A=e[12],R=e[13],O=e[14],z=e[15],W=n*p-i*c,X=n*m-s*c,Y=n*x-l*c,re=i*m-s*p,ne=i*x-l*p,ue=s*x-l*m,de=w*R-E*A,ve=w*O-D*A,Ce=w*z-S*A,Te=E*O-D*R,Le=E*z-S*R,Ue=D*z-S*O,Pe=W*Ue-X*Le+Y*Te+re*Ce-ne*ve+ue*de;return Pe?(t[0]=(p*Ue-m*Le+x*Te)*(Pe=1/Pe),t[1]=(s*Le-i*Ue-l*Te)*Pe,t[2]=(R*ue-O*ne+z*re)*Pe,t[3]=(D*ne-E*ue-S*re)*Pe,t[4]=(m*Ce-c*Ue-x*ve)*Pe,t[5]=(n*Ue-s*Ce+l*ve)*Pe,t[6]=(O*Y-A*ue-z*X)*Pe,t[7]=(w*ue-D*Y+S*X)*Pe,t[8]=(c*Le-p*Ce+x*de)*Pe,t[9]=(i*Ce-n*Le-l*de)*Pe,t[10]=(A*ne-R*Y+z*W)*Pe,t[11]=(E*Y-w*ne-S*W)*Pe,t[12]=(p*ve-c*Te-m*de)*Pe,t[13]=(n*Te-i*ve+s*de)*Pe,t[14]=(R*X-A*re-O*W)*Pe,t[15]=(w*re-E*X+D*W)*Pe,t):null},wt.adjoint=function(t,e){var n=e[0],i=e[1],s=e[2],l=e[3],c=e[4],p=e[5],m=e[6],x=e[7],w=e[8],E=e[9],D=e[10],S=e[11],A=e[12],R=e[13],O=e[14],z=e[15];return t[0]=p*(D*z-S*O)-E*(m*z-x*O)+R*(m*S-x*D),t[1]=-(i*(D*z-S*O)-E*(s*z-l*O)+R*(s*S-l*D)),t[2]=i*(m*z-x*O)-p*(s*z-l*O)+R*(s*x-l*m),t[3]=-(i*(m*S-x*D)-p*(s*S-l*D)+E*(s*x-l*m)),t[4]=-(c*(D*z-S*O)-w*(m*z-x*O)+A*(m*S-x*D)),t[5]=n*(D*z-S*O)-w*(s*z-l*O)+A*(s*S-l*D),t[6]=-(n*(m*z-x*O)-c*(s*z-l*O)+A*(s*x-l*m)),t[7]=n*(m*S-x*D)-c*(s*S-l*D)+w*(s*x-l*m),t[8]=c*(E*z-S*R)-w*(p*z-x*R)+A*(p*S-x*E),t[9]=-(n*(E*z-S*R)-w*(i*z-l*R)+A*(i*S-l*E)),t[10]=n*(p*z-x*R)-c*(i*z-l*R)+A*(i*x-l*p),t[11]=-(n*(p*S-x*E)-c*(i*S-l*E)+w*(i*x-l*p)),t[12]=-(c*(E*O-D*R)-w*(p*O-m*R)+A*(p*D-m*E)),t[13]=n*(E*O-D*R)-w*(i*O-s*R)+A*(i*D-s*E),t[14]=-(n*(p*O-m*R)-c*(i*O-s*R)+A*(i*m-s*p)),t[15]=n*(p*D-m*E)-c*(i*D-s*E)+w*(i*m-s*p),t},wt.determinant=function(t){var e=t[0],n=t[1],i=t[2],s=t[3],l=t[4],c=t[5],p=t[6],m=t[7],x=t[8],w=t[9],E=t[10],D=t[11],S=t[12],A=t[13],R=t[14],O=t[15];return(e*c-n*l)*(E*O-D*R)-(e*p-i*l)*(w*O-D*A)+(e*m-s*l)*(w*R-E*A)+(n*p-i*c)*(x*O-D*S)-(n*m-s*c)*(x*R-E*S)+(i*m-s*p)*(x*A-w*S)},wt.multiply=eu,wt.translate=function(t,e,n){var i,s,l,c,p,m,x,w,E,D,S,A,R=n[0],O=n[1],z=n[2];return e===t?(t[12]=e[0]*R+e[4]*O+e[8]*z+e[12],t[13]=e[1]*R+e[5]*O+e[9]*z+e[13],t[14]=e[2]*R+e[6]*O+e[10]*z+e[14],t[15]=e[3]*R+e[7]*O+e[11]*z+e[15]):(s=e[1],l=e[2],c=e[3],p=e[4],m=e[5],x=e[6],w=e[7],E=e[8],D=e[9],S=e[10],A=e[11],t[0]=i=e[0],t[1]=s,t[2]=l,t[3]=c,t[4]=p,t[5]=m,t[6]=x,t[7]=w,t[8]=E,t[9]=D,t[10]=S,t[11]=A,t[12]=i*R+p*O+E*z+e[12],t[13]=s*R+m*O+D*z+e[13],t[14]=l*R+x*O+S*z+e[14],t[15]=c*R+w*O+A*z+e[15]),t},wt.scale=function(t,e,n){var i=n[0],s=n[1],l=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},wt.rotate=function(t,e,n,i){var s,l,c,p,m,x,w,E,D,S,A,R,O,z,W,X,Y,re,ne,ue,de,ve,Ce,Te,Le=i[0],Ue=i[1],Pe=i[2],Be=Math.hypot(Le,Ue,Pe);return Be<Fn.EPSILON?null:(Le*=Be=1/Be,Ue*=Be,Pe*=Be,s=Math.sin(n),l=Math.cos(n),m=e[1],x=e[2],w=e[3],D=e[5],S=e[6],A=e[7],O=e[9],z=e[10],W=e[11],X=Le*Le*(c=1-l)+l,ne=Le*Ue*c-Pe*s,ue=Ue*Ue*c+l,de=Pe*Ue*c+Le*s,ve=Le*Pe*c+Ue*s,Ce=Ue*Pe*c-Le*s,Te=Pe*Pe*c+l,t[0]=(p=e[0])*X+(E=e[4])*(Y=Ue*Le*c+Pe*s)+(R=e[8])*(re=Pe*Le*c-Ue*s),t[1]=m*X+D*Y+O*re,t[2]=x*X+S*Y+z*re,t[3]=w*X+A*Y+W*re,t[4]=p*ne+E*ue+R*de,t[5]=m*ne+D*ue+O*de,t[6]=x*ne+S*ue+z*de,t[7]=w*ne+A*ue+W*de,t[8]=p*ve+E*Ce+R*Te,t[9]=m*ve+D*Ce+O*Te,t[10]=x*ve+S*Ce+z*Te,t[11]=w*ve+A*Ce+W*Te,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},wt.rotateX=function(t,e,n){var i=Math.sin(n),s=Math.cos(n),l=e[4],c=e[5],p=e[6],m=e[7],x=e[8],w=e[9],E=e[10],D=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=l*s+x*i,t[5]=c*s+w*i,t[6]=p*s+E*i,t[7]=m*s+D*i,t[8]=x*s-l*i,t[9]=w*s-c*i,t[10]=E*s-p*i,t[11]=D*s-m*i,t},wt.rotateY=function(t,e,n){var i=Math.sin(n),s=Math.cos(n),l=e[0],c=e[1],p=e[2],m=e[3],x=e[8],w=e[9],E=e[10],D=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*s-x*i,t[1]=c*s-w*i,t[2]=p*s-E*i,t[3]=m*s-D*i,t[8]=l*i+x*s,t[9]=c*i+w*s,t[10]=p*i+E*s,t[11]=m*i+D*s,t},wt.rotateZ=function(t,e,n){var i=Math.sin(n),s=Math.cos(n),l=e[0],c=e[1],p=e[2],m=e[3],x=e[4],w=e[5],E=e[6],D=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*s+x*i,t[1]=c*s+w*i,t[2]=p*s+E*i,t[3]=m*s+D*i,t[4]=x*s-l*i,t[5]=w*s-c*i,t[6]=E*s-p*i,t[7]=D*s-m*i,t},wt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},wt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},wt.fromRotation=function(t,e,n){var i,s,l,c=n[0],p=n[1],m=n[2],x=Math.hypot(c,p,m);return x<Fn.EPSILON?null:(c*=x=1/x,p*=x,m*=x,i=Math.sin(e),s=Math.cos(e),t[0]=c*c*(l=1-s)+s,t[1]=p*c*l+m*i,t[2]=m*c*l-p*i,t[3]=0,t[4]=c*p*l-m*i,t[5]=p*p*l+s,t[6]=m*p*l+c*i,t[7]=0,t[8]=c*m*l+p*i,t[9]=p*m*l-c*i,t[10]=m*m*l+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},wt.fromXRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},wt.fromYRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},wt.fromZRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},wt.fromRotationTranslation=bl,wt.fromQuat2=function(t,e){var n=new Fn.ARRAY_TYPE(3),i=-e[0],s=-e[1],l=-e[2],c=e[3],p=e[4],m=e[5],x=e[6],w=e[7],E=i*i+s*s+l*l+c*c;return E>0?(n[0]=2*(p*c+w*i+m*l-x*s)/E,n[1]=2*(m*c+w*s+x*i-p*l)/E,n[2]=2*(x*c+w*l+p*s-m*i)/E):(n[0]=2*(p*c+w*i+m*l-x*s),n[1]=2*(m*c+w*s+x*i-p*l),n[2]=2*(x*c+w*l+p*s-m*i)),bl(t,e,n),t},wt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},wt.getScaling=Ks,wt.getRotation=function(t,e){var n=new Fn.ARRAY_TYPE(3);Ks(n,e);var i=1/n[0],s=1/n[1],l=1/n[2],c=e[0]*i,p=e[1]*s,m=e[2]*l,x=e[4]*i,w=e[5]*s,E=e[6]*l,D=e[8]*i,S=e[9]*s,A=e[10]*l,R=c+w+A,O=0;return R>0?(O=2*Math.sqrt(R+1),t[3]=.25*O,t[0]=(E-S)/O,t[1]=(D-m)/O,t[2]=(p-x)/O):c>w&&c>A?(O=2*Math.sqrt(1+c-w-A),t[3]=(E-S)/O,t[0]=.25*O,t[1]=(p+x)/O,t[2]=(D+m)/O):w>A?(O=2*Math.sqrt(1+w-c-A),t[3]=(D-m)/O,t[0]=(p+x)/O,t[1]=.25*O,t[2]=(E+S)/O):(O=2*Math.sqrt(1+A-c-w),t[3]=(p-x)/O,t[0]=(D+m)/O,t[1]=(E+S)/O,t[2]=.25*O),t},wt.fromRotationTranslationScale=function(t,e,n,i){var s=e[0],l=e[1],c=e[2],p=e[3],m=s+s,x=l+l,w=c+c,E=s*m,D=s*x,S=s*w,A=l*x,R=l*w,O=c*w,z=p*m,W=p*x,X=p*w,Y=i[0],re=i[1],ne=i[2];return t[0]=(1-(A+O))*Y,t[1]=(D+X)*Y,t[2]=(S-W)*Y,t[3]=0,t[4]=(D-X)*re,t[5]=(1-(E+O))*re,t[6]=(R+z)*re,t[7]=0,t[8]=(S+W)*ne,t[9]=(R-z)*ne,t[10]=(1-(E+A))*ne,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},wt.fromRotationTranslationScaleOrigin=function(t,e,n,i,s){var l=e[0],c=e[1],p=e[2],m=e[3],x=l+l,w=c+c,E=p+p,D=l*x,S=l*w,A=l*E,R=c*w,O=c*E,z=p*E,W=m*x,X=m*w,Y=m*E,re=i[0],ne=i[1],ue=i[2],de=s[0],ve=s[1],Ce=s[2],Te=(1-(R+z))*re,Le=(S+Y)*re,Ue=(A-X)*re,Pe=(S-Y)*ne,Be=(1-(D+z))*ne,Se=(O+W)*ne,Ve=(A+X)*ue,He=(O-W)*ue,je=(1-(D+R))*ue;return t[0]=Te,t[1]=Le,t[2]=Ue,t[3]=0,t[4]=Pe,t[5]=Be,t[6]=Se,t[7]=0,t[8]=Ve,t[9]=He,t[10]=je,t[11]=0,t[12]=n[0]+de-(Te*de+Pe*ve+Ve*Ce),t[13]=n[1]+ve-(Le*de+Be*ve+He*Ce),t[14]=n[2]+Ce-(Ue*de+Se*ve+je*Ce),t[15]=1,t},wt.fromQuat=function(t,e){var n=e[0],i=e[1],s=e[2],l=e[3],c=n+n,p=i+i,m=s+s,x=n*c,w=i*c,E=i*p,D=s*c,S=s*p,A=s*m,R=l*c,O=l*p,z=l*m;return t[0]=1-E-A,t[1]=w+z,t[2]=D-O,t[3]=0,t[4]=w-z,t[5]=1-x-A,t[6]=S+R,t[7]=0,t[8]=D+O,t[9]=S-R,t[10]=1-x-E,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},wt.frustum=function(t,e,n,i,s,l,c){var p=1/(n-e),m=1/(s-i),x=1/(l-c);return t[0]=2*l*p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*l*m,t[6]=0,t[7]=0,t[8]=(n+e)*p,t[9]=(s+i)*m,t[10]=(c+l)*x,t[11]=-1,t[12]=0,t[13]=0,t[14]=c*l*2*x,t[15]=0,t},wt.perspectiveNO=bi,wt.perspectiveZO=function(t,e,n,i,s){var l,c=1/Math.tan(e/2);return t[0]=c/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(t[10]=s*(l=1/(i-s)),t[14]=s*i*l):(t[10]=-1,t[14]=-i),t},wt.perspectiveFromFieldOfView=function(t,e,n,i){var s=Math.tan(e.upDegrees*Math.PI/180),l=Math.tan(e.downDegrees*Math.PI/180),c=Math.tan(e.leftDegrees*Math.PI/180),p=Math.tan(e.rightDegrees*Math.PI/180),m=2/(c+p),x=2/(s+l);return t[0]=m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=x,t[6]=0,t[7]=0,t[8]=-(c-p)*m*.5,t[9]=(s-l)*x*.5,t[10]=i/(n-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*n/(n-i),t[15]=0,t},wt.orthoNO=wi,wt.orthoZO=function(t,e,n,i,s,l,c){var p=1/(e-n),m=1/(i-s),x=1/(l-c);return t[0]=-2*p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=x,t[11]=0,t[12]=(e+n)*p,t[13]=(s+i)*m,t[14]=l*x,t[15]=1,t},wt.lookAt=function(t,e,n,i){var s,l,c,p,m,x,w,E,D,S,A=e[0],R=e[1],O=e[2],z=i[0],W=i[1],X=i[2],Y=n[0],re=n[1],ne=n[2];return Math.abs(A-Y)<Fn.EPSILON&&Math.abs(R-re)<Fn.EPSILON&&Math.abs(O-ne)<Fn.EPSILON?Jc(t):(w=A-Y,E=R-re,D=O-ne,s=W*(D*=S=1/Math.hypot(w,E,D))-X*(E*=S),l=X*(w*=S)-z*D,c=z*E-W*w,(S=Math.hypot(s,l,c))?(s*=S=1/S,l*=S,c*=S):(s=0,l=0,c=0),p=E*c-D*l,m=D*s-w*c,x=w*l-E*s,(S=Math.hypot(p,m,x))?(p*=S=1/S,m*=S,x*=S):(p=0,m=0,x=0),t[0]=s,t[1]=p,t[2]=w,t[3]=0,t[4]=l,t[5]=m,t[6]=E,t[7]=0,t[8]=c,t[9]=x,t[10]=D,t[11]=0,t[12]=-(s*A+l*R+c*O),t[13]=-(p*A+m*R+x*O),t[14]=-(w*A+E*R+D*O),t[15]=1,t)},wt.targetTo=function(t,e,n,i){var s=e[0],l=e[1],c=e[2],p=i[0],m=i[1],x=i[2],w=s-n[0],E=l-n[1],D=c-n[2],S=w*w+E*E+D*D;S>0&&(w*=S=1/Math.sqrt(S),E*=S,D*=S);var A=m*D-x*E,R=x*w-p*D,O=p*E-m*w;return(S=A*A+R*R+O*O)>0&&(A*=S=1/Math.sqrt(S),R*=S,O*=S),t[0]=A,t[1]=R,t[2]=O,t[3]=0,t[4]=E*O-D*R,t[5]=D*A-w*O,t[6]=w*R-E*A,t[7]=0,t[8]=w,t[9]=E,t[10]=D,t[11]=0,t[12]=s,t[13]=l,t[14]=c,t[15]=1,t},wt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},wt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},wt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},wt.subtract=wl,wt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},wt.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t[9]=e[9]+n[9]*i,t[10]=e[10]+n[10]*i,t[11]=e[11]+n[11]*i,t[12]=e[12]+n[12]*i,t[13]=e[13]+n[13]*i,t[14]=e[14]+n[14]*i,t[15]=e[15]+n[15]*i,t},wt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},wt.equals=function(t,e){var n=t[0],i=t[1],s=t[2],l=t[3],c=t[4],p=t[5],m=t[6],x=t[7],w=t[8],E=t[9],D=t[10],S=t[11],A=t[12],R=t[13],O=t[14],z=t[15],W=e[0],X=e[1],Y=e[2],re=e[3],ne=e[4],ue=e[5],de=e[6],ve=e[7],Ce=e[8],Te=e[9],Le=e[10],Ue=e[11],Pe=e[12],Be=e[13],Se=e[14],Ve=e[15];return Math.abs(n-W)<=Fn.EPSILON*Math.max(1,Math.abs(n),Math.abs(W))&&Math.abs(i-X)<=Fn.EPSILON*Math.max(1,Math.abs(i),Math.abs(X))&&Math.abs(s-Y)<=Fn.EPSILON*Math.max(1,Math.abs(s),Math.abs(Y))&&Math.abs(l-re)<=Fn.EPSILON*Math.max(1,Math.abs(l),Math.abs(re))&&Math.abs(c-ne)<=Fn.EPSILON*Math.max(1,Math.abs(c),Math.abs(ne))&&Math.abs(p-ue)<=Fn.EPSILON*Math.max(1,Math.abs(p),Math.abs(ue))&&Math.abs(m-de)<=Fn.EPSILON*Math.max(1,Math.abs(m),Math.abs(de))&&Math.abs(x-ve)<=Fn.EPSILON*Math.max(1,Math.abs(x),Math.abs(ve))&&Math.abs(w-Ce)<=Fn.EPSILON*Math.max(1,Math.abs(w),Math.abs(Ce))&&Math.abs(E-Te)<=Fn.EPSILON*Math.max(1,Math.abs(E),Math.abs(Te))&&Math.abs(D-Le)<=Fn.EPSILON*Math.max(1,Math.abs(D),Math.abs(Le))&&Math.abs(S-Ue)<=Fn.EPSILON*Math.max(1,Math.abs(S),Math.abs(Ue))&&Math.abs(A-Pe)<=Fn.EPSILON*Math.max(1,Math.abs(A),Math.abs(Pe))&&Math.abs(R-Be)<=Fn.EPSILON*Math.max(1,Math.abs(R),Math.abs(Be))&&Math.abs(O-Se)<=Fn.EPSILON*Math.max(1,Math.abs(O),Math.abs(Se))&&Math.abs(z-Ve)<=Fn.EPSILON*Math.max(1,Math.abs(z),Math.abs(Ve))},wt.sub=wt.mul=wt.ortho=wt.perspective=void 0;var Fn=function(t,e){if(t&&t.__esModule)return t;if(t===null||Qs(t)!=="object"&&typeof t!="function")return{default:t};var n=Kc(void 0);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var c=s?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(Ut);function Kc(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Kc=function(i){return i?n:e})(t)}function Jc(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function eu(t,e,n){var i=e[0],s=e[1],l=e[2],c=e[3],p=e[4],m=e[5],x=e[6],w=e[7],E=e[8],D=e[9],S=e[10],A=e[11],R=e[12],O=e[13],z=e[14],W=e[15],X=n[0],Y=n[1],re=n[2],ne=n[3];return t[0]=X*i+Y*p+re*E+ne*R,t[1]=X*s+Y*m+re*D+ne*O,t[2]=X*l+Y*x+re*S+ne*z,t[3]=X*c+Y*w+re*A+ne*W,t[4]=(X=n[4])*i+(Y=n[5])*p+(re=n[6])*E+(ne=n[7])*R,t[5]=X*s+Y*m+re*D+ne*O,t[6]=X*l+Y*x+re*S+ne*z,t[7]=X*c+Y*w+re*A+ne*W,t[8]=(X=n[8])*i+(Y=n[9])*p+(re=n[10])*E+(ne=n[11])*R,t[9]=X*s+Y*m+re*D+ne*O,t[10]=X*l+Y*x+re*S+ne*z,t[11]=X*c+Y*w+re*A+ne*W,t[12]=(X=n[12])*i+(Y=n[13])*p+(re=n[14])*E+(ne=n[15])*R,t[13]=X*s+Y*m+re*D+ne*O,t[14]=X*l+Y*x+re*S+ne*z,t[15]=X*c+Y*w+re*A+ne*W,t}function bl(t,e,n){var i=e[0],s=e[1],l=e[2],c=e[3],p=i+i,m=s+s,x=l+l,w=i*p,E=i*m,D=i*x,S=s*m,A=s*x,R=l*x,O=c*p,z=c*m,W=c*x;return t[0]=1-(S+R),t[1]=E+W,t[2]=D-z,t[3]=0,t[4]=E-W,t[5]=1-(w+R),t[6]=A+O,t[7]=0,t[8]=D+z,t[9]=A-O,t[10]=1-(w+S),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Ks(t,e){var n=e[4],i=e[5],s=e[6],l=e[8],c=e[9],p=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,i,s),t[2]=Math.hypot(l,c,p),t}function bi(t,e,n,i,s){var l,c=1/Math.tan(e/2);return t[0]=c/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(t[10]=(s+i)*(l=1/(i-s)),t[14]=2*s*i*l):(t[10]=-1,t[14]=-2*i),t}function wi(t,e,n,i,s,l,c){var p=1/(e-n),m=1/(i-s),x=1/(l-c);return t[0]=-2*p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*x,t[11]=0,t[12]=(e+n)*p,t[13]=(s+i)*m,t[14]=(c+l)*x,t[15]=1,t}function wl(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}wt.perspective=bi,wt.ortho=wi,wt.mul=eu,wt.sub=wl;var bt={},Tt={};function Js(t){return Js=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Js(t)}Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.create=ea,Tt.clone=function(t){var e=new Gr.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Tt.length=ta,Tt.fromValues=function(t,e,n){var i=new Gr.ARRAY_TYPE(3);return i[0]=t,i[1]=e,i[2]=n,i},Tt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Tt.set=function(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t},Tt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},Tt.subtract=Tl,Tt.multiply=Po,Tt.divide=ss,Tt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Tt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Tt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},Tt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},Tt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Tt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},Tt.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t},Tt.distance=as,Tt.squaredDistance=El,Tt.squaredLength=na,Tt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Tt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Tt.normalize=function(t,e){var n=e[0],i=e[1],s=e[2],l=n*n+i*i+s*s;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t},Tt.dot=ra,Tt.cross=function(t,e,n){var i=e[0],s=e[1],l=e[2],c=n[0],p=n[1],m=n[2];return t[0]=s*m-l*p,t[1]=l*c-i*m,t[2]=i*p-s*c,t},Tt.lerp=function(t,e,n,i){var s=e[0],l=e[1],c=e[2];return t[0]=s+i*(n[0]-s),t[1]=l+i*(n[1]-l),t[2]=c+i*(n[2]-c),t},Tt.hermite=function(t,e,n,i,s,l){var c=l*l,p=c*(2*l-3)+1,m=c*(l-2)+l,x=c*(l-1),w=c*(3-2*l);return t[0]=e[0]*p+n[0]*m+i[0]*x+s[0]*w,t[1]=e[1]*p+n[1]*m+i[1]*x+s[1]*w,t[2]=e[2]*p+n[2]*m+i[2]*x+s[2]*w,t},Tt.bezier=function(t,e,n,i,s,l){var c=1-l,p=c*c,m=l*l,x=p*c,w=3*l*p,E=3*m*c,D=m*l;return t[0]=e[0]*x+n[0]*w+i[0]*E+s[0]*D,t[1]=e[1]*x+n[1]*w+i[1]*E+s[1]*D,t[2]=e[2]*x+n[2]*w+i[2]*E+s[2]*D,t},Tt.random=function(t,e){e=e||1;var n=2*Gr.RANDOM()*Math.PI,i=2*Gr.RANDOM()-1,s=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*s,t[1]=Math.sin(n)*s,t[2]=i*e,t},Tt.transformMat4=function(t,e,n){var i=e[0],s=e[1],l=e[2],c=n[3]*i+n[7]*s+n[11]*l+n[15];return t[0]=(n[0]*i+n[4]*s+n[8]*l+n[12])/(c=c||1),t[1]=(n[1]*i+n[5]*s+n[9]*l+n[13])/c,t[2]=(n[2]*i+n[6]*s+n[10]*l+n[14])/c,t},Tt.transformMat3=function(t,e,n){var i=e[0],s=e[1],l=e[2];return t[0]=i*n[0]+s*n[3]+l*n[6],t[1]=i*n[1]+s*n[4]+l*n[7],t[2]=i*n[2]+s*n[5]+l*n[8],t},Tt.transformQuat=function(t,e,n){var i=n[0],s=n[1],l=n[2],c=e[0],p=e[1],m=e[2],x=s*m-l*p,w=l*c-i*m,E=i*p-s*c,D=s*E-l*w,S=l*x-i*E,A=i*w-s*x,R=2*n[3];return w*=R,E*=R,S*=2,A*=2,t[0]=c+(x*=R)+(D*=2),t[1]=p+w+S,t[2]=m+E+A,t},Tt.rotateX=function(t,e,n,i){var s=[],l=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],l[0]=s[0],l[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),l[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=l[0]+n[0],t[1]=l[1]+n[1],t[2]=l[2]+n[2],t},Tt.rotateY=function(t,e,n,i){var s=[],l=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],l[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),l[1]=s[1],l[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=l[0]+n[0],t[1]=l[1]+n[1],t[2]=l[2]+n[2],t},Tt.rotateZ=function(t,e,n,i){var s=[],l=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],l[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),l[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),l[2]=s[2],t[0]=l[0]+n[0],t[1]=l[1]+n[1],t[2]=l[2]+n[2],t},Tt.angle=function(t,e){var n=t[0],i=t[1],s=t[2],l=e[0],c=e[1],p=e[2],m=Math.sqrt(n*n+i*i+s*s)*Math.sqrt(l*l+c*c+p*p),x=m&&ra(t,e)/m;return Math.acos(Math.min(Math.max(x,-1),1))},Tt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Tt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Tt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Tt.equals=function(t,e){var n=t[0],i=t[1],s=t[2],l=e[0],c=e[1],p=e[2];return Math.abs(n-l)<=Gr.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=Gr.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-p)<=Gr.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))},Tt.forEach=Tt.sqrLen=Tt.len=Tt.sqrDist=Tt.dist=Tt.div=Tt.mul=Tt.sub=void 0;var Gr=function(t,e){if(t&&t.__esModule)return t;if(t===null||Js(t)!=="object"&&typeof t!="function")return{default:t};var n=os(void 0);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var c=s?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(Ut);function os(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(os=function(i){return i?n:e})(t)}function ea(){var t=new Gr.ARRAY_TYPE(3);return Gr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ta(t){return Math.hypot(t[0],t[1],t[2])}function Tl(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Po(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ss(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function as(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function El(t,e){var n=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return n*n+i*i+s*s}function na(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function ra(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Tt.sub=Tl,Tt.mul=Po,Tt.div=ss,Tt.dist=as,Tt.sqrDist=El,Tt.len=ta,Tt.sqrLen=na;var ai,tu=(ai=ea(),function(t,e,n,i,s,l){var c,p;for(e||(e=3),n||(n=0),p=i?Math.min(i*e+n,t.length):t.length,c=n;c<p;c+=e)ai[0]=t[c],ai[1]=t[c+1],ai[2]=t[c+2],s(ai,ai,l),t[c]=ai[0],t[c+1]=ai[1],t[c+2]=ai[2];return t});Tt.forEach=tu;var Et={};function Il(t){return Il=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Il(t)}Object.defineProperty(Et,"__esModule",{value:!0}),Et.create=ls,Et.clone=function(t){var e=new Zn.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Et.fromValues=function(t,e,n,i){var s=new Zn.ARRAY_TYPE(4);return s[0]=t,s[1]=e,s[2]=n,s[3]=i,s},Et.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Et.set=function(t,e,n,i,s){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t},Et.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Et.subtract=Ni,Et.multiply=zi,Et.divide=Dl,Et.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Et.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Et.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},Et.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},Et.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Et.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Et.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},Et.distance=Ro,Et.squaredDistance=Lo,Et.length=oa,Et.squaredLength=sa,Et.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Et.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Et.normalize=function(t,e){var n=e[0],i=e[1],s=e[2],l=e[3],c=n*n+i*i+s*s+l*l;return c>0&&(c=1/Math.sqrt(c)),t[0]=n*c,t[1]=i*c,t[2]=s*c,t[3]=l*c,t},Et.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Et.cross=function(t,e,n,i){var s=n[0]*i[1]-n[1]*i[0],l=n[0]*i[2]-n[2]*i[0],c=n[0]*i[3]-n[3]*i[0],p=n[1]*i[2]-n[2]*i[1],m=n[1]*i[3]-n[3]*i[1],x=n[2]*i[3]-n[3]*i[2],w=e[0],E=e[1],D=e[2],S=e[3];return t[0]=E*x-D*m+S*p,t[1]=-w*x+D*c-S*l,t[2]=w*m-E*c+S*s,t[3]=-w*p+E*l-D*s,t},Et.lerp=function(t,e,n,i){var s=e[0],l=e[1],c=e[2],p=e[3];return t[0]=s+i*(n[0]-s),t[1]=l+i*(n[1]-l),t[2]=c+i*(n[2]-c),t[3]=p+i*(n[3]-p),t},Et.random=function(t,e){var n,i,s,l,c,p;e=e||1;do c=(n=2*Zn.RANDOM()-1)*n+(i=2*Zn.RANDOM()-1)*i;while(c>=1);do p=(s=2*Zn.RANDOM()-1)*s+(l=2*Zn.RANDOM()-1)*l;while(p>=1);var m=Math.sqrt((1-c)/p);return t[0]=e*n,t[1]=e*i,t[2]=e*s*m,t[3]=e*l*m,t},Et.transformMat4=function(t,e,n){var i=e[0],s=e[1],l=e[2],c=e[3];return t[0]=n[0]*i+n[4]*s+n[8]*l+n[12]*c,t[1]=n[1]*i+n[5]*s+n[9]*l+n[13]*c,t[2]=n[2]*i+n[6]*s+n[10]*l+n[14]*c,t[3]=n[3]*i+n[7]*s+n[11]*l+n[15]*c,t},Et.transformQuat=function(t,e,n){var i=e[0],s=e[1],l=e[2],c=n[0],p=n[1],m=n[2],x=n[3],w=x*i+p*l-m*s,E=x*s+m*i-c*l,D=x*l+c*s-p*i,S=-c*i-p*s-m*l;return t[0]=w*x+S*-c+E*-m-D*-p,t[1]=E*x+S*-p+D*-c-w*-m,t[2]=D*x+S*-m+w*-p-E*-c,t[3]=e[3],t},Et.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Et.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Et.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Et.equals=function(t,e){var n=t[0],i=t[1],s=t[2],l=t[3],c=e[0],p=e[1],m=e[2],x=e[3];return Math.abs(n-c)<=Zn.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-p)<=Zn.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(s-m)<=Zn.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(l-x)<=Zn.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))},Et.forEach=Et.sqrLen=Et.len=Et.sqrDist=Et.dist=Et.div=Et.mul=Et.sub=void 0;var Zn=function(t,e){if(t&&t.__esModule)return t;if(t===null||Il(t)!=="object"&&typeof t!="function")return{default:t};var n=ia(void 0);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var c=s?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(Ut);function ia(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ia=function(i){return i?n:e})(t)}function ls(){var t=new Zn.ARRAY_TYPE(4);return Zn.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ni(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function zi(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Dl(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Ro(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function Lo(t,e){var n=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],l=e[3]-t[3];return n*n+i*i+s*s+l*l}function oa(t){return Math.hypot(t[0],t[1],t[2],t[3])}function sa(t){var e=t[0],n=t[1],i=t[2],s=t[3];return e*e+n*n+i*i+s*s}Et.sub=Ni,Et.mul=zi,Et.div=Dl,Et.dist=Ro,Et.sqrDist=Lo,Et.len=oa,Et.sqrLen=sa;var nu=function(){var t=ls();return function(e,n,i,s,l,c){var p,m;for(n||(n=4),i||(i=0),m=s?Math.min(s*n+i,e.length):e.length,p=i;p<m;p+=n)t[0]=e[p],t[1]=e[p+1],t[2]=e[p+2],t[3]=e[p+3],l(t,t,c),e[p]=t[0],e[p+1]=t[1],e[p+2]=t[2],e[p+3]=t[3];return e}}();function aa(t){return aa=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},aa(t)}Et.forEach=nu,Object.defineProperty(bt,"__esModule",{value:!0}),bt.create=la,bt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},bt.setAxisAngle=Ml,bt.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),i=Math.sin(n/2);return i>li.EPSILON?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),n},bt.getAngle=function(t,e){var n=le(t,e);return Math.acos(2*n*n-1)},bt.multiply=ca,bt.rotateX=function(t,e,n){n*=.5;var i=e[0],s=e[1],l=e[2],c=e[3],p=Math.sin(n),m=Math.cos(n);return t[0]=i*m+c*p,t[1]=s*m+l*p,t[2]=l*m-s*p,t[3]=c*m-i*p,t},bt.rotateY=function(t,e,n){n*=.5;var i=e[0],s=e[1],l=e[2],c=e[3],p=Math.sin(n),m=Math.cos(n);return t[0]=i*m-l*p,t[1]=s*m+c*p,t[2]=l*m+i*p,t[3]=c*m-s*p,t},bt.rotateZ=function(t,e,n){n*=.5;var i=e[0],s=e[1],l=e[2],c=e[3],p=Math.sin(n),m=Math.cos(n);return t[0]=i*m+s*p,t[1]=s*m-i*p,t[2]=l*m+c*p,t[3]=c*m-l*p,t},bt.calculateW=function(t,e){var n=e[0],i=e[1],s=e[2];return t[0]=n,t[1]=i,t[2]=s,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-s*s)),t},bt.exp=fe,bt.ln=B,bt.pow=function(t,e,n){return B(t,e),se(t,t,n),fe(t,t),t},bt.slerp=H,bt.random=function(t){var e=li.RANDOM(),n=li.RANDOM(),i=li.RANDOM(),s=Math.sqrt(1-e),l=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*n),t[1]=s*Math.cos(2*Math.PI*n),t[2]=l*Math.sin(2*Math.PI*i),t[3]=l*Math.cos(2*Math.PI*i),t},bt.invert=function(t,e){var n=e[0],i=e[1],s=e[2],l=e[3],c=n*n+i*i+s*s+l*l,p=c?1/c:0;return t[0]=-n*p,t[1]=-i*p,t[2]=-s*p,t[3]=l*p,t},bt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},bt.fromMat3=te,bt.fromEuler=function(t,e,n,i){var s=.5*Math.PI/180;e*=s,n*=s,i*=s;var l=Math.sin(e),c=Math.cos(e),p=Math.sin(n),m=Math.cos(n),x=Math.sin(i),w=Math.cos(i);return t[0]=l*m*w-c*p*x,t[1]=c*p*w+l*m*x,t[2]=c*m*x-l*p*w,t[3]=c*m*w+l*p*x,t},bt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},bt.setAxes=bt.sqlerp=bt.rotationTo=bt.equals=bt.exactEquals=bt.normalize=bt.sqrLen=bt.squaredLength=bt.len=bt.length=bt.lerp=bt.dot=bt.scale=bt.mul=bt.add=bt.set=bt.copy=bt.fromValues=bt.clone=void 0;var li=cs(Ut),Oo=cs(fn),ci=cs(Tt),gr=cs(Et);function ru(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ru=function(i){return i?n:e})(t)}function cs(t,e){if(t&&t.__esModule)return t;if(t===null||aa(t)!=="object"&&typeof t!="function")return{default:t};var n=ru(e);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var c=s?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}function la(){var t=new li.ARRAY_TYPE(4);return li.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ml(t,e,n){n*=.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function ca(t,e,n){var i=e[0],s=e[1],l=e[2],c=e[3],p=n[0],m=n[1],x=n[2],w=n[3];return t[0]=i*w+c*p+s*x-l*m,t[1]=s*w+c*m+l*p-i*x,t[2]=l*w+c*x+i*m-s*p,t[3]=c*w-i*p-s*m-l*x,t}function fe(t,e){var n=e[0],i=e[1],s=e[2],l=e[3],c=Math.sqrt(n*n+i*i+s*s),p=Math.exp(l),m=c>0?p*Math.sin(c)/c:0;return t[0]=n*m,t[1]=i*m,t[2]=s*m,t[3]=p*Math.cos(c),t}function B(t,e){var n=e[0],i=e[1],s=e[2],l=e[3],c=Math.sqrt(n*n+i*i+s*s),p=c>0?Math.atan2(c,l)/c:0;return t[0]=n*p,t[1]=i*p,t[2]=s*p,t[3]=.5*Math.log(n*n+i*i+s*s+l*l),t}function H(t,e,n,i){var s,l,c,p,m,x=e[0],w=e[1],E=e[2],D=e[3],S=n[0],A=n[1],R=n[2],O=n[3];return(l=x*S+w*A+E*R+D*O)<0&&(l=-l,S=-S,A=-A,R=-R,O=-O),1-l>li.EPSILON?(s=Math.acos(l),c=Math.sin(s),p=Math.sin((1-i)*s)/c,m=Math.sin(i*s)/c):(p=1-i,m=i),t[0]=p*x+m*S,t[1]=p*w+m*A,t[2]=p*E+m*R,t[3]=p*D+m*O,t}function te(t,e){var n,i=e[0]+e[4]+e[8];if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);var l=(s+1)%3,c=(s+2)%3;n=Math.sqrt(e[3*s+s]-e[3*l+l]-e[3*c+c]+1),t[s]=.5*n,t[3]=(e[3*l+c]-e[3*c+l])*(n=.5/n),t[l]=(e[3*l+s]+e[3*s+l])*n,t[c]=(e[3*c+s]+e[3*s+c])*n}return t}bt.clone=gr.clone,bt.fromValues=gr.fromValues,bt.copy=gr.copy,bt.set=gr.set,bt.add=gr.add,bt.mul=ca;var se=gr.scale;bt.scale=se;var le=gr.dot;bt.dot=le,bt.lerp=gr.lerp;var xe=gr.length;bt.length=xe,bt.len=xe;var Ie=gr.squaredLength;bt.squaredLength=Ie,bt.sqrLen=Ie;var ge=gr.normalize;bt.normalize=ge,bt.exactEquals=gr.exactEquals,bt.equals=gr.equals;var Me,Xe,$e,ut=(Me=ci.create(),Xe=ci.fromValues(1,0,0),$e=ci.fromValues(0,1,0),function(t,e,n){var i=ci.dot(e,n);return i<-.999999?(ci.cross(Me,Xe,e),ci.len(Me)<1e-6&&ci.cross(Me,$e,e),ci.normalize(Me,Me),Ml(t,Me,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ci.cross(Me,e,n),t[0]=Me[0],t[1]=Me[1],t[2]=Me[2],t[3]=1+i,ge(t,t))});bt.rotationTo=ut;var yt,Ft,Nt=(yt=la(),Ft=la(),function(t,e,n,i,s,l){return H(yt,e,s,l),H(Ft,n,i,l),H(t,yt,Ft,2*l*(1-l)),t});bt.sqlerp=Nt;var Ct,Xt=(Ct=Oo.create(),function(t,e,n,i){return Ct[0]=n[0],Ct[3]=n[1],Ct[6]=n[2],Ct[1]=i[0],Ct[4]=i[1],Ct[7]=i[2],Ct[2]=-e[0],Ct[5]=-e[1],Ct[8]=-e[2],ge(t,te(t,Ct))});bt.setAxes=Xt;var lt={};function Nn(t){return Nn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nn(t)}Object.defineProperty(lt,"__esModule",{value:!0}),lt.create=function(){var t=new mn.ARRAY_TYPE(8);return mn.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},lt.clone=function(t){var e=new mn.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},lt.fromValues=function(t,e,n,i,s,l,c,p){var m=new mn.ARRAY_TYPE(8);return m[0]=t,m[1]=e,m[2]=n,m[3]=i,m[4]=s,m[5]=l,m[6]=c,m[7]=p,m},lt.fromRotationTranslationValues=function(t,e,n,i,s,l,c){var p=new mn.ARRAY_TYPE(8);p[0]=t,p[1]=e,p[2]=n,p[3]=i;var m=.5*s,x=.5*l,w=.5*c;return p[4]=m*i+x*n-w*e,p[5]=x*i+w*t-m*n,p[6]=w*i+m*e-x*t,p[7]=-m*t-x*e-w*n,p},lt.fromRotationTranslation=Tr,lt.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},lt.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},lt.fromMat4=function(t,e){var n=Kt.create();er.getRotation(n,e);var i=new mn.ARRAY_TYPE(3);return er.getTranslation(i,e),Tr(t,n,i),t},lt.copy=Er,lt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},lt.set=function(t,e,n,i,s,l,c,p,m){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t[4]=l,t[5]=c,t[6]=p,t[7]=m,t},lt.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},lt.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},lt.getTranslation=function(t,e){var n=e[4],i=e[5],s=e[6],l=e[7],c=-e[0],p=-e[1],m=-e[2],x=e[3];return t[0]=2*(n*x+l*c+i*m-s*p),t[1]=2*(i*x+l*p+s*c-n*m),t[2]=2*(s*x+l*m+n*p-i*c),t},lt.translate=function(t,e,n){var i=e[0],s=e[1],l=e[2],c=e[3],p=.5*n[0],m=.5*n[1],x=.5*n[2],w=e[4],E=e[5],D=e[6],S=e[7];return t[0]=i,t[1]=s,t[2]=l,t[3]=c,t[4]=c*p+s*x-l*m+w,t[5]=c*m+l*p-i*x+E,t[6]=c*x+i*m-s*p+D,t[7]=-i*p-s*m-l*x+S,t},lt.rotateX=function(t,e,n){var i=-e[0],s=-e[1],l=-e[2],c=e[3],p=e[4],m=e[5],x=e[6],w=e[7],E=p*c+w*i+m*l-x*s,D=m*c+w*s+x*i-p*l,S=x*c+w*l+p*s-m*i,A=w*c-p*i-m*s-x*l;return Kt.rotateX(t,e,n),t[4]=E*(c=t[3])+A*(i=t[0])+D*(l=t[2])-S*(s=t[1]),t[5]=D*c+A*s+S*i-E*l,t[6]=S*c+A*l+E*s-D*i,t[7]=A*c-E*i-D*s-S*l,t},lt.rotateY=function(t,e,n){var i=-e[0],s=-e[1],l=-e[2],c=e[3],p=e[4],m=e[5],x=e[6],w=e[7],E=p*c+w*i+m*l-x*s,D=m*c+w*s+x*i-p*l,S=x*c+w*l+p*s-m*i,A=w*c-p*i-m*s-x*l;return Kt.rotateY(t,e,n),t[4]=E*(c=t[3])+A*(i=t[0])+D*(l=t[2])-S*(s=t[1]),t[5]=D*c+A*s+S*i-E*l,t[6]=S*c+A*l+E*s-D*i,t[7]=A*c-E*i-D*s-S*l,t},lt.rotateZ=function(t,e,n){var i=-e[0],s=-e[1],l=-e[2],c=e[3],p=e[4],m=e[5],x=e[6],w=e[7],E=p*c+w*i+m*l-x*s,D=m*c+w*s+x*i-p*l,S=x*c+w*l+p*s-m*i,A=w*c-p*i-m*s-x*l;return Kt.rotateZ(t,e,n),t[4]=E*(c=t[3])+A*(i=t[0])+D*(l=t[2])-S*(s=t[1]),t[5]=D*c+A*s+S*i-E*l,t[6]=S*c+A*l+E*s-D*i,t[7]=A*c-E*i-D*s-S*l,t},lt.rotateByQuatAppend=function(t,e,n){var i=n[0],s=n[1],l=n[2],c=n[3],p=e[0],m=e[1],x=e[2],w=e[3];return t[0]=p*c+w*i+m*l-x*s,t[1]=m*c+w*s+x*i-p*l,t[2]=x*c+w*l+p*s-m*i,t[3]=w*c-p*i-m*s-x*l,t[4]=(p=e[4])*c+(w=e[7])*i+(m=e[5])*l-(x=e[6])*s,t[5]=m*c+w*s+x*i-p*l,t[6]=x*c+w*l+p*s-m*i,t[7]=w*c-p*i-m*s-x*l,t},lt.rotateByQuatPrepend=function(t,e,n){var i=e[0],s=e[1],l=e[2],c=e[3],p=n[0],m=n[1],x=n[2],w=n[3];return t[0]=i*w+c*p+s*x-l*m,t[1]=s*w+c*m+l*p-i*x,t[2]=l*w+c*x+i*m-s*p,t[3]=c*w-i*p-s*m-l*x,t[4]=i*(w=n[7])+c*(p=n[4])+s*(x=n[6])-l*(m=n[5]),t[5]=s*w+c*m+l*p-i*x,t[6]=l*w+c*x+i*m-s*p,t[7]=c*w-i*p-s*m-l*x,t},lt.rotateAroundAxis=function(t,e,n,i){if(Math.abs(i)<mn.EPSILON)return Er(t,e);var s=Math.hypot(n[0],n[1],n[2]);i*=.5;var l=Math.sin(i),c=l*n[0]/s,p=l*n[1]/s,m=l*n[2]/s,x=Math.cos(i),w=e[0],E=e[1],D=e[2],S=e[3];t[0]=w*x+S*c+E*m-D*p,t[1]=E*x+S*p+D*c-w*m,t[2]=D*x+S*m+w*p-E*c,t[3]=S*x-w*c-E*p-D*m;var A=e[4],R=e[5],O=e[6],z=e[7];return t[4]=A*x+z*c+R*m-O*p,t[5]=R*x+z*p+O*c-A*m,t[6]=O*x+z*m+A*p-R*c,t[7]=z*x-A*c-R*p-O*m,t},lt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},lt.multiply=us,lt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},lt.lerp=function(t,e,n,i){var s=1-i;return jh(e,n)<0&&(i=-i),t[0]=e[0]*s+n[0]*i,t[1]=e[1]*s+n[1]*i,t[2]=e[2]*s+n[2]*i,t[3]=e[3]*s+n[3]*i,t[4]=e[4]*s+n[4]*i,t[5]=e[5]*s+n[5]*i,t[6]=e[6]*s+n[6]*i,t[7]=e[7]*s+n[7]*i,t},lt.invert=function(t,e){var n=Cl(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},lt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},lt.normalize=function(t,e){var n=Cl(e);if(n>0){n=Math.sqrt(n);var i=e[0]/n,s=e[1]/n,l=e[2]/n,c=e[3]/n,p=e[4],m=e[5],x=e[6],w=e[7],E=i*p+s*m+l*x+c*w;t[0]=i,t[1]=s,t[2]=l,t[3]=c,t[4]=(p-i*E)/n,t[5]=(m-s*E)/n,t[6]=(x-l*E)/n,t[7]=(w-c*E)/n}return t},lt.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},lt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},lt.equals=function(t,e){var n=t[0],i=t[1],s=t[2],l=t[3],c=t[4],p=t[5],m=t[6],x=t[7],w=e[0],E=e[1],D=e[2],S=e[3],A=e[4],R=e[5],O=e[6],z=e[7];return Math.abs(n-w)<=mn.EPSILON*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(i-E)<=mn.EPSILON*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(s-D)<=mn.EPSILON*Math.max(1,Math.abs(s),Math.abs(D))&&Math.abs(l-S)<=mn.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-A)<=mn.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(p-R)<=mn.EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(m-O)<=mn.EPSILON*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(x-z)<=mn.EPSILON*Math.max(1,Math.abs(x),Math.abs(z))},lt.sqrLen=lt.squaredLength=lt.len=lt.length=lt.dot=lt.mul=lt.setReal=lt.getReal=void 0;var mn=sr(Ut),Kt=sr(bt),er=sr(wt);function zn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(zn=function(i){return i?n:e})(t)}function sr(t,e){if(t&&t.__esModule)return t;if(t===null||Nn(t)!=="object"&&typeof t!="function")return{default:t};var n=zn(e);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var c=s?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}function Tr(t,e,n){var i=.5*n[0],s=.5*n[1],l=.5*n[2],c=e[0],p=e[1],m=e[2],x=e[3];return t[0]=c,t[1]=p,t[2]=m,t[3]=x,t[4]=i*x+s*m-l*p,t[5]=s*x+l*c-i*m,t[6]=l*x+i*p-s*c,t[7]=-i*c-s*p-l*m,t}function Er(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function us(t,e,n){var i=e[0],s=e[1],l=e[2],c=e[3],p=n[4],m=n[5],x=n[6],w=n[7],E=e[4],D=e[5],S=e[6],A=e[7],R=n[0],O=n[1],z=n[2],W=n[3];return t[0]=i*W+c*R+s*z-l*O,t[1]=s*W+c*O+l*R-i*z,t[2]=l*W+c*z+i*O-s*R,t[3]=c*W-i*R-s*O-l*z,t[4]=i*w+c*p+s*x-l*m+E*W+A*R+D*z-S*O,t[5]=s*w+c*m+l*p-i*x+D*W+A*O+S*R-E*z,t[6]=l*w+c*x+i*m-s*p+S*W+A*z+E*O-D*R,t[7]=c*w-i*p-s*m-l*x+A*W-E*R-D*O-S*z,t}lt.getReal=Kt.copy,lt.setReal=Kt.copy,lt.mul=us;var jh=Kt.dot;lt.dot=jh;var gp=Kt.length;lt.length=gp,lt.len=gp;var Cl=Kt.squaredLength;lt.squaredLength=Cl,lt.sqrLen=Cl;var Ot={};function Uh(t){return Uh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Uh(t)}Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.create=$h,Ot.clone=function(t){var e=new ko.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Ot.fromValues=function(t,e){var n=new ko.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},Ot.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Ot.set=function(t,e,n){return t[0]=e,t[1]=n,t},Ot.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},Ot.subtract=Hh,Ot.multiply=qh,Ot.divide=Wh,Ot.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Ot.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Ot.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},Ot.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},Ot.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Ot.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},Ot.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t},Ot.distance=Zh,Ot.squaredDistance=Xh,Ot.length=Yh,Ot.squaredLength=Qh,Ot.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Ot.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Ot.normalize=function(t,e){var n=e[0],i=e[1],s=n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t},Ot.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Ot.cross=function(t,e,n){var i=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=i,t},Ot.lerp=function(t,e,n,i){var s=e[0],l=e[1];return t[0]=s+i*(n[0]-s),t[1]=l+i*(n[1]-l),t},Ot.random=function(t,e){e=e||1;var n=2*ko.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},Ot.transformMat2=function(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[2]*s,t[1]=n[1]*i+n[3]*s,t},Ot.transformMat2d=function(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[2]*s+n[4],t[1]=n[1]*i+n[3]*s+n[5],t},Ot.transformMat3=function(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[3]*s+n[6],t[1]=n[1]*i+n[4]*s+n[7],t},Ot.transformMat4=function(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[4]*s+n[12],t[1]=n[1]*i+n[5]*s+n[13],t},Ot.rotate=function(t,e,n,i){var s=e[0]-n[0],l=e[1]-n[1],c=Math.sin(i),p=Math.cos(i);return t[0]=s*p-l*c+n[0],t[1]=s*c+l*p+n[1],t},Ot.angle=function(t,e){var n=t[0],i=t[1],s=e[0],l=e[1],c=Math.sqrt(n*n+i*i)*Math.sqrt(s*s+l*l);return Math.acos(Math.min(Math.max(c&&(n*s+i*l)/c,-1),1))},Ot.zero=function(t){return t[0]=0,t[1]=0,t},Ot.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Ot.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Ot.equals=function(t,e){var n=t[0],i=t[1],s=e[0],l=e[1];return Math.abs(n-s)<=ko.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-l)<=ko.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))},Ot.forEach=Ot.sqrLen=Ot.sqrDist=Ot.dist=Ot.div=Ot.mul=Ot.sub=Ot.len=void 0;var ko=function(t,e){if(t&&t.__esModule)return t;if(t===null||Uh(t)!=="object"&&typeof t!="function")return{default:t};var n=Gh(void 0);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var c=s?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(Ut);function Gh(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Gh=function(i){return i?n:e})(t)}function $h(){var t=new ko.ARRAY_TYPE(2);return ko.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function Hh(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function qh(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function Wh(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function Zh(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Xh(t,e){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i}function Yh(t){return Math.hypot(t[0],t[1])}function Qh(t){var e=t[0],n=t[1];return e*e+n*n}Ot.len=Yh,Ot.sub=Hh,Ot.mul=qh,Ot.div=Wh,Ot.dist=Zh,Ot.sqrDist=Xh,Ot.sqrLen=Qh;var _p=function(){var t=$h();return function(e,n,i,s,l,c){var p,m;for(n||(n=2),i||(i=0),m=s?Math.min(s*n+i,e.length):e.length,p=i;p<m;p+=n)t[0]=e[p],t[1]=e[p+1],l(t,t,c),e[p]=t[0],e[p+1]=t[1];return e}}();function ua(t){return ua=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ua(t)}Ot.forEach=_p,Object.defineProperty(an,"__esModule",{value:!0}),o.aA=an.vec4=o._=an.vec3=an.vec2=an.quat2=o.av=an.quat=o.ad=an.mat4=o.bC=an.mat3=an.mat2d=o.aC=an.mat2=an.glMatrix=void 0;var iu=Bi(Ut);an.glMatrix=iu;var ou=Bi(cn);o.aC=an.mat2=ou;var yp=Bi(bn);an.mat2d=yp;var xp=Bi(fn);o.bC=an.mat3=xp;var vp=Bi(wt);o.ad=an.mat4=vp;var ha=Bi(bt);o.av=an.quat=ha;var Ht=Bi(lt);an.quat2=Ht;var H_=Bi(Ot);an.vec2=H_;var q_=Bi(Tt);o._=an.vec3=q_;var W_=Bi(Et);function Kh(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Kh=function(i){return i?n:e})(t)}function Bi(t,e){if(t&&t.__esModule)return t;if(t===null||ua(t)!=="object"&&typeof t!="function")return{default:t};var n=Kh(e);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var c=s?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}o.aA=an.vec4=W_;var Jh=Sl;function Sl(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=i}Sl.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,i=0;i<8;i++){var s=this.sampleCurveX(n)-t;if(Math.abs(s)<e)return n;var l=this.sampleCurveDerivativeX(n);if(Math.abs(l)<1e-6)break;n-=s/l}var c=0,p=1;for(n=t,i=0;i<20&&(s=this.sampleCurveX(n),!(Math.abs(s-t)<e));i++)t>s?c=n:p=n,n=.5*(p-c)+c;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Al=Rt(Jh),su=da;function da(t,e){this.x=t,this.y=e}da.prototype={clone:function(){return new da(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),i=Math.sin(t),s=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-i*(this.y-e.y),this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},da.convert=function(t){return t instanceof da?t:Array.isArray(t)?new da(t[0],t[1]):t};var tt=Rt(su);let ed=Math.PI/180,au=180/Math.PI;function qt(t){return t*ed}function Ar(t){return t*au}let bp=[[0,0],[1,0],[1,1],[0,1]];function Pl(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function hs(t,e,n,i){let s=new Al(t,e,n,i);return function(l){return s.solve(l)}}let Z_=hs(.25,.1,.25,1);function St(t,e,n){return Math.min(n,Math.max(e,t))}function Rl(t,e,n){return(n=St((n-t)/(e-t),0,1))*n*(3-2*n)}function ds(t,e,n){let i=n-e,s=((t-e)%i+i)%i+e;return s===e?n:s}function $r(t,e,n){if(!t.length)return n(null,[]);let i=t.length,s=new Array(t.length),l=null;t.forEach((c,p)=>{e(c,(m,x)=>{m&&(l=m),s[p]=x,--i==0&&n(l,s)})})}function td(t){let e=[];for(let n in t)e.push(t[n]);return e}function Pr(t,...e){for(let n of e)for(let i in n)t[i]=n[i];return t}let wp=1;function lu(){return wp++}function cu(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function nd(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function rd(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function uu(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function fs(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Fo(t,e,n){let i={};for(let s in t)i[s]=e.call(this,t[s],s,t);return i}function id(t,e,n){let i={};for(let s in t)e.call(this,t[s],s,t)&&(i[s]=t[s]);return i}function Vi(t){return Array.isArray(t)?t.map(Vi):typeof t=="object"&&t?Fo(t,Vi):t}let od={};function Qn(t){od[t]||(typeof console<"u"&&console.warn(t),od[t]=!0)}function rr(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function ps(t){let e=0;for(let n,i,s=0,l=t.length,c=l-1;s<l;c=s++)n=t[s],i=t[c],e+=(i.x-n.x)*(n.y+i.y);return e}function Rr([t,e,n]){let i=qt(e+90),s=qt(n);return{x:t*Math.cos(i)*Math.sin(s),y:t*Math.sin(i)*Math.sin(s),z:t*Math.cos(s),azimuthal:e,polar:n}}function Ll(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function sd(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,i,s,l)=>{let c=s||l;return e[i]=!c||c.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let ad,ms,hu,fa,gs,pa,No=null;function ld(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ol(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Tp(t,e,n,i){for(;e<n;){let s=e+n>>1;t[s]<i?e=s+1:n=s}return e}function du(t,e,n,i){for(;e<n;){let s=e+n>>1;t[s]<=i?e=s+1:n=s}return e}function fu(t){return t>0?1/(1.001-t):1+t}function ma(t){return t>0?1-1/(1.001-t):-t}function pu(){return ad==null&&(ad=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ad}let _r={now:()=>fa!==void 0?fa:performance.now(),setNow(t){fa=t},restoreNow(){fa=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:n,height:i}=t;gs||(gs=document.createElement("canvas"));let s=gs.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return(n>gs.width||i>gs.height)&&(gs.width=n,gs.height=i),s.clearRect(-e,-e,n+2*e,i+2*e),s.drawImage(t,0,0,n,i),s.getImageData(-e,-e,n+2*e,i+2*e)},resolveURL:t=>(ms||(ms=document.createElement("a")),ms.href=t,ms.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(hu==null&&(hu=window.matchMedia("(prefers-reduced-motion: reduce)")),hu.matches)},hasCanvasFingerprintNoise(){if(pa!==void 0)return pa;if(!pu())return pa=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),n=0;for(let s=0;s<t.width;++s)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(s,0,1,1);let i=e.getImageData(0,0,t.width,t.height);n=0;for(let s=0;s<i.data.length;++s)if(s%4!=3&&n++!==i.data[s])return pa=!0,!0;return pa=!1,!1}};function Ep(t,e){let n=t.indexOf("?");if(n<0)return`${t}?${new URLSearchParams(e).toString()}`;let i=new URLSearchParams(t.slice(n));for(let s in e)i.set(s,e[s]);return`${t.slice(0,n)}?${i.toString()}`}function cd(t,e={persistentParams:[]}){let n=t.indexOf("?");if(n<0)return t;let i=new URLSearchParams,s=new URLSearchParams(t.slice(n));for(let c of e.persistentParams){let p=s.get(c);p&&i.set(c,p)}let l=i.toString();return`${t.slice(0,n)}${l.length>0?`?${l}`:""}`}let ud="mapbox-tiles",hd=500,Ip=50,no,mu;function dd(){try{return caches}catch{}}function kl(){let t=dd();t&&!no&&(no=t.open(ud))}let fd=1/0,Fl={supported:!1,testSupport:function(t){!gu&&ga&&(pd?Mp(t):Nl=t)}},Nl,ga,gu=!1,pd=!1,Dp=typeof self<"u"?self:{};function Mp(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ga),t.isContextLost())return;Fl.supported=!0}catch{}t.deleteTexture(e),gu=!0}Dp.document&&(ga=Dp.document.createElement("img"),ga.onload=function(){Nl&&Mp(Nl),Nl=null,pd=!0},ga.onerror=function(){gu=!0,Nl=null},ga.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let _u={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(_u);class yu extends Error{constructor(e,n,i){n===401&&me(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let md=Ll()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,zl=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(md())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(i,s){let l=new AbortController,c=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:md(),referrerPolicy:i.referrerPolicy,signal:l.signal}),p=!1,m=!1,x=(w=c.url).indexOf("sku=")>0&&me(w);var w;i.type==="json"&&c.headers.set("Accept","application/json");let E=(S,A,R)=>{if(m)return;if(S&&S.message!=="SecurityError"&&Qn(S.toString()),A&&R)return D(A);let O=Date.now();fetch(c).then(z=>{if(z.ok){let W=x?z.clone():null;return D(z,W,O)}return s(new yu(z.statusText,z.status,i.url))}).catch(z=>{z.name!=="AbortError"&&s(new Error(`${z.message} ${i.url}`))})},D=(S,A,R)=>{(i.type==="arrayBuffer"?S.arrayBuffer():i.type==="json"?S.json():S.text()).then(O=>{m||(A&&R&&function(z,W,X){if(kl(),!no)return;let Y=sd(W.headers.get("Cache-Control")||"");if(Y["no-store"])return;let re={status:W.status,statusText:W.statusText,headers:new Headers};W.headers.forEach((de,ve)=>re.headers.set(ve,de)),Y["max-age"]&&re.headers.set("Expires",new Date(X+1e3*Y["max-age"]).toUTCString());let ne=re.headers.get("Expires");if(!ne||new Date(ne).getTime()-X<42e4)return;let ue=cd(z.url,{persistentParams:["language","worldview"]});if(W.status===206){let de=z.headers.get("Range");if(!de)return;re.status=200,ue=Ep(ue,{range:de})}(function(de,ve){if(mu===void 0)try{new Response(new ReadableStream),mu=!0}catch{mu=!1}mu?ve(de.body):de.blob().then(ve)})(W,de=>{let ve=new Response((Ce=W.status)!==200&&Ce!==404&&[101,103,204,205,304].includes(Ce)?null:de,re);var Ce;kl(),no&&no.then(Te=>Te.put(ue,ve)).catch(Te=>Qn(Te.message))})}(c,A,R),p=!0,s(null,O,S.headers.get("Cache-Control"),S.headers.get("Expires")))}).catch(O=>{m||s(new Error(O.message))})};return x?function(S,A){if(kl(),!no)return A(null);no.then(R=>{let O=cd(S.url,{persistentParams:["language","worldview"]}),z=S.headers.get("Range");z&&(O=Ep(O,{range:z})),R.match(O).then(W=>{let X=function(Y){if(!Y)return!1;let re=new Date(Y.headers.get("Expires")||0),ne=sd(Y.headers.get("Cache-Control")||"");return re>Date.now()&&!ne["no-cache"]}(W);R.delete(O),X&&R.put(O,W.clone()),A(null,W,X)}).catch(A)}).catch(A)}(c,E):E(null,null),{cancel:()=>{m=!0,p||l.abort()}}}(t,e);if(Ll()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(i,s){let l=new XMLHttpRequest;l.open(i.method||"GET",i.url,!0),i.type==="arrayBuffer"&&(l.responseType="arraybuffer");for(let c in i.headers)l.setRequestHeader(c,i.headers[c]);return i.type==="json"&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials=i.credentials==="include",l.onerror=()=>{s(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let c=l.response;if(i.type==="json")try{c=JSON.parse(l.response)}catch(p){return s(p)}s(null,c,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else s(new yu(l.statusText,l.status,i.url))},l.send(i.body),{cancel:()=>l.abort()}}(t,e)},zo=function(t,e){return zl(Pr(t,{type:"arrayBuffer"}),e)};function Cp(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let gd="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",xu,ji;xu=[],ji=0;let _d=function(t,e){if(Fl.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ji>=Z.MAX_PARALLEL_IMAGE_REQUESTS){let l={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return xu.push(l),l}ji++;let n=!1,i=()=>{if(!n)for(n=!0,ji--;xu.length&&ji<Z.MAX_PARALLEL_IMAGE_REQUESTS;){let l=xu.shift(),{requestParameters:c,callback:p,cancelled:m}=l;m||(l.cancel=_d(c,p).cancel)}},s=zo(t,(l,c,p,m)=>{i(),l?e(l):c&&(self.createImageBitmap?function(x,w){let E=new Blob([new Uint8Array(x)],{type:"image/png"});createImageBitmap(E).then(D=>{w(null,D)}).catch(D=>{w(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(c,(x,w)=>e(x,w,p,m)):function(x,w){let E=new Image;E.onload=()=>{w(null,E),URL.revokeObjectURL(E.src),E.onload=null,requestAnimationFrame(()=>{E.src=gd})},E.onerror=()=>w(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let D=new Blob([new Uint8Array(x)],{type:"image/png"});E.src=x.byteLength?URL.createObjectURL(D):gd}(c,(x,w)=>e(x,w,p,m)))});return{cancel:()=>{s.cancel(),i()}}},yd="01",xd="NO_ACCESS_TOKEN",Sp=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ti(t){let e=t.match(Sp);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function _s(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let Ap="mapbox.eventData";function Pp(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Bl{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=Pp(Z.ACCESS_TOKEN),i="";return i=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(s,l)=>String.fromCharCode(+("0x"+l)))):Z.ACCESS_TOKEN||"",e?`${Ap}.${e}:${i}`:`${Ap}:${i}`}fetchEventData(){let e=ld("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{let s=localStorage.getItem(n);s&&(this.eventData=JSON.parse(s));let l=localStorage.getItem(i);l&&(this.anonId=l)}catch{Qn("Unable to read from LocalStorage")}}saveEventData(){let e=ld("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid"),s=this.anonId;if(e&&s)try{localStorage.setItem(i,s),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Qn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,i,s){if(!Z.EVENTS_URL)return;let l=Ti(Z.EVENTS_URL);l.params.push(`access_token=${s||Z.ACCESS_TOKEN||""}`);let c={event:this.type,created:new Date(e).toISOString()},p=n?Pr(c,n):c,m={url:_s(l),headers:{"Content-Type":"text/plain"},body:JSON.stringify([p])};this.pendingRequest=function(x,w){return zl(Pr(x,{method:"POST"}),w)}(m,x=>{this.pendingRequest=null,i(x),this.saveEventData(),this.processRequests(s)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let vu=new class extends Bl{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Z.EVENTS_URL&&Z.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>ye(n)||me(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=Pp(Z.ACCESS_TOKEN),n=e?e.u:Z.ACCESS_TOKEN,i=n!==this.eventData.tokenU;rd(this.anonId)||(this.anonId=cu(),i=!0);let s=this.queue.shift();if(this.eventData.lastSuccess){let l=new Date(this.eventData.lastSuccess),c=new Date(s),p=(s-this.eventData.lastSuccess)/864e5;i=i||p>=1||p<-1||l.getDate()!==c.getDate()}else i=!0;i?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:yd,"enabled.telemetry":!1,userId:this.anonId},l=>{l||(this.eventData.lastSuccess=s,this.eventData.tokenU=n)},t):this.processRequests()}},vd=vu.postTurnstileEvent.bind(vu),bu=new class extends Bl{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,i){this.skuToken=e,this.errorCb=i,Z.EVENTS_URL&&(n||Z.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(xd)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),rd(this.anonId)||(this.anonId=cu()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:yd,skuToken:this.skuToken,userId:this.anonId},i=>{i?this.errorCb(i):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},X_=bu.postMapLoadEvent.bind(bu),Rp=new class extends Bl{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=cu(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){let e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){let{map:n,style:i,importedStyles:s}=e;if(!Z.EVENTS_URL||!t&&!Z.ACCESS_TOKEN)return;let l=this.getMapInstanceId(n),c={mapInstanceId:l,eventId:this.getEventId(l),style:i};s.length&&(c.importedStyles=s),this.queueRequest({timestamp:Date.now(),payload:c},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:n}=this.queue.shift();this.postEvent(e,n,()=>{},t)}},bd=Rp.postStyleLoadEvent.bind(Rp),Lp=new class extends Bl{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Z.EVENTS_URL&&(t||Z.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),i=function(s){let l=performance.getEntriesByType("resource"),c=performance.getEntriesByType("mark"),p=function(S){let A={};if(S){for(let R in S)if(R!=="other")for(let O of S[R]){let z=`${R}ResolveRangeMin`,W=`${R}ResolveRangeMax`,X=`${R}RequestCount`,Y=`${R}RequestCachedCount`;A[z]=Math.min(A[z]||1/0,O.startTime),A[W]=Math.max(A[W]||-1/0,O.responseEnd);let re=ne=>{A[ne]===void 0&&(A[ne]=0),++A[ne]};O.transferSize!==void 0&&O.transferSize===0&&re(Y),re(X)}}return A}(function(S,A){let R={};if(S)for(let O of S){let z=A(O);R[z]===void 0&&(R[z]=[]),R[z].push(O)}return R}(l,jt)),m=window.devicePixelRatio,x=navigator.connection||navigator.mozConnection||navigator.webkitConnection,w=x?x.effectiveType:void 0,E={counters:[],metadata:[],attributes:[]},D=(S,A,R)=>{R!=null&&S.push({name:A,value:R.toString()})};for(let S in p)D(E.counters,S,p[S]);if(s.interactionRange[0]!==1/0&&s.interactionRange[1]!==-1/0&&(D(E.counters,"interactionRangeMin",s.interactionRange[0]),D(E.counters,"interactionRangeMax",s.interactionRange[1])),c)for(let S of Object.keys(mt)){let A=mt[S],R=c.find(O=>O.name===A);R&&D(E.counters,A,R.startTime)}return D(E.counters,"visibilityHidden",s.visibilityHidden),D(E.attributes,"style",function(S){if(S)for(let A of S){let R=A.name.split("?")[0];if(et(R)){let O=R.split("/").slice(-2);if(O.length===2)return`mapbox://styles/${O[0]}/${O[1]}`}}}(l)),D(E.attributes,"terrainEnabled",s.terrainEnabled?"true":"false"),D(E.attributes,"fogEnabled",s.fogEnabled?"true":"false"),D(E.attributes,"projection",s.projection),D(E.attributes,"zoom",s.zoom),D(E.metadata,"devicePixelRatio",m),D(E.metadata,"connectionEffectiveType",w),D(E.metadata,"navigatorUserAgent",navigator.userAgent),D(E.metadata,"screenWidth",window.screen.width),D(E.metadata,"screenHeight",window.screen.height),D(E.metadata,"windowWidth",window.innerWidth),D(E.metadata,"windowHeight",window.innerHeight),D(E.metadata,"mapWidth",s.width/m),D(E.metadata,"mapHeight",s.height/m),D(E.metadata,"webglRenderer",s.renderer),D(E.metadata,"webglVendor",s.vendor),D(E.metadata,"sdkVersion",k),D(E.metadata,"sdkIdentifier","mapbox-gl-js"),E}(n);for(let s of i.metadata);for(let s of i.counters);for(let s of i.attributes);this.postEvent(e,i,()=>{},t)}},wu=Lp.postPerformanceEvent.bind(Lp),_a=new class extends Bl{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,i){if(!Z.API_URL||!Z.SESSION_PATH)return;let s=Ti(Z.API_URL+Z.SESSION_PATH);s.params.push(`sku=${e||""}`),s.params.push(`access_token=${i||Z.ACCESS_TOKEN||""}`);let l={url:_s(s),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(c,p){return zl(Pr(c,{method:"GET"}),p)}(l,c=>{this.pendingRequest=null,n(c),this.saveEventData(),this.processRequests(i)})}getSessionAPI(t,e,n,i){this.skuToken=e,this.errorCb=i,Z.SESSION_PATH&&Z.API_URL&&(n||Z.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(xd)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,i=>{i?this.errorCb(i):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},Op=_a.getSessionAPI.bind(_a),ys=new Set;var Vl={exports:{}},Y_={exports:function(t,e){var n,i,s,l,c,p,m,x;for(i=t.length-(n=3&t.length),s=e,c=3432918353,p=461845907,x=0;x<i;)m=255&t.charCodeAt(x)|(255&t.charCodeAt(++x))<<8|(255&t.charCodeAt(++x))<<16|(255&t.charCodeAt(++x))<<24,++x,s=27492+(65535&(l=5*(65535&(s=(s^=m=(65535&(m=(m=(65535&m)*c+(((m>>>16)*c&65535)<<16)&4294967295)<<15|m>>>17))*p+(((m>>>16)*p&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(l>>>16)&65535)<<16);switch(m=0,n){case 3:m^=(255&t.charCodeAt(x+2))<<16;case 2:m^=(255&t.charCodeAt(x+1))<<8;case 1:s^=m=(65535&(m=(m=(65535&(m^=255&t.charCodeAt(x)))*c+(((m>>>16)*c&65535)<<16)&4294967295)<<15|m>>>17))*p+(((m>>>16)*p&65535)<<16)&4294967295}return s^=t.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,(s^=s>>>16)>>>0}},Q_={exports:function(t,e){for(var n,i=t.length,s=e^i,l=0;i>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24))+((1540483477*(n>>>16)&65535)<<16),s=1540483477*(65535&s)+((1540483477*(s>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++l;switch(i){case 3:s^=(255&t.charCodeAt(l+2))<<16;case 2:s^=(255&t.charCodeAt(l+1))<<8;case 1:s=1540483477*(65535&(s^=255&t.charCodeAt(l)))+((1540483477*(s>>>16)&65535)<<16)}return s=1540483477*(65535&(s^=s>>>13))+((1540483477*(s>>>16)&65535)<<16),(s^=s>>>15)>>>0}},Tu=Y_.exports,wd=Q_.exports;Vl.exports=Tu,Vl.exports.murmur3=Tu,Vl.exports.murmur2=wd;var jl=Rt(Vl.exports);class ei{constructor(e,...n){Pr(this,n[0]||{}),this.type=e}}class ro extends ei{constructor(e,n={}){super("error",Pr({error:e},n))}}function kp(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function Td(t,e,n){if(n&&n[t]){let i=n[t].indexOf(e);i!==-1&&n[t].splice(i,1)}}class xs{on(e,n){return this._listeners=this._listeners||{},kp(e,n,this._listeners),this}off(e,n){return Td(e,n,this._listeners),Td(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},kp(e,n,this._oneTimeListeners),this):new Promise(i=>this.once(e,i))}fire(e,n){let i=typeof e=="string"?new ei(e,n):e,s=i.type;if(this.listens(s)){i.target=this;let l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(let m of l)m.call(this,i);let c=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(let m of c)Td(s,m,this._oneTimeListeners),m.call(this,i);let p=this._eventedParent;p&&(Pr(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(i))}else i instanceof ro&&console.error(i.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}o.F=void 0;var Fp={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Eu(t){return(t=Math.round(t))<0?0:t>255?255:t}function Iu(t){return Eu(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function ya(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Ed(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{o.F={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Fp)return Fp[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var i=n.indexOf("("),s=n.indexOf(")");if(i!==-1&&s+1===n.length){var l=n.substr(0,i),c=n.substr(i+1,s-(i+1)).split(","),p=1;switch(l){case"rgba":if(c.length!==4)return null;p=ya(c.pop());case"rgb":return c.length!==3?null:[Iu(c[0]),Iu(c[1]),Iu(c[2]),p];case"hsla":if(c.length!==4)return null;p=ya(c.pop());case"hsl":if(c.length!==3)return null;var m=(parseFloat(c[0])%360+360)%360/360,x=ya(c[1]),w=ya(c[2]),E=w<=.5?w*(x+1):w+x-w*x,D=2*w-E;return[Eu(255*Ed(D,E,m+1/3)),Eu(255*Ed(D,E,m)),Eu(255*Ed(D,E,m-1/3)),p];default:return null}}return null}}catch{}class nn{constructor(e,n,i,s=1){this.r=e,this.g=n,this.b=i,this.a=s}static parse(e){if(!e)return;if(e instanceof nn)return e;if(typeof e!="string")return;let n=o.F(e);return n?new nn(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,i,s]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(i)},${s})`}toRenderColor(e){let{r:n,g:i,b:s,a:l}=this;return new K_(e,n,i,s,l)}}class K_{constructor(e,n,i,s,l){if(e){let c=e.image.height,p=c*c;n=l===0?0:n/l*(c-1),i=l===0?0:i/l*(c-1),s=l===0?0:s/l*(c-1);let m=Math.floor(n),x=Math.floor(i),w=Math.floor(s),E=Math.ceil(n),D=Math.ceil(i),S=Math.ceil(s),A=n-m,R=i-x,O=s-w,z=e.image.data,W=4*(m+x*p+w*c),X=4*(m+x*p+S*c),Y=4*(m+D*p+w*c),re=4*(m+D*p+S*c),ne=4*(E+x*p+w*c),ue=4*(E+x*p+S*c),de=4*(E+D*p+w*c),ve=4*(E+D*p+S*c);if(W<0||ve>=z.length)throw new Error("out of range");this.r=pt(pt(pt(z[W],z[X],O),pt(z[Y],z[re],O),R),pt(pt(z[ne],z[ue],O),pt(z[de],z[ve],O),R),A)/255*l,this.g=pt(pt(pt(z[W+1],z[X+1],O),pt(z[Y+1],z[re+1],O),R),pt(pt(z[ne+1],z[ue+1],O),pt(z[de+1],z[ve+1],O),R),A)/255*l,this.b=pt(pt(pt(z[W+2],z[X+2],O),pt(z[Y+2],z[re+2],O),R),pt(pt(z[ne+2],z[ue+2],O),pt(z[de+2],z[ve+2],O),R),A)/255*l,this.a=l}else this.r=n,this.g=i,this.b=s,this.a=l}toArray(){let{r:e,g:n,b:i,a:s}=this;return s===0?[0,0,0,0]:[255*e/s,255*n/s,255*i/s,s]}toArray01(){let{r:e,g:n,b:i,a:s}=this;return s===0?[0,0,0,0]:[e/s,n/s,i/s,s]}toArray01Scaled(e){let{r:n,g:i,b:s,a:l}=this;return l===0?[0,0,0]:[n/l*e,i/l*e,s/l*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:i,a:s}=this;return[e,n,i,s]}toArray01Linear(){let{r:e,g:n,b:i,a:s}=this;return s===0?[0,0,0,0]:[Math.pow(e/s,2.2),Math.pow(n/s,2.2),Math.pow(i/s,2.2),s]}}function pt(t,e,n){return t*(1-n)+e*n}function Np(t,e,n){return t.map((i,s)=>pt(i,e[s],n))}nn.black=new nn(0,0,0,1),nn.white=new nn(1,1,1,1),nn.transparent=new nn(0,0,0,0),nn.red=new nn(1,0,0,1),nn.blue=new nn(0,0,1,1);var Du=Object.freeze({__proto__:null,array:Np,color:function(t,e,n){return new nn(pt(t.r,e.r,n),pt(t.g,e.g,n),pt(t.b,e.b,n),pt(t.a,e.a,n))},number:pt});function Id(t,...e){for(let n of e)for(let i in n)t[i]=n[i];return t}class Ui extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Dd{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[i,s]of n)this.bindings[i]=s}concat(e){return new Dd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let Ei={kind:"null"},st={kind:"number"},rn={kind:"string"},Jt={kind:"boolean"},ui={kind:"color"},xa={kind:"object"},zt={kind:"value"},Ul={kind:"collator"},Gi={kind:"formatted"},Gl={kind:"resolvedImage"};function Hr(t,e){return{kind:"array",itemType:t,N:e}}function tr(t){if(t.kind==="array"){let e=tr(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let J_=[Ei,st,rn,Jt,ui,Gi,xa,Hr(zt),Gl];function $l(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!$l(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let n of J_)if(!$l(n,e))return null}}return`Expected ${tr(t)} but found ${tr(e)} instead.`}function Mu(t,e){return e.some(n=>n.kind===t.kind)}function vs(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}class va{constructor(e,n,i){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Hl{constructor(e,n,i,s,l){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=i,this.fontStack=s,this.textColor=l}}class yr{constructor(e){this.sections=e}static fromString(e){return new yr([new Hl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof yr?e:yr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),e.push(i)}return e}}class ti{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new ti({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Ii(t,e,n,i){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?i===void 0||typeof i=="number"&&i>=0&&i<=1?null:`Invalid rgba value [${[t,e,n,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof i=="number"?[t,e,n,i]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ba(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof nn||t instanceof va||t instanceof yr||t instanceof ti)return!0;if(Array.isArray(t)){for(let e of t)if(!ba(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!ba(t[e]))return!1;return!0}return!1}function ir(t){if(t===null)return Ei;if(typeof t=="string")return rn;if(typeof t=="boolean")return Jt;if(typeof t=="number")return st;if(t instanceof nn)return ui;if(t instanceof va)return Ul;if(t instanceof yr)return Gi;if(t instanceof ti)return Gl;if(Array.isArray(t)){let e=t.length,n;for(let i of t){let s=ir(i);if(n){if(n===s)continue;n=zt;break}n=s}return Hr(n||zt,e)}return xa}function Di(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof nn||t instanceof yr||t instanceof ti?t.toString():JSON.stringify(t)}class io{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ba(e[1]))return n.error("invalid value");let i=e[1],s=ir(i),l=n.expectedType;return s.kind!=="array"||s.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(s=l),new io(s,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof nn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof yr?this.value.serialize():this.value}}class hr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let Md={string:rn,number:st,boolean:Jt,object:xa};class Mi{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let i,s=1,l=e[0];if(l==="array"){let p,m;if(e.length>2){let x=e[1];if(typeof x!="string"||!(x in Md)||x==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);p=Md[x],s++}else p=zt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);m=e[2],s++}i=Hr(p,m)}else i=Md[l];let c=[];for(;s<e.length;s++){let p=n.parse(e[s],s,zt);if(!p)return null;c.push(p)}return new Mi(i,c)}evaluate(e){for(let n=0;n<this.args.length;n++){let i=this.args[n].evaluate(e);if(!$l(this.type,ir(i)))return i;if(n===this.args.length-1)throw new hr(`Expected value to be of type ${tr(this.type)}, but found ${tr(ir(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let i=e.itemType;if(i.kind==="string"||i.kind==="number"||i.kind==="boolean"){n.push(i.kind);let s=e.N;(typeof s=="number"||this.args.length>1)&&n.push(s)}}return n.concat(this.args.map(i=>i.serialize()))}}class ql{constructor(e){this.type=Gi,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let i=e[1];if(!Array.isArray(i)&&typeof i=="object")return n.error("First argument must be an image or text section.");let s=[],l=!1;for(let c=1;c<=e.length-1;++c){let p=e[c];if(l&&typeof p=="object"&&!Array.isArray(p)){l=!1;let m=null;if(p["font-scale"]&&(m=n.parse(p["font-scale"],1,st),!m))return null;let x=null;if(p["text-font"]&&(x=n.parse(p["text-font"],1,Hr(rn)),!x))return null;let w=null;if(p["text-color"]&&(w=n.parse(p["text-color"],1,ui),!w))return null;let E=s[s.length-1];E.scale=m,E.font=x,E.textColor=w}else{let m=n.parse(e[c],1,zt);if(!m)return null;let x=m.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,s.push({content:m,scale:null,font:null,textColor:null})}}return new ql(s)}evaluate(e){return new yr(this.sections.map(n=>{let i=n.content.evaluate(e);return ir(i)===Gl?new Hl("",i,null,null,null):new Hl(Di(i),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),e.push(i)}return e}}class Wl{constructor(e,n){this.type=Gl,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let i=n.parse(e[1],1,rn);if(!i)return n.error("No image name provided.");if(e.length===2)return new Wl(i);let s=n.parse(e[2],1,rn);return s?new Wl(i,s):n.error("Secondary image variant is not a string.")}evaluate(e){let n=ti.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function bs(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let Cd={"to-boolean":Jt,"to-color":ui,"to-number":st,"to-string":rn};class $i{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let i=e[0],s=[],l=Ei;if(i==="to-array"){if(!Array.isArray(e[1]))return null;let c=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);l=Hr(n.expectedType.itemType,c)}else{if(!(c>0&&ba(e[1][0])))return null;l=Hr(ir(e[1][0]),c)}for(let p=0;p<c;p++){let m=e[1][p],x;if(bs(m)==="array")x=n.parse(m,void 0,l.itemType);else{let w=bs(m);if(w!==l.itemType.kind)return n.error(`Expected ${l.itemType.kind} but found ${w}.`);x=n.registry.literal.parse(["literal",m===void 0?null:m],n)}if(!x)return null;s.push(x)}}else{if((i==="to-boolean"||i==="to-string")&&e.length!==2)return n.error("Expected one argument.");l=Cd[i];for(let c=1;c<e.length;c++){let p=n.parse(e[c],c,zt);if(!p)return null;s.push(p)}}return new $i(l,s)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,i;for(let s of this.args){if(n=s.evaluate(e),i=null,n instanceof nn)return n;if(typeof n=="string"){let l=e.parseColor(n);if(l)return l}else if(Array.isArray(n)&&(i=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ii(n[0],n[1],n[2],n[3]),!i))return new nn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new hr(i||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let i of this.args){if(n=i.evaluate(e),n===null)return 0;let s=Number(n);if(!isNaN(s))return s}throw new hr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?yr.fromString(Di(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ti.fromString(Di(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Di(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ql([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Wl(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}let ey=["Unknown","Point","LineString","Polygon"];class Cu{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ey[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:i,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*n-e[0])+this.featureDistanceData.bearing[1]*(s*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=nn.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class Lr{constructor(e,n,i,s,l){this.name=e,this.type=n,this._evaluate=i,this.args=s,this._overloadIndex=l}evaluate(e){if(!this._evaluate){let n=Lr.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let i=e[0],s=Lr.definitions[i];if(!s)return n.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);let l=Array.isArray(s)?s[0]:s.type,c=Array.isArray(s)?[[s[1],s[2]]]:s.overloads,p=[],m=null,x=-1;for(let[w,E]of c){if(Array.isArray(w)&&w.length!==e.length-1)continue;p.push(w),x++,m=new ku(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);let D=[],S=!1;for(let A=1;A<e.length;A++){let R=e[A],O=Array.isArray(w)?w[A-1]:w.type,z=m.parse(R,1+D.length,O);if(!z){S=!0;break}D.push(z)}if(!S)if(Array.isArray(w)&&w.length!==D.length)m.error(`Expected ${w.length} arguments, but found ${D.length} instead.`);else{for(let A=0;A<D.length;A++){let R=Array.isArray(w)?w[A]:w.type,O=D[A];m.concat(A+1).checkSubtype(R,O.type)}if(m.errors.length===0)return new Lr(i,l,E,D,x)}}if(p.length===1)n.errors.push(...m.errors);else{let w=(p.length?p:c.map(([D])=>D)).map(Zl).join(" | "),E=[];for(let D=1;D<e.length;D++){let S=n.parse(e[D],1+E.length);if(!S)return null;E.push(tr(S.type))}n.error(`Expected arguments of type ${w}, but found (${E.join(", ")}) instead.`)}return null}static register(e,n){Lr.definitions=n;for(let i in n)e[i]=Lr}}function Zl(t){return Array.isArray(t)?`(${t.map(tr).join(", ")})`:`(${tr(t.type)}...)`}class Xl{constructor(e,n,i){this.type=Ul,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let i=e[1];if(typeof i!="object"||Array.isArray(i))return n.error("Collator options argument must be an object.");let s=n.parse(i["case-sensitive"]!==void 0&&i["case-sensitive"],1,Jt);if(!s)return null;let l=n.parse(i["diacritic-sensitive"]!==void 0&&i["diacritic-sensitive"],1,Jt);if(!l)return null;let c=null;return i.locale&&(c=n.parse(i.locale,1,rn),!c)?null:new Xl(s,l,c)}evaluate(e){return new va(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function zp(t,e,n=0,i=t.length-1,s=ty){for(;i>n;){if(i-n>600){let m=i-n+1,x=e-n+1,w=Math.log(m),E=.5*Math.exp(2*w/3),D=.5*Math.sqrt(w*E*(m-E)/m)*(x-m/2<0?-1:1);zp(t,e,Math.max(n,Math.floor(e-x*E/m+D)),Math.min(i,Math.floor(e+(m-x)*E/m+D)),s)}let l=t[e],c=n,p=i;for(Yl(t,n,e),s(t[i],l)>0&&Yl(t,n,i);c<p;){for(Yl(t,c,p),c++,p--;s(t[c],l)<0;)c++;for(;s(t[p],l)>0;)p--}s(t[n],l)===0?Yl(t,n,p):(p++,Yl(t,p,i)),p<=e&&(n=p+1),e<=p&&(i=p-1)}}function Yl(t,e,n){let i=t[e];t[e]=t[n],t[n]=i}function ty(t,e){return t<e?-1:t>e?1:0}function Bp(t){let e=0;for(let n,i,s=0,l=t.length,c=l-1;s<l;c=s++)n=t[s],i=t[c],e+=(i.x-n.x)*(n.y+i.y);return e}function Ql(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Kl(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Vp(t,e,n){let i=t[0]-e[0],s=t[1]-e[1],l=t[0]-n[0],c=t[1]-n[1];return i*c-l*s==0&&i*l<=0&&s*c<=0}function Wt(t,e,n=!1){let i=!1;for(let p=0,m=e.length;p<m;p++){let x=e[p];for(let w=0,E=x.length,D=E-1;w<E;D=w++){let S=x[D],A=x[w];if(Vp(t,S,A))return n;(l=S)[1]>(s=t)[1]!=(c=A)[1]>s[1]&&s[0]<(c[0]-l[0])*(s[1]-l[1])/(c[1]-l[1])+l[0]&&(i=!i)}}var s,l,c;return i}function Sd(t,e,n,i){let s=i[0]-n[0],l=i[1]-n[1],c=(t[0]-n[0])*l-s*(t[1]-n[1]),p=(e[0]-n[0])*l-s*(e[1]-n[1]);return c>0&&p<0||c<0&&p>0}function Jl(t,e,n,i){return(s=[i[0]-n[0],i[1]-n[1]])[0]*(l=[e[0]-t[0],e[1]-t[1]])[1]-s[1]*l[0]!=0&&!(!Sd(t,e,n,i)||!Sd(n,i,t,e));var s,l}let Bo=8192;function ny(t,e){let n=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,s=Math.pow(2,e.z);return[Math.round(n*s*Bo),Math.round(i*s*Bo)]}function Su(t,e){for(let n=0;n<e.length;n++)if(Wt(t,e[n]))return!0;return!1}function Au(t,e,n){for(let i of n)for(let s=0,l=i.length,c=l-1;s<l;c=s++)if(Jl(t,e,i[c],i[s]))return!0;return!1}function ec(t,e){for(let n=0;n<t.length;++n)if(!Wt(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Au(t[n],t[n+1],e))return!1;return!0}function ry(t,e){for(let n=0;n<e.length;n++)if(ec(t,e[n]))return!0;return!1}function Pu(t,e,n){let i=[];for(let s=0;s<t.length;s++){let l=[];for(let c=0;c<t[s].length;c++){let p=ny(t[s][c],n);Ql(e,p),l.push(p)}i.push(l)}return i}function Ci(t,e,n){let i=[];for(let s=0;s<t.length;s++){let l=Pu(t[s],e,n);i.push(l)}return i}function jp(t,e,n,i){if(t[0]<n[0]||t[0]>n[2]){let s=.5*i,l=t[0]-n[0]>s?-i:n[0]-t[0]>s?i:0;l===0&&(l=t[0]-n[2]>s?-i:n[2]-t[0]>s?i:0),t[0]+=l}Ql(e,t)}function Ad(t,e,n,i){let s=Math.pow(2,i.z)*Bo,l=[i.x*Bo,i.y*Bo],c=[];if(!t)return c;for(let p of t)for(let m of p){let x=[m.x+l[0],m.y+l[1]];jp(x,e,n,s),c.push(x)}return c}function wa(t,e,n,i){let s=Math.pow(2,i.z)*Bo,l=[i.x*Bo,i.y*Bo],c=[];if(!t)return c;for(let m of t){let x=[];for(let w of m){let E=[w.x+l[0],w.y+l[1]];Ql(e,E),x.push(E)}c.push(x)}if(e[2]-e[0]<=s/2){(p=e)[0]=p[1]=1/0,p[2]=p[3]=-1/0;for(let m of c)for(let x of m)jp(x,e,n,s)}var p;return c}class oo{constructor(e,n){this.type=Jt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ba(e[1])){let i=e[1];if(i.type==="FeatureCollection")for(let s=0;s<i.features.length;++s){let l=i.features[s].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new oo(i,i.features[s].geometry)}else if(i.type==="Feature"){let s=i.geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new oo(i,i.geometry)}else if(i.type==="Polygon"||i.type==="MultiPolygon")return new oo(i,i)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,i){let s=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],c=n.canonicalID();if(!c)return!1;if(i.type==="Polygon"){let p=Pu(i.coordinates,l,c),m=Ad(n.geometry(),s,l,c);if(!Kl(s,l))return!1;for(let x of m)if(!Wt(x,p))return!1}if(i.type==="MultiPolygon"){let p=Ci(i.coordinates,l,c),m=Ad(n.geometry(),s,l,c);if(!Kl(s,l))return!1;for(let x of m)if(!Su(x,p))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,i){let s=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],c=n.canonicalID();if(!c)return!1;if(i.type==="Polygon"){let p=Pu(i.coordinates,l,c),m=wa(n.geometry(),s,l,c);if(!Kl(s,l))return!1;for(let x of m)if(!ec(x,p))return!1}if(i.type==="MultiPolygon"){let p=Ci(i.coordinates,l,c),m=wa(n.geometry(),s,l,c);if(!Kl(s,l))return!1;for(let x of m)if(!ry(x,p))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let Ru={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Up=1/298.257223563,Gp=Up*(2-Up),Ta=Math.PI/180;class ws{static fromTile(e,n,i){let s=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),l=Math.atan(.5*(Math.exp(s)-Math.exp(-s)))/Ta;return new ws(l,i)}static get units(){return Ru}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!Ru[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(Ru).join(", ")}`);let i=6378.137*Ta*(n?Ru[n]:1),s=Math.cos(e*Ta),l=1/(1-Gp*(1-s*s)),c=Math.sqrt(l);this.kx=i*c*s,this.ky=i*c*l*(1-Gp)}distance(e,n){let i=hi(e[0]-n[0])*this.kx,s=(e[1]-n[1])*this.ky;return Math.sqrt(i*i+s*s)}bearing(e,n){let i=hi(n[0]-e[0])*this.kx;return Math.atan2(i,(n[1]-e[1])*this.ky)/Ta}destination(e,n,i){let s=i*Ta;return this.offset(e,Math.sin(s)*n,Math.cos(s)*n)}offset(e,n,i){return[e[0]+n/this.kx,e[1]+i/this.ky]}lineDistance(e){let n=0;for(let i=0;i<e.length-1;i++)n+=this.distance(e[i],e[i+1]);return n}area(e){let n=0;for(let i=0;i<e.length;i++){let s=e[i];for(let l=0,c=s.length,p=c-1;l<c;p=l++)n+=hi(s[l][0]-s[p][0])*(s[l][1]+s[p][1])*(i?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let i=0;if(n<=0)return e[0];for(let s=0;s<e.length-1;s++){let l=e[s],c=e[s+1],p=this.distance(l,c);if(i+=p,i>n)return Ea(l,c,(n-(i-p))/p)}return e[e.length-1]}pointToSegmentDistance(e,n,i){let[s,l]=n,c=hi(i[0]-s)*this.kx,p=(i[1]-l)*this.ky;if(c!==0||p!==0){let m=(hi(e[0]-s)*this.kx*c+(e[1]-l)*this.ky*p)/(c*c+p*p);m>1?(s=i[0],l=i[1]):m>0&&(s+=c/this.kx*m,l+=p/this.ky*m)}return c=hi(e[0]-s)*this.kx,p=(e[1]-l)*this.ky,Math.sqrt(c*c+p*p)}pointOnLine(e,n){let i=1/0,s=e[0][0],l=e[0][1],c=0,p=0;for(let m=0;m<e.length-1;m++){let x=e[m][0],w=e[m][1],E=hi(e[m+1][0]-x)*this.kx,D=(e[m+1][1]-w)*this.ky,S=0;E===0&&D===0||(S=(hi(n[0]-x)*this.kx*E+(n[1]-w)*this.ky*D)/(E*E+D*D),S>1?(x=e[m+1][0],w=e[m+1][1]):S>0&&(x+=E/this.kx*S,w+=D/this.ky*S)),E=hi(n[0]-x)*this.kx,D=(n[1]-w)*this.ky;let A=E*E+D*D;A<i&&(i=A,s=x,l=w,c=m,p=S)}return{point:[s,l],index:c,t:Math.max(0,Math.min(1,p))}}lineSlice(e,n,i){let s=this.pointOnLine(i,e),l=this.pointOnLine(i,n);if(s.index>l.index||s.index===l.index&&s.t>l.t){let x=s;s=l,l=x}let c=[s.point],p=s.index+1,m=l.index;!$p(i[p],c[0])&&p<=m&&c.push(i[p]);for(let x=p+1;x<=m;x++)c.push(i[x]);return $p(i[m],l.point)||c.push(l.point),c}lineSliceAlong(e,n,i){let s=0,l=[];for(let c=0;c<i.length-1;c++){let p=i[c],m=i[c+1],x=this.distance(p,m);if(s+=x,s>e&&l.length===0&&l.push(Ea(p,m,(e-(s-x))/x)),s>=n)return l.push(Ea(p,m,(n-(s-x))/x)),l;s>e&&l.push(m)}return l}bufferPoint(e,n){let i=n/this.ky,s=n/this.kx;return[e[0]-s,e[1]-i,e[0]+s,e[1]+i]}bufferBBox(e,n){let i=n/this.ky,s=n/this.kx;return[e[0]-s,e[1]-i,e[2]+s,e[3]+i]}insideBBox(e,n){return hi(e[0]-n[0])>=0&&hi(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function $p(t,e){return t[0]===e[0]&&t[1]===e[1]}function Ea(t,e,n){let i=hi(e[0]-t[0]);return[t[0]+i*n,t[1]+(e[1]-t[1])*n]}function hi(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}class Pd{constructor(e=[],n=(i,s)=>i<s?-1:i>s?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:n,compare:i}=this,s=n[e];for(;e>0;){let l=e-1>>1,c=n[l];if(i(s,c)>=0)break;n[e]=c,e=l}n[e]=s}_down(e){let{data:n,compare:i}=this,s=this.length>>1,l=n[e];for(;e<s;){let c=1+(e<<1),p=c+1;if(p<this.length&&i(n[p],n[c])<0&&(c=p),i(n[c],l)>=0)break;n[e]=n[c],e=c}n[e]=l}}var Ye=8192;function Hp(t,e){return e.dist-t.dist}let Rd=100,Ld=50;function qp(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function tc(t){return t[1]-t[0]+1}function qr(t,e){let n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Od(t,e){if(t[0]>t[1])return[null,null];let n=tc(t);if(e){if(n===2)return[t,null];let i=Math.floor(n/2);return[[t[0],t[0]+i],[t[0]+i,t[1]]]}{if(n===1)return[t,null];let i=Math.floor(n/2)-1;return[[t[0],t[0]+i],[t[0]+i+1,t[1]]]}}function Ts(t,e){let n=[1/0,1/0,-1/0,-1/0];if(!qr(e,t.length))return n;for(let i=e[0];i<=e[1];++i)Ql(n,t[i]);return n}function Ia(t){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let i=0;i<t[n].length;++i)Ql(e,t[n][i]);return e}function Da(t,e,n){if(qp(t)||qp(e))return NaN;let i=0,s=0;return t[2]<e[0]&&(i=e[0]-t[2]),t[0]>e[2]&&(i=t[0]-e[2]),t[1]>e[3]&&(s=t[1]-e[3]),t[3]<e[1]&&(s=e[1]-t[3]),n.distance([0,0],[i,s])}function iy(t){return 360*t-180}function oy(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function kd(t,e){let n=Math.pow(2,e.z),i=(t.y/Ye+e.y)/n;return[iy((t.x/Ye+e.x)/n),oy(i)]}function sy(t,e){let n=[];for(let i=0;i<t.length;++i)n.push(kd(t[i],e));return n}function Vo(t,e,n){let i=n.pointOnLine(e,t).point;return n.distance(t,i)}function Wp(t,e,n,i,s){let l=n.slice(i[0],i[1]+1),c=1/0;for(let p=e[0];p<=e[1];++p)if((c=Math.min(c,Vo(t[p],l,s)))===0)return 0;return c}function Fd(t,e,n,i,s){let l=Math.min(s.pointToSegmentDistance(t,n,i),s.pointToSegmentDistance(e,n,i)),c=Math.min(s.pointToSegmentDistance(n,t,e),s.pointToSegmentDistance(i,t,e));return Math.min(l,c)}function Zp(t,e,n,i,s){if(!qr(e,t.length)||!qr(i,n.length))return NaN;let l=1/0;for(let c=e[0];c<e[1];++c)for(let p=i[0];p<i[1];++p){if(Jl(t[c],t[c+1],n[p],n[p+1]))return 0;l=Math.min(l,Fd(t[c],t[c+1],n[p],n[p+1],s))}return l}function Xp(t,e,n,i,s){if(!qr(e,t.length)||!qr(i,n.length))return NaN;let l=1/0;for(let c=e[0];c<=e[1];++c)for(let p=i[0];p<=i[1];++p)if((l=Math.min(l,s.distance(t[c],n[p])))===0)return l;return l}function Si(t,e,n){if(Wt(t,e,!0))return 0;let i=1/0;for(let s of e){let l=s.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(s[0]!==s[l-1]&&(i=Math.min(i,n.pointToSegmentDistance(t,s[l-1],s[0])))===0||(i=Math.min(i,Vo(t,s,n)))===0)return i}return i}function Yp(t,e,n,i){if(!qr(e,t.length))return NaN;for(let l=e[0];l<=e[1];++l)if(Wt(t[l],n,!0))return 0;let s=1/0;for(let l=e[0];l<e[1];++l)for(let c of n)for(let p=0,m=c.length,x=m-1;p<m;x=p++){if(Jl(t[l],t[l+1],c[x],c[p]))return 0;s=Math.min(s,Fd(t[l],t[l+1],c[x],c[p],i))}return s}function Qp(t,e){for(let n of t)for(let i=0;i<=n.length-1;++i)if(Wt(n[i],e,!0))return!0;return!1}function Kp(t,e,n,i=1/0){let s=Ia(t),l=Ia(e);if(i!==1/0&&Da(s,l,n)>=i)return i;if(Kl(s,l)){if(Qp(t,e))return 0}else if(Qp(e,t))return 0;let c=i;for(let p of t)for(let m=0,x=p.length,w=x-1;m<x;w=m++)for(let E of e)for(let D=0,S=E.length,A=S-1;D<S;A=D++){if(Jl(p[w],p[m],E[A],E[D]))return 0;c=Math.min(c,Fd(p[w],p[m],E[A],E[D],n))}return c}function Es(t,e,n,i,s,l,c){if(l===null||c===null)return;let p=Da(Ts(i,l),Ts(s,c),n);p<e&&t.push({dist:p,range1:l,range2:c})}function ay(t,e,n,i,s=1/0){let l=Math.min(i.distance(t[0],n[0][0]),s);if(l===0)return l;let c=new Pd([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Hp),p=e?Ld:Rd,m=Ia(n);for(;c.length;){let x=c.pop();if(x.dist>=l)continue;let w=x.range1;if(tc(w)<=p){if(!qr(w,t.length))return NaN;if(e){let E=Yp(t,w,n,i);if((l=Math.min(l,E))===0)return l}else for(let E=w[0];E<=w[1];++E){let D=Si(t[E],n,i);if((l=Math.min(l,D))===0)return l}}else{let E=Od(w,e);if(E[0]!==null){let D=Da(Ts(t,E[0]),m,i);D<l&&c.push({dist:D,range1:E[0],range2:[0,0]})}if(E[1]!==null){let D=Da(Ts(t,E[1]),m,i);D<l&&c.push({dist:D,range1:E[1],range2:[0,0]})}}}return l}function Jp(t,e,n,i,s,l=1/0){let c=Math.min(l,s.distance(t[0],n[0]));if(c===0)return c;let p=new Pd([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],Hp),m=e?Ld:Rd,x=i?Ld:Rd;for(;p.length;){let w=p.pop();if(w.dist>=c)continue;let E=w.range1,D=w.range2;if(tc(E)<=m&&tc(D)<=x){if(!qr(E,t.length)||!qr(D,n.length))return NaN;if(e&&i?c=Math.min(c,Zp(t,E,n,D,s)):e||i?e&&!i?c=Math.min(c,Wp(n,D,t,E,s)):!e&&i&&(c=Math.min(c,Wp(t,E,n,D,s))):c=Math.min(c,Xp(t,E,n,D,s)),c===0)return c}else{let S=Od(E,e),A=Od(D,i);Es(p,c,s,t,n,S[0],A[0]),Es(p,c,s,t,n,S[0],A[1]),Es(p,c,s,t,n,S[1],A[0]),Es(p,c,s,t,n,S[1],A[1])}}return c}function Nd(t,e,n,i,s=1/0){let l=s,c=Ts(t,[0,t.length-1]);for(let p of n)if(!(l!==1/0&&Da(c,Ts(p,[0,p.length-1]),i)>=l)&&(l=Math.min(l,Jp(t,e,p,!0,i,l)),l===0))return l;return l}function Lu(t,e,n,i,s=1/0){let l=s,c=Ts(t,[0,t.length-1]);for(let p of n){if(l!==1/0&&Da(c,Ia(p),i)>=l)continue;let m=ay(t,e,p,i,l);if(isNaN(m))return m;if((l=Math.min(l,m))===0)return l}return l}function zd(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Hi{constructor(e,n){this.type=st,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ba(e[1])){let i=e[1];if(i.type==="FeatureCollection"){for(let s=0;s<i.features.length;++s)if(zd(i.features[s].geometry.type))return new Hi(i,i.features[s].geometry)}else if(i.type==="Feature"){if(zd(i.geometry.type))return new Hi(i,i.geometry)}else if(zd(i.type))return new Hi(i,i)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),i=e.canonicalID();if(n!=null&&i!=null){if(e.geometryType()==="Point")return function(s,l,c){let p=[];for(let x of s)for(let w of x)p.push(kd(w,l));let m=new ws(p[0][1],"meters");return c.type==="Point"||c.type==="MultiPoint"||c.type==="LineString"?Jp(p,!1,c.type==="Point"?[c.coordinates]:c.coordinates,c.type==="LineString",m):c.type==="MultiLineString"?Nd(p,!1,c.coordinates,m):c.type==="Polygon"||c.type==="MultiPolygon"?Lu(p,!1,c.type==="Polygon"?[c.coordinates]:c.coordinates,m):null}(n,i,this.geometries);if(e.geometryType()==="LineString")return function(s,l,c){let p=[];for(let x of s){let w=[];for(let E of x)w.push(kd(E,l));p.push(w)}let m=new ws(p[0][0][1],"meters");if(c.type==="Point"||c.type==="MultiPoint"||c.type==="LineString")return Nd(c.type==="Point"?[c.coordinates]:c.coordinates,c.type==="LineString",p,m);if(c.type==="MultiLineString"){let x=1/0;for(let w=0;w<c.coordinates.length;w++){let E=Nd(c.coordinates[w],!0,p,m,x);if(isNaN(E))return E;if((x=Math.min(x,E))===0)return x}return x}if(c.type==="Polygon"||c.type==="MultiPolygon"){let x=1/0;for(let w=0;w<p.length;w++){let E=Lu(p[w],!0,c.type==="Polygon"?[c.coordinates]:c.coordinates,m,x);if(isNaN(E))return E;if((x=Math.min(x,E))===0)return x}return x}return null}(n,i,this.geometries);if(e.geometryType()==="Polygon")return function(s,l,c){let p=[];for(let x of function(w,E){let D=w.length;if(D<=1)return[w];let S=[],A,R;for(let O=0;O<D;O++){let z=Bp(w[O]);z!==0&&(w[O].area=Math.abs(z),R===void 0&&(R=z<0),R===z<0?(A&&S.push(A),A=[w[O]]):A.push(w[O]))}return A&&S.push(A),S}(s)){let w=[];for(let E=0;E<x.length;++E)w.push(sy(x[E],l));p.push(w)}let m=new ws(p[0][0][0][1],"meters");if(c.type==="Point"||c.type==="MultiPoint"||c.type==="LineString")return Lu(c.type==="Point"?[c.coordinates]:c.coordinates,c.type==="LineString",p,m);if(c.type==="MultiLineString"){let x=1/0;for(let w=0;w<c.coordinates.length;w++){let E=Lu(c.coordinates[w],!0,p,m,x);if(isNaN(E))return E;if((x=Math.min(x,E))===0)return x}return x}return c.type==="Polygon"||c.type==="MultiPolygon"?function(x,w,E){let D=1/0;for(let S of x)for(let A of w){let R=Kp(S,A,E,D);if(isNaN(R))return R;if((D=Math.min(D,R))===0)return D}return D}(c.type==="Polygon"?[c.coordinates]:c.coordinates,p,m):null}(n,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ma(t,e){switch(t){case"string":return Di(e);case"number":return+e;case"boolean":return!!e;case"color":return nn.parse(e);case"formatted":return yr.fromString(Di(e));case"resolvedImage":return ti.fromString(Di(e))}return e}function Wr(t,e,n,i){return i!==void 0&&(t=i*Math.round(t/i)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}class so{constructor(e,n,i){this.type=e,this.key=n,this.scope=i}static parse(e,n){let i=n.expectedType;if(i==null&&(i=zt),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");let s=n.parse(e[1],1);if(!(s instanceof io))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let l=n.parse(e[2],2);return l instanceof io?new so(i,Di(s.value),Di(l.value)):n.error("Scope of 'config' expression must be a string literal.")}return new so(i,Di(s.value))}evaluate(e){let n=[this.key,this.scope,e.scope].filter(Boolean).join(""),i=e.getConfig(n);if(!i)return null;let{type:s,value:l,values:c,minValue:p,maxValue:m,stepValue:x}=i,w=i.default.evaluate(e),E=w;if(l){let D=e.scope;e.scope=(D||"").split("").slice(1).join(""),E=l.evaluate(e),e.scope=D}return s&&(E=Ma(s,E)),E===void 0||p===void 0&&m===void 0&&x===void 0||(typeof E=="number"?E=Wr(E,p,m,x):Array.isArray(E)&&(E=E.map(D=>typeof D=="number"?Wr(D,p,m,x):D))),l!==void 0&&E!==void 0&&c&&!c.includes(E)&&(E=w,s&&(E=Ma(s,E))),(s&&s!==this.type||E!==void 0&&ir(E)!==this.type)&&(E=Ma(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function nc(t){if(t instanceof Lr&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof oo||t instanceof Hi)return!1;let e=!0;return t.eachChild(n=>{e&&!nc(n)&&(e=!1)}),e}function Ou(t){if(t instanceof Lr&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!Ou(n)&&(e=!1)}),e}function Bd(t){if(t instanceof so)return!1;let e=!0;return t.eachChild(n=>{e&&!Bd(n)&&(e=!1)}),e}function rc(t,e){if(t instanceof Lr&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(i=>{n&&!rc(i,e)&&(n=!1)}),n}class Ca{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let i=e[1];return n.scope.has(i)?new Ca(i,n.scope.get(i)):n.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Vd{constructor(e,n=[],i,s=new Dd,l=[],c,p){this.registry=e,this.path=n,this.key=n.map(m=>`[${m}]`).join(""),this.scope=s,this.errors=l,this.expectedType=i,this._scope=c,this.options=p}parse(e,n,i,s,l={}){return n||i?this.concat(n,i,s)._parse(e,l):this._parse(e,l)}_parse(e,n){function i(s,l,c){return c==="assert"?new Mi(l,[s]):c==="coerce"?new $i(l,[s]):s}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let s=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(s){let l=s.parse(e,this);if(!l)return null;if(this.expectedType){let c=this.expectedType,p=l.type;if(c.kind!=="string"&&c.kind!=="number"&&c.kind!=="boolean"&&c.kind!=="object"&&c.kind!=="array"||p.kind!=="value")if(c.kind!=="color"&&c.kind!=="formatted"&&c.kind!=="resolvedImage"||p.kind!=="value"&&p.kind!=="string"){if(this.checkSubtype(c,p))return null}else l=i(l,c,n.typeAnnotation||"coerce");else l=i(l,c,n.typeAnnotation||"assert")}if(!(l instanceof io)&&l.type.kind!=="resolvedImage"&&jd(l)){let c=new Cu(this._scope,this.options);try{l=new io(l.type,l.evaluate(c))}catch(p){return this.error(p.message),null}}return l}return $i.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,i){let s=typeof e=="number"?this.path.concat(e):this.path,l=i?this.scope.concat(i):this.scope;return new Vd(this.registry,s,n||null,l,this.errors,this._scope,this.options)}error(e,...n){let i=`${this.key}${n.map(s=>`[${s}]`).join("")}`;this.errors.push(new Ui(i,e))}checkSubtype(e,n){let i=$l(e,n);return i&&this.error(i),i}}var ku=Vd;function jd(t){if(t instanceof Ca)return jd(t.boundExpression);if(t instanceof Lr&&t.name==="error"||t instanceof Xl||t instanceof oo||t instanceof Hi||t instanceof so)return!1;let e=t instanceof $i||t instanceof Mi,n=!0;return t.eachChild(i=>{n=e?n&&jd(i):n&&i instanceof io}),!!n&&nc(t)&&rc(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Fu(t,e){let n=t.length-1,i,s,l=0,c=n,p=0;for(;l<=c;)if(p=Math.floor((l+c)/2),i=t[p],s=t[p+1],i<=e){if(p===n||e<s)return p;l=p+1}else{if(!(i>e))throw new hr("Input is not a number.");c=p-1}return 0}class Is{constructor(e,n,i){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[s,l]of i)this.labels.push(s),this.outputs.push(l)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let i=n.parse(e[1],1,st);if(!i)return null;let s=[],l=null;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);for(let c=1;c<e.length;c+=2){let p=c===1?-1/0:e[c],m=e[c+1],x=c,w=c+1;if(typeof p!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(s.length&&s[s.length-1][0]>=p)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);let E=n.parse(m,w,l);if(!E)return null;l=l||E.type,s.push([p,E])}return new Is(l,i,s)}evaluate(e){let n=this.labels,i=this.outputs;if(n.length===1)return i[0].evaluate(e);let s=this.input.evaluate(e);if(s<=n[0])return i[0].evaluate(e);let l=n.length;return s>=n[l-1]?i[l-1].evaluate(e):i[Fu(n,s)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}let em=.95047,Ud=1.08883,Gd=4/29,Sa=6/29,Nu=3*Sa*Sa,zu=Sa*Sa*Sa,tm=Math.PI/180,ly=180/Math.PI;function Bu(t){return t>zu?Math.pow(t,1/3):t/Nu+Gd}function $d(t){return t>Sa?t*t*t:Nu*(t-Gd)}function ic(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Hd(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function nm(t){let e=Hd(t.r),n=Hd(t.g),i=Hd(t.b),s=Bu((.4124564*e+.3575761*n+.1804375*i)/em),l=Bu((.2126729*e+.7151522*n+.072175*i)/1);return{l:116*l-16,a:500*(s-l),b:200*(l-Bu((.0193339*e+.119192*n+.9503041*i)/Ud)),alpha:t.a}}function rm(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*$d(e),n=em*$d(n),i=Ud*$d(i),new nn(ic(3.2404542*n-1.5371385*e-.4985314*i),ic(-.969266*n+1.8760108*e+.041556*i),ic(.0556434*n-.2040259*e+1.0572252*i),t.alpha)}function cy(t,e,n){let i=e-t;return t+n*(i>180||i<-180?i-360*Math.round(i/360):i)}let Aa={forward:nm,reverse:rm,interpolate:function(t,e,n){return{l:pt(t.l,e.l,n),a:pt(t.a,e.a,n),b:pt(t.b,e.b,n),alpha:pt(t.alpha,e.alpha,n)}}},oc={forward:function(t){let{l:e,a:n,b:i}=nm(t),s=Math.atan2(i,n)*ly;return{h:s<0?s+360:s,c:Math.sqrt(n*n+i*i),l:e,alpha:t.a}},reverse:function(t){let e=t.h*tm,n=t.c;return rm({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:cy(t.h,e.h,n),c:pt(t.c,e.c,n),l:pt(t.l,e.l,n),alpha:pt(t.alpha,e.alpha,n)}}};var im=Object.freeze({__proto__:null,hcl:oc,lab:Aa});class ni{constructor(e,n,i,s,l){this.type=e,this.operator=n,this.interpolation=i,this.input=s,this.labels=[],this.outputs=[];for(let[c,p]of l)this.labels.push(c),this.outputs.push(p)}static interpolationFactor(e,n,i,s){let l=0;if(e.name==="exponential")l=qd(n,e.base,i,s);else if(e.name==="linear")l=qd(n,1,i,s);else if(e.name==="cubic-bezier"){let c=e.controlPoints;l=new Al(c[0],c[1],c[2],c[3]).solve(qd(n,1,i,s))}return l}static parse(e,n){let[i,s,l,...c]=e;if(!Array.isArray(s)||s.length===0)return n.error("Expected an interpolation type expression.",1);if(s[0]==="linear")s={name:"linear"};else if(s[0]==="exponential"){let x=s[1];if(typeof x!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);s={name:"exponential",base:x}}else{if(s[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(s[0])}`,1,0);{let x=s.slice(1);if(x.length!==4||x.some(w=>typeof w!="number"||w<0||w>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);s={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(l=n.parse(l,2,st),!l)return null;let p=[],m=null;i==="interpolate-hcl"||i==="interpolate-lab"?m=ui:n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let x=0;x<c.length;x+=2){let w=c[x],E=c[x+1],D=x+3,S=x+4;if(typeof w!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(p.length&&p[p.length-1][0]>=w)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);let A=n.parse(E,S,m);if(!A)return null;m=m||A.type,p.push([w,A])}return m.kind==="number"||m.kind==="color"||m.kind==="array"&&m.itemType.kind==="number"&&typeof m.N=="number"?new ni(m,i,s,l,p):n.error(`Type ${tr(m)} is not interpolatable.`)}evaluate(e){let n=this.labels,i=this.outputs;if(n.length===1)return i[0].evaluate(e);let s=this.input.evaluate(e);if(s<=n[0])return i[0].evaluate(e);let l=n.length;if(s>=n[l-1])return i[l-1].evaluate(e);let c=Fu(n,s),p=ni.interpolationFactor(this.interpolation,s,n[c],n[c+1]),m=i[c].evaluate(e),x=i[c+1].evaluate(e);return this.operator==="interpolate"?Du[this.type.kind.toLowerCase()](m,x,p):this.operator==="interpolate-hcl"?oc.reverse(oc.interpolate(oc.forward(m),oc.forward(x),p)):Aa.reverse(Aa.interpolate(Aa.forward(m),Aa.forward(x),p))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let i=0;i<this.labels.length;i++)n.push(this.labels[i],this.outputs[i].serialize());return n}}function qd(t,e,n,i){let s=i-n,l=t-n;return s===0?0:e===1?l/s:(Math.pow(e,l)-1)/(Math.pow(e,s)-1)}class Vu{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let i=null,s=n.expectedType;s&&s.kind!=="value"&&(i=s);let l=[];for(let p of e.slice(1)){let m=n.parse(p,1+l.length,i,void 0,{typeAnnotation:"omit"});if(!m)return null;i=i||m.type,l.push(m)}let c=s&&l.some(p=>$l(s,p.type));return new Vu(c?zt:i,l)}evaluate(e){let n,i=null,s=0;for(let l of this.args){if(s++,i=l.evaluate(e),i&&i instanceof ti&&!i.available&&(n||(n=i),i=null,s===this.args.length))return n;if(i!==null)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class ju{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let i=[];for(let l=1;l<e.length-1;l+=2){let c=e[l];if(typeof c!="string")return n.error(`Expected string, but found ${typeof c} instead.`,l);if(/[^a-zA-Z0-9_]/.test(c))return n.error("Variable names must contain only alphanumeric characters or '_'.",l);let p=n.parse(e[l+1],l+1);if(!p)return null;i.push([c,p])}let s=n.parse(e[e.length-1],e.length-1,n.expectedType,i);return s?new ju(i,s):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,i]of this.bindings)e.push(n,i.serialize());return e.push(this.result.serialize()),e}}class Wd{constructor(e,n,i){this.type=e,this.index=n,this.input=i}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let i=n.parse(e[1],1,st),s=n.parse(e[2],2,Hr(n.expectedType||zt));return i&&s?new Wd(s.type.itemType,i,s):null}evaluate(e){let n=this.index.evaluate(e),i=this.input.evaluate(e);if(n<0)throw new hr(`Array index out of bounds: ${n} < 0.`);if(n>=i.length)throw new hr(`Array index out of bounds: ${n} > ${i.length-1}.`);if(n!==Math.floor(n))throw new hr(`Array index must be an integer, but found ${n} instead.`);return i[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Zd{constructor(e,n){this.type=Jt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let i=n.parse(e[1],1,zt),s=n.parse(e[2],2,zt);return i&&s?Mu(i.type,[Jt,rn,st,Ei,zt])?new Zd(i,s):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${tr(i.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(i==null)return!1;if(!vs(n,["boolean","string","number","null"]))throw new hr(`Expected first argument to be of type boolean, string, number or null, but found ${tr(ir(n))} instead.`);if(!vs(i,["string","array"]))throw new hr(`Expected second argument to be of type array or string, but found ${tr(ir(i))} instead.`);return i.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ds{constructor(e,n,i){this.type=st,this.needle=e,this.haystack=n,this.fromIndex=i}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let i=n.parse(e[1],1,zt),s=n.parse(e[2],2,zt);if(!i||!s)return null;if(!Mu(i.type,[Jt,rn,st,Ei,zt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${tr(i.type)} instead`);if(e.length===4){let l=n.parse(e[3],3,st);return l?new Ds(i,s,l):null}return new Ds(i,s)}evaluate(e){let n=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!vs(n,["boolean","string","number","null"]))throw new hr(`Expected first argument to be of type boolean, string, number or null, but found ${tr(ir(n))} instead.`);if(!vs(i,["string","array"]))throw new hr(`Expected second argument to be of type array or string, but found ${tr(ir(i))} instead.`);if(this.fromIndex){let s=this.fromIndex.evaluate(e);return i.indexOf(n,s)}return i.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Xd{constructor(e,n,i,s,l,c){this.inputType=e,this.type=n,this.input=i,this.cases=s,this.outputs=l,this.otherwise=c}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let i,s;n.expectedType&&n.expectedType.kind!=="value"&&(s=n.expectedType);let l={},c=[];for(let x=2;x<e.length-1;x+=2){let w=e[x],E=e[x+1];Array.isArray(w)||(w=[w]);let D=n.concat(x);if(w.length===0)return D.error("Expected at least one branch label.");for(let A of w){if(typeof A!="number"&&typeof A!="string")return D.error("Branch labels must be numbers or strings.");if(typeof A=="number"&&Math.abs(A)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof A=="number"&&Math.floor(A)!==A)return D.error("Numeric branch labels must be integer values.");if(i){if(D.checkSubtype(i,ir(A)))return null}else i=ir(A);if(l[String(A)]!==void 0)return D.error("Branch labels must be unique.");l[String(A)]=c.length}let S=n.parse(E,x,s);if(!S)return null;s=s||S.type,c.push(S)}let p=n.parse(e[1],1,zt);if(!p)return null;let m=n.parse(e[e.length-1],e.length-1,s);return m?p.type.kind!=="value"&&n.concat(1).checkSubtype(i,p.type)?null:new Xd(i,s,p,l,c,m):null}evaluate(e){let n=this.input.evaluate(e);return(ir(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),i=[],s={};for(let c of n){let p=s[this.cases[c]];p===void 0?(s[this.cases[c]]=i.length,i.push([this.cases[c],[c]])):i[p][1].push(c)}let l=c=>this.inputType.kind==="number"?Number(c):c;for(let[c,p]of i)e.push(p.length===1?l(p[0]):p.map(l)),e.push(this.outputs[c].serialize());return e.push(this.otherwise.serialize()),e}}class Yd{constructor(e,n,i){this.type=e,this.branches=n,this.otherwise=i}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let i;n.expectedType&&n.expectedType.kind!=="value"&&(i=n.expectedType);let s=[];for(let c=1;c<e.length-1;c+=2){let p=n.parse(e[c],c,Jt);if(!p)return null;let m=n.parse(e[c+1],c+1,i);if(!m)return null;s.push([p,m]),i=i||m.type}let l=n.parse(e[e.length-1],e.length-1,i);return l?new Yd(i,s,l):null}evaluate(e){for(let[n,i]of this.branches)if(n.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,i]of this.branches)e(n),e(i);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Ms{constructor(e,n,i,s){this.type=e,this.input=n,this.beginIndex=i,this.endIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let i=n.parse(e[1],1,zt),s=n.parse(e[2],2,st);if(!i||!s)return null;if(!Mu(i.type,[Hr(zt),rn,zt]))return n.error(`Expected first argument to be of type array or string, but found ${tr(i.type)} instead`);if(e.length===4){let l=n.parse(e[3],3,st);return l?new Ms(i.type,i,s,l):null}return new Ms(i.type,i,s)}evaluate(e){let n=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!vs(n,["string","array"]))throw new hr(`Expected first argument to be of type array or string, but found ${tr(ir(n))} instead.`);if(this.endIndex){let s=this.endIndex.evaluate(e);return n.slice(i,s)}return n.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function om(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Qd(t,e,n,i){return i.compare(e,n)===0}function Pa(t,e,n){let i=t!=="=="&&t!=="!=";return class WM{constructor(l,c,p){this.type=Jt,this.lhs=l,this.rhs=c,this.collator=p,this.hasUntypedArgument=l.type.kind==="value"||c.type.kind==="value"}static parse(l,c){if(l.length!==3&&l.length!==4)return c.error("Expected two or three arguments.");let p=l[0],m=c.parse(l[1],1,zt);if(!m)return null;if(!om(p,m.type))return c.concat(1).error(`"${p}" comparisons are not supported for type '${tr(m.type)}'.`);let x=c.parse(l[2],2,zt);if(!x)return null;if(!om(p,x.type))return c.concat(2).error(`"${p}" comparisons are not supported for type '${tr(x.type)}'.`);if(m.type.kind!==x.type.kind&&m.type.kind!=="value"&&x.type.kind!=="value")return c.error(`Cannot compare types '${tr(m.type)}' and '${tr(x.type)}'.`);i&&(m.type.kind==="value"&&x.type.kind!=="value"?m=new Mi(x.type,[m]):m.type.kind!=="value"&&x.type.kind==="value"&&(x=new Mi(m.type,[x])));let w=null;if(l.length===4){if(m.type.kind!=="string"&&x.type.kind!=="string"&&m.type.kind!=="value"&&x.type.kind!=="value")return c.error("Cannot use collator to compare non-string types.");if(w=c.parse(l[3],3,Ul),!w)return null}return new WM(m,x,w)}evaluate(l){let c=this.lhs.evaluate(l),p=this.rhs.evaluate(l);if(i&&this.hasUntypedArgument){let m=ir(c),x=ir(p);if(m.kind!==x.kind||m.kind!=="string"&&m.kind!=="number")throw new hr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${m.kind}, ${x.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){let m=ir(c),x=ir(p);if(m.kind!=="string"||x.kind!=="string")return e(l,c,p)}return this.collator?n(l,c,p,this.collator.evaluate(l)):e(l,c,p)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){let l=[t];return this.eachChild(c=>{l.push(c.serialize())}),l}}}let sm=Pa("==",function(t,e,n){return e===n},Qd),am=Pa("!=",function(t,e,n){return e!==n},function(t,e,n,i){return!Qd(0,e,n,i)}),lm=Pa("<",function(t,e,n){return e<n},function(t,e,n,i){return i.compare(e,n)<0}),cm=Pa(">",function(t,e,n){return e>n},function(t,e,n,i){return i.compare(e,n)>0}),Kd=Pa("<=",function(t,e,n){return e<=n},function(t,e,n,i){return i.compare(e,n)<=0}),Jd=Pa(">=",function(t,e,n){return e>=n},function(t,e,n,i){return i.compare(e,n)>=0});class ef{constructor(e,n,i,s,l,c){this.type=rn,this.number=e,this.locale=n,this.currency=i,this.unit=s,this.minFractionDigits=l,this.maxFractionDigits=c}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let i=n.parse(e[1],1,st);if(!i)return null;let s=e[2];if(typeof s!="object"||Array.isArray(s))return n.error("NumberFormat options argument must be an object.");let l=null;if(s.locale&&(l=n.parse(s.locale,1,rn),!l))return null;let c=null;if(s.currency&&(c=n.parse(s.currency,1,rn),!c))return null;let p=null;if(s.unit&&(p=n.parse(s.unit,1,rn),!p))return null;let m=null;if(s["min-fraction-digits"]&&(m=n.parse(s["min-fraction-digits"],1,st),!m))return null;let x=null;return s["max-fraction-digits"]&&(x=n.parse(s["max-fraction-digits"],1,st),!x)?null:new ef(i,l,c,p,m,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class tf{constructor(e){this.type=st,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let i=n.parse(e[1],1);return i?i.type.kind!=="array"&&i.type.kind!=="string"&&i.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${tr(i.type)} instead.`):new tf(i):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new hr(`Expected value to be of type string or array, but found ${tr(ir(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function nf(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Ra={"==":sm,"!=":am,">":cm,"<":lm,">=":Jd,"<=":Kd,array:Mi,at:Wd,boolean:Mi,case:Yd,coalesce:Vu,collator:Xl,format:ql,image:Wl,in:Zd,"index-of":Ds,interpolate:ni,"interpolate-hcl":ni,"interpolate-lab":ni,length:tf,let:ju,literal:io,match:Xd,number:Mi,"number-format":ef,object:Mi,slice:Ms,step:Is,string:Mi,"to-boolean":$i,"to-color":$i,"to-number":$i,"to-string":$i,var:Ca,within:oo,distance:Hi,config:so};function um(t,[e,n,i,s]){e=e.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);let l=s?s.evaluate(t):1,c=Ii(e,n,i,l);if(c)throw new hr(c);return new nn(e/255*l,n/255*l,i/255*l,l)}function hm(t,[e,n,i,s]){e=e.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);let l=s?s.evaluate(t):1,c=function(x,w,E,D){return typeof x=="number"&&x>=0&&x<=360?typeof w=="number"&&w>=0&&w<=100&&typeof E=="number"&&E>=0&&E<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[x,w,E,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[x,w,E,D]:[x,w,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[x,w,E,D]:[x,w,E]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,i,l);if(c)throw new hr(c);let p=`hsla(${e}, ${n}%, ${i}%, ${l})`,m=nn.parse(p);if(!m)throw new hr(`Failed to parse HSLA color: ${p}`);return m}function dm(t,e){return t in e}function rf(t,e){let n=e[t];return n===void 0?null:n}function Cs(t){return{type:t}}function fm(t){return{result:"success",value:t}}function Ss(t){return{result:"error",value:t}}function pm(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function of(t){return t["property-type"]==="data-driven"}function u(t){return pm(t.expression,"measure-light")}function r(t){return pm(t.expression,"zoom")}function a(t){return!!t.expression&&t.expression.interpolated}function f(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function g(t){return t}function y(t,e){let n=e.type==="color",i=t.stops&&typeof t.stops[0][0]=="object",s=i||!(i||t.property!==void 0),l=t.type||(a(e)?"exponential":"interval");if(n&&((t=Id({},t)).stops&&(t.stops=t.stops.map(x=>[x[0],nn.parse(x[1])])),t.default=nn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!im[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let c,p,m;if(l==="exponential")c=C;else if(l==="interval")c=M;else if(l==="categorical"){c=T,p=Object.create(null);for(let x of t.stops)p[x[0]]=x[1];m=typeof t.stops[0][0]}else{if(l!=="identity")throw new Error(`Unknown function type "${l}"`);c=P}if(i){let x={},w=[];for(let S=0;S<t.stops.length;S++){let A=t.stops[S],R=A[0].zoom;x[R]===void 0&&(x[R]={zoom:R,type:t.type,property:t.property,default:t.default,stops:[]},w.push(R)),x[R].stops.push([A[0].value,A[1]])}let E=[];for(let S of w)E.push([x[S].zoom,y(x[S],e)]);let D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:ni.interpolationFactor.bind(void 0,D),zoomStops:E.map(S=>S[0]),evaluate:({zoom:S},A)=>C({stops:E,base:t.base},e,S).evaluate(S,A)}}if(s){let x=l==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:ni.interpolationFactor.bind(void 0,x),zoomStops:t.stops.map(w=>w[0]),evaluate:({zoom:w})=>c(t,e,w,p,m)}}return{kind:"source",evaluate(x,w){let E=w&&w.properties?w.properties[t.property]:void 0;return E===void 0?b(t.default,e.default):c(t,e,E,p,m)}}}function b(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function T(t,e,n,i,s){return b(typeof n===s?i[n]:void 0,t.default,e.default)}function M(t,e,n){if(bs(n)!=="number")return b(t.default,e.default);let i=t.stops.length;if(i===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];let s=Fu(t.stops.map(l=>l[0]),n);return t.stops[s][1]}function C(t,e,n){let i=t.base!==void 0?t.base:1;if(bs(n)!=="number")return b(t.default,e.default);let s=t.stops.length;if(s===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[s-1][0])return t.stops[s-1][1];let l=Fu(t.stops.map(w=>w[0]),n),c=function(w,E,D,S){let A=S-D,R=w-D;return A===0?0:E===1?R/A:(Math.pow(E,R)-1)/(Math.pow(E,A)-1)}(n,i,t.stops[l][0],t.stops[l+1][0]),p=t.stops[l][1],m=t.stops[l+1][1],x=Du[e.type]||g;if(t.colorSpace&&t.colorSpace!=="rgb"){let w=im[t.colorSpace];x=(E,D)=>w.reverse(w.interpolate(w.forward(E),w.forward(D),c))}return typeof p.evaluate=="function"?{evaluate(...w){let E=p.evaluate.apply(void 0,w),D=m.evaluate.apply(void 0,w);if(E!==void 0&&D!==void 0)return x(E,D,c)}}:x(p,m,c)}function P(t,e,n){return e.type==="color"?n=nn.parse(n):e.type==="formatted"?n=yr.fromString(n.toString()):e.type==="resolvedImage"?n=ti.fromString(n.toString()):bs(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),b(n,t.default,e.default)}Lr.register(Ra,{error:[{kind:"error"},[rn],(t,[e])=>{throw new hr(e.evaluate(t))}],typeof:[rn,[zt],(t,[e])=>tr(ir(e.evaluate(t)))],"to-rgba":[Hr(st,4),[ui],(t,[e])=>e.evaluate(t).toRenderColor(null).toArray()],rgb:[ui,[st,st,st],um],rgba:[ui,[st,st,st,st],um],hsl:[ui,[st,st,st],hm],hsla:[ui,[st,st,st,st],hm],has:{type:Jt,overloads:[[[rn],(t,[e])=>dm(e.evaluate(t),t.properties())],[[rn,xa],(t,[e,n])=>dm(e.evaluate(t),n.evaluate(t))]]},get:{type:zt,overloads:[[[rn],(t,[e])=>rf(e.evaluate(t),t.properties())],[[rn,xa],(t,[e,n])=>rf(e.evaluate(t),n.evaluate(t))]]},"feature-state":[zt,[rn],(t,[e])=>rf(e.evaluate(t),t.featureState||{})],properties:[xa,[],t=>t.properties()],"geometry-type":[rn,[],t=>t.geometryType()],id:[zt,[],t=>t.id()],zoom:[st,[],t=>t.globals.zoom],pitch:[st,[],t=>t.globals.pitch||0],"distance-from-center":[st,[],t=>t.distanceFromCenter()],"measure-light":[st,[rn],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[st,[],t=>t.globals.heatmapDensity||0],"line-progress":[st,[],t=>t.globals.lineProgress||0],"raster-value":[st,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[st,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[st,[],t=>t.globals.skyRadialProgress||0],accumulated:[zt,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[st,Cs(st),(t,e)=>{let n=0;for(let i of e)n+=i.evaluate(t);return n}],"*":[st,Cs(st),(t,e)=>{let n=1;for(let i of e)n*=i.evaluate(t);return n}],"-":{type:st,overloads:[[[st,st],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[st],(t,[e])=>-e.evaluate(t)]]},"/":[st,[st,st],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[st,[st,st],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[st,[],()=>Math.LN2],pi:[st,[],()=>Math.PI],e:[st,[],()=>Math.E],"^":[st,[st,st],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[st,[st],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[st,[st],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[st,[st],(t,[e])=>Math.log(e.evaluate(t))],log2:[st,[st],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[st,[st],(t,[e])=>Math.sin(e.evaluate(t))],cos:[st,[st],(t,[e])=>Math.cos(e.evaluate(t))],tan:[st,[st],(t,[e])=>Math.tan(e.evaluate(t))],asin:[st,[st],(t,[e])=>Math.asin(e.evaluate(t))],acos:[st,[st],(t,[e])=>Math.acos(e.evaluate(t))],atan:[st,[st],(t,[e])=>Math.atan(e.evaluate(t))],min:[st,Cs(st),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[st,Cs(st),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[st,[st],(t,[e])=>Math.abs(e.evaluate(t))],round:[st,[st],(t,[e])=>{let n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[st,[st],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[st,[st],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Jt,[rn,zt],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Jt,[zt],(t,[e])=>t.id()===e.value],"filter-type-==":[Jt,[rn],(t,[e])=>t.geometryType()===e.value],"filter-<":[Jt,[rn,zt],(t,[e,n])=>{let i=t.properties()[e.value],s=n.value;return typeof i==typeof s&&i<s}],"filter-id-<":[Jt,[zt],(t,[e])=>{let n=t.id(),i=e.value;return typeof n==typeof i&&n<i}],"filter->":[Jt,[rn,zt],(t,[e,n])=>{let i=t.properties()[e.value],s=n.value;return typeof i==typeof s&&i>s}],"filter-id->":[Jt,[zt],(t,[e])=>{let n=t.id(),i=e.value;return typeof n==typeof i&&n>i}],"filter-<=":[Jt,[rn,zt],(t,[e,n])=>{let i=t.properties()[e.value],s=n.value;return typeof i==typeof s&&i<=s}],"filter-id-<=":[Jt,[zt],(t,[e])=>{let n=t.id(),i=e.value;return typeof n==typeof i&&n<=i}],"filter->=":[Jt,[rn,zt],(t,[e,n])=>{let i=t.properties()[e.value],s=n.value;return typeof i==typeof s&&i>=s}],"filter-id->=":[Jt,[zt],(t,[e])=>{let n=t.id(),i=e.value;return typeof n==typeof i&&n>=i}],"filter-has":[Jt,[zt],(t,[e])=>e.value in t.properties()],"filter-has-id":[Jt,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Jt,[Hr(rn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Jt,[Hr(zt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Jt,[rn,Hr(zt)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Jt,[rn,Hr(zt)],(t,[e,n])=>function(i,s,l,c){for(;l<=c;){let p=l+c>>1;if(s[p]===i)return!0;s[p]>i?c=p-1:l=p+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Jt,overloads:[[[Jt,Jt],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Cs(Jt),(t,e)=>{for(let n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Jt,overloads:[[[Jt,Jt],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Cs(Jt),(t,e)=>{for(let n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Jt,[Jt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Jt,[rn],(t,[e])=>{let n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[rn,[rn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[rn,[rn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[rn,Cs(zt),(t,e)=>e.map(n=>Di(n.evaluate(t))).join("")],"resolved-locale":[rn,[Ul],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[st,[st,st,zt],(t,e)=>{let[n,i,s]=e.map(c=>c.evaluate(t));if(n>i||n===i)return n;let l;if(typeof s=="string")l=function(c){let p=0;if(c.length===0)return p;for(let m=0;m<c.length;m++)p=(p<<5)-p+c.charCodeAt(m),p|=0;return p}(s);else{if(typeof s!="number")throw new hr(`Invalid seed input: ${s}`);l=s}return n+nf(l)()*(i-n)}]});class L{constructor(e,n,i,s){this.expression=e,this._warningHistory={},this._evaluator=new Cu(i,s),this._defaultValue=n?function(l){return l.type==="color"&&(f(l.default)||Array.isArray(l.default))?new nn(0,0,0,0):l.type==="color"?nn.parse(l.default)||null:l.default===void 0?null:l.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,i,s,l,c,p,m){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=i,this._evaluator.canonical=s||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=c,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=m||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,i,s,l,c,p,m){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=i||null,this._evaluator.canonical=s||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=c||null,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=m||null;try{let x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new hr(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function F(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ra}function N(t,e,n,i){let s=new ku(Ra,[],e?function(c){let p={color:ui,string:rn,number:st,enum:rn,boolean:Jt,formatted:Gi,resolvedImage:Gl};return c.type==="array"?Hr(p[c.value]||zt,c.length):p[c.type]}(e):void 0,void 0,void 0,n,i),l=s.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?fm(new L(l,e,n,i)):Ss(s.errors)}class j{constructor(e,n,i){this.kind=e,this._styleExpression=n,this.isLightConstant=i,this.isStateDependent=e!=="constant"&&!Ou(n.expression),this.isConfigDependent=!Bd(n.expression)}evaluateWithoutErrorHandling(e,n,i,s,l,c){return this._styleExpression.evaluateWithoutErrorHandling(e,n,i,s,l,c)}evaluate(e,n,i,s,l,c){return this._styleExpression.evaluate(e,n,i,s,l,c)}}class U{constructor(e,n,i,s,l){this.kind=e,this.zoomStops=i,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Ou(n.expression),this.isLightConstant=l,this.isConfigDependent=!Bd(n.expression),this.interpolationType=s}evaluateWithoutErrorHandling(e,n,i,s,l,c){return this._styleExpression.evaluateWithoutErrorHandling(e,n,i,s,l,c)}evaluate(e,n,i,s,l,c){return this._styleExpression.evaluate(e,n,i,s,l,c)}interpolationFactor(e,n,i){return this.interpolationType?ni.interpolationFactor(this.interpolationType,e,n,i):0}}function G(t,e,n,i){if((t=N(t,e,n,i)).result==="error")return t;let s=t.value.expression,l=nc(s);if(!l&&!of(e))return Ss([new Ui("","data expressions not supported")]);let c=rc(s,["zoom","pitch","distance-from-center"]);if(!c&&!r(e))return Ss([new Ui("","zoom expressions not supported")]);let p=rc(s,["measure-light"]);if(!p&&!u(e))return Ss([new Ui("","measure-light expression not supported")]);let m=e.expression&&e.expression.relaxZoomRestriction,x=Q(s);return x||c||m?x instanceof Ui?Ss([x]):x instanceof ni&&!a(e)?Ss([new Ui("",'"interpolate" expressions cannot be used with this property')]):fm(x?new U(l?"camera":"composite",t.value,x.labels,x instanceof ni?x.interpolation:void 0,p):new j(l?"constant":"source",t.value,p)):Ss([new Ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ${constructor(e,n){this._parameters=e,this._specification=n,Id(this,y(this._parameters,this._specification))}static deserialize(e){return new $(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Q(t){let e=null;if(t instanceof ju)e=Q(t.result);else if(t instanceof Vu){for(let n of t.args)if(e=Q(n),e)break}else(t instanceof Is||t instanceof ni)&&t.input instanceof Lr&&t.input.name==="zoom"&&(e=t);return e instanceof Ui||t.eachChild(n=>{let i=Q(n);i instanceof Ui?e=i:e&&i&&e!==i&&(e=new Ui("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var K=oe,J=3;function oe(t,e,n){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var s=new Int32Array(this.arrayBuffer);t=s[0],this.d=(e=s[1])+2*(n=s[2]);for(var l=0;l<this.d*this.d;l++){var c=s[J+l],p=s[J+l+1];i.push(c===p?null:s.subarray(c,p))}var m=s[J+i.length+1];this.keys=s.subarray(s[J+i.length],m),this.bboxes=s.subarray(m),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var x=0;x<this.d*this.d;x++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var w=n/e*t;this.min=-w,this.max=t+w}oe.prototype.insert=function(t,e,n,i,s){this._forEachCell(e,n,i,s,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(s)},oe.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},oe.prototype._insertCell=function(t,e,n,i,s,l){this.cells[s].push(l)},oe.prototype.query=function(t,e,n,i,s){var l=this.min,c=this.max;if(t<=l&&e<=l&&c<=n&&c<=i&&!s)return Array.prototype.slice.call(this.keys);var p=[];return this._forEachCell(t,e,n,i,this._queryCell,p,{},s),p},oe.prototype._queryCell=function(t,e,n,i,s,l,c,p){var m=this.cells[s];if(m!==null)for(var x=this.keys,w=this.bboxes,E=0;E<m.length;E++){var D=m[E];if(c[D]===void 0){var S=4*D;(p?p(w[S+0],w[S+1],w[S+2],w[S+3]):t<=w[S+2]&&e<=w[S+3]&&n>=w[S+0]&&i>=w[S+1])?(c[D]=!0,l.push(x[D])):c[D]=!1}}},oe.prototype._forEachCell=function(t,e,n,i,s,l,c,p){for(var m=this._convertToCellCoord(t),x=this._convertToCellCoord(e),w=this._convertToCellCoord(n),E=this._convertToCellCoord(i),D=m;D<=w;D++)for(var S=x;S<=E;S++){var A=this.d*S+D;if((!p||p(this._convertFromCellCoord(D),this._convertFromCellCoord(S),this._convertFromCellCoord(D+1),this._convertFromCellCoord(S+1)))&&s.call(this,t,e,n,i,A,l,c,p))return}},oe.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},oe.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},oe.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=J+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var s=new Int32Array(e+n+this.keys.length+this.bboxes.length);s[0]=this.extent,s[1]=this.n,s[2]=this.padding;for(var l=e,c=0;c<t.length;c++){var p=t[c];s[J+c]=l,s.set(p,l),l+=p.length}return s[J+t.length]=l,s.set(this.keys,l),s[J+t.length+1]=l+=this.keys.length,s.set(this.bboxes,l),l+=this.bboxes.length,s.buffer};var ie=Rt(K);let ce={};function q(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),ce[e]={klass:t,omit:n.omit||[]}}q(Object,"Object"),ie.serialize=function(t,e){let n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},ie.deserialize=function(t){return new ie(t.buffer)},Object.defineProperty(ie,"name",{value:"Grid"}),q(ie,"Grid"),q(nn,"Color"),q(Error,"Error"),q(yr,"Formatted"),q(Hl,"FormattedSection"),q(yu,"AJAXError"),q(ti,"ResolvedImage"),q($,"StylePropertyFunction"),q(L,"StyleExpression",{omit:["_evaluator"]}),q(U,"ZoomDependentExpression"),q(j,"ZoomConstantExpression"),q(Lr,"CompoundExpression",{omit:["_evaluate"]});for(let t in Ra)ce[Ra[t]._classRegistryKey]||q(Ra[t],`Expression${t}`);function ee(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function he(t){return self.ImageBitmap&&t instanceof ImageBitmap}function we(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(ee(t)||he(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let n=[];for(let i of t)n.push(we(i,e));return n}if(t instanceof Map){let n={$name:"Map"};for(let[i,s]of t.entries())n[i]=we(s);return n}if(typeof t=="object"){let n=t.constructor,i=n._classRegistryKey;if(!i)throw new Error(`can't serialize object of unregistered class ${i}`);let s=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(let l in t)t.hasOwnProperty(l)&&(ce[i].omit.indexOf(l)>=0||(s[l]=we(t[l],e)));t instanceof Error&&(s.message=t.message)}if(s.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(s.$name=i),s}throw new Error("can't serialize object of type "+typeof t)}function pe(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||ee(t)||he(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(pe);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let s=new Map;for(let l of Object.keys(t))l!=="$name"&&s.set(l,pe(t[l]));return s}let{klass:n}=ce[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);let i=Object.create(n.prototype);for(let s of Object.keys(t))s!=="$name"&&(i[s]=pe(t[s]));return i}throw new Error("can't deserialize object of type "+typeof t)}let ae={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Ee(t){for(let e of t)if(ke(e.charCodeAt(0)))return!0;return!1}function Fe(t){for(let e of t)if(!ze(e.charCodeAt(0)))return!1;return!0}function ze(t){return!(ae.Arabic(t)||ae["Arabic Supplement"](t)||ae["Arabic Extended-A"](t)||ae["Arabic Presentation Forms-A"](t)||ae["Arabic Presentation Forms-B"](t))}function ke(t){return!(t!==746&&t!==747&&(t<4352||!(ae["Bopomofo Extended"](t)||ae.Bopomofo(t)||ae["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||ae["CJK Compatibility Ideographs"](t)||ae["CJK Compatibility"](t)||ae["CJK Radicals Supplement"](t)||ae["CJK Strokes"](t)||!(!ae["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||ae["CJK Unified Ideographs Extension A"](t)||ae["CJK Unified Ideographs"](t)||ae["Enclosed CJK Letters and Months"](t)||ae["Hangul Compatibility Jamo"](t)||ae["Hangul Jamo Extended-A"](t)||ae["Hangul Jamo Extended-B"](t)||ae["Hangul Jamo"](t)||ae["Hangul Syllables"](t)||ae.Hiragana(t)||ae["Ideographic Description Characters"](t)||ae.Kanbun(t)||ae["Kangxi Radicals"](t)||ae["Katakana Phonetic Extensions"](t)||ae.Katakana(t)&&t!==12540||!(!ae["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!ae["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||ae["Unified Canadian Aboriginal Syllabics"](t)||ae["Unified Canadian Aboriginal Syllabics Extended"](t)||ae["Vertical Forms"](t)||ae["Yijing Hexagram Symbols"](t)||ae["Yi Syllables"](t)||ae["Yi Radicals"](t))))}function _e(t){return!(ke(t)||function(e){return!!(ae["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ae["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ae["Letterlike Symbols"](e)||ae["Number Forms"](e)||ae["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ae["Control Pictures"](e)&&e!==9251||ae["Optical Character Recognition"](e)||ae["Enclosed Alphanumerics"](e)||ae["Geometric Shapes"](e)||ae["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ae["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ae["CJK Symbols and Punctuation"](e)||ae.Katakana(e)||ae["Private Use Area"](e)||ae["CJK Compatibility Forms"](e)||ae["Small Form Variants"](e)||ae["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function De(t){return t>=1424&&t<=2303||ae["Arabic Presentation Forms-A"](t)||ae["Arabic Presentation Forms-B"](t)}function Re(t,e){return!(!e&&De(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||ae.Khmer(t))}function Qe(t){for(let e of t)if(De(e.charCodeAt(0)))return!0;return!1}let Ke="deferred",nt="loading",Je="loaded",Ze=null,Ae="unavailable",at=null,Lt=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Ae="error"),Ze&&Ze(t)};function gt(){It.fire(new ei("pluginStateChange",{pluginStatus:Ae,pluginURL:at}))}let It=new xs,Gt=function(){return Ae},Ln=function(){if(Ae!==Ke||!at)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ae=nt,gt(),at&&zo({url:at},t=>{t?Lt(t):(Ae=Je,gt())})},Bt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ae===Je||Bt.applyArabicShaping!=null,isLoading:()=>Ae===nt,setState(t){Ae=t.pluginStatus,at=t.pluginURL},isParsed:()=>Bt.applyArabicShaping!=null&&Bt.processBidirectionalText!=null&&Bt.processStyledBidirectionalText!=null,getPluginURL:()=>at};class vt{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,i){for(let s of n)if(!Re(s.charCodeAt(0),i))return!1;return!0}(e,Bt.isLoaded())}}class wn{constructor(e,n,i,s){this.property=e,this.value=n,this.expression=function(l,c,p,m){if(f(l))return new $(l,c);if(F(l)||Array.isArray(l)&&l.length>0){let x=G(l,c,p,m);if(x.result==="error")throw new Error(x.value.map(w=>`${w.key}: ${w.message}`).join(", "));return x.value}{let x=l;return typeof l=="string"&&c.type==="color"&&(x=nn.parse(l)),{kind:"constant",isConfigDependent:!1,evaluate:()=>x}}}(n===void 0?e.specification.default:n,e.specification,i,s)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,i){return this.property.possiblyEvaluate(this,e,n,i)}}class dn{constructor(e,n,i){this.property=e,this.value=new wn(e,void 0,n,i)}transitioned(e,n){return new Dt(this.property,this.value,n,Pr({},e.transition,this.transition),e.now)}untransitioned(){return new Dt(this.property,this.value,null,{},0)}}class $t{constructor(e,n,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=i,this.isConfigDependent=!1}getValue(e){return Vi(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new dn(this._values[e].property,this._scope,this._options)),this._values[e].value=new wn(this._values[e].property,n===null?void 0:Vi(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let i=this._properties.properties;if(e)for(let s in e){let l=e[s];if(fs(s,"-transition")){let c=s.slice(0,-11);i[c]&&this.setTransition(c,l)}else i.hasOwnProperty(s)&&this.setValue(s,l)}}getTransition(e){return Vi(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new dn(this._values[e].property)),this._values[e].transition=Vi(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let i=this.getValue(n);i!==void 0&&(e[n]=i);let s=this.getTransition(n);s!==void 0&&(e[`${n}-transition`]=s)}return e}transitioned(e,n){let i=new Dn(this._properties);for(let s of Object.keys(this._values))i._values[s]=this._values[s].transitioned(e,n._values[s]);return i}untransitioned(){let e=new Dn(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Dt{constructor(e,n,i,s,l){let c=s.delay||0,p=s.duration||0;l=l||0,this.property=e,this.value=n,this.begin=l+c,this.end=this.begin+p,e.specification.transition&&(s.delay||s.duration)&&(this.prior=i)}possiblyEvaluate(e,n,i){let s=e.now||0,l=this.value.possiblyEvaluate(e,n,i),c=this.prior;if(c){if(s>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(s<this.begin)return c.possiblyEvaluate(e,n,i);{let p=(s-this.begin)/(this.end-this.begin);return this.property.interpolate(c.possiblyEvaluate(e,n,i),l,Pl(p))}}return l}}class Dn{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,i){let s=new Mn(this._properties);for(let l of Object.keys(this._values))s._values[l]=this._values[l].possiblyEvaluate(e,n,i);return s}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Xn{constructor(e,n,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=i,this.isConfigDependent=!1}getValue(e){return Vi(this._values[e].value)}setValue(e,n){this._values[e]=new wn(this._values[e].property,n===null?void 0:Vi(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let i=this.getValue(n);i!==void 0&&(e[n]=i)}return e}possiblyEvaluate(e,n,i){let s=new Mn(this._properties);for(let l of Object.keys(this._values))s._values[l]=this._values[l].possiblyEvaluate(e,n,i);return s}}class gn{constructor(e,n,i){this.property=e,this.value=n,this.parameters=i}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,i,s){return this.property.evaluate(this.value,this.parameters,e,n,i,s)}}class Mn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Oe{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,i){let s=Du[this.specification.type];return s?s(e,n,i):e}}class it{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,i,s){return new gn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},i,s)}:e.expression,n)}interpolate(e,n,i){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new gn(this,{kind:"constant",value:void 0},e.parameters);let s=Du[this.specification.type];return s?new gn(this,{kind:"constant",value:s(e.value.value,n.value.value,i)},e.parameters):e}evaluate(e,n,i,s,l,c){return e.kind==="constant"?e.value:e.evaluate(n,i,s,l,c)}}class dr{constructor(e){this.specification=e}possiblyEvaluate(e,n,i,s){return!!e.expression.evaluate(n,null,{},i,s)}interpolate(){return!1}}class ln{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new vt(0,{});for(let i in e){let s=e[i];s.specification.overridable&&this.overridableProperties.push(i);let l=this.defaultPropertyValues[i]=new wn(s,void 0),c=this.defaultTransitionablePropertyValues[i]=new dn(s);this.defaultTransitioningPropertyValues[i]=c.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=l.possiblyEvaluate(n)}}}q(it,"DataDrivenProperty"),q(Oe,"DataConstantProperty"),q(dr,"ColorRampProperty");var be=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Or(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Ir(t){if(Array.isArray(t))return t.map(Ir);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let n in t)e[n]=Ir(t[n]);return e}return Or(t)}function fr(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!fr(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Dr(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};fr(t)||(t=qi(t));let n=t,i=!0;try{i=function(x){if(!ri(x))return x;let w=Ir(x);return ao(w),w=Ai(w),w}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let s=be[`filter_${e}`],l=N(i,s),c=null;if(l.result==="error")throw new Error(l.value.map(x=>`${x.key}: ${x.message}`).join(", "));c=(x,w,E)=>l.value.evaluate(x,w,{},E);let p=null,m=null;if(i!==n){let x=N(n,s);if(x.result==="error")throw new Error(x.value.map(w=>`${w.key}: ${w.message}`).join(", "));p=(w,E,D,S,A)=>x.value.evaluate(w,E,{},D,void 0,void 0,S,A),m=!nc(x.value.expression)}return{filter:c,dynamicFilter:p||void 0,needGeometry:Go(i),needFeature:!!m}}function Ai(t){if(!Array.isArray(t))return t;let e=function(n){if(jo.has(n[0])){for(let i=1;i<n.length;i++)if(ri(n[i]))return!0}return n}(t);return e===!0?e:e.map(n=>Ai(n))}function ao(t){let e=!1,n=[];if(t[0]==="case"){for(let i=1;i<t.length-1;i+=2)e=e||ri(t[i]),n.push(t[i+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||ri(t[1]);for(let i=2;i<t.length-1;i+=2)n.push(t[i+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||ri(t[1]);for(let i=1;i<t.length-1;i+=2)n.push(t[i+1])}e&&(t.length=0,t.push("any",...n));for(let i=1;i<t.length;i++)ao(t[i])}function ri(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(ri(t[n]))return!0;return!1}let jo=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Uo(t,e){return t<e?-1:t>e?1:0}function Go(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Go(t[e]))return!0;return!1}function qi(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?As(t[1],t[2],"=="):e==="!="?Oa(As(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?As(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(qi))):e==="all"?["all"].concat(t.slice(1).map(qi)):e==="none"?["all"].concat(t.slice(1).map(qi).map(Oa)):e==="in"?La(t[1],t.slice(2)):e==="!in"?Oa(La(t[1],t.slice(2))):e==="has"?sc(t[1]):e!=="!has"||Oa(sc(t[1]));var n}function As(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function La(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Uo)]]:["filter-in-small",t,["literal",e]]}}function sc(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Oa(t){return["!",t]}let ka="";function Uu(t,e){return e?`${t}${ka}${e}`:t}let Gu="-transition",Ps=new Set(["fill","line","background","hillshade","raster"]);class Mr extends xs{constructor(e,n,i,s,l){if(super(),this.id=e.id,this.fqid=Uu(this.id,i),this.type=e.type,this.scope=i,this.lut=s,this.options=l,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new Xn(n.layout,this.scope,l),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new $t(n.paint,this.scope,l);for(let c in e.paint)this.setPaintProperty(c,e.paint[c]);for(let c in e.layout)this.setLayoutProperty(c,e.layout[c]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Mn(n.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return Ps.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let i=this._unevaluatedLayout;i._properties.properties[e]&&(i.setValue(e,n),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return fs(e,Gu)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){let i=this._transitionablePaint,s=i._properties.properties;if(fs(e,Gu)){let E=e.slice(0,-11);return s[E]&&i.setTransition(E,n||void 0),!1}if(!s[e])return!1;let l=i._values[e],c=l.value.isDataDriven(),p=l.value;i.setValue(e,n),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let m=i._values[e].value,x=m.isDataDriven(),w=fs(e,"pattern")||e==="line-dasharray";return x||c||w||this._handleOverridablePaintPropertyUpdate(e,p,m)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,i){return null}_handleOverridablePaintPropertyUpdate(e,n,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return id({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof gn&&of(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Dr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,i,s,l,c,p,m,x){}queryIntersectsMatchingFeature(e,n,i,s){}}let sf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class mm{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Bn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function un(t,e=1){let n=0,i=0;return{members:t.map(s=>{let l=sf[s.type].BYTES_PER_ELEMENT,c=n=L1(n,Math.max(e,l)),p=s.components||1;return i=Math.max(i,l),n+=l*p,{name:s.name,type:s.type,components:p,offset:c}}),size:L1(n,Math.max(i,e)),alignment:e}}function L1(t,e){return Math.ceil(t/e)*e}class lo extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){let s=2*e;return this.int16[s+0]=n,this.int16[s+1]=i,e}}lo.prototype.bytesPerElement=4,q(lo,"StructArrayLayout2i4");class gm extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i){let s=this.length;return this.resize(s+1),this.emplace(s,e,n,i)}emplace(e,n,i,s){let l=3*e;return this.int16[l+0]=n,this.int16[l+1]=i,this.int16[l+2]=s,e}}gm.prototype.bytesPerElement=6,q(gm,"StructArrayLayout3i6");class Fa extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,s)}emplace(e,n,i,s,l){let c=4*e;return this.int16[c+0]=n,this.int16[c+1]=i,this.int16[c+2]=s,this.int16[c+3]=l,e}}Fa.prototype.bytesPerElement=8,q(Fa,"StructArrayLayout4i8");class uy extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,s,l){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,i,s,l)}emplace(e,n,i,s,l,c){let p=5*e;return this.int16[p+0]=n,this.int16[p+1]=i,this.int16[p+2]=s,this.int16[p+3]=l,this.int16[p+4]=c,e}}uy.prototype.bytesPerElement=10,q(uy,"StructArrayLayout5i10");class hy extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,l,c,p){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,i,s,l,c,p)}emplace(e,n,i,s,l,c,p,m){let x=6*e,w=12*e,E=3*e;return this.int16[x+0]=n,this.int16[x+1]=i,this.uint8[w+4]=s,this.uint8[w+5]=l,this.uint8[w+6]=c,this.uint8[w+7]=p,this.float32[E+2]=m,e}}hy.prototype.bytesPerElement=12,q(hy,"StructArrayLayout2i4ub1f12");class Na extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,s)}emplace(e,n,i,s,l){let c=4*e;return this.float32[c+0]=n,this.float32[c+1]=i,this.float32[c+2]=s,this.float32[c+3]=l,e}}Na.prototype.bytesPerElement=16,q(Na,"StructArrayLayout4f16");class za extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i){let s=this.length;return this.resize(s+1),this.emplace(s,e,n,i)}emplace(e,n,i,s){let l=3*e;return this.float32[l+0]=n,this.float32[l+1]=i,this.float32[l+2]=s,e}}za.prototype.bytesPerElement=12,q(za,"StructArrayLayout3f12");class Ba extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,l){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,i,s,l)}emplace(e,n,i,s,l,c){let p=6*e,m=3*e;return this.uint16[p+0]=n,this.uint16[p+1]=i,this.uint16[p+2]=s,this.uint16[p+3]=l,this.float32[m+2]=c,e}}Ba.prototype.bytesPerElement=12,q(Ba,"StructArrayLayout4ui1f12");class _m extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,s)}emplace(e,n,i,s,l){let c=4*e;return this.uint16[c+0]=n,this.uint16[c+1]=i,this.uint16[c+2]=s,this.uint16[c+3]=l,e}}_m.prototype.bytesPerElement=8,q(_m,"StructArrayLayout4ui8");class ym extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,s,l,c){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,i,s,l,c)}emplace(e,n,i,s,l,c,p){let m=6*e;return this.int16[m+0]=n,this.int16[m+1]=i,this.int16[m+2]=s,this.int16[m+3]=l,this.int16[m+4]=c,this.int16[m+5]=p,e}}ym.prototype.bytesPerElement=12,q(ym,"StructArrayLayout6i12");class dy extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,s,l,c,p,m,x,w,E,D){let S=this.length;return this.resize(S+1),this.emplace(S,e,n,i,s,l,c,p,m,x,w,E,D)}emplace(e,n,i,s,l,c,p,m,x,w,E,D,S){let A=12*e;return this.int16[A+0]=n,this.int16[A+1]=i,this.int16[A+2]=s,this.int16[A+3]=l,this.uint16[A+4]=c,this.uint16[A+5]=p,this.uint16[A+6]=m,this.uint16[A+7]=x,this.int16[A+8]=w,this.int16[A+9]=E,this.int16[A+10]=D,this.int16[A+11]=S,e}}dy.prototype.bytesPerElement=24,q(dy,"StructArrayLayout4i4ui4i24");class fy extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,l,c){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,i,s,l,c)}emplace(e,n,i,s,l,c,p){let m=10*e,x=5*e;return this.int16[m+0]=n,this.int16[m+1]=i,this.int16[m+2]=s,this.float32[x+2]=l,this.float32[x+3]=c,this.float32[x+4]=p,e}}fy.prototype.bytesPerElement=20,q(fy,"StructArrayLayout3i3f20");class py extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}py.prototype.bytesPerElement=4,q(py,"StructArrayLayout1ul4");class ac extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}ac.prototype.bytesPerElement=4,q(ac,"StructArrayLayout1f4");class Va extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){let s=2*e;return this.uint16[s+0]=n,this.uint16[s+1]=i,e}}Va.prototype.bytesPerElement=4,q(Va,"StructArrayLayout2ui4");class my extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,s,l,c,p,m,x,w,E,D,S){let A=this.length;return this.resize(A+1),this.emplace(A,e,n,i,s,l,c,p,m,x,w,E,D,S)}emplace(e,n,i,s,l,c,p,m,x,w,E,D,S,A){let R=20*e,O=10*e;return this.int16[R+0]=n,this.int16[R+1]=i,this.int16[R+2]=s,this.int16[R+3]=l,this.int16[R+4]=c,this.float32[O+3]=p,this.float32[O+4]=m,this.float32[O+5]=x,this.float32[O+6]=w,this.int16[R+14]=E,this.uint32[O+8]=D,this.uint16[R+18]=S,this.uint16[R+19]=A,e}}my.prototype.bytesPerElement=40,q(my,"StructArrayLayout5i4f1i1ul2ui40");class xm extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,s,l,c,p){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,i,s,l,c,p)}emplace(e,n,i,s,l,c,p,m){let x=8*e;return this.int16[x+0]=n,this.int16[x+1]=i,this.int16[x+2]=s,this.int16[x+4]=l,this.int16[x+5]=c,this.int16[x+6]=p,this.int16[x+7]=m,e}}xm.prototype.bytesPerElement=16,q(xm,"StructArrayLayout3i2i2i16");class gy extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,s,l){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,i,s,l)}emplace(e,n,i,s,l,c){let p=4*e,m=8*e;return this.float32[p+0]=n,this.float32[p+1]=i,this.float32[p+2]=s,this.int16[m+6]=l,this.int16[m+7]=c,e}}gy.prototype.bytesPerElement=16,q(gy,"StructArrayLayout2f1f2i16");class _y extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,s)}emplace(e,n,i,s,l){let c=12*e,p=3*e;return this.uint8[c+0]=n,this.uint8[c+1]=i,this.float32[p+1]=s,this.float32[p+2]=l,e}}_y.prototype.bytesPerElement=12,q(_y,"StructArrayLayout2ub2f12");class pr extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i){let s=this.length;return this.resize(s+1),this.emplace(s,e,n,i)}emplace(e,n,i,s){let l=3*e;return this.uint16[l+0]=n,this.uint16[l+1]=i,this.uint16[l+2]=s,e}}pr.prototype.bytesPerElement=6,q(pr,"StructArrayLayout3ui6");class yy extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,l,c,p,m,x,w,E,D,S,A,R,O,z,W,X,Y,re){let ne=this.length;return this.resize(ne+1),this.emplace(ne,e,n,i,s,l,c,p,m,x,w,E,D,S,A,R,O,z,W,X,Y,re)}emplace(e,n,i,s,l,c,p,m,x,w,E,D,S,A,R,O,z,W,X,Y,re,ne){let ue=30*e,de=15*e,ve=60*e;return this.int16[ue+0]=n,this.int16[ue+1]=i,this.int16[ue+2]=s,this.float32[de+2]=l,this.float32[de+3]=c,this.uint16[ue+8]=p,this.uint16[ue+9]=m,this.uint32[de+5]=x,this.uint32[de+6]=w,this.uint32[de+7]=E,this.uint16[ue+16]=D,this.uint16[ue+17]=S,this.uint16[ue+18]=A,this.float32[de+10]=R,this.float32[de+11]=O,this.uint8[ve+48]=z,this.uint8[ve+49]=W,this.uint8[ve+50]=X,this.uint32[de+13]=Y,this.int16[ue+28]=re,this.uint8[ve+58]=ne,e}}yy.prototype.bytesPerElement=60,q(yy,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class xy extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,l,c,p,m,x,w,E,D,S,A,R,O,z,W,X,Y,re,ne,ue,de,ve,Ce,Te,Le,Ue,Pe,Be,Se,Ve,He){let je=this.length;return this.resize(je+1),this.emplace(je,e,n,i,s,l,c,p,m,x,w,E,D,S,A,R,O,z,W,X,Y,re,ne,ue,de,ve,Ce,Te,Le,Ue,Pe,Be,Se,Ve,He)}emplace(e,n,i,s,l,c,p,m,x,w,E,D,S,A,R,O,z,W,X,Y,re,ne,ue,de,ve,Ce,Te,Le,Ue,Pe,Be,Se,Ve,He,je){let rt=22*e,Ge=44*e,We=88*e;return this.float32[rt+0]=n,this.float32[rt+1]=i,this.int16[Ge+4]=s,this.int16[Ge+5]=l,this.int16[Ge+6]=c,this.int16[Ge+7]=p,this.int16[Ge+8]=m,this.int16[Ge+9]=x,this.int16[Ge+10]=w,this.int16[Ge+11]=E,this.int16[Ge+12]=D,this.uint16[Ge+13]=S,this.uint16[Ge+14]=A,this.uint16[Ge+15]=R,this.uint16[Ge+16]=O,this.uint16[Ge+17]=z,this.uint16[Ge+18]=W,this.uint16[Ge+19]=X,this.uint16[Ge+20]=Y,this.uint16[Ge+21]=re,this.uint16[Ge+22]=ne,this.uint16[Ge+23]=ue,this.uint16[Ge+24]=de,this.uint16[Ge+25]=ve,this.uint16[Ge+26]=Ce,this.uint16[Ge+27]=Te,this.uint32[rt+14]=Le,this.float32[rt+15]=Ue,this.float32[rt+16]=Pe,this.float32[rt+17]=Be,this.float32[rt+18]=Se,this.float32[rt+19]=Ve,this.float32[rt+20]=He,this.uint8[We+84]=je,e}}xy.prototype.bytesPerElement=88,q(xy,"StructArrayLayout2f9i15ui1ul6f1ub88");class lc extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,l){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,i,s,l)}emplace(e,n,i,s,l,c){let p=5*e;return this.float32[p+0]=n,this.float32[p+1]=i,this.float32[p+2]=s,this.float32[p+3]=l,this.float32[p+4]=c,e}}lc.prototype.bytesPerElement=20,q(lc,"StructArrayLayout5f20");class vy extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,l,c,p){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,i,s,l,c,p)}emplace(e,n,i,s,l,c,p,m){let x=7*e;return this.float32[x+0]=n,this.float32[x+1]=i,this.float32[x+2]=s,this.float32[x+3]=l,this.float32[x+4]=c,this.float32[x+5]=p,this.float32[x+6]=m,e}}vy.prototype.bytesPerElement=28,q(vy,"StructArrayLayout7f28");class $u extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){let s=2*e;return this.float32[s+0]=n,this.float32[s+1]=i,e}}$u.prototype.bytesPerElement=8,q($u,"StructArrayLayout2f8");class by extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,s)}emplace(e,n,i,s,l){let c=6*e;return this.uint32[3*e+0]=n,this.uint16[c+2]=i,this.uint16[c+3]=s,this.uint16[c+4]=l,e}}by.prototype.bytesPerElement=12,q(by,"StructArrayLayout1ul3ui12");class af extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}af.prototype.bytesPerElement=2,q(af,"StructArrayLayout1ui2");class wy extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,l,c,p,m,x,w,E,D,S,A,R,O){let z=this.length;return this.resize(z+1),this.emplace(z,e,n,i,s,l,c,p,m,x,w,E,D,S,A,R,O)}emplace(e,n,i,s,l,c,p,m,x,w,E,D,S,A,R,O,z){let W=16*e;return this.float32[W+0]=n,this.float32[W+1]=i,this.float32[W+2]=s,this.float32[W+3]=l,this.float32[W+4]=c,this.float32[W+5]=p,this.float32[W+6]=m,this.float32[W+7]=x,this.float32[W+8]=w,this.float32[W+9]=E,this.float32[W+10]=D,this.float32[W+11]=S,this.float32[W+12]=A,this.float32[W+13]=R,this.float32[W+14]=O,this.float32[W+15]=z,e}}wy.prototype.bytesPerElement=64,q(wy,"StructArrayLayout16f64");class vm extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,l,c,p){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,i,s,l,c,p)}emplace(e,n,i,s,l,c,p,m){let x=10*e,w=5*e;return this.uint16[x+0]=n,this.uint16[x+1]=i,this.uint16[x+2]=s,this.uint16[x+3]=l,this.float32[w+2]=c,this.float32[w+3]=p,this.float32[w+4]=m,e}}vm.prototype.bytesPerElement=20,q(vm,"StructArrayLayout4ui3f20");class Ty extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}Ty.prototype.bytesPerElement=2,q(Ty,"StructArrayLayout1i2");class Ey extends Bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}Ey.prototype.bytesPerElement=1,q(Ey,"StructArrayLayout1ub1");class O1 extends mm{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}O1.prototype.size=40;class Iy extends my{get(e){return new O1(this,e)}}q(Iy,"CollisionBoxArray");class k1 extends mm{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}k1.prototype.size=60;class F1 extends yy{get(e){return new k1(this,e)}}q(F1,"PlacedSymbolArray");class N1 extends mm{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}N1.prototype.size=88;class z1 extends xy{get(e){return new N1(this,e)}}q(z1,"SymbolInstanceArray");class B1 extends ac{getoffsetX(e){return this.float32[1*e+0]}}q(B1,"GlyphOffsetArray");class V1 extends lo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}q(V1,"SymbolLineVertexArray");class j1 extends mm{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}j1.prototype.size=12;class U1 extends by{get(e){return new j1(this,e)}}q(U1,"FeatureIndexArray");class G1 extends Va{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}q(G1,"FillExtrusionCentroidArray");let CC=un([{name:"a_pos",components:2,type:"Int16"}],4),SC=un([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class $n{constructor(e=[]){this.segments=e}_prepareSegment(e,n,i,s){let l=this.segments[this.segments.length-1];return e>$n.MAX_VERTEX_ARRAY_LENGTH&&Qn(`Max vertices per segment is ${$n.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>$n.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==s)&&(l={vertexOffset:n,primitiveOffset:i,vertexLength:0,primitiveLength:0},s!==void 0&&(l.sortKey=s),this.segments.push(l)),l}prepareSegment(e,n,i,s){return this._prepareSegment(e,n.length,i.length,s)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,i,s){return new $n([{vertexOffset:e,primitiveOffset:n,vertexLength:i,primitiveLength:s,vaos:{},sortKey:0}])}}function $1(t,e){return 256*(t=St(Math.floor(t),0,255))+St(Math.floor(e),0,255)}$n.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,q($n,"SegmentVector");let AC=un([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),PC=un([{name:"a_dash",components:4,type:"Uint16"}]);class lf{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,i,s){this.ids.push(H1(e)),this.positions.push(n,i,s)}eachPosition(e,n){let i=H1(e),s=0,l=this.ids.length-1;for(;s<l;){let c=s+l>>1;this.ids[c]>=i?l=c:s=c+1}for(;this.ids[s]===i;)n(this.positions[3*s],this.positions[3*s+1],this.positions[3*s+2]),s++}static serialize(e,n){let i=new Float64Array(e.ids),s=new Uint32Array(e.positions);return Dy(i,s,0,i.length-1),n&&(n.add(i.buffer),n.add(s.buffer)),{ids:i,positions:s}}static deserialize(e){let n=new lf,i;n.ids=e.ids,n.positions=e.positions;for(let s of n.ids)s!==i&&n.uniqueIds.push(s),i=s;return n.indexed=!0,n}}function H1(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:jl(String(t))}function Dy(t,e,n,i){for(;n<i;){let s=t[n+i>>1],l=n-1,c=i+1;for(;;){do l++;while(t[l]<s);do c--;while(t[c]>s);if(l>=c)break;bm(t,l,c),bm(e,3*l,3*c),bm(e,3*l+1,3*c+1),bm(e,3*l+2,3*c+2)}c-n<i-c?(Dy(t,e,n,c),n=c+1):(Dy(t,e,c+1,i),i=c)}}function bm(t,e,n){let i=t[e];t[e]=t[n],t[n]=i}q(lf,"FeaturePositionMap");class Rs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,i){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class wm extends Rs{constructor(e){super(e),this.current=0}set(e,n,i){this.fetchUniformLocation(e,n)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class Zr extends Rs{constructor(e){super(e),this.current=0}set(e,n,i){this.fetchUniformLocation(e,n)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Ls extends Rs{constructor(e){super(e),this.current=[0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class My extends Rs{constructor(e){super(e),this.current=[0,0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class Cy extends Rs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class q1 extends Rs{constructor(e){super(e),this.current=nn.transparent.toRenderColor(null)}set(e,n,i){this.fetchUniformLocation(e,n)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}let RC=new Float32Array(16);class cf extends Rs{constructor(e){super(e),this.current=RC}set(e,n,i){if(this.fetchUniformLocation(e,n)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let s=1;s<16;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}let LC=new Float32Array(9),OC=new Float32Array(4);class Sy extends Rs{constructor(e){super(e),this.current=OC}set(e,n,i){if(this.fetchUniformLocation(e,n)){for(let s=0;s<4;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}}function Ay(t){return[$1(255*t.r,255*t.g),$1(255*t.b,255*t.a)]}class uf{constructor(e,n,i,s){this.value=e,this.uniformNames=n.map(l=>`u_${l}`),this.type=i,this.context=s}setUniform(e,n,i,s,l){let c=s.constantOr(this.value);n.set(e,l,c instanceof nn?c.toRenderColor(this.context.lut):c)}getBinding(e,n){return this.type==="color"?new q1(e):new Zr(e)}}class Hu{constructor(e,n){this.uniformNames=n.map(i=>`u_${i}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,i,s,l){let c=l==="u_pattern"||l==="u_dash"?this.pattern:l==="u_pixel_ratio"?this.pixelRatio:null;c&&n.set(e,l,c)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new Cy(e):new Zr(e)}}class Os{constructor(e,n,i,s){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=n.map(l=>({name:`a_${l}`,type:"Float32",components:i==="color"?2:1,offset:0})),this.paintVertexArray=new s}populatePaintArray(e,n,i,s,l,c,p){let m=this.paintVertexArray.length,x=this.expression.evaluate(new vt(0,{brightness:c}),n,{},l,s,p);this.paintVertexArray.resize(e),this._setPaintValue(m,e,x,this.context)}updatePaintArray(e,n,i,s,l,c,p){let m=this.expression.evaluate({zoom:0,brightness:p},i,s,void 0,l);this._setPaintValue(e,n,m,this.context)}_setPaintValue(e,n,i,s){if(this.type==="color"){let l=Ay(i.toRenderColor(s.lut));for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,l[0],l[1])}else{for(let l=e;l<n;l++)this.paintVertexArray.emplace(l,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class co{constructor(e,n,i,s,l,c){this.expression=e,this.uniformNames=n.map(p=>`u_${p}_t`),this.type=i,this.useIntegerZoom=s,this.context=l,this.maxValue=0,this.paintVertexAttributes=n.map(p=>({name:`a_${p}`,type:"Float32",components:i==="color"?4:2,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,i,s,l,c,p){let m=this.expression.evaluate(new vt(this.context.zoom,{brightness:c}),n,{},l,s,p),x=this.expression.evaluate(new vt(this.context.zoom+1,{brightness:c}),n,{},l,s,p),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,m,x,this.context)}updatePaintArray(e,n,i,s,l,c,p){let m=this.expression.evaluate({zoom:this.context.zoom,brightness:p},i,s,void 0,l),x=this.expression.evaluate({zoom:this.context.zoom+1,brightness:p},i,s,void 0,l);this._setPaintValue(e,n,m,x,this.context)}_setPaintValue(e,n,i,s,l){if(this.type==="color"){let c=Ay(i.toRenderColor(l.lut)),p=Ay(i.toRenderColor(l.lut));for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,c[0],c[1],p[0],p[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,i,s);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,i,s,l){let c=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,p=St(this.expression.interpolationFactor(c,this.context.zoom,this.context.zoom+1),0,1);n.set(e,l,p)}getBinding(e,n){return new Zr(e)}}class ja{constructor(e,n,i,s,l){this.expression=e,this.layerId=l,this.paintVertexAttributes=(i==="array"?PC:AC).members;for(let c=0;c<n.length;++c);this.paintVertexArray=new s}populatePaintArray(e,n,i,s){let l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,n.patterns&&n.patterns[this.layerId],i)}updatePaintArray(e,n,i,s,l,c,p){this._setPaintValues(e,n,i.patterns&&i.patterns[this.layerId],c)}_setPaintValues(e,n,i,s){if(!s||!i)return;let l=s[i];if(!l)return;let{tl:c,br:p,pixelRatio:m}=l;for(let x=e;x<n;x++)this.paintVertexArray.emplace(x,c[0],c[1],p[0],p[1],m)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cc{constructor(e,n,i=()=>!0){this.binders={},this._buffers=[],this.context=n;let s=[];for(let l in e.paint._values){let c=e.paint.get(l);if(!i(l)||!(c instanceof gn&&of(c.property.specification)))continue;let p=FC(l,e.type),m=c.value,x=c.property.specification.type,w=!!c.property.useIntegerZoom,E=l==="line-dasharray"||l.endsWith("pattern"),D=l==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(m.kind!=="constant"||D)if(m.kind==="source"||D||E){let S=W1(l,x,"source");this.binders[l]=E?new ja(m,p,x,S,e.id):new Os(m,p,x,S),s.push(`/a_${l}`)}else{let S=W1(l,x,"composite");this.binders[l]=new co(m,p,x,w,n,S),s.push(`/z_${l}`)}else this.binders[l]=E?new Hu(m.value,p):new uf(m.value,p,x,n),s.push(`/u_${l}`)}this.cacheKey=s.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof Os||n instanceof co?n.maxValue:0}populatePaintArrays(e,n,i,s,l,c,p){for(let m in this.binders){let x=this.binders[m];x.context=this.context,(x instanceof Os||x instanceof co||x instanceof ja)&&x.populatePaintArray(e,n,i,s,l,c,p)}}setConstantPatternPositions(e){for(let n in this.binders){let i=this.binders[n];i instanceof Hu&&i.setConstantPatternPositions(e)}}updatePaintArrays(e,n,i,s,l,c,p,m){let x=!1,w=Object.keys(e),E=w.length!==0,D=E?w:n.uniqueIds;this.context.lut=l.lut;for(let S in this.binders){let A=this.binders[S];if(A.context=this.context,(A instanceof Os||A instanceof co||A instanceof ja)&&(A.expression.isStateDependent===!0||A.expression.isLightConstant===!1)){let R=l.paint.get(S);A.expression=R.value;for(let O of D){let z=e[O.toString()];n.eachPosition(O,(W,X,Y)=>{let re=s.feature(W);A.updatePaintArray(X,Y,re,z,c,p,m)})}if(!E)for(let O of i.uniqueIds){let z=e[O.toString()];i.eachPosition(O,(W,X,Y)=>{let re=s.feature(W);A.updatePaintArray(X,Y,re,z,c,p,m)})}x=!0}}return x}defines(){let e=[];for(let n in this.binders){let i=this.binders[n];(i instanceof uf||i instanceof Hu)&&e.push(...i.uniformNames.map(s=>`#define HAS_UNIFORM_${s}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let i=this.binders[n];if(i instanceof Os||i instanceof co||i instanceof ja)for(let s=0;s<i.paintVertexAttributes.length;s++)e.push(i.paintVertexAttributes[s].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let i=this.binders[n];if(i instanceof uf||i instanceof Hu||i instanceof co)for(let s of i.uniformNames)e.push(s)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let i in this.binders){let s=this.binders[i];if(s instanceof uf||s instanceof Hu||s instanceof co)for(let l of s.uniformNames)n.push({name:l,property:i,binding:s.getBinding(e,l)})}return n}setUniforms(e,n,i,s,l){for(let{name:c,property:p,binding:m}of i)this.binders[p].setUniform(e,m,l,s.get(p),c)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof Os||n instanceof co||n instanceof ja)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let i=this.binders[n];(i instanceof Os||i instanceof co||i instanceof ja)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof Os||n instanceof co||n instanceof ja)&&n.destroy()}}}class Ua{constructor(e,n,i=()=>!0){this.programConfigurations={};for(let s of e)this.programConfigurations[s.id]=new cc(s,n,i);this.needsUpload=!1,this._featureMap=new lf,this._featureMapWithoutIds=new lf,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,i,s,l,c,p,m){for(let x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,n,s,l,c,p,m);n.id!==void 0?this._featureMap.add(n.id,i,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,i,s,l,c){for(let p of i)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,p,s,l,c||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let kC={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function FC(t,e){return kC[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let NC={"line-pattern":{source:Ba,composite:Ba},"fill-pattern":{source:Ba,composite:Ba},"fill-extrusion-pattern":{source:Ba,composite:Ba},"line-dasharray":{source:_m,composite:_m}},zC={color:{source:$u,composite:Na},number:{source:ac,composite:$u}};function W1(t,e,n){let i=NC[t];return i&&i[n]||zC[e][n]}q(uf,"ConstantBinder"),q(Hu,"PatternConstantBinder"),q(Os,"SourceExpressionBinder"),q(ja,"PatternCompositeBinder"),q(co,"CompositeExpressionBinder"),q(cc,"ProgramConfiguration",{omit:["_buffers"]}),q(Ua,"ProgramConfigurationSet");let Xr=Ye/Math.PI/2,Py=5,Z1=6,BC=16383,qu=64,Ry=[qu,32,16],Wi=-Xr,Zi=Xr;function Wu(t,e,n,i=Xr){return n=qt(n),[t*Math.sin(n)*i,-e*i,t*Math.cos(n)*i]}function uc(t,e,n){return Wu(Math.cos(qt(t)),Math.sin(qt(t)),e,n)}let Zu=63710088e-1,Ly=2*Math.PI*Zu;class en{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new en(ds(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,i=this.lat*n,s=e.lat*n,l=Math.sin(i)*Math.sin(s)+Math.cos(i)*Math.cos(s)*Math.cos((e.lng-this.lng)*n);return Zu*Math.acos(Math.min(l,1))}toBounds(e=0){let n=360*e/40075017,i=n/Math.cos(Math.PI/180*this.lat);return new Ga({lng:this.lng-i,lat:this.lat-n},{lng:this.lng+i,lat:this.lat+n})}toEcef(e){return uc(this.lat,this.lng,Xr+e*Xr/Zu)}static convert(e){if(e instanceof en)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new en(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new en(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ga{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){let i=e;this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]])}else{let i=e;this.setSouthWest(i[0]).setNorthEast(i[1])}}setNorthEast(e){return this._ne=e instanceof en?new en(e.lng,e.lat):en.convert(e),this}setSouthWest(e){return this._sw=e instanceof en?new en(e.lng,e.lat):en.convert(e),this}extend(e){let n=this._sw,i=this._ne,s,l;if(e instanceof en)s=e,l=e;else{if(!(e instanceof Ga))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ga.convert(e)):this.extend(en.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(en.convert(e)):this;if(s=e._sw,l=e._ne,!s||!l)return this}return n||i?(n.lng=Math.min(s.lng,n.lng),n.lat=Math.min(s.lat,n.lat),i.lng=Math.max(l.lng,i.lng),i.lat=Math.max(l.lat,i.lat)):(this._sw=new en(s.lng,s.lat),this._ne=new en(l.lng,l.lat)),this}getCenter(){return new en((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new en(this.getWest(),this.getNorth())}getSouthEast(){return new en(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:i}=en.convert(e),s=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(s=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&s}static convert(e){return!e||e instanceof Ga?e:new Ga(e)}}var X1={};(function(t,e){(function(n){function i(l,c,p){var m=s(256*l,256*(c=Math.pow(2,p)-c-1),p),x=s(256*(l+1),256*(c+1),p);return m[0]+","+m[1]+","+x[0]+","+x[1]}function s(l,c,p){var m=2*Math.PI*6378137/256/Math.pow(2,p);return[l*m-2*Math.PI*6378137/2,c*m-2*Math.PI*6378137/2]}n.getURL=function(l,c,p,m,x,w){return w=w||{},l+"?"+["bbox="+i(p,m,x),"format="+(w.format||"image/png"),"service="+(w.service||"WMS"),"version="+(w.version||"1.1.1"),"request="+(w.request||"GetMap"),"srs="+(w.srs||"EPSG:3857"),"width="+(w.width||256),"height="+(w.height||256),"layers="+c].join("&")},n.getTileBBox=i,n.getMercCoords=s,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,X1);var VC=X1;class hc{constructor(e,n,i){this.z=e,this.x=n,this.y=i,this.key=hf(0,e,e,n,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let i=VC.getTileBBox(this.x,this.y,this.z),s=function(l,c,p){let m,x="";for(let w=l;w>0;w--)m=1<<w-1,x+=(c&m?1:0)+(p&m?2:0);return x}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",s).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Y1{constructor(e,n){this.wrap=e,this.canonical=n,this.key=hf(e,n.z,n.z,n.x,n.y)}}class lr{constructor(e,n,i,s,l){this.overscaledZ=e,this.wrap=n,this.canonical=new hc(i,+s,+l),this.key=n===0&&e===i?this.canonical.key:hf(n,e,i,s,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new lr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new lr(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return hf(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let i=this.canonical.z-e;return hf(this.wrap*+n,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new lr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,i=2*this.canonical.x,s=2*this.canonical.y;return[new lr(n,this.wrap,n,i,s),new lr(n,this.wrap,n,i+1,s),new lr(n,this.wrap,n,i,s+1),new lr(n,this.wrap,n,i+1,s+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new lr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new lr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Y1(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function hf(t,e,n,i,s){let l=1<<Math.min(n,22),c=l*(s%l)+i%l;return t&&n<22&&(c+=l*l*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*c+n)+(e-n)}let jC=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new lr(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new lr(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new lr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new lr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];q(hc,"CanonicalTileID"),q(lr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let UC=0,GC=25.5;function Oy(t){return Ly*Math.cos(t*Math.PI/180)}function $o(t){return(180+t)/360}function Ho(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Yr(t,e){return t/Oy(e)}function ii(t){return 360*t-180}function xr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Q1(t,e){return t*Oy(xr(e))}let nr=85.051129;function K1(t){return Math.cos(qt(St(t,-nr,nr)))}function dc(t,e){let n=St(e,UC,GC),i=Math.pow(2,n);return K1(t)*Ly/(512*i)}function J1(t){return 1/Math.cos(t*Math.PI/180)}function Tm(t,e=0){let n=Math.exp(Math.PI*(1-(t.y+e/Ye)/(1<<t.z)*2));return 80150034*n/(n*n+1)/Ye/(1<<t.z)}class kr{constructor(e,n,i=0){this.x=+e,this.y=+n,this.z=+i}static fromLngLat(e,n=0){let i=en.convert(e);return new kr($o(i.lng),Ho(i.lat),Yr(n,i.lat))}toLngLat(){return new en(ii(this.x),xr(this.y))}toAltitude(){return Q1(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ly*J1(xr(this.y))}}function ky(t,e,n,i,s,l,c,p,m){let x=(e+i)/2,w=(n+s)/2,E=new tt(x,w);p(E),function(D,S,A,R,O,z){let W=A-O,X=R-z;return Math.abs((R-S)*W-(A-D)*X)/Math.hypot(W,X)}(E.x,E.y,l.x,l.y,c.x,c.y)>=m?(ky(t,e,n,x,w,l,E,p,m),ky(t,x,w,i,s,E,c,p,m)):t.push(c)}function eb(t,e,n){let i=t[0],s=i.x,l=i.y;e(i);let c=[i];for(let p=1;p<t.length;p++){let m=t[p],{x,y:w}=m;e(m),ky(c,s,l,x,w,i,m,e,n),s=x,l=w,i=m}return c}function Fy(t,e,n,i){if(i(e,n)){let s=e.add(n)._mult(.5);Fy(t,e,s,i),Fy(t,s,n,i)}else t.push(n)}function $C(t,e){let n=t[0],i=[n];for(let s=1;s<t.length;s++){let l=t[s];Fy(i,n,l,e),n=l}return i}let Ny=Math.pow(2,14)-1,tb=-Ny-1;function HC(t,e){let n=Math.round(t.x*e),i=Math.round(t.y*e);return t.x=St(n,tb,Ny),t.y=St(i,tb,Ny),(n<t.x||n>t.x+1||i<t.y||i>t.y+1)&&Qn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function uo(t,e,n){let i=t.loadGeometry(),s=t.extent,l=Ye/s;if(e&&n&&n.projection.isReprojectedInTileSpace){let c=1<<e.z,{scale:p,x:m,y:x,projection:w}=n,E=D=>{let S=ii((e.x+D.x/s)/c),A=xr((e.y+D.y/s)/c),R=w.project(S,A);D.x=(R.x*p-m)*s,D.y=(R.y*p-x)*s};for(let D=0;D<i.length;D++)if(t.type!==1)i[D]=eb(i[D],E,1);else{let S=[];for(let A of i[D])A.x<0||A.x>=s||A.y<0||A.y>=s||(E(A),S.push(A));i[D]=S}}for(let c of i)for(let p of c)HC(p,l);return i}function ks(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?uo(t):[]}}function Em(t,e,n,i,s){t.emplaceBack(2*e+(i+1)/2,2*n+(s+1)/2)}function Im(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class zy{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new lo,this.indexArray=new pr,this.segments=new $n,this.programConfigurations=new Ua(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(e,n){}populate(e,n,i,s){let l=this.layers[0],c=[],p=null;l.type==="circle"&&(p=l.layout.get("circle-sort-key"));for(let{feature:x,id:w,index:E,sourceLayerIndex:D}of e){let S=this.layers[0]._featureFilter.needGeometry,A=ks(x,S);if(!this.layers[0]._featureFilter.filter(new vt(this.zoom),A,i))continue;let R=p?p.evaluate(A,{},i):void 0,O={id:w,properties:x.properties,type:x.type,sourceLayerIndex:D,index:E,geometry:S?A.geometry:uo(x,i,s),patterns:{},sortKey:R};c.push(O)}p&&c.sort((x,w)=>x.sortKey-w.sortKey);let m=null;s.projection.name==="globe"&&(this.globeExtVertexArray=new ym,m=s.projection);for(let x of c){let{geometry:w,index:E,sourceLayerIndex:D}=x,S=e[E].feature;this.addFeature(x,w,E,n.availableImages,i,m,n.brightness),n.featureIndex.insert(S,w,E,D,this.index)}}update(e,n,i,s,l){let c=Object.keys(e).length!==0;c&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,c?this.stateDependentLayers:this.layers,i,s,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,CC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,SC.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,i,s,l,c,p){for(let m of n)for(let x of m){let w=x.x,E=x.y;if(w<0||w>=Ye||E<0||E>=Ye)continue;if(c){let A=c.projectTilePoint(w,E,l),R=c.upVector(l,w,E),O=this.globeExtVertexArray;Im(O,A,R),Im(O,A,R),Im(O,A,R),Im(O,A,R)}let D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),S=D.vertexLength;Em(this.layoutVertexArray,w,E,-1,-1),Em(this.layoutVertexArray,w,E,1,-1),Em(this.layoutVertexArray,w,E,1,1),Em(this.layoutVertexArray,w,E,-1,1),this.indexArray.emplaceBack(S,S+1,S+2),this.indexArray.emplaceBack(S,S+2,S+3),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},s,l,p)}}function By(t,e){for(let n=0;n<t.length;n++)if($a(e,t[n]))return!0;for(let n=0;n<e.length;n++)if($a(t,e[n]))return!0;return!!Vy(t,e)}function qC(t,e,n){return!!$a(t,e)||!!jy(e,t,n)}function nb(t,e){if(t.length===1)return ib(e,t[0]);for(let n=0;n<e.length;n++){let i=e[n];for(let s=0;s<i.length;s++)if($a(t,i[s]))return!0}for(let n=0;n<t.length;n++)if(ib(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Vy(t,e[n]))return!0;return!1}function WC(t,e,n){if(t.length>1){if(Vy(t,e))return!0;for(let i=0;i<e.length;i++)if(jy(e[i],t,n))return!0}for(let i=0;i<t.length;i++)if(jy(t[i],e,n))return!0;return!1}function Vy(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){let i=t[n],s=t[n+1];for(let l=0;l<e.length-1;l++)if(ZC(i,s,e[l],e[l+1]))return!0}return!1}function ZC(t,e,n,i){return rr(t,n,i)!==rr(e,n,i)&&rr(t,e,n)!==rr(t,e,i)}function jy(t,e,n){let i=n*n;if(e.length===1)return t.distSqr(e[0])<i;for(let s=1;s<e.length;s++)if(rb(t,e[s-1],e[s])<i)return!0;return!1}function rb(t,e,n){let i=e.distSqr(n);if(i===0)return t.distSqr(e);let s=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return t.distSqr(s<0?e:s>1?n:n.sub(e)._mult(s)._add(e))}function ib(t,e){let n,i,s,l=!1;for(let c=0;c<t.length;c++){n=t[c];for(let p=0,m=n.length-1;p<n.length;m=p++)i=n[p],s=n[m],i.y>e.y!=s.y>e.y&&e.x<(s.x-i.x)*(e.y-i.y)/(s.y-i.y)+i.x&&(l=!l)}return l}function $a(t,e){let n=!1;for(let i=0,s=t.length-1;i<t.length;s=i++){let l=t[i],c=t[s];l.y>e.y!=c.y>e.y&&e.x<(c.x-l.x)*(e.y-l.y)/(c.y-l.y)+l.x&&(n=!n)}return n}function ob(t,e,n,i,s){for(let c of t)if(e<=c.x&&n<=c.y&&i>=c.x&&s>=c.y)return!0;let l=[new tt(e,n),new tt(e,s),new tt(i,s),new tt(i,n)];if(t.length>2){for(let c of l)if($a(t,c))return!0}for(let c=0;c<t.length-1;c++)if(XC(t[c],t[c+1],l))return!0;return!1}function XC(t,e,n){let i=n[0],s=n[2];if(t.x<i.x&&e.x<i.x||t.x>s.x&&e.x>s.x||t.y<i.y&&e.y<i.y||t.y>s.y&&e.y>s.y)return!1;let l=rr(t,e,n[0]);return l!==rr(t,e,n[1])||l!==rr(t,e,n[2])||l!==rr(t,e,n[3])}function Xu(t,e,n,i,s,l){let c=e.y-t.y,p=t.x-e.x;if(l=l||0){let m=c*c+p*p;if(m===0)return!0;let x=Math.sqrt(m);c/=x,p/=x}return!((n.x-t.x)*c+(n.y-t.y)*p-l<0||(i.x-t.x)*c+(i.y-t.y)*p-l<0||(s.x-t.x)*c+(s.y-t.y)*p-l<0)}function Uy(t,e,n,i,s,l,c){return!(Xu(t,e,i,s,l,c)||Xu(e,n,i,s,l,c)||Xu(n,t,i,s,l,c)||Xu(i,s,t,e,n,c)||Xu(s,l,t,e,n,c)||Xu(l,i,t,e,n,c))}function Yu(t,e,n){let i=e.paint.get(t).value;return i.kind==="constant"?i.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Dm(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function sb(t,e,n,i,s){if(!e[0]&&!e[1])return t;let l=tt.convert(e)._mult(s);n==="viewport"&&l._rotate(-i);let c=[];for(let p=0;p<t.length;p++)c.push(t[p].sub(l));return c}function ab(t,e,n,i){let s=tt.convert(t)._mult(i);return e==="viewport"&&s._rotate(-n),s}q(zy,"CircleBucket",{omit:["layers"]});let YC=new ln({"circle-sort-key":new it(be.layout_circle["circle-sort-key"]),visibility:new Oe(be.layout_circle.visibility)});var QC={paint:new ln({"circle-radius":new it(be.paint_circle["circle-radius"]),"circle-color":new it(be.paint_circle["circle-color"]),"circle-blur":new it(be.paint_circle["circle-blur"]),"circle-opacity":new it(be.paint_circle["circle-opacity"]),"circle-translate":new Oe(be.paint_circle["circle-translate"]),"circle-translate-anchor":new Oe(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Oe(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Oe(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new it(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new it(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new it(be.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Oe(be.paint_circle["circle-emissive-strength"])}),layout:YC};class Gy{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,i){let s=o._.dot(n,this.dir);if(Math.abs(s)<1e-6)return!1;let l=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/s;return i[0]=this.pos[0]+this.dir[0]*l,i[1]=this.pos[1]+this.dir[1]*l,i[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(e,n,i){if(o._.equals(this.pos,e)||n===0)return i[0]=i[1]=i[2]=0,!1;let[s,l,c]=this.dir,p=this.pos[0]-e[0],m=this.pos[1]-e[1],x=this.pos[2]-e[2],w=s*s+l*l+c*c,E=2*(p*s+m*l+x*c),D=E*E-4*w*(p*p+m*m+x*x-n*n);if(D<0){let S=Math.max(-E/2,0),A=p+s*S,R=m+l*S,O=x+c*S,z=Math.hypot(A,R,O);return i[0]=A*n/z,i[1]=R*n/z,i[2]=O*n/z,!1}{let S=(-E-Math.sqrt(D))/(2*w);if(S<0){let A=Math.hypot(p,m,x);return i[0]=p*n/A,i[1]=m*n/A,i[2]=x*n/A,!1}return i[0]=p+s*S,i[1]=m+l*S,i[2]=x+c*S,!0}}}class $y{constructor(e,n,i,s,l){this.TL=e,this.TR=n,this.BR=i,this.BL=s,this.horizon=l}static fromInvProjectionMatrix(e,n,i){let s=[-1,1,1],l=[1,1,1],c=[1,-1,1],p=[-1,-1,1],m=o._.transformMat4(s,s,e),x=o._.transformMat4(l,l,e),w=o._.transformMat4(c,c,e),E=o._.transformMat4(p,p,e);return new $y(m,x,w,E,n/i)}}function df(t,e,n){let i=1/0,s=-1/0,l=[];for(let c of t){o._.sub(l,c,e);let p=o._.dot(l,n);i=Math.min(i,p),s=Math.max(s,p)}return[i,s]}function lb(t,e){let n=!0;for(let i=0;i<t.planes.length;i++){let s=t.planes[i],l=0;for(let c=0;c<e.length;c++)l+=o._.dot(s,e[c])+s[3]>=0;if(l===0)return 0;l!==e.length&&(n=!1)}return n?2:1}function cb(t,e){for(let n of t.projections){let i=df(e,t.points[0],n.axis);if(n.projection[1]<i[0]||n.projection[0]>i[1])return 0}return 1}function ub(t,e){let n=0,i=[0,0,0,0];for(let s=0;s<t.length;s++)i[0]=t[s][0],i[1]=t[s][1],i[2]=t[s][2],i[3]=1,o.aA.dot(i,e)>=0&&n++;return n}class Hy{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=Vn.fromPoints(this.points),this.projections=[],this.frustumEdges=[o._.sub([],this.points[2],this.points[3]),o._.sub([],this.points[0],this.points[3]),o._.sub([],this.points[4],this.points[0]),o._.sub([],this.points[5],this.points[1]),o._.sub([],this.points[6],this.points[2]),o._.sub([],this.points[7],this.points[3])];for(let i of this.frustumEdges){let s=[0,-i[2],i[1]],l=[i[2],0,-i[0]];this.projections.push({axis:s,projection:df(this.points,this.points[0],s)}),this.projections.push({axis:l,projection:df(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(e,n,i,s){let l=Math.pow(2,i),c=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{let w=o.aA.transformMat4([],x,e),E=1/w[3]/n*l;return o.aA.mul(w,w,[E,E,s?1/w[3]:E,E])}),p=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{let w=o._.sub([],c[x[0]],c[x[1]]),E=o._.sub([],c[x[2]],c[x[1]]),D=o._.normalize([],o._.cross([],w,E)),S=-o._.dot(D,c[x[1]]);return D.concat(S)}),m=[];for(let x=0;x<c.length;x++)m.push([c[x][0],c[x][1],c[x][2]]);return new Hy(m,p)}intersectsPrecise(e,n,i){for(let s=0;s<n.length;s++)if(!ub(e,n[s]))return 0;for(let s=0;s<this.planes.length;s++)if(!ub(e,this.planes[s]))return 0;for(let s of i)for(let l of this.frustumEdges){let c=o._.cross([],s,l),p=o._.length(c);if(p===0)continue;o._.scale(c,c,1/p);let m=df(this.points,this.points[0],c),x=df(e,this.points[0],c);if(m[0]>x[1]||x[0]>m[1])return 0}return 1}}class Vn{static fromPoints(e){let n=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(let s of e)o._.min(n,n,s),o._.max(i,i,s);return new Vn(n,i)}static fromTileIdAndHeight(e,n,i){let s=1<<e.canonical.z,l=e.canonical.x,c=e.canonical.y;return new Vn([l/s,c/s,n],[(l+1)/s,(c+1)/s,i])}static applyTransform(e,n){let i=e.getCorners();for(let s=0;s<i.length;++s)o._.transformMat4(i[s],i[s],n);return Vn.fromPoints(i)}static applyTransformFast(e,n){let i=[n[12],n[13],n[14]],s=[...i];for(let l=0;l<3;l++)for(let c=0;c<3;c++){let p=n[4*c+l],m=p*e.min[c],x=p*e.max[c];i[l]+=Math.min(m,x),s[l]+=Math.max(m,x)}return new Vn(i,s)}static projectAabbCorners(e,n){let i=e.getCorners();for(let s=0;s<i.length;++s)o._.transformMat4(i[s],i[s],n);return i}constructor(e,n){this.min=e,this.max=n,this.center=o._.scale([],o._.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],i=o._.clone(this.min),s=o._.clone(this.max);for(let l=0;l<n.length;l++)i[l]=n[l]?this.min[l]:this.center[l],s[l]=n[l]?this.center[l]:this.max[l];return s[2]=this.max[2],new Vn(i,s)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?lb(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?lb(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?cb(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?cb(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}q(Vn,"Aabb");let KC=un([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Mm}=KC,hb=un([{name:"a_pos_3",components:3,type:"Int16"}]);var ff=un([{name:"a_pos",type:"Int16",components:2}]);function Cm(t){return t*Xr/Zu}let JC=[new Vn([Wi,Wi,Wi],[Zi,Zi,Zi]),new Vn([Wi,Wi,Wi],[0,0,Zi]),new Vn([0,Wi,Wi],[Zi,0,Zi]),new Vn([Wi,0,Wi],[0,Zi,Zi]),new Vn([0,0,Wi],[Zi,Zi,Zi])];function db(t,e,n,i=!0){let s=o._.scale([],t._camera.position,t.worldSize),l=[e,n,1,1];o.aA.transformMat4(l,l,t.pixelMatrixInverse),o.aA.scale(l,l,1/l[3]);let c=o._.sub([],l,s),p=o._.normalize([],c),m=t.globeMatrix,x=[m[12],m[13],m[14]],w=o._.sub([],x,s),E=o._.length(w),D=o._.normalize([],w),S=t.worldSize/(2*Math.PI),A=o._.dot(D,p),R=Math.asin(S/E);if(R<Math.acos(A)){if(!i)return null;let Te=[],Le=[];o._.scale(Te,p,E/A),o._.normalize(Le,o._.sub(Le,Te,w)),o._.normalize(p,o._.add(p,w,o._.scale(p,Le,Math.tan(R)*E)))}let O=[];new Gy(s,p).closestPointOnSphere(x,S,O);let z=o._.normalize([],Ol(m,0)),W=o._.normalize([],Ol(m,1)),X=o._.normalize([],Ol(m,2)),Y=o._.dot(z,O),re=o._.dot(W,O),ne=o._.dot(X,O),ue=Ar(Math.asin(-re/S)),de=Ar(Math.atan2(Y,ne));de=t.center.lng+function(Te,Le){let Ue=(Le-Te+180)%360-180;return Ue<-180?Ue+360:Ue}(t.center.lng,de);let ve=$o(de),Ce=St(Ho(ue),0,1);return new kr(ve,Ce)}class eS{constructor(e,n,i){this.a=o._.sub([],e,i),this.b=o._.sub([],n,i),this.center=i;let s=o._.normalize([],this.a),l=o._.normalize([],this.b);this.angle=Math.acos(o._.dot(s,l))}}function qy(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(i,s,l,c){let p=Math.sin(l);return i*(Math.sin((1-c)*l)/p)+s*(Math.sin(c*l)/p)}(t.a[e],t.b[e],t.angle,St(n,0,1))+t.center[e]}function qo(t){if(t.z<=1)return JC[t.z+2*t.y+t.x];let e=Wy(Sm(t));return Vn.fromPoints(e)}function Fs(t,e,n){return o._.scale(t,t,1-n),o._.scaleAndAdd(t,t,e,n)}function fb(t,e){let n=Ns(e.zoom);if(n===0)return qo(t);let i=Sm(t),s=Wy(i),l=$o(i.getWest())*e.worldSize,c=$o(i.getEast())*e.worldSize,p=Ho(i.getNorth())*e.worldSize,m=Ho(i.getSouth())*e.worldSize,x=[l,p,0],w=[c,p,0],E=[l,m,0],D=[c,m,0],S=o.ad.invert([],e.globeMatrix);return o._.transformMat4(x,x,S),o._.transformMat4(w,w,S),o._.transformMat4(E,E,S),o._.transformMat4(D,D,S),s[0]=Fs(s[0],E,n),s[1]=Fs(s[1],D,n),s[2]=Fs(s[2],w,n),s[3]=Fs(s[3],x,n),Vn.fromPoints(s)}function pb(t,e,n){for(let i of t)o._.transformMat4(i,i,e),o._.scale(i,i,n)}function mb(t,e,n,i){let s=e/t.worldSize,l=t.globeMatrix;if(n.z<=1){let ve=qo(n).getCorners();return pb(ve,l,s),Vn.fromPoints(ve)}let c=Sm(n,i),p=Wy(c,Xr+Cm(t._tileCoverLift));pb(p,l,s);let m=Number.MAX_VALUE,x=[-m,-m,-m],w=[m,m,m];if(c.contains(t.center)){for(let Te of p)o._.min(w,w,Te),o._.max(x,x,Te);x[2]=0;let ve=t.point,Ce=[ve.x*s,ve.y*s,0];return o._.min(w,w,Ce),o._.max(x,x,Ce),new Vn(w,x)}if(t._tileCoverLift>0){for(let ve of p)o._.min(w,w,ve),o._.max(x,x,ve);return new Vn(w,x)}let E=[l[12]*s,l[13]*s,l[14]*s],D=c.getCenter(),S=St(t.center.lat,-nr,nr),A=St(D.lat,-nr,nr),R=$o(t.center.lng),O=Ho(S),z=R-$o(D.lng),W=O-Ho(A);z>.5?z-=1:z<-.5&&(z+=1);let X=0;if(Math.abs(z)>Math.abs(W))X=z>=0?1:3;else{X=W>=0?0:2;let ve=[l[4]*s,l[5]*s,l[6]*s],Ce=-Math.sin(qt(W>=0?c.getSouth():c.getNorth()))*Xr;o._.scaleAndAdd(E,E,ve,Ce)}let Y=p[X],re=p[(X+1)%4],ne=new eS(Y,re,E),ue=[qy(ne,0)||Y[0],qy(ne,1)||Y[1],qy(ne,2)||Y[2]],de=Ns(t.zoom);if(de>0){let ve=function({x:Te,y:Le,z:Ue},Pe,Be,Se,Ve){let He=1/(1<<Ue),je=Te*He,rt=je+He,Ge=Le*He,We=Ge+He,dt=0,ht=(je+rt)/2-Se;return ht>.5?dt=-1:ht<-.5&&(dt=1),je=((je+dt)*Pe-(Se*=Pe))*Be+Se,rt=((rt+dt)*Pe-Se)*Be+Se,Ge=(Ge*Pe-(Ve*=Pe))*Be+Ve,We=(We*Pe-Ve)*Be+Ve,[[je,We,0],[rt,We,0],[rt,Ge,0],[je,Ge,0]]}(n,e,t._pixelsPerMercatorPixel,R,O);for(let Te=0;Te<p.length;Te++)Fs(p[Te],ve[Te],de);let Ce=o._.add([],ve[X],ve[(X+1)%4]);o._.scale(Ce,Ce,.5),Fs(ue,Ce,de)}for(let ve of p)o._.min(w,w,ve),o._.max(x,x,ve);return w[2]=Math.min(Y[2],re[2]),o._.min(w,w,ue),o._.max(x,x,ue),new Vn(w,x)}function Sm({x:t,y:e,z:n},i=!1){let s=1/(1<<n),l=new en(ii(t*s),e===(1<<n)-1&&i?-90:xr((e+1)*s)),c=new en(ii((t+1)*s),e===0&&i?90:xr(e*s));return new Ga(l,c)}function Wy(t,e=Xr){let n=qt(t.getNorth()),i=qt(t.getSouth()),s=Math.cos(n),l=Math.cos(i),c=Math.sin(n),p=Math.sin(i),m=t.getWest(),x=t.getEast();return[Wu(l,p,m,e),Wu(l,p,x,e),Wu(s,c,x,e),Wu(s,c,m,e)]}function pf(t,e,n,i){let s=1<<n.z,l=(t/Ye+n.x)/s;return uc(xr((e/Ye+n.y)/s),ii(l),i)}function Am({min:t,max:e}){return BC/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let gb=new Float64Array(16);function mf(t){let e=Am(t),n=o.ad.fromScaling(gb,[e,e,e]);return o.ad.translate(n,n,o._.negate([],t.min))}function Zy(t){let e=o.ad.fromTranslation(gb,t.min),n=1/Am(t);return o.ad.scale(e,e,[n,n,n])}function Xy(t){let e=Ye/(2*Math.PI);return t/(2*Math.PI)/e}function _b(t,e){return Ye/(512*Math.pow(2,t))*Am(qo(e))}function yb(t,e,n,i,s){let l=Xy(n),c=[t,e,-n/(2*Math.PI)],p=o.ad.identity(new Float64Array(16));return o.ad.translate(p,p,c),o.ad.scale(p,p,[l,l,l]),o.ad.rotateX(p,p,qt(-s)),o.ad.rotateY(p,p,qt(-i)),p}function Ns(t){return Rl(Py,Z1,t)}function xb(t,e){let n=uc(e.lat,e.lng),i=function(l){let c=uc(l._center.lat,l._center.lng),p=o._.fromValues(0,1,0),m=o._.cross([],p,c),x=o.ad.fromRotation([],-l.angle,c);m=o._.transformMat4(m,m,x),o.ad.fromRotation(x,-l._pitch,m);let w=o._.normalize([],c);return o._.scale(w,w,Cm(l.cameraToCenterDistance/l.pixelsPerMeter)),o._.transformMat4(w,w,x),o._.add([],c,w)}(t),s=o._.subtract([],i,n);return o._.angle(s,n)}function Yy(t,e){return xb(t,e)>Math.PI/2*1.01}let vb=qt(85),tS=Math.cos(vb),nS=Math.sin(vb),rS=o.ad.create(),bb=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function wb(t,e,n,i,s,l,c,p,m){if(l&&t.queryGeometry.isAboveHorizon)return!1;l&&(m*=t.pixelToTileUnitsFactor);let x=t.tileID.canonical,w=n.projection.upVectorScale(x,n.center.lat,n.worldSize).metersToTile;for(let E of e)for(let D of E){let S=D.add(p),A=s&&n.elevation?n.elevation.exaggeration()*s.getElevationAt(S.x,S.y,!0):0,R=n.projection.projectTilePoint(S.x,S.y,x);if(A>0){let X=n.projection.upVector(x,S.x,S.y);R.x+=X[0]*w*A,R.y+=X[1]*w*A,R.z+=X[2]*w*A}let O=l?S:iS(R.x,R.y,R.z,i),z=l?t.tilespaceRays.map(X=>sS(X,A)):t.queryGeometry.screenGeometry,W=o.aA.transformMat4([],[R.x,R.y,R.z,1],i);if(!c&&l?m*=W[3]/n.cameraToCenterDistance:c&&!l&&(m*=n.cameraToCenterDistance/W[3]),l){let X=xr((D.y/Ye+x.y)/(1<<x.z));m/=n.projection.pixelsPerMeter(X,1)/Yr(1,X)}if(qC(z,O,m))return!0}return!1}function iS(t,e,n,i){let s=o.aA.transformMat4([],[t,e,n,1],i);return new tt(s[0]/s[3],s[1]/s[3])}let Tb=o._.fromValues(0,0,0),oS=o._.fromValues(0,0,1);function sS(t,e){let n=o._.create();return Tb[2]=e,t.intersectsPlane(Tb,oS,n),new tt(n[0],n[1])}class Eb extends zy{}function Ib(t,{width:e,height:n},i,s){if(s){if(s instanceof Uint8ClampedArray)s=new Uint8Array(s.buffer);else if(s.length!==e*n*i)throw new RangeError("mismatched image size")}else s=new Uint8Array(e*n*i);return t.width=e,t.height=n,t.data=s,t}function Db(t,e,n){let{width:i,height:s}=e;i===t.width&&s===t.height||(Qy(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,s)},n,null),t.width=i,t.height=s,t.data=e.data)}function Qy(t,e,n,i,s,l,c,p){if(s.width===0||s.height===0)return e;if(s.width>t.width||s.height>t.height||n.x>t.width-s.width||n.y>t.height-s.height)throw new RangeError("out of range source coordinates for image copy");if(s.width>e.width||s.height>e.height||i.x>e.width-s.width||i.y>e.height-s.height)throw new RangeError("out of range destination coordinates for image copy");let m=t.data,x=e.data,w=l===4&&p;for(let E=0;E<s.height;E++){let D=((n.y+E)*t.width+n.x)*l,S=((i.y+E)*e.width+i.x)*l;if(w)for(let A=0;A<s.width;A++){let R=D+A*l+3,O=S+A*l;x[O+0]=255,x[O+1]=255,x[O+2]=255,x[O+3]=m[R]}else if(c)for(let A=0;A<s.width;A++){let R=D+A*l,O=S+A*l,z=m[R+3],W=new nn(m[R+0]/255*z,m[R+1]/255*z,m[R+2]/255*z,z).toRenderColor(c).toArray();x[O+0]=W[0],x[O+1]=W[1],x[O+2]=W[2],x[O+3]=W[3]}else for(let A=0;A<s.width*l;A++)x[S+A]=m[D+A]}return e}q(Eb,"HeatmapBucket",{omit:["layers"]});class Ha{constructor(e,n){Ib(this,e,1,n)}resize(e){Db(this,new Ha(e),1)}clone(){return new Ha({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,i,s,l){Qy(e,n,i,s,l,1,null)}}class Pi{constructor(e,n){Ib(this,e,4,n)}resize(e){Db(this,new Pi(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Pi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,i,s,l,c,p){Qy(e,n,i,s,l,4,c,p)}}class Mb{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}q(Ha,"AlphaImage"),q(Pi,"RGBAImage");let aS=new ln({visibility:new Oe(be.layout_heatmap.visibility)});var lS={paint:new ln({"heatmap-radius":new it(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new it(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Oe(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new dr(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Oe(be.paint_heatmap["heatmap-opacity"])}),layout:aS};function gf(t){let e={},n=t.resolution||256,i=t.clips?t.clips.length:1,s=t.image||new Pi({width:n,height:i}),l=(c,p,m)=>{e[t.evaluationKey]=m;let x=t.expression.evaluate(e);x&&(s.data[c+p+0]=Math.floor(255*x.r/x.a),s.data[c+p+1]=Math.floor(255*x.g/x.a),s.data[c+p+2]=Math.floor(255*x.b/x.a),s.data[c+p+3]=Math.floor(255*x.a))};if(t.clips)for(let c=0,p=0;c<i;++c,p+=4*n)for(let m=0,x=0;m<n;m++,x+=4){let w=m/(n-1),{start:E,end:D}=t.clips[c];l(p,x,E*(1-w)+D*w)}else for(let c=0,p=0;c<n;c++,p+=4)l(0,p,c/(n-1));return s}let cS=new ln({visibility:new Oe(be.layout_hillshade.visibility)});var uS={paint:new ln({"hillshade-illumination-direction":new Oe(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Oe(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Oe(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Oe(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Oe(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Oe(be.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Oe(be.paint_hillshade["hillshade-emissive-strength"])}),layout:cS};let hS=un([{name:"a_pos",components:2,type:"Int16"}],4),{members:dS}=hS;function _f(t,e,n=2){let i=e&&e.length,s=i?e[0]*n:t.length,l=Cb(t,0,s,n,!0),c=[];if(!l||l.next===l.prev)return c;let p,m,x;if(i&&(l=function(w,E,D,S){let A=[];for(let R=0,O=E.length;R<O;R++){let z=Cb(w,E[R]*S,R<O-1?E[R+1]*S:w.length,S,!1);z===z.next&&(z.steiner=!0),A.push(vS(z))}A.sort(_S);for(let R=0;R<A.length;R++)D=yS(A[R],D);return D}(t,e,l,n)),t.length>80*n){p=1/0,m=1/0;let w=-1/0,E=-1/0;for(let D=n;D<s;D+=n){let S=t[D],A=t[D+1];S<p&&(p=S),A<m&&(m=A),S>w&&(w=S),A>E&&(E=A)}x=Math.max(w-p,E-m),x=x!==0?32767/x:0}return yf(l,c,n,p,m,x,0),c}function Cb(t,e,n,i,s){let l;if(s===function(c,p,m,x){let w=0;for(let E=p,D=m-x;E<m;E+=x)w+=(c[D]-c[E])*(c[E+1]+c[D+1]),D=E;return w}(t,e,n,i)>0)for(let c=e;c<n;c+=i)l=Pb(c/i|0,t[c],t[c+1],l);else for(let c=n-i;c>=e;c-=i)l=Pb(c/i|0,t[c],t[c+1],l);return l&&Pm(l,l.next)&&(vf(l),l=l.next),l}function fc(t,e){if(!t)return t;e||(e=t);let n,i=t;do if(n=!1,i.steiner||!Pm(i,i.next)&&cr(i.prev,i,i.next)!==0)i=i.next;else{if(vf(i),i=e=i.prev,i===i.next)break;n=!0}while(n||i!==e);return e}function yf(t,e,n,i,s,l,c){if(!t)return;!c&&l&&function(m,x,w,E){let D=m;do D.z===0&&(D.z=Ky(D.x,D.y,x,w,E)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==m);D.prevZ.nextZ=null,D.prevZ=null,function(S){let A,R=1;do{let O,z=S;S=null;let W=null;for(A=0;z;){A++;let X=z,Y=0;for(let ne=0;ne<R&&(Y++,X=X.nextZ,X);ne++);let re=R;for(;Y>0||re>0&&X;)Y!==0&&(re===0||!X||z.z<=X.z)?(O=z,z=z.nextZ,Y--):(O=X,X=X.nextZ,re--),W?W.nextZ=O:S=O,O.prevZ=W,W=O;z=X}W.nextZ=null,R*=2}while(A>1)}(D)}(t,i,s,l);let p=t;for(;t.prev!==t.next;){let m=t.prev,x=t.next;if(l?pS(t,i,s,l):fS(t))e.push(m.i,t.i,x.i),vf(t),t=x.next,p=x.next;else if((t=x)===p){c?c===1?yf(t=mS(fc(t),e),e,n,i,s,l,2):c===2&&gS(t,e,n,i,s,l):yf(fc(t),e,n,i,s,l,1);break}}}function fS(t){let e=t.prev,n=t,i=t.next;if(cr(e,n,i)>=0)return!1;let s=e.x,l=n.x,c=i.x,p=e.y,m=n.y,x=i.y,w=s<l?s<c?s:c:l<c?l:c,E=p<m?p<x?p:x:m<x?m:x,D=s>l?s>c?s:c:l>c?l:c,S=p>m?p>x?p:x:m>x?m:x,A=i.next;for(;A!==e;){if(A.x>=w&&A.x<=D&&A.y>=E&&A.y<=S&&Qu(s,p,l,m,c,x,A.x,A.y)&&cr(A.prev,A,A.next)>=0)return!1;A=A.next}return!0}function pS(t,e,n,i){let s=t.prev,l=t,c=t.next;if(cr(s,l,c)>=0)return!1;let p=s.x,m=l.x,x=c.x,w=s.y,E=l.y,D=c.y,S=p<m?p<x?p:x:m<x?m:x,A=w<E?w<D?w:D:E<D?E:D,R=p>m?p>x?p:x:m>x?m:x,O=w>E?w>D?w:D:E>D?E:D,z=Ky(S,A,e,n,i),W=Ky(R,O,e,n,i),X=t.prevZ,Y=t.nextZ;for(;X&&X.z>=z&&Y&&Y.z<=W;){if(X.x>=S&&X.x<=R&&X.y>=A&&X.y<=O&&X!==s&&X!==c&&Qu(p,w,m,E,x,D,X.x,X.y)&&cr(X.prev,X,X.next)>=0||(X=X.prevZ,Y.x>=S&&Y.x<=R&&Y.y>=A&&Y.y<=O&&Y!==s&&Y!==c&&Qu(p,w,m,E,x,D,Y.x,Y.y)&&cr(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;X&&X.z>=z;){if(X.x>=S&&X.x<=R&&X.y>=A&&X.y<=O&&X!==s&&X!==c&&Qu(p,w,m,E,x,D,X.x,X.y)&&cr(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;Y&&Y.z<=W;){if(Y.x>=S&&Y.x<=R&&Y.y>=A&&Y.y<=O&&Y!==s&&Y!==c&&Qu(p,w,m,E,x,D,Y.x,Y.y)&&cr(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function mS(t,e){let n=t;do{let i=n.prev,s=n.next.next;!Pm(i,s)&&Sb(i,n,n.next,s)&&xf(i,s)&&xf(s,i)&&(e.push(i.i,n.i,s.i),vf(n),vf(n.next),n=t=s),n=n.next}while(n!==t);return fc(n)}function gS(t,e,n,i,s,l){let c=t;do{let p=c.next.next;for(;p!==c.prev;){if(c.i!==p.i&&bS(c,p)){let m=Ab(c,p);return c=fc(c,c.next),m=fc(m,m.next),yf(c,e,n,i,s,l,0),void yf(m,e,n,i,s,l,0)}p=p.next}c=c.next}while(c!==t)}function _S(t,e){return t.x-e.x}function yS(t,e){let n=function(s,l){let c=l,p=s.x,m=s.y,x,w=-1/0;do{if(m<=c.y&&m>=c.next.y&&c.next.y!==c.y){let R=c.x+(m-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(R<=p&&R>w&&(w=R,x=c.x<c.next.x?c:c.next,R===p))return x}c=c.next}while(c!==l);if(!x)return null;let E=x,D=x.x,S=x.y,A=1/0;c=x;do{if(p>=c.x&&c.x>=D&&p!==c.x&&Qu(m<S?p:w,m,D,S,m<S?w:p,m,c.x,c.y)){let R=Math.abs(m-c.y)/(p-c.x);xf(c,s)&&(R<A||R===A&&(c.x>x.x||c.x===x.x&&xS(x,c)))&&(x=c,A=R)}c=c.next}while(c!==E);return x}(t,e);if(!n)return e;let i=Ab(n,t);return fc(i,i.next),fc(n,n.next)}function xS(t,e){return cr(t.prev,t,e.prev)<0&&cr(e.next,t,t.next)<0}function Ky(t,e,n,i,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function vS(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Qu(t,e,n,i,s,l,c,p){return(s-c)*(e-p)>=(t-c)*(l-p)&&(t-c)*(i-p)>=(n-c)*(e-p)&&(n-c)*(l-p)>=(s-c)*(i-p)}function bS(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,i){let s=n;do{if(s.i!==n.i&&s.next.i!==n.i&&s.i!==i.i&&s.next.i!==i.i&&Sb(s,s.next,n,i))return!0;s=s.next}while(s!==n);return!1}(t,e)&&(xf(t,e)&&xf(e,t)&&function(n,i){let s=n,l=!1,c=(n.x+i.x)/2,p=(n.y+i.y)/2;do s.y>p!=s.next.y>p&&s.next.y!==s.y&&c<(s.next.x-s.x)*(p-s.y)/(s.next.y-s.y)+s.x&&(l=!l),s=s.next;while(s!==n);return l}(t,e)&&(cr(t.prev,t,e.prev)||cr(t,e.prev,e))||Pm(t,e)&&cr(t.prev,t,t.next)>0&&cr(e.prev,e,e.next)>0)}function cr(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Pm(t,e){return t.x===e.x&&t.y===e.y}function Sb(t,e,n,i){let s=Lm(cr(t,e,n)),l=Lm(cr(t,e,i)),c=Lm(cr(n,i,t)),p=Lm(cr(n,i,e));return s!==l&&c!==p||!(s!==0||!Rm(t,n,e))||!(l!==0||!Rm(t,i,e))||!(c!==0||!Rm(n,t,i))||!(p!==0||!Rm(n,e,i))}function Rm(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Lm(t){return t>0?1:t<0?-1:0}function xf(t,e){return cr(t.prev,t,t.next)<0?cr(t,e,t.next)>=0&&cr(t,t.prev,e)>=0:cr(t,e,t.prev)<0||cr(t,t.next,e)<0}function Ab(t,e){let n=Jy(t.i,t.x,t.y),i=Jy(e.i,e.x,e.y),s=t.next,l=e.prev;return t.next=e,e.prev=t,n.next=s,s.prev=n,i.next=n,n.prev=i,l.next=i,i.prev=l,i}function Pb(t,e,n,i){let s=Jy(t,e,n);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function vf(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Jy(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Om(t,e){let n=t.length;if(n<=1)return[t];let i=[],s,l;for(let c=0;c<n;c++){let p=ps(t[c]);p!==0&&(t[c].area=Math.abs(p),l===void 0&&(l=p<0),l===p<0?(s&&i.push(s),s=[t[c]]):s.push(t[c]))}if(s&&i.push(s),e>1)for(let c=0;c<i.length;c++)i[c].length<=e||(zp(i[c],e,1,i[c].length-1,wS),i[c]=i[c].slice(0,e));return i}function wS(t,e){return e.area-t.area}function e0(t,e,n){let i=n.patternDependencies,s=!1;for(let l of e){let c=l.paint.get(`${t}-pattern`);c.isConstant()||(s=!0);let p=c.constantOr(null);p&&(s=!0,i[p]=!0)}return s}function t0(t,e,n,i,s){let l=s.patternDependencies;for(let c of e){let p=c.paint.get(`${t}-pattern`).value;if(p.kind!=="constant"){let m=p.evaluate({zoom:i},n,{},s.availableImages);m=m&&m.name?m.name:m,l[m]=!0,n.patterns[c.id]=m}}return n}class km{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new lo,this.indexArray=new pr,this.indexArray2=new Va,this.programConfigurations=new Ua(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new $n,this.segments2=new $n,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}updateFootprints(e,n){}populate(e,n,i,s){this.hasPattern=e0("fill",this.layers,n);let l=this.layers[0].layout.get("fill-sort-key"),c=[];for(let{feature:p,id:m,index:x,sourceLayerIndex:w}of e){let E=this.layers[0]._featureFilter.needGeometry,D=ks(p,E);if(!this.layers[0]._featureFilter.filter(new vt(this.zoom),D,i))continue;let S=l?l.evaluate(D,{},i,n.availableImages):void 0,A={id:m,properties:p.properties,type:p.type,sourceLayerIndex:w,index:x,geometry:E?D.geometry:uo(p,i,s),patterns:{},sortKey:S};c.push(A)}l&&c.sort((p,m)=>p.sortKey-m.sortKey);for(let p of c){let{geometry:m,index:x,sourceLayerIndex:w}=p;if(this.hasPattern){let E=t0("fill",this.layers,p,this.zoom,n);this.patternFeatures.push(E)}else this.addFeature(p,m,x,i,{},n.availableImages,n.brightness);n.featureIndex.insert(e[x].feature,m,x,w,this.index)}}update(e,n,i,s,l){let c=Object.keys(e).length!==0;c&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,c?this.stateDependentLayers:this.layers,i,s,l)}addFeatures(e,n,i,s,l,c){for(let p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,i,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dS),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,i,s,l,c=[],p){for(let m of Om(n,500)){let x=0;for(let R of m)x+=R.length;let w=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),E=w.vertexLength,D=[],S=[];for(let R of m){if(R.length===0)continue;R!==m[0]&&S.push(D.length/2);let O=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),z=O.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(z+R.length-1,z),D.push(R[0].x),D.push(R[0].y);for(let W=1;W<R.length;W++)this.layoutVertexArray.emplaceBack(R[W].x,R[W].y),this.indexArray2.emplaceBack(z+W-1,z+W),D.push(R[W].x),D.push(R[W].y);O.vertexLength+=R.length,O.primitiveLength+=R.length}let A=_f(D,S);for(let R=0;R<A.length;R+=3)this.indexArray.emplaceBack(E+A[R],E+A[R+1],E+A[R+2]);w.vertexLength+=x,w.primitiveLength+=A.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,l,c,s,p)}}q(km,"FillBucket",{omit:["layers","patternFeatures"]});let TS=new ln({"fill-sort-key":new it(be.layout_fill["fill-sort-key"]),visibility:new Oe(be.layout_fill.visibility)});var ES={paint:new ln({"fill-antialias":new Oe(be.paint_fill["fill-antialias"]),"fill-opacity":new it(be.paint_fill["fill-opacity"]),"fill-color":new it(be.paint_fill["fill-color"]),"fill-outline-color":new it(be.paint_fill["fill-outline-color"]),"fill-translate":new Oe(be.paint_fill["fill-translate"]),"fill-translate-anchor":new Oe(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new it(be.paint_fill["fill-pattern"]),"fill-emissive-strength":new Oe(be.paint_fill["fill-emissive-strength"])}),layout:TS};class n0{constructor(e,n,i,s){if(this.triangleCount=n.length/3,this.min=new tt(0,0),this.max=new tt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[l,c]=[e[0].clone(),e[0].clone()];for(let E=1;E<e.length;++E){let D=e[E];l.x=Math.min(l.x,D.x),l.y=Math.min(l.y,D.y),c.x=Math.max(c.x,D.x),c.y=Math.max(c.y,D.y)}if(s){let E=Math.ceil(Math.max(c.x-l.x,c.y-l.y)/s);i=Math.max(i,E)}if(i===0)return;this.min=l,this.max=c;let p=this.max.sub(this.min);p.x=Math.max(p.x,1),p.y=Math.max(p.y,1);let m=Math.max(p.x,p.y)/i;this.cellsX=Math.max(1,Math.ceil(p.x/m)),this.cellsY=Math.max(1,Math.ceil(p.y/m)),this.xScale=1/m,this.yScale=1/m;let x=[];for(let E=0;E<this.triangleCount;E++){let D=e[n[3*E+0]].sub(this.min),S=e[n[3*E+1]].sub(this.min),A=e[n[3*E+2]].sub(this.min),R=Wo(Math.floor(Math.min(D.x,S.x,A.x)),this.xScale,this.cellsX),O=Wo(Math.floor(Math.max(D.x,S.x,A.x)),this.xScale,this.cellsX),z=Wo(Math.floor(Math.min(D.y,S.y,A.y)),this.yScale,this.cellsY),W=Wo(Math.floor(Math.max(D.y,S.y,A.y)),this.yScale,this.cellsY),X=new tt(0,0),Y=new tt(0,0),re=new tt(0,0),ne=new tt(0,0);for(let ue=z;ue<=W;++ue){X.y=Y.y=ue*m,re.y=ne.y=(ue+1)*m;for(let de=R;de<=O;++de)X.x=re.x=de*m,Y.x=ne.x=(de+1)*m,(Uy(D,S,A,X,Y,ne)||Uy(D,S,A,X,ne,re))&&x.push({cellIdx:ue*this.cellsX+de,triIdx:E})}}if(x.length===0)return;x.sort((E,D)=>E.cellIdx-D.cellIdx||E.triIdx-D.triIdx);let w=0;for(;w<x.length;){let E=x[w].cellIdx,D={start:this.payload.length,len:0};for(;w<x.length&&x[w].cellIdx===E;)++D.len,this.payload.push(x[w++].triIdx);this.cells[E]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let i=Wo(e.x-this.min.x,this.xScale,this.cellsX),s=Wo(e.y-this.min.y,this.yScale,this.cellsY),l=this.cells[s*this.cellsX+i];if(l){this._lazyInitLookup();for(let c=0;c<l.len;c++){let p=this.payload[l.start+c],m=Math.floor(p/8),x=1<<p%8;if(!(this.lookup[m]&x)&&(this.lookup[m]|=x,n.push(p),n.length===this.triangleCount))return}}}query(e,n,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();let s=Wo(e.x-this.min.x,this.xScale,this.cellsX),l=Wo(n.x-this.min.x,this.xScale,this.cellsX),c=Wo(e.y-this.min.y,this.yScale,this.cellsY),p=Wo(n.y-this.min.y,this.yScale,this.cellsY);for(let m=c;m<=p;m++)for(let x=s;x<=l;x++){let w=this.cells[m*this.cellsX+x];if(w)for(let E=0;E<w.len;E++){let D=this.payload[w.start+E],S=Math.floor(D/8),A=1<<D%8;if(!(this.lookup[S]&A)&&(this.lookup[S]|=A,i.push(D),i.length===this.triangleCount))return}}}}function Wo(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}q(n0,"TriangleGridIndex");class Rb{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(e,n){for(let i of this.footprints)n.push({footprint:i,id:e})}populate(e,n,i,s){let l=[];for(let{feature:c,id:p,index:m,sourceLayerIndex:x}of e){let w=this.layers[0]._featureFilter.needGeometry,E=ks(c,w);if(!this.layers[0]._featureFilter.filter(new vt(this.zoom),E,i))continue;let D={id:p,properties:c.properties,type:c.type,sourceLayerIndex:x,index:m,geometry:w?E.geometry:uo(c,i,s),patterns:{}};l.push(D)}for(let c of l){let{geometry:p,index:m,sourceLayerIndex:x}=c;this.addFeature(c,p,m,i,{},n.availableImages,n.brightness),n.featureIndex.insert(e[m].feature,p,m,x,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,i,s,l){}destroy(){}addFeature(e,n,i,s,l,c=[],p){for(let m of Om(n,2)){let x=[],w=[],E=[],D=new tt(1/0,1/0),S=new tt(-1/0,-1/0);for(let O of m)if(O.length!==0){O!==m[0]&&E.push(w.length/2);for(let z=0;z<O.length;z++)w.push(O[z].x),w.push(O[z].y),x.push(O[z]),D.x=Math.min(D.x,O[z].x),D.y=Math.min(D.y,O[z].y),S.x=Math.max(S.x,O[z].x),S.y=Math.max(S.y,O[z].y)}let A=_f(w,E),R=new n0(x,A,8,256);this.footprints.push({vertices:x,indices:A,grid:R,min:D,max:S})}}}q(Rb,"ClipBucket",{omit:["layers"]});let IS=new ln({"clip-layer-types":new Oe(be.layout_clip["clip-layer-types"])});var DS={paint:new ln({}),layout:IS};let MS=un([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),CS=un([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),SS=un([{name:"a_centroid_pos",components:2,type:"Uint16"}]),AS=un([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),PS=un([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:RS}=MS;var Fm={},LS=su,Lb=Ku;function Ku(t,e,n,i,s){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=s,t.readFields(OS,this,e)}function OS(t,e,n){t==1?e.id=n.readVarint():t==2?function(i,s){for(var l=i.readVarint()+i.pos;i.pos<l;){var c=s._keys[i.readVarint()],p=s._values[i.readVarint()];s.properties[c]=p}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function kS(t){for(var e,n,i=0,s=0,l=t.length,c=l-1;s<l;c=s++)i+=((n=t[c]).x-(e=t[s]).x)*(e.y+n.y);return i}Ku.types=["Unknown","Point","LineString","Polygon"],Ku.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,s=0,l=0,c=0,p=[];t.pos<n;){if(s<=0){var m=t.readVarint();i=7&m,s=m>>3}if(s--,i===1||i===2)l+=t.readSVarint(),c+=t.readSVarint(),i===1&&(e&&p.push(e),e=[]),e.push(new LS(l,c));else{if(i!==7)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&p.push(e),p},Ku.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,i=0,s=0,l=0,c=1/0,p=-1/0,m=1/0,x=-1/0;t.pos<e;){if(i<=0){var w=t.readVarint();n=7&w,i=w>>3}if(i--,n===1||n===2)(s+=t.readSVarint())<c&&(c=s),s>p&&(p=s),(l+=t.readSVarint())<m&&(m=l),l>x&&(x=l);else if(n!==7)throw new Error("unknown command "+n)}return[c,m,p,x]},Ku.prototype.toGeoJSON=function(t,e,n){var i,s,l=this.extent*Math.pow(2,n),c=this.extent*t,p=this.extent*e,m=this.loadGeometry(),x=Ku.types[this.type];function w(S){for(var A=0;A<S.length;A++){var R=S[A];S[A]=[360*(R.x+c)/l-180,360/Math.PI*Math.atan(Math.exp((180-360*(R.y+p)/l)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(i=0;i<m.length;i++)E[i]=m[i][0];w(m=E);break;case 2:for(i=0;i<m.length;i++)w(m[i]);break;case 3:for(m=function(S){var A=S.length;if(A<=1)return[S];for(var R,O,z=[],W=0;W<A;W++){var X=kS(S[W]);X!==0&&(O===void 0&&(O=X<0),O===X<0?(R&&z.push(R),R=[S[W]]):R.push(S[W]))}return R&&z.push(R),z}(m),i=0;i<m.length;i++)for(s=0;s<m[i].length;s++)w(m[i][s])}m.length===1?m=m[0]:x="Multi"+x;var D={type:"Feature",geometry:{type:x,coordinates:m},properties:this.properties};return"id"in this&&(D.id=this.id),D};var FS=Lb,Ob=kb;function kb(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(NS,this,e),this.length=this._features.length}function NS(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(i){for(var s=null,l=i.readVarint()+i.pos;i.pos<l;){var c=i.readVarint()>>3;s=c===1?i.readString():c===2?i.readFloat():c===3?i.readDouble():c===4?i.readVarint64():c===5?i.readVarint():c===6?i.readSVarint():c===7?i.readBoolean():null}return s}(n))}kb.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new FS(this._pbf,e,this.extent,this._keys,this._values)};var zS=Ob;function BS(t,e,n){if(t===3){var i=new zS(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}var r0=Fm.VectorTile=function(t,e){this.layers=t.readFields(BS,{},e)},Nm=Fm.VectorTileFeature=Lb;Fm.VectorTileLayer=Ob;class pc extends tt{constructor(e,n,i){super(e,n),this.z=i}}class Fb extends pc{constructor(e,n,i,s){super(e,n,i),this.w=s}}function zm(t,e,n,i){let s=[],l=i===0?(c,p,m,x,w,E)=>{c.push(new tt(E,m+(E-p)/(x-p)*(w-m)))}:(c,p,m,x,w,E)=>{c.push(new tt(p+(E-m)/(w-m)*(x-p),E))};for(let c of t){let p=[];for(let m of c){if(m.length<=2)continue;let x=[];for(let D=0;D<m.length-1;D++){let S=m[D].x,A=m[D].y,R=m[D+1].x,O=m[D+1].y,z=i===0?S:A,W=i===0?R:O;z<e?W>e&&l(x,S,A,R,O,e):z>n?W<n&&l(x,S,A,R,O,n):x.push(m[D]),W<e&&z>=e&&l(x,S,A,R,O,e),W>n&&z<=n&&l(x,S,A,R,O,n)}let w=m[m.length-1],E=i===0?w.x:w.y;E>=e&&E<=n&&x.push(w),x.length&&(w=x[x.length-1],x[0].x===w.x&&x[0].y===w.y||x.push(x[0]),p.push(x))}p.length&&s.push(p)}return s}function Nb(t,e,n,i){let s=n==="x"?"y":"x",l=(i-t[n])/(e[n]-t[n]);t[s]=t[s]+(e[s]-t[s])*l,t[n]=i,t.hasOwnProperty("z")&&(t.z=pt(t.z,e.z,l)),t.hasOwnProperty("w")&&(t.w=pt(t.w,e.w,l))}function zb(t,e,n,i){let s=n,l=i;for(let c of["x","y"]){let p=t,m=e;p[c]>=m[c]&&(p=e,m=t),p[c]<s&&m[c]>s&&Nb(p,m,c,s),p[c]<l&&m[c]>l&&Nb(m,p,c,l)}}function Bm(t,e){return t.x-e.x||t.y-e.y}function Bb(t,e){return Bm(t.min,e.min)===0&&Bm(t.max,e.max)===0}function i0(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function o0(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n].sourceId!==e[n].sourceId||!Bb(t[n],e[n])||t[n].order!==e[n].order||t[n].clipMask!==e[n].clipMask)return!1;return!0}function Vb(t,e,n){let i=1/Ye,s=1/(1<<n.canonical.z),l=(e.x*i+n.canonical.x)*s+n.wrap,c=(e.y*i+n.canonical.y)*s;return{min:new tt((t.x*i+n.canonical.x)*s+n.wrap,(t.y*i+n.canonical.y)*s),max:new tt(l,c)}}function VS(t,e,n){let i=1<<n.canonical.z,s=((e.x-n.wrap)*i-n.canonical.x)*Ye,l=(e.y*i-n.canonical.y)*Ye;return{min:new tt(((t.x-n.wrap)*i-n.canonical.x)*Ye,(t.y*i-n.canonical.y)*Ye),max:new tt(s,l)}}function jb(t,e,n,i,s,l,c){let p=t.indices,m=t.vertices,x=[];for(let w=i;w<i+s;w+=3){let E=e[n[w+0]+l],D=e[n[w+1]+l],S=e[n[w+2]+l],A=Math.min(E.x,D.x,S.x),R=Math.max(E.x,D.x,S.x),O=Math.min(E.y,D.y,S.y),z=Math.max(E.y,D.y,S.y);x.length=0,t.grid.query(new tt(A,O),new tt(R,z),x);for(let W=0;W<x.length;W++){let X=x[W];if(Uy(m[p[3*X+0]],m[p[3*X+1]],m[p[3*X+2]],E,D,S,c))return!0}}return!1}function Ub(t,e,n,i){if(!t||!n)return!1;let s=t.vertices;if(!e.canonical.equals(i.canonical)||e.wrap!==i.wrap){if(n.vertices.length<t.vertices.length)return Ub(n,i,t,e);let l=e.canonical,c=i.canonical,p=Math.pow(2,c.z-l.z);s=t.vertices.map(m=>new tt((m.x+l.x*Ye)*p-c.x*Ye,(m.y+l.y*Ye)*p-c.y*Ye))}return jb(n,s,t.indices,0,t.indices.length,0,0)}function Gb(t,e,n,i){let s=Math.pow(2,i.z-n.z);return new tt((t+n.x*Ye)*s-i.x*Ye,(e+n.y*Ye)*s-i.y*Ye)}function $b(t,e){let n=[];e.footprint.grid.queryPoint(t,n);let i=e.footprint.indices,s=e.footprint.vertices;for(let l=0;l<n.length;l++){let c=n[l];if($a([s[i[3*c+0]],s[i[3*c+1]],s[i[3*c+2]]],t))return!0}return!1}class Hb{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let i=this.toIdx(e,n);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function qb(t,e,n,i){let s=0,l=Number.MAX_VALUE;for(let c=0;c<3;c++)if(Math.abs(i[c])<1e-15){if(n[c]<t[c]||n[c]>e[c])return null}else{let p=1/i[c],m=(t[c]-n[c])*p,x=(e[c]-n[c])*p;if(m>x){let w=m;m=x,x=w}if(m>s&&(s=m),x<l&&(l=x),s>l)return null}return s}function Wb(t,e,n,i,s,l,c,p,m,x,w){let E=i-t,D=s-e,S=l-n,A=c-t,R=p-e,O=m-n,z=w[1]*O-w[2]*R,W=w[2]*A-w[0]*O,X=w[0]*R-w[1]*A,Y=E*z+D*W+S*X;if(Math.abs(Y)<1e-15)return null;let re=1/Y,ne=x[0]-t,ue=x[1]-e,de=x[2]-n,ve=(ne*z+ue*W+de*X)*re;if(ve<0||ve>1)return null;let Ce=ue*S-de*D,Te=de*E-ne*S,Le=ne*D-ue*E,Ue=(w[0]*Ce+w[1]*Te+w[2]*Le)*re;return Ue<0||ve+Ue>1?null:(A*Ce+R*Te+O*Le)*re}function Zb(t,e,n){return(t-e)/(n-e)}function Xb(t,e,n,i,s,l,c,p,m){let x=1<<n,w=l-i,E=c-s,D=(t+1)/x*w+i,S=(e+0)/x*E+s,A=(e+1)/x*E+s;p[0]=(t+0)/x*w+i,p[1]=S,m[0]=D,m[1]=A}class Yb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(l){let c=Math.ceil(Math.log2(l.dim/8)),p=[],m=Math.ceil(Math.pow(2,c)),x=1/m,w=(S,A,R,O,z)=>{let W=O?1:0,X=(S+1)*R-W,Y=A*R,re=(A+1)*R-W;z[0]=S*R,z[1]=Y,z[2]=X,z[3]=re},E=new Hb(m),D=[];for(let S=0;S<m*m;S++){w(S%m,Math.floor(S/m),x,!1,D);let A=qa(D[0],D[1],l),R=qa(D[2],D[1],l),O=qa(D[2],D[3],l),z=qa(D[0],D[3],l);E.minimums.push(Math.min(A,R,O,z)),E.maximums.push(Math.max(A,R,O,z)),E.leaves.push(1)}for(p.push(E),m/=2;m>=1;m/=2){let S=p[p.length-1];E=new Hb(m);for(let A=0;A<m*m;A++){w(A%m,Math.floor(A/m),2,!0,D);let R=S.getElevation(D[0],D[1]),O=S.getElevation(D[2],D[1]),z=S.getElevation(D[2],D[3]),W=S.getElevation(D[0],D[3]),X=S.isLeaf(D[0],D[1]),Y=S.isLeaf(D[2],D[1]),re=S.isLeaf(D[2],D[3]),ne=S.isLeaf(D[0],D[3]),ue=Math.min(R.min,O.min,z.min,W.min),de=Math.max(R.max,O.max,z.max,W.max),ve=X&&Y&&re&&ne;E.maximums.push(de),E.minimums.push(ue),E.leaves.push(de-ue<=5&&ve?1:0)}p.push(E)}return p}(this.dem),i=n.length-1,s=n[i];this._addNode(s.minimums[0],s.maximums[0],s.leaves[0]),this._construct(n,0,0,i,0)}raycastRoot(e,n,i,s,l,c,p=1){return qb([e,n,-100],[i,s,this.maximums[0]*p],l,c)}raycast(e,n,i,s,l,c,p=1){if(!this.nodeCount)return null;let m=this.raycastRoot(e,n,i,s,l,c,p);if(m==null)return null;let x=[],w=[],E=[],D=[],S=[{idx:0,t:m,nodex:0,nodey:0,depth:0}];for(;S.length>0;){let{idx:A,t:R,nodex:O,nodey:z,depth:W}=S.pop();if(this.leaves[A]){Xb(O,z,W,e,n,i,s,E,D);let Y=1<<W,re=(O+0)/Y,ne=(O+1)/Y,ue=(z+0)/Y,de=(z+1)/Y,ve=qa(re,ue,this.dem)*p,Ce=qa(ne,ue,this.dem)*p,Te=qa(ne,de,this.dem)*p,Le=qa(re,de,this.dem)*p,Ue=Wb(E[0],E[1],ve,D[0],E[1],Ce,D[0],D[1],Te,l,c),Pe=Wb(D[0],D[1],Te,E[0],D[1],Le,E[0],E[1],ve,l,c),Be=Math.min(Ue!==null?Ue:Number.MAX_VALUE,Pe!==null?Pe:Number.MAX_VALUE);if(Be!==Number.MAX_VALUE)return Be;{let Se=o._.scaleAndAdd([],l,c,R);if(Qb(ve,Ce,Le,Te,Zb(Se[0],E[0],D[0]),Zb(Se[1],E[1],D[1]))>=Se[2])return R}continue}let X=0;for(let Y=0;Y<this._siblingOffset.length;Y++){Xb((O<<1)+this._siblingOffset[Y][0],(z<<1)+this._siblingOffset[Y][1],W+1,e,n,i,s,E,D),E[2]=-100,D[2]=this.maximums[this.childOffsets[A]+Y]*p;let re=qb(E,D,l,c);if(re!=null){let ne=re;x[Y]=ne;let ue=!1;for(let de=0;de<X&&!ue;de++)ne>=x[w[de]]&&(w.splice(de,0,Y),ue=!0);ue||(w[X]=Y),X++}}for(let Y=0;Y<X;Y++){let re=w[Y];S.push({idx:this.childOffsets[A]+re,t:x[re],nodex:(O<<1)+this._siblingOffset[re][0],nodey:(z<<1)+this._siblingOffset[re][1],depth:W+1})}}return null}_addNode(e,n,i){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,i,s,l){if(e[s].isLeaf(n,i)===1)return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);let c=s-1,p=e[c],m=0,x=0;for(let w=0;w<this._siblingOffset.length;w++){let E=2*n+this._siblingOffset[w][0],D=2*i+this._siblingOffset[w][1],S=p.getElevation(E,D),A=p.isLeaf(E,D),R=this._addNode(S.min,S.max,A);A&&(m|=1<<w),x||(x=R)}for(let w=0;w<this._siblingOffset.length;w++)m&1<<w||this._construct(e,2*n+this._siblingOffset[w][0],2*i+this._siblingOffset[w][1],c,x+w)}}function Qb(t,e,n,i,s,l){return pt(pt(t,n,l),pt(e,i,l),s)}function qa(t,e,n){let i=n.dim,s=St(t*i-.5,0,i-1),l=St(e*i-.5,0,i-1),c=Math.floor(s),p=Math.floor(l),m=Math.min(c+1,i-1),x=Math.min(p+1,i-1);return Qb(n.get(c,p),n.get(m,p),n.get(c,x),n.get(m,x),s-c,l-p)}let jS={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function US(t,e,n){return(256*t*256+256*e+n)/10-1e4}function GS(t,e,n){return 256*t+e+n/256-32768}class Vm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,i,s=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(i&&i!=="mapbox"&&i!=="terrarium")return Qn(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let l=this.dim=n.height-2,c=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=s,this._modifiedForSources={},!s){for(let m=0;m<l;m++)c[this._idx(-1,m)]=c[this._idx(0,m)],c[this._idx(l,m)]=c[this._idx(l-1,m)],c[this._idx(m,-1)]=c[this._idx(m,0)],c[this._idx(m,l)]=c[this._idx(m,l-1)];c[this._idx(-1,-1)]=c[this._idx(0,0)],c[this._idx(l,-1)]=c[this._idx(l-1,0)],c[this._idx(-1,l)]=c[this._idx(0,l-1)],c[this._idx(l,l)]=c[this._idx(l-1,l-1)]}let p=i==="terrarium"?GS:US;for(let m=0;m<c.length;++m){let x=4*m;this.floatView[m]=p(this.pixels[x],this.pixels[x+1],this.pixels[x+2])}this._timestamp=_r.now()}_buildQuadTree(){this._tree=new Yb(this)}get(e,n,i=!1){i&&(e=St(e,-1,this.dim),n=St(n,-1,this.dim));let s=this._idx(e,n);return this.floatView[s]}set(e,n,i){let s=this._idx(e,n),l=this.floatView[s];return this.floatView[s]=i,i-l}static getUnpackVector(e){return jS[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let i=[0,0,0,0],s=Vm.getUnpackVector(n),l=Math.floor((e+s[3])/s[2]);return i[2]=l%256,l=Math.floor(l/256),i[1]=l%256,l=Math.floor(l/256),i[0]=l,i}getPixels(){return new Mb({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let s=n*this.dim,l=n*this.dim+this.dim,c=i*this.dim,p=i*this.dim+this.dim;switch(n){case-1:s=l-1;break;case 1:l=s+1}switch(i){case-1:c=p-1;break;case 1:p=c+1}let m=-n*this.dim,x=-i*this.dim;for(let w=c;w<p;w++)for(let E=s;E<l;E++){let D=4*this._idx(E,w),S=4*this._idx(E+m,w+x);this.pixels[D+0]=e.pixels[S+0],this.pixels[D+1]=e.pixels[S+1],this.pixels[D+2]=e.pixels[S+2],this.pixels[D+3]=e.pixels[S+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}q(Vm,"DEMData"),q(Yb,"DemMinMaxQuadTree",{omit:["dem"]});class Ju{constructor(e,n,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=i}static create(e,n,i){let s=i||e.findDEMTileFor(n);if(!s||!s.dem)return;let l=s.dem,c=s.tileID,p=1<<n.canonical.z-c.canonical.z;return new Ju(s,l.dim/Ye/p,[(n.canonical.x/p-c.canonical.x)*l.dim,(n.canonical.y/p-c.canonical.y)*l.dim])}tileCoordToPixel(e,n){let i=n*this._scale+this._offset[1],s=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(i);return new tt(s,l)}getElevationAt(e,n,i,s){let l=e*this._scale+this._offset[0],c=n*this._scale+this._offset[1],p=Math.floor(l),m=Math.floor(c),x=this._dem;return s=!!s,i?pt(pt(x.get(p,m,s),x.get(p,m+1,s),c-m),pt(x.get(p+1,m,s),x.get(p+1,m+1,s),c-m),l-p):x.get(p,m,s)}getElevationAtPixel(e,n,i){return this._dem.get(e,n,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Yr(1,e)*this._dem.stride}}let Kb={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},$S=Nm.types,HS=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],qS=["fill-extrusion-flood-light-ground-radius"],WS=Math.pow(2,13),ZS=Math.pow(2,15)-1,Jb=new tt(0,1),Wa=2147483648;function bf(t,e,n,i,s,l,c,p){t.emplaceBack((e<<1)+c,(n<<1)+l,(Math.floor(i*WS)<<1)+s,Math.round(p))}function jm(t,e,n,i,s,l){t.emplaceBack(e.x,e.y,(n.x<<1)+i,(n.y<<1)+s,l)}function wf(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class ew{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class tw{constructor(){this.centroidXY=new tt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new tt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new tt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new tt(this.max.x-this.min.x,this.max.y-this.min.y)}}class nw{constructor(){this.acc=new tt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,i){this.accCount++,this.acc._add(n);let s=!!this.borders;n.x<e.min.x?(e.min.x=n.x,s=!0):n.x>e.max.x&&(e.max.x=n.x,s=!0),n.y<e.min.y?(e.min.y=n.y,s=!0):n.y>e.max.y&&(e.max.y=n.y,s=!0),((n.x===0||n.x===Ye)&&n.x===i.x)!=((n.y===0||n.y===Ye)&&n.y===i.y)&&this.processBorderOverlap(n,i),s&&this.checkBorderIntersection(n,i)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,pt(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Ye!=e.x>Ye&&this.addBorderIntersection(1,pt(n.y,e.y,(Ye-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,pt(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Ye!=e.y>Ye&&this.addBorderIntersection(3,pt(n.x,e.x,(Ye-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let i=this.borders[e];n<i[0]&&(i[0]=n),n>i[1]&&(i[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let i=e.x===0?0:1;this.addBorderIntersection(i,n.y),this.addBorderIntersection(i,e.y)}else{let i=e.y===0?2:3;this.addBorderIntersection(i,n.x),this.addBorderIntersection(i,e.x)}}centroid(){return this.accCount===0?new tt(0,0):new tt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function rw(t,e){let n=t.add(e)._unit(),i=St(t.x*n.x+t.y*n.y,-1,1);var s,l,c;return s=Math.acos(i),Math.min(4,Math.max(-4,Math.tan(s)))/4*ZS*((l=t).x*(c=e).y-l.y*c.x<0?-1:1)}let XS=[t=>t.x<0,t=>t.x>Ye,t=>t.y<0,t=>t.y>Ye];function YS(t,e,n,i){let s=[4];if(i===0)return s;n._mult(i);let l=t.sub(n),c=e.sub(n),p=[t,e,l,c];for(let m=0;m<4;m++)for(let x of p)if(XS[m](x)){s.push(m);break}return s}class iw{constructor(e){this.vertexArray=new uy,this.indexArray=new pr,this.programConfigurations=new Ua(e.layers,{zoom:e.zoom,lut:e.lut},n=>qS.includes(n)),this._segments=new $n,this.hiddenByLandmarkVertexArray=new Ey,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new $n}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,i,s=!1){let l=e.length;if(l>2){let c=Math.max(0,this._segments.get().length-1),p=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[c].length),m;c!==this._segments.get().length-1&&(c++,this._segmentToGroundQuads[c]=[],this._segmentToRegionTriCounts[c]=[0,0,0,0,0]);{let x=e[0],w=e[1];m=rw(x.sub(e[l-1])._perp()._unit(),w.sub(x)._perp()._unit())}for(let x=0;x<l;x++){let w=x===l-1?0:x+1,E=e[x],D=e[w],S=e[w===l-1?0:w+1],A=D.sub(E)._perp()._unit(),R=rw(A,S.sub(D)._perp()._unit()),O=m,z=R;if(s0(E,D,n)||s&&aw(E,n)&&aw(D,n)){m=R;continue}let W=p.vertexLength;jm(this.vertexArray,E,D,1,1,O),jm(this.vertexArray,E,D,1,0,O),jm(this.vertexArray,E,D,0,1,z),jm(this.vertexArray,E,D,0,0,z),p.vertexLength+=4;let X=YS(E,D,A,i);for(let Y of X)this._segmentToGroundQuads[c].push({id:W,region:Y}),this._segmentToRegionTriCounts[c][Y]+=2,p.primitiveLength+=2;m=R}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let i=0;i<n;i++)this._segmentToGroundQuads[i].sort((s,l)=>s.region-l.region);for(let i=0;i<n;i++){let s=this._segmentToGroundQuads[i],l=e[i],c=this._segmentToRegionTriCounts[i];c.reduce((m,x)=>m+x,0);let p=0;for(let m=0;m<=4;m++){let x=c[m];if(x!==0){let w=this.regionSegments[m];w||(w=this.regionSegments[m]=new $n);let E={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+p,vertexLength:l.vertexLength,primitiveLength:x};w.get().push(E)}p+=x}for(let m=0;m<s.length;m++){let x=s[m].id;this.indexArray.emplaceBack(x,x+1,x+3),this.indexArray.emplaceBack(x,x+3,x+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,i,s,l,c){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,i,s,l,c)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,CS.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,i,s,l,c){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,i,s,l,c)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let i=e.flags&Wa?1:0;for(let s=e.groundVertexArrayOffset;s<n;++s)this.hiddenByLandmarkVertexArray.emplace(s,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,AS.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class Um{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new pr,this.footprintVertices=new lo,this.footprintSegments=[],this.layoutVertexArray=new Fa,this.centroidVertexArray=new G1,this.indexArray=new pr,this.programConfigurations=new Ua(e.layers,{zoom:e.zoom,lut:e.lut},n=>HS.includes(n)),this.segments=new $n,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new iw(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,n){}populate(e,n,i,s){this.features=[],this.hasPattern=e0("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Tm(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:l,id:c,index:p,sourceLayerIndex:m}of e){let x=this.layers[0]._featureFilter.needGeometry,w=ks(l,x);if(!this.layers[0]._featureFilter.filter(new vt(this.zoom),w,i))continue;let E={id:c,sourceLayerIndex:m,index:p,geometry:x?w.geometry:uo(l,i,s),properties:l.properties,type:l.type,patterns:{}},D=this.layoutVertexArray.length;this.hasPattern?this.features.push(t0("fill-extrusion",this.layers,E,this.zoom,n)):this.addFeature(E,E.geometry,p,i,{},n.availableImages,s,n.brightness),n.featureIndex.insert(l,E.geometry,p,m,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,i,s,l,c){for(let p of this.features){let{geometry:m}=p;this.addFeature(p,m,p.index,n,i,s,l,c)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,i,s,l){let c=Object.keys(e).length!==0;if(c&&!this.stateDependentLayers.length)return;let p=c?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,p,i,s,l),this.groundEffect.update(e,n,p,i,s,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,RS),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,PS.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,SS.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,i,s,l,c,p,m){let x=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,w=[new tt(0,0),new tt(Ye,Ye)],E=p.projection,D=E.name==="globe",S=$S[e.type]==="Polygon",A=new nw;A.centroidDataIndex=this.centroidData.length;let R=new tw,O=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},s)<=0,z=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},s);R.height=z,R.vertexArrayOffset=this.layoutVertexArray.length,R.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ym);let W=Om(n,500);for(let de=W.length-1;de>=0;de--){let ve=W[de];(ve.length===0||(X=ve[0]).every(Ce=>Ce.x<=0)||X.every(Ce=>Ce.x>=Ye)||X.every(Ce=>Ce.y<=0)||X.every(Ce=>Ce.y>=Ye))&&W.splice(de,1)}var X;let Y;if(D)Y=hw(W,w,s);else{Y=[];for(let de of W)Y.push({polygon:de,bounds:w})}let re=S?this.edgeRadius:0,ne=re>0&&this.zoom<17,ue=(de,ve)=>{if(de.length===0)return!1;let Ce=de[de.length-1];return ve.x===Ce.x&&ve.y===Ce.y};for(let{polygon:de,bounds:ve}of Y){let Ce=0,Te=0;for(let Be of de)S&&!Be[0].equals(Be[Be.length-1])&&Be.push(Be[0]),Te+=S?Be.length-1:Be.length;let Le=this.segments.prepareSegment((S?5:4)*Te,this.layoutVertexArray,this.indexArray);R.footprintSegIdx<0&&(R.footprintSegIdx=this.footprintSegments.length),R.polygonSegIdx<0&&(R.polygonSegIdx=this.polygonSegments.length);let Ue={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Pe=new ew;if(Pe.vertexOffset=this.footprintVertices.length,Pe.indexOffset=3*this.footprintIndices.length,Pe.ringIndices=[],S){let Be=[],Se=[];Ce=Le.vertexLength;for(let He=0;He<de.length;He++){let je=de[He];je.length&&He!==0&&Se.push(Be.length/2);let rt=[],Ge,We;Ge=je[1].sub(je[0])._perp()._unit(),Pe.ringIndices.push(je.length-1);for(let dt=1;dt<je.length;dt++){let ht=je[dt],ct=je[dt===je.length-1?1:dt+1],qe=ht.clone();if(re){We=ct.sub(ht)._perp()._unit();let ft=Ge.add(We)._unit(),At=re*Math.min(4,1/(Ge.x*ft.x+Ge.y*ft.y));qe.x+=At*ft.x,qe.y+=At*ft.y,qe.x=Math.round(qe.x),qe.y=Math.round(qe.y),Ge=We}!O||re!==0&&!ne||ue(rt,qe)||rt.push(qe),bf(this.layoutVertexArray,qe.x,qe.y,0,0,1,1,0),Le.vertexLength++,this.footprintVertices.emplaceBack(ht.x,ht.y),Be.push(ht.x,ht.y),D&&wf(this.layoutVertexExtArray,E.projectTilePoint(qe.x,qe.y,s),E.upVector(s,qe.x,qe.y))}O&&(re===0||ne)&&(rt.length!==0&&ue(rt,rt[0])&&rt.pop(),this.groundEffect.addData(rt,ve,x))}let Ve=_f(Be,Se);for(let He=0;He<Ve.length;He+=3)this.footprintIndices.emplaceBack(Pe.vertexOffset+Ve[He+0],Pe.vertexOffset+Ve[He+1],Pe.vertexOffset+Ve[He+2]),this.indexArray.emplaceBack(Ce+Ve[He],Ce+Ve[He+2],Ce+Ve[He+1]),Le.primitiveLength++;Pe.indexCount+=Ve.length,Pe.vertexCount+=this.footprintVertices.length-Pe.vertexOffset}for(let Be=0;Be<de.length;Be++){let Se=de[Be];A.startRing(R,Se[0]);let Ve=Se.length>4&&lw(Se[Se.length-2],Se[0],Se[1]),He=re?QS(Se[Se.length-2],Se[0],Se[1],re):0,je=[],rt,Ge,We;Ge=Se[1].sub(Se[0])._perp()._unit();let dt=!0;for(let ht=1,ct=0;ht<Se.length;ht++){let qe=Se[ht-1],ft=Se[ht],At=Se[ht===Se.length-1?1:ht+1];if(A.appendEdge(R,ft,qe),s0(ft,qe,ve)){re&&(Ge=At.sub(ft)._perp()._unit(),dt=!dt);continue}let xt=ft.sub(qe)._perp(),kt=xt.x/(Math.abs(xt.x)+Math.abs(xt.y)),Pt=xt.y>0?1:0,Vt=qe.dist(ft);if(ct+Vt>32768&&(ct=0),re){We=At.sub(ft)._perp()._unit();let on=sw(qe,ft,At,ow(Ge,We),re);isNaN(on)&&(on=0);let Yt=ft.sub(qe)._unit();qe=qe.add(Yt.mult(He))._round(),ft=ft.add(Yt.mult(-on))._round(),He=on,Ge=We,O&&this.zoom>=17&&(ue(je,qe)||je.push(qe),ue(je,ft)||je.push(ft))}let _t=Le.vertexLength,xn=Se.length>4&&lw(qe,ft,At),_n=cw(ct,Ve,dt);if(bf(this.layoutVertexArray,qe.x,qe.y,kt,Pt,0,0,_n),bf(this.layoutVertexArray,qe.x,qe.y,kt,Pt,0,1,_n),ct+=Vt,_n=cw(ct,xn,!dt),Ve=xn,bf(this.layoutVertexArray,ft.x,ft.y,kt,Pt,0,0,_n),bf(this.layoutVertexArray,ft.x,ft.y,kt,Pt,0,1,_n),Le.vertexLength+=4,this.indexArray.emplaceBack(_t+0,_t+1,_t+2),this.indexArray.emplaceBack(_t+1,_t+3,_t+2),Le.primitiveLength+=2,re){let on=Ce+(ht===1?Se.length-2:ht-2),Yt=ht===1?Ce:on+1;if(this.indexArray.emplaceBack(_t+1,on,_t+3),this.indexArray.emplaceBack(on,Yt,_t+3),Le.primitiveLength+=2,rt===void 0&&(rt=_t),!s0(At,Se[ht],ve)){let sn=ht===Se.length-1?rt:Le.vertexLength;this.indexArray.emplaceBack(_t+2,_t+3,sn),this.indexArray.emplaceBack(_t+3,sn+1,sn),this.indexArray.emplaceBack(_t+3,Yt,sn+1),Le.primitiveLength+=3}dt=!dt}if(D){let on=this.layoutVertexExtArray,Yt=E.projectTilePoint(qe.x,qe.y,s),sn=E.projectTilePoint(ft.x,ft.y,s),An=E.upVector(s,qe.x,qe.y),Tn=E.upVector(s,ft.x,ft.y);wf(on,Yt,An),wf(on,Yt,An),wf(on,sn,Tn),wf(on,sn,Tn)}}S&&(Ce+=Se.length-1),O&&re&&this.zoom>=17&&(je.length!==0&&ue(je,je[0])&&je.pop(),this.groundEffect.addData(je,ve,x,re>0))}this.footprintSegments.push(Pe),Ue.triangleCount=this.indexArray.length-Ue.triangleArrayOffset,this.polygonSegments.push(Ue),++R.footprintSegLen,++R.polygonSegLen}if(R.vertexCount=this.layoutVertexArray.length-R.vertexArrayOffset,R.groundVertexCount=this.groundEffect.vertexArray.length-R.groundVertexArrayOffset,R.vertexCount!==0){if(R.centroidXY=A.borders?Jb:this.encodeCentroid(A,R),this.centroidData.push(R),A.borders){this.featuresOnBorder.push(A);let de=this.featuresOnBorder.length-1;for(let ve=0;ve<A.borders.length;ve++)A.borders[ve][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ve].push(de)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,l,c,s,m),this.groundEffect.addPaintPropertiesData(e,i,l,c,s,m),this.maxHeight=Math.max(this.maxHeight,z)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,i)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[i].borders[e][0])}splitToSubtiles(){let e=[];for(let p=0;p<this.centroidData.length;p++){let m=this.centroidData[p],x=+(m.min.y+m.max.y>Ye),w=2*x+(+(m.min.x+m.max.x>Ye)^x);for(let E=0;E<m.polygonSegLen;E++){let D=m.polygonSegIdx+E;e.push({centroidIdx:p,subtile:w,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}let n=new pr;e.sort((p,m)=>p.triangleSegmentIdx===m.triangleSegmentIdx?p.subtile-m.subtile:p.triangleSegmentIdx-m.triangleSegmentIdx);let i=0,s=0,l=0;for(let p of e){if(p.triangleSegmentIdx!==i)break;l++}let c=e.length;for(;s!==e.length;){i=e[s].triangleSegmentIdx;let p=0,m=s,x=s;for(let w=m;w<l&&e[w].subtile===p;w++)x++;for(;m!==l;){let w=e[m];p=w.subtile;let E=this.centroidData[w.centroidIdx].min.clone(),D=this.centroidData[w.centroidIdx].max.clone(),S={vertexOffset:this.segments.segments[i].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[i].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let A=m;A<x;A++){let R=e[A],O=this.polygonSegments[R.polygonSegmentIdx],z=this.centroidData[R.centroidIdx].min,W=this.centroidData[R.centroidIdx].max,X=this.indexArray.uint16;for(let Y=O.triangleArrayOffset;Y<O.triangleArrayOffset+O.triangleCount;Y++)n.emplaceBack(X[3*Y],X[3*Y+1],X[3*Y+2]);S.primitiveLength+=O.triangleCount,E.x=Math.min(E.x,z.x),E.y=Math.min(E.y,z.y),D.x=Math.max(D.x,W.x),D.y=Math.max(D.y,W.y)}S.primitiveLength>0&&this.triangleSubSegments.push({segment:S,min:E,max:D}),m=x;for(let A=m;A<l&&e[A].subtile===e[m].subtile;A++)x++}s=l;for(let w=s;w<c&&e[w].triangleSegmentIdx===e[s].triangleSegmentIdx;w++)l++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,i){let s=0,l=0,c=1<<e.canonical.z;if(n){let R=n.getMinMaxForTile(e);R&&(s=R.min,l=R.max)}l+=this.maxHeight;let p=e.toUnwrapped(),m,x=[p.canonical.x/c+p.wrap,p.canonical.y/c],w=[(p.canonical.x+1)/c+p.wrap,(p.canonical.y+1)/c],E=new $n,D=(R,O,z)=>[R[0]*(1-z[0])+O[0]*z[0],R[1]*(1-z[1])+O[1]*z[1]],S=[],A=[];for(let R of this.triangleSubSegments){S[0]=R.min.x/Ye,S[1]=R.min.y/Ye,A[0]=R.max.x/Ye,A[1]=R.max.y/Ye;let O=D(x,w,S),z=D(x,w,A);if(new Vn([O[0],O[1],s],[z[0],z[1],l]).intersectsPrecise(i)===0){m&&(E.segments.push(m),m=void 0);continue}let W=R.segment;m&&m.vertexOffset!==W.vertexOffset&&(E.segments.push(m),m=void 0),m?(m.vertexLength+=W.vertexLength,m.primitiveLength+=W.primitiveLength):m={vertexOffset:W.vertexOffset,primitiveLength:W.primitiveLength,vertexLength:W.vertexLength,primitiveOffset:W.primitiveOffset,sortKey:void 0,vaos:{}}}return m&&E.segments.push(m),E}encodeCentroid(e,n){let i=e.centroid(),s=n.span(),l=Math.min(7,Math.round(s.x*this.tileToMeter/10)),c=Math.min(7,Math.round(s.y*this.tileToMeter/10));return new tt(St(i.x,1,Ye-1)<<3|l,St(i.y,1,Ye-1)<<3|c)}encodeBorderCentroid(e){if(!e.borders)return new tt(0,0);let n=e.borders,i=Number.MAX_VALUE;if(n[0][0]!==i||n[1][0]!==i){let s=n[0][0]!==i?0:1;return new tt(6|(n[0][0]!==i?0:65528),(n[s][0]+n[s][1])/2<<3|6)}{let s=n[2][0]!==i?2:3;return new tt((n[s][0]+n[s][1])/2<<3|6,6|(n[2][0]!==i?0:65528))}}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=Wa,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,i=e.vertexCount+e.vertexArrayOffset,s=e.flags&Wa?Jb:e.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==s.y||l!==s.x){for(let c=n;c<i;++c)this.centroidVertexArray.emplace(c,s.x,s.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,i){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let s=n.getReplacementRegionsForTile(e.toUnwrapped());if(o0(this.activeReplacements,s))return;if(this.activeReplacements=s,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let c of this.centroidData)c.flags&=2147483647;let l=[];for(let c of this.activeReplacements){if(c.order<i)continue;let p=Math.pow(2,c.footprintTileId.canonical.z-e.canonical.z);for(let m of this.centroidData)if(!(m.flags&Wa||c.min.x>m.max.x||m.min.x>c.max.x||c.min.y>m.max.y||m.min.y>c.max.y))for(let x=0;x<m.footprintSegLen;x++){let w=this.footprintSegments[m.footprintSegIdx+x];if(l.length=0,KS(this.footprintVertices,w.vertexOffset,w.vertexCount,c.footprintTileId.canonical,e.canonical,l),jb(c.footprint,l,this.footprintIndices.uint16,w.indexOffset,w.indexCount,-w.vertexOffset,-p)){m.flags|=Wa;break}}}for(let c of this.centroidData)this.writeCentroidToBuffer(c);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,i){let s=!1;for(let l=0;l<i.footprintSegLen;l++){let c=this.footprintSegments[i.footprintSegIdx+l],p=0;for(let m of c.ringIndices){for(let x=p,w=m+p-1;x<m+p;w=x++){let E=this.footprintVertices.int16[2*(x+c.vertexOffset)+0],D=this.footprintVertices.int16[2*(x+c.vertexOffset)+1],S=this.footprintVertices.int16[2*(w+c.vertexOffset)+1];D>n!=S>n&&e<(this.footprintVertices.int16[2*(w+c.vertexOffset)+0]-E)*(n-D)/(S-D)+E&&(s=!s)}p=m}}return s}getHeightAtTileCoord(e,n){let i=Number.NEGATIVE_INFINITY,s=!0,l=4*(e+Ye)*Ye+(n+Ye);if(this.partLookup.hasOwnProperty(l)){let c=this.partLookup[l];return c?{height:c.height,hidden:!!(c.flags&Wa)}:void 0}for(let c of this.centroidData)e>c.max.x||c.min.x>e||n>c.max.y||c.min.y>n||this.footprintContainsPoint(e,n,c)&&c&&c.height>i&&(i=c.height,this.partLookup[l]=c,s=!!(c.flags&Wa));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:s};this.partLookup[l]=void 0}}function ow(t,e){let n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function QS(t,e,n,i){let s=e.sub(t)._perp()._unit(),l=n.sub(e)._perp()._unit();return sw(t,e,n,ow(s,l),i)}function sw(t,e,n,i,s){let l=Math.sqrt(1-i*i);return Math.min(t.dist(e)/3,e.dist(n)/3,s*l/i)}function s0(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function aw(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function lw(t,e,n){if(t.x<0||t.x>=Ye||e.x<0||e.x>=Ye||n.x<0||n.x>=Ye)return!1;let i=n.sub(e),s=i.perp(),l=t.sub(e);return(i.x*l.x+i.y*l.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(l.x*l.x+l.y*l.y))>-.866&&s.x*l.x+s.y*l.y<0}function cw(t,e,n){let i=e?2|t:-3&t;return n?1|i:-2&i}function uw(){let t=Math.PI/32,e=Math.tan(t),n=Zu;return n*Math.sqrt(1+2*e*e)-n}function hw(t,e,n){let i=1<<n.z,s=ii(n.x/i),l=ii((n.x+1)/i),c=xr(n.y/i),p=xr((n.y+1)/i);return function(m,x,w,E,D=0,S){let A=[];if(!m.length||!w||!E)return A;let R=(ne,ue)=>{for(let de of ne)A.push({polygon:de,bounds:ue})},O=Math.ceil(Math.log2(w)),z=Math.ceil(Math.log2(E)),W=O-z,X=[];for(let ne=0;ne<Math.abs(W);ne++)X.push(W>0?0:1);for(let ne=0;ne<Math.min(O,z);ne++)X.push(0),X.push(1);let Y=m;if(Y=zm(Y,x[0].y-D,x[1].y+D,1),Y=zm(Y,x[0].x-D,x[1].x+D,0),!Y.length)return A;let re=[];for(X.length?re.push({polygons:Y,bounds:x,depth:0}):R(Y,x);re.length;){let ne=re.pop(),ue=ne.depth,de=X[ue],ve=ne.bounds[0],Ce=ne.bounds[1],Te=de===0?ve.x:ve.y,Le=de===0?Ce.x:Ce.y,Ue=S?S(de,Te,Le):.5*(Te+Le),Pe=zm(ne.polygons,Te-D,Ue+D,de),Be=zm(ne.polygons,Ue-D,Le+D,de);if(Pe.length){let Se=[ve,new tt(de===0?Ue:Ce.x,de===1?Ue:Ce.y)];X.length>ue+1?re.push({polygons:Pe,bounds:Se,depth:ue+1}):R(Pe,Se)}if(Be.length){let Se=[new tt(de===0?Ue:ve.x,de===1?Ue:ve.y),Ce];X.length>ue+1?re.push({polygons:Be,bounds:Se,depth:ue+1}):R(Be,Se)}}return A}(t,e,Math.ceil((l-s)/11.25),Math.ceil((c-p)/11.25),1,(m,x,w)=>{if(m===0)return .5*(x+w);{let E=xr((n.y+x/Ye)/i);return(Ho(.5*(xr((n.y+w/Ye)/i)+E))*i-n.y)*Ye}})}function KS(t,e,n,i,s,l){let c=Math.pow(2,i.z-s.z);for(let p=0;p<n;p++){let m=t.int16[2*(p+e)+0],x=t.int16[2*(p+e)+1];m=(m+s.x*Ye)*c-i.x*Ye,x=(x+s.y*Ye)*c-i.y*Ye,l.push(new tt(m,x))}}q(Um,"FillExtrusionBucket",{omit:["layers","features"]}),q(tw,"PartData"),q(ew,"FootprintSegment"),q(nw,"BorderCentroidData"),q(iw,"GroundEffect");let JS=new ln({visibility:new Oe(be["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Oe(be["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var e2={paint:new ln({"fill-extrusion-opacity":new Oe(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new it(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Oe(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Oe(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new it(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new it(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new it(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Oe(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Oe(be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Oe(be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Oe(be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Oe(be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Oe(be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Oe(be["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Oe(be["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new it(be["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new it(be["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Oe(be["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Oe(be["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Oe(be["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Oe(be["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Oe(be["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:JS};function Tf(t,e){return t.x*e.x+t.y*e.y}function dw(t,e){if(t.length===1){let n=0,i=e[n++],s;for(;!s||i.equals(s);)if(s=e[n++],!s)return 1/0;for(;n<e.length;n++){let l=e[n],c=t[0],p=s.sub(i),m=l.sub(i),x=c.sub(i),w=Tf(p,p),E=Tf(p,m),D=Tf(m,m),S=Tf(x,p),A=Tf(x,m),R=w*D-E*E,O=(D*S-E*A)/R,z=(w*A-E*S)/R,W=i.z*(1-O-z)+s.z*O+l.z*z;if(isFinite(W))return W}return 1/0}{let n=1/0;for(let i of e)n=Math.min(n,i.z);return n}}function fw(t,e,n,i,s,l,c,p){let m=c*s.getElevationAt(t,e,!0,!0),x=l[0]!==0,w=x?l[1]===0?c*(l[0]/7-450):c*function(E,D,S){let A=Math.floor(D[0]/8),R=Math.floor(D[1]/8),O=10*(D[0]-8*A),z=10*(D[1]-8*R),W=E.getElevationAt(A,R,!0,!0),X=E.getMeterToDEM(S),Y=Math.floor(.5*(O*X-1)),re=Math.floor(.5*(z*X-1)),ne=E.tileCoordToPixel(A,R),ue=2*Y+1,de=2*re+1,ve=function(Be,Se,Ve,He,je){return[Be.getElevationAtPixel(Se,Ve,!0),Be.getElevationAtPixel(Se+je,Ve,!0),Be.getElevationAtPixel(Se,Ve+je,!0),Be.getElevationAtPixel(Se+He,Ve+je,!0)]}(E,ne.x-Y,ne.y-re,ue,de),Ce=Math.abs(ve[0]-ve[1]),Te=Math.abs(ve[2]-ve[3]),Le=Math.abs(ve[0]-ve[2])+Math.abs(ve[1]-ve[3]),Ue=Math.min(.25,.5*X*(Ce+Te)/ue),Pe=Math.min(.25,.5*X*Le/de);return W+Math.max(Ue*O,Pe*z)}(s,l,p):m;return{base:m+(n===0)?-1:n,top:x?Math.max(w+i,m+n+2):m+i}}let t2=un([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:n2}=t2,r2=un([{name:"a_packed",components:4,type:"Float32"}]),{members:i2}=r2,o2=un([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:s2}=o2,a2=un([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),l2=un([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),c2=un([{name:"a_projected_pos",components:4,type:"Float32"}],4);un([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let a0=un([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),pw=un([{name:"a_z_offset",components:1,type:"Float32"}],4),u2=un([{name:"a_texb",components:2,type:"Uint16"}]),h2=un([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),d2=un([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);un([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let mw=un([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),f2=un([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);un([{name:"triangle",components:3,type:"Uint16"}]),un([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),un([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),un([{type:"Float32",name:"offsetX"}]),un([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class gw{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Ha({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let i=this.getKey(e,n);return this.positions[i]}trim(){let e=this.width,n=this.height=nd(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,i){let s=[],l=e.length%2==1?-e[e.length-1]*i:0,c=e[0]*i,p=!0;s.push({left:l,right:c,isDash:p,zeroLength:e[0]===0});let m=e[0];for(let x=1;x<e.length;x++){p=!p;let w=e[x];l=m*i,m+=w,c=m*i,s.push({left:l,right:c,isDash:p,zeroLength:w===0})}return s}addRoundDash(e,n,i){let s=n/2;for(let l=-i;l<=i;l++){let c=this.width*(this.nextRow+i+l),p=0,m=e[p];for(let x=0;x<this.width;x++){x/m.right>1&&(m=e[++p]);let w=Math.abs(x-m.left),E=Math.abs(x-m.right),D=Math.min(w,E),S,A=l/i*(s+1);if(m.isDash){let R=s-Math.abs(A);S=Math.sqrt(D*D+R*R)}else S=s-Math.sqrt(D*D+A*A);this.image.data[c+x]=Math.max(0,Math.min(255,S+128))}}}addRegularDash(e,n){for(let m=e.length-1;m>=0;--m){let x=e[m],w=e[m+1];x.zeroLength?e.splice(m,1):w&&w.isDash===x.isDash&&(w.left=x.left,e.splice(m,1))}let i=e[0],s=e[e.length-1];i.isDash===s.isDash&&(i.left=s.left-this.width,s.right=i.right+this.width);let l=this.width*this.nextRow,c=0,p=e[c];for(let m=0;m<this.width;m++){m/p.right>1&&(p=e[++c]);let x=Math.abs(m-p.left),w=Math.abs(m-p.right),E=Math.min(x,w);this.image.data[l+m]=Math.max(0,Math.min(255,(p.isDash?E:-E)+n+128))}}addDash(e,n){let i=this.getKey(e,n);if(this.positions[i])return this.positions[i];let s=n==="round",l=s?7:0,c=2*l+1;if(this.nextRow+c>this.height)return Qn("LineAtlas out of space"),null;e.length===0&&e.push(1);let p=0;for(let w=0;w<e.length;w++)e[w]<0&&(Qn("Negative value is found in line dasharray, replacing values with 0"),e[w]=0),p+=e[w];if(p!==0){let w=this.width/p,E=this.getDashRanges(e,this.width,w);s?this.addRoundDash(E,w,l):this.addRegularDash(E,n==="square"?.5*w:0)}let m=this.nextRow+l;this.nextRow+=c;let x={tl:[m,l],br:[p,0]};return this.positions[i]=x,x}}q(gw,"LineAtlas");let p2=Nm.types,m2=Math.cos(Math.PI/180*37.5),g2=Math.cos(Math.PI/180*5);class Gm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new hy,this.layoutVertexArray2=new Na,this.patternVertexArray=new za,this.indexArray=new pr,this.programConfigurations=new Ua(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new $n,this.maxLineLength=0,this.zOffsetVertexArray=new ac,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Ye/64}updateFootprints(e,n){}populate(e,n,i,s){this.hasPattern=e0("line",this.layers,n);let l=this.layers[0].layout.get("line-sort-key"),c=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!c.isConstant()||!!c.constantOr(0);let p=[];for(let{feature:E,id:D,index:S,sourceLayerIndex:A}of e){let R=this.layers[0]._featureFilter.needGeometry,O=ks(E,R);if(!this.layers[0]._featureFilter.filter(new vt(this.zoom),O,i))continue;let z=l?l.evaluate(O,{},i):void 0,W={id:D,properties:E.properties,type:E.type,sourceLayerIndex:A,index:S,geometry:R?O.geometry:uo(E,i,s),patterns:{},sortKey:z};p.push(W)}l&&p.sort((E,D)=>E.sortKey-D.sortKey);let{lineAtlas:m,featureIndex:x}=n,w=this.addConstantDashes(m);for(let E of p){let{geometry:D,index:S,sourceLayerIndex:A}=E;if(w&&this.addFeatureDashes(E,m),this.hasPattern){let R=t0("line",this.layers,E,this.zoom,n);this.patternFeatures.push(R)}else this.addFeature(E,D,S,i,m.positions,n.availableImages,n.brightness);x.insert(e[S].feature,D,S,A,this.index)}}addConstantDashes(e){let n=!1;for(let i of this.layers){let s=i.paint.get("line-dasharray").value,l=i.layout.get("line-cap").value;if(s.kind!=="constant"||l.kind!=="constant")n=!0;else{let c=l.value,p=s.value;if(!p)continue;e.addDash(p,c)}}return n}addFeatureDashes(e,n){let i=this.zoom;for(let s of this.layers){let l=s.paint.get("line-dasharray").value,c=s.layout.get("line-cap").value;if(l.kind==="constant"&&c.kind==="constant")continue;let p,m;if(l.kind==="constant"){if(p=l.value,!p)continue}else p=l.evaluate({zoom:i},e);m=c.kind==="constant"?c.value:c.evaluate({zoom:i},e),n.addDash(p,m),e.patterns[s.id]=n.getKey(p,m)}}update(e,n,i,s,l){let c=Object.keys(e).length!==0;c&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,c?this.stateDependentLayers:this.layers,i,s,l)}addFeatures(e,n,i,s,l,c){for(let p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,i,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,i2)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,s2)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,pw.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,n2),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,i,s,l,c,p){let m=this.layers[0].layout,x=m.get("line-join").evaluate(e,{}),w=m.get("line-cap").evaluate(e,{}),E=m.get("line-miter-limit"),D=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let S of n)this.addLine(S,e,s,x,w,E,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,l,c,s,p)}addLine(e,n,i,s,l,c,p){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;let m={zoom:this.zoom,lineProgress:void 0},x=this.layers[0].layout,w=s==="none";if(this.patternJoinNone=this.hasPattern&&w,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<e.length-1;ne++)this.totalDistance+=e[ne].dist(e[ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let E=p2[n.type]==="Polygon",D=e.length;for(;D>=2&&e[D-1].equals(e[D-2]);)D--;let S=0;for(;S<D-1&&e[S].equals(e[S+1]);)S++;if(D<(E?3:2))return;s==="bevel"&&(c=1.05);let A=this.overscaling<=16?15*Ye/(512*this.overscaling):0,R=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),O,z,W,X,Y,re;this.e1=this.e2=-1,E&&(O=e[D-2],Y=e[S].sub(O)._unit()._perp());for(let ne=S;ne<D;ne++){if(W=ne===D-1?E?e[S+1]:void 0:e[ne+1],W&&e[ne].equals(W))continue;if(Y&&(X=Y),O&&(z=O),O=e[ne],this.hasZOffset){let Se=x.get("line-z-offset").value;if(Se.kind==="constant")re=Se.value;else{if(this.lineClips){let Ve=this.totalDistance/(this.lineClips.end-this.lineClips.start);m.lineProgress=(Ve*this.lineClips.start+this.distance+(z?z.dist(O):0))/Ve}else Qn(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),m.lineProgress=0;re=Se.evaluate(m,n)}re=re||0}Y=W?W.sub(O)._unit()._perp():X,X=X||Y;let ue=z&&W,de=ue?s:E||w?"butt":l,ve=X.x*Y.x+X.y*Y.y;if(w){let Se=function(Ve){if(Ve.patternJoinNone){let He=Ve.segmentPoints.length/2,je=Ve.lineSoFar-Ve.segmentStart;for(let rt=0;rt<He;++rt){let Ge=Ve.segmentPoints[2*rt+1],We=Math.round(Ve.segmentPoints[2*rt])+.5+.25*Ge;Ve.patternVertexArray.emplaceBack(We,je,Ve.segmentStart),Ve.patternVertexArray.emplaceBack(We,je,Ve.segmentStart)}Ve.segmentPoints.length=0}Ve.e1=Ve.e2=-1};if(ue&&ve<g2){this.updateDistance(z,O),this.addCurrentVertex(O,X,1,1,R,re),Se(this),this.addCurrentVertex(O,Y,-1,-1,R,re);continue}if(z){if(!W){this.updateDistance(z,O),this.addCurrentVertex(O,X,1,1,R,re),Se(this);continue}de="miter"}}let Ce=X.add(Y);Ce.x===0&&Ce.y===0||Ce._unit();let Te=Ce.x*Y.x+Ce.y*Y.y,Le=Te!==0?1/Te:1/0,Ue=2*Math.sqrt(2-2*Te),Pe=Te<m2&&z&&W,Be=X.x*Y.y-X.y*Y.x>0;if(Pe&&ne>S){let Se=O.dist(z);if(Se>2*A){let Ve=O.sub(O.sub(z)._mult(A/Se)._round());this.updateDistance(z,Ve),this.addCurrentVertex(Ve,X,0,0,R,re),z=Ve}}if(ue&&de==="round"&&(Le<p?de="miter":Le<=2&&(de="fakeround")),de==="miter"&&Le>c&&(de="bevel"),de==="bevel"&&(Le>2&&(de="flipbevel"),Le<c&&(de="miter")),z&&this.updateDistance(z,O),de==="miter")Ce._mult(Le),this.addCurrentVertex(O,Ce,0,0,R,re);else if(de==="flipbevel"){if(Le>100)Ce=Y.mult(-1);else{let Se=Le*X.add(Y).mag()/X.sub(Y).mag();Ce._perp()._mult(Se*(Be?-1:1))}this.addCurrentVertex(O,Ce,0,0,R,re),this.addCurrentVertex(O,Ce.mult(-1),0,0,R,re)}else if(de==="bevel"||de==="fakeround"){let Se=-Math.sqrt(Le*Le-1),Ve=Be?Se:0,He=Be?0:Se;if(z&&this.addCurrentVertex(O,X,Ve,He,R,re),de==="fakeround"){let je=Math.round(180*Ue/Math.PI/20);for(let rt=1;rt<je;rt++){let Ge=rt/je;if(Ge!==.5){let dt=Ge-.5;Ge+=Ge*dt*(Ge-1)*((1.0904+ve*(ve*(3.55645-1.43519*ve)-3.2452))*dt*dt+(.848013+ve*(.215638*ve-1.06021)))}let We=Y.sub(X)._mult(Ge)._add(X)._unit()._mult(Be?-1:1);this.addHalfVertex(O,We.x,We.y,!1,Be,0,R,re)}}W&&this.addCurrentVertex(O,Y,-Ve,-He,R,re)}else de==="butt"?this.addCurrentVertex(O,Ce,0,0,R,re):de==="square"?(z||this.addCurrentVertex(O,Ce,-1,-1,R,re),this.addCurrentVertex(O,Ce,0,0,R,re),z&&this.addCurrentVertex(O,Ce,1,1,R,re)):de==="round"&&(z&&(this.addCurrentVertex(O,X,0,0,R,re),this.addCurrentVertex(O,X,1,1,R,re,!0)),W&&(this.addCurrentVertex(O,Y,-1,-1,R,re,!0),this.addCurrentVertex(O,Y,0,0,R,re)));if(Pe&&ne<D-1){let Se=O.dist(W);if(Se>2*A){let Ve=O.add(W.sub(O)._mult(A/Se)._round());this.updateDistance(O,Ve),this.addCurrentVertex(Ve,Y,0,0,R,re),O=Ve}}}}addVerticesTo(e,n,i,s,l,c,p,m,x,w){let E=(n.w-e.w)/this.tessellationStep|0;if(E>1){this.lineSoFar=e.w;let D=(n.x-e.x)/E,S=(n.y-e.y)/E,A=(n.z-e.z)/E,R=(n.w-e.w)/E;for(let O=1;O<E;++O)e.x+=D,e.y+=S,e.z+=A,this.lineSoFar+=R,this.addHalfVertex(e,i,s,w,!1,p,x,e.z),this.addHalfVertex(e,l,c,w,!0,-m,x,e.z)}this.lineSoFar=n.w,this.addHalfVertex(n,i,s,w,!1,p,x,n.z),this.addHalfVertex(n,l,c,w,!0,-m,x,n.z)}addCurrentVertex(e,n,i,s,l,c,p=!1){let m=n.x+n.y*i,x=n.y-n.x*i,w=n.y*s-n.x,E=-n.y-n.x*s;if(c!=null){let S=Ye+10,A=c,R=new Fb(e.x,e.y,A,this.lineSoFar),O=_w(e,-10,S),z=this.lineSoFar;if(this.currentVertex)if(O){let W=this.currentVertexIsOutside,X=this.currentVertex,Y=new Fb(e.x,e.y,A,this.lineSoFar);zb(X,Y,-10,S),_w(Y,-10,S)||(W&&(this.e1=this.e2=-1,this.lineSoFar=X.w,this.addHalfVertex(X,m,x,p,!1,i,l,X.z),this.addHalfVertex(X,w,E,p,!0,-s,l,X.z)),this.addVerticesTo(X,Y,m,x,w,E,i,s,l,p))}else{let W=this.currentVertex;this.currentVertexIsOutside&&(zb(W,R,-10,S),this.e1=this.e2=-1,this.lineSoFar=W.w,this.addHalfVertex(W,m,x,p,!1,i,l,W.z),this.addHalfVertex(W,w,E,p,!0,-s,l,W.z)),this.addVerticesTo(W,R,m,x,w,E,i,s,l,p)}else O||(this.addHalfVertex(e,m,x,p,!1,i,l,c),this.addHalfVertex(e,w,E,p,!0,-s,l,c));this.currentVertex=R,this.currentVertexIsOutside=O,this.lineSoFar=z}else this.addHalfVertex(e,m,x,p,!1,i,l,c),this.addHalfVertex(e,w,E,p,!0,-s,l,c)}addHalfVertex({x:e,y:n},i,s,l,c,p,m,x){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),c||this.segmentPoints.push(this.lineSoFar-this.segmentStart,p)),this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(n<<1)+(c?1:0),Math.round(63*i)+128,Math.round(63*s)+128,1+(p===0?0:p<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let w=m.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),m.primitiveLength++),c?this.e2=w:this.e1=w,x!=null&&this.zOffsetVertexArray.emplaceBack(x)}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}function _w(t,e,n){return t.x<e||t.x>n||t.y<e||t.y>n}q(Gm,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let _2=new ln({"line-cap":new it(be.layout_line["line-cap"]),"line-join":new it(be.layout_line["line-join"]),"line-miter-limit":new Oe(be.layout_line["line-miter-limit"]),"line-round-limit":new Oe(be.layout_line["line-round-limit"]),"line-sort-key":new it(be.layout_line["line-sort-key"]),"line-z-offset":new it(be.layout_line["line-z-offset"]),visibility:new Oe(be.layout_line.visibility)});var $m={paint:new ln({"line-opacity":new it(be.paint_line["line-opacity"]),"line-color":new it(be.paint_line["line-color"]),"line-translate":new Oe(be.paint_line["line-translate"]),"line-translate-anchor":new Oe(be.paint_line["line-translate-anchor"]),"line-width":new it(be.paint_line["line-width"]),"line-gap-width":new it(be.paint_line["line-gap-width"]),"line-offset":new it(be.paint_line["line-offset"]),"line-blur":new it(be.paint_line["line-blur"]),"line-dasharray":new it(be.paint_line["line-dasharray"]),"line-pattern":new it(be.paint_line["line-pattern"]),"line-gradient":new dr(be.paint_line["line-gradient"]),"line-trim-offset":new Oe(be.paint_line["line-trim-offset"]),"line-trim-fade-range":new Oe(be.paint_line["line-trim-fade-range"]),"line-trim-color":new Oe(be.paint_line["line-trim-color"]),"line-emissive-strength":new Oe(be.paint_line["line-emissive-strength"]),"line-border-width":new it(be.paint_line["line-border-width"]),"line-border-color":new it(be.paint_line["line-border-color"]),"line-occlusion-opacity":new Oe(be.paint_line["line-occlusion-opacity"])}),layout:_2};function yw(t,e,n){return e*(Ye/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function xw(t,e){return 1/yw(t,1,e.tileZoom)}function vw(t,e,n,i){return t.translatePosMatrix(i||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let bw=t=>{let e=[];ww(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=t.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let i=t.layout.get("line-join").constantOr("miter")==="none",s=!!t.paint.get("line-pattern").constantOr(1);return i&&s&&e.push("LINE_JOIN_NONE"),e};function ww(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class Tw{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let i=e[n];this._stringToNumber[i]=n,this._numberToString[n]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var y2={read:function(t,e,n,i,s){var l,c,p=8*s-i-1,m=(1<<p)-1,x=m>>1,w=-7,E=n?s-1:0,D=n?-1:1,S=t[e+E];for(E+=D,l=S&(1<<-w)-1,S>>=-w,w+=p;w>0;l=256*l+t[e+E],E+=D,w-=8);for(c=l&(1<<-w)-1,l>>=-w,w+=i;w>0;c=256*c+t[e+E],E+=D,w-=8);if(l===0)l=1-x;else{if(l===m)return c?NaN:1/0*(S?-1:1);c+=Math.pow(2,i),l-=x}return(S?-1:1)*c*Math.pow(2,l-i)},write:function(t,e,n,i,s,l){var c,p,m,x=8*l-s-1,w=(1<<x)-1,E=w>>1,D=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,S=i?0:l-1,A=i?1:-1,R=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(p=isNaN(e)?1:0,c=w):(c=Math.floor(Math.log(e)/Math.LN2),e*(m=Math.pow(2,-c))<1&&(c--,m*=2),(e+=c+E>=1?D/m:D*Math.pow(2,1-E))*m>=2&&(c++,m/=2),c+E>=w?(p=0,c=w):c+E>=1?(p=(e*m-1)*Math.pow(2,s),c+=E):(p=e*Math.pow(2,E-1)*Math.pow(2,s),c=0));s>=8;t[n+S]=255&p,S+=A,p/=256,s-=8);for(c=c<<s|p,x+=s;x>0;t[n+S]=255&c,S+=A,c/=256,x-=8);t[n+S-A]|=128*R}},Ew=jn,Hm=y2;function jn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}jn.Varint=0,jn.Fixed64=1,jn.Bytes=2,jn.Fixed32=5;var l0=4294967296,Iw=1/l0,Dw=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function zs(t){return t.type===jn.Bytes?t.readVarint()+t.pos:t.pos+1}function eh(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Mw(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var s=n.pos-1;s>=t;s--)n.buf[s+i]=n.buf[s]}function x2(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function v2(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function b2(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function w2(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function T2(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function E2(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function I2(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function D2(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function M2(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function qm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function th(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function Cw(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}jn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),s=i>>3,l=this.pos;this.type=7&i,t(s,e,this),this.pos===l&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=qm(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Cw(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=qm(this.buf,this.pos)+qm(this.buf,this.pos+4)*l0;return this.pos+=8,t},readSFixed64:function(){var t=qm(this.buf,this.pos)+Cw(this.buf,this.pos+4)*l0;return this.pos+=8,t},readFloat:function(){var t=Hm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Hm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(s,l,c){var p,m,x=c.buf;if(p=(112&(m=x[c.pos++]))>>4,m<128||(p|=(127&(m=x[c.pos++]))<<3,m<128)||(p|=(127&(m=x[c.pos++]))<<10,m<128)||(p|=(127&(m=x[c.pos++]))<<17,m<128)||(p|=(127&(m=x[c.pos++]))<<24,m<128)||(p|=(1&(m=x[c.pos++]))<<31,m<128))return eh(s,p,l);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Dw?function(n,i,s){return Dw.decode(n.subarray(i,s))}(this.buf,e,t):function(n,i,s){for(var l="",c=i;c<s;){var p,m,x,w=n[c],E=null,D=w>239?4:w>223?3:w>191?2:1;if(c+D>s)break;D===1?w<128&&(E=w):D===2?(192&(p=n[c+1]))==128&&(E=(31&w)<<6|63&p)<=127&&(E=null):D===3?(m=n[c+2],(192&(p=n[c+1]))==128&&(192&m)==128&&((E=(15&w)<<12|(63&p)<<6|63&m)<=2047||E>=55296&&E<=57343)&&(E=null)):D===4&&(m=n[c+2],x=n[c+3],(192&(p=n[c+1]))==128&&(192&m)==128&&(192&x)==128&&((E=(15&w)<<18|(63&p)<<12|(63&m)<<6|63&x)<=65535||E>=1114112)&&(E=null)),E===null?(E=65533,D=1):E>65535&&(E-=65536,l+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),l+=String.fromCharCode(E),c+=D}return l}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==jn.Bytes)return t.push(this.readVarint(e));var n=zs(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==jn.Bytes)return t.push(this.readSVarint());var e=zs(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==jn.Bytes)return t.push(this.readBoolean());var e=zs(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==jn.Bytes)return t.push(this.readFloat());var e=zs(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==jn.Bytes)return t.push(this.readDouble());var e=zs(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==jn.Bytes)return t.push(this.readFixed32());var e=zs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==jn.Bytes)return t.push(this.readSFixed32());var e=zs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==jn.Bytes)return t.push(this.readFixed64());var e=zs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==jn.Bytes)return t.push(this.readSFixed64());var e=zs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===jn.Varint)for(;this.buf[this.pos++]>127;);else if(e===jn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===jn.Fixed32)this.pos+=4;else{if(e!==jn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),th(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),th(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),th(this.buf,-1&t,this.pos),th(this.buf,Math.floor(t*Iw),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),th(this.buf,-1&t,this.pos),th(this.buf,Math.floor(t*Iw),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var i,s;if(e>=0?(i=e%4294967296|0,s=e/4294967296|0):(s=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,s=s+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(l,c,p){p.buf[p.pos++]=127&l|128,l>>>=7,p.buf[p.pos++]=127&l|128,l>>>=7,p.buf[p.pos++]=127&l|128,l>>>=7,p.buf[p.pos++]=127&l|128,p.buf[p.pos]=127&(l>>>=7)}(i,0,n),function(l,c){var p=(7&l)<<4;c.buf[c.pos++]|=p|((l>>>=3)?128:0),l&&(c.buf[c.pos++]=127&l|((l>>>=7)?128:0),l&&(c.buf[c.pos++]=127&l|((l>>>=7)?128:0),l&&(c.buf[c.pos++]=127&l|((l>>>=7)?128:0),l&&(c.buf[c.pos++]=127&l|((l>>>=7)?128:0),l&&(c.buf[c.pos++]=127&l)))))}(s,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(i,s,l){for(var c,p,m=0;m<s.length;m++){if((c=s.charCodeAt(m))>55295&&c<57344){if(!p){c>56319||m+1===s.length?(i[l++]=239,i[l++]=191,i[l++]=189):p=c;continue}if(c<56320){i[l++]=239,i[l++]=191,i[l++]=189,p=c;continue}c=p-55296<<10|c-56320|65536,p=null}else p&&(i[l++]=239,i[l++]=191,i[l++]=189,p=null);c<128?i[l++]=c:(c<2048?i[l++]=c>>6|192:(c<65536?i[l++]=c>>12|224:(i[l++]=c>>18|240,i[l++]=c>>12&63|128),i[l++]=c>>6&63|128),i[l++]=63&c|128)}return l}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&Mw(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Hm.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Hm.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&Mw(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,jn.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,x2,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,v2,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,T2,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,b2,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,w2,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,E2,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,I2,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,D2,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,M2,e)},writeBytesField:function(t,e){this.writeTag(t,jn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,jn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,jn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,jn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,jn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,jn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,jn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,jn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,jn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,jn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var nh=Rt(Ew);let C2=["id","tile","layer","source","sourceLayer","state"];class Sw{constructor(e,n,i,s,l){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=i,this._y=s,this.properties=e.properties,this.id=l}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let n of C2)this[n]!==void 0&&(e[n]=this[n]);return e}}class S2{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,i){let s=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][s]=this.stateChanges[e][s]||{},Pr(this.stateChanges[e][s],i),this.deletedStates[e]===null){this.deletedStates[e]={};for(let l in this.state[e])l!==s&&(this.deletedStates[e][l]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][s]===null){this.deletedStates[e][s]={};for(let l in this.state[e][s])i[l]||(this.deletedStates[e][s][l]=null)}else for(let l in i)this.deletedStates[e]&&this.deletedStates[e][s]&&this.deletedStates[e][s][l]===null&&delete this.deletedStates[e][s][l]}removeFeatureState(e,n,i){if(this.deletedStates[e]===null)return;let s=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&n!==void 0)this.deletedStates[e][s]!==null&&(this.deletedStates[e][s]=this.deletedStates[e][s]||{},this.deletedStates[e][s][i]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][s])for(i in this.deletedStates[e][s]={},this.stateChanges[e][s])this.deletedStates[e][s][i]=null;else this.deletedStates[e][s]=null;else this.deletedStates[e]=null}getState(e,n){let i=String(n),s=Pr({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let l=this.deletedStates[e][n];if(l===null)return{};for(let c in l)delete s[c]}return s}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let i={};for(let s in this.stateChanges){this.state[s]=this.state[s]||{};let l={};for(let c in this.stateChanges[s])this.state[s][c]||(this.state[s][c]={}),Pr(this.state[s][c],this.stateChanges[s][c]),l[c]=this.state[s][c];i[s]=l}for(let s in this.deletedStates){this.state[s]=this.state[s]||{};let l={};if(this.deletedStates[s]===null)for(let c in this.state[s])l[c]={},this.state[s][c]={};else for(let c in this.deletedStates[s]){if(this.deletedStates[s][c]===null)this.state[s][c]={};else if(this.state[s][c])for(let p of Object.keys(this.deletedStates[s][c]))delete this.state[s][c][p];l[c]=this.state[s][c]}i[s]=i[s]||{},Pr(i[s],l)}if(this.stateChanges={},this.deletedStates={},Object.keys(i).length!==0)for(let s in e)e[s].setFeatureState(i,n)}}class Aw{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ie(Ye,16,0),this.featureIndexArray=new U1,this.promoteId=n,this.is3DTile=!1}insert(e,n,i,s,l,c=0,p=0){let m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,s,l,c);let x=this.grid;for(let w=0;w<n.length;w++){let E=n[w],D=[1/0,1/0,-1/0,-1/0];for(let S=0;S<E.length;S++){let A=E[S];D[0]=Math.min(D[0],A.x),D[1]=Math.min(D[1],A.y),D[2]=Math.max(D[2],A.x),D[3]=Math.max(D[3],A.y)}p!==0&&(D[0]-=p,D[1]-=p,D[2]+=p,D[3]+=p),D[0]<Ye&&D[1]<Ye&&D[2]>=0&&D[3]>=0&&x.insert(m,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new r0(new nh(this.rawTileData)).layers,this.sourceLayerCoder=new Tw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,i,s){this.loadVTLayers();let l=e.params||{},c=Dr(l.filter),p=e.tileResult,m=e.transform,x=p.bufferedTilespaceBounds,w=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(A,R,O,z)=>ob(p.bufferedTilespaceGeometry,A,R,O,z));w.sort(A2);let E=null;m.elevation&&w.length>0&&(E=Ju.create(m.elevation,this.tileID));let D={},S;for(let A=0;A<w.length;A++){let R=w[A];if(R===S)continue;S=R;let O=this.featureIndexArray.get(R),z=null;if(this.is3DTile){let W=this.bucketLayerIDs[0][0],X=n[W];if(X.type!=="model")continue;let{queryFeature:Y,intersectionZ:re}=X.queryIntersectsMatchingFeature(p,O.featureIndex,c,m);Y&&this.appendToResult(D,W,O.featureIndex,Y,re)}else this.loadMatchingFeature(D,O,c,l.layers,l.availableImages,n,i,s,(W,X,Y,re=0)=>(z||(z=uo(W,this.tileID.canonical,e.tileTransform)),X.queryIntersectsFeature(p,W,Y,z,this.z,e.transform,e.pixelPosMatrix,E,re)))}return D}loadMatchingFeature(e,n,i,s,l,c,p,m,x){let{featureIndex:w,bucketIndex:E,sourceLayerIndex:D,layoutVertexArrayOffset:S}=n,A=this.bucketLayerIDs[E];if(s&&!function(W,X){for(let Y=0;Y<W.length;Y++)if(X.indexOf(W[Y])>=0)return!0;return!1}(s,A))return;let R=this.sourceLayerCoder.decode(D),O=this.vtLayers[R].feature(w);if(i.needGeometry){let W=ks(O,!0);if(!i.filter(new vt(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!i.filter(new vt(this.tileID.overscaledZ),O))return;let z=this.getId(O,R);for(let W=0;W<A.length;W++){let X=A[W];if(s&&s.indexOf(X)<0)continue;let Y=c[X];if(!Y)continue;let re={};z!==void 0&&m&&(re=m.getState(Y.sourceLayer||"_geojsonTileLayer",z));let ne=!x||x(O,Y,re,S);if(!ne)continue;let ue=new Sw(O,this.z,this.x,this.y,z),de=Pr({},p[X]);de.paint=Pw(de.paint,Y.paint,O,re,l),de.layout=Pw(de.layout,Y.layout,O,re,l),ue.layer=de,this.appendToResult(e,X,w,ue,ne)}}appendToResult(e,n,i,s,l){let c=e[n];c===void 0&&(c=e[n]=[]),c.push({featureIndex:i,feature:s,intersectionZ:l})}lookupSymbolFeatures(e,n,i,s,l,c,p,m){let x={};this.loadVTLayers();let w=Dr(l);for(let E of e)this.loadMatchingFeature(x,{bucketIndex:i,sourceLayerIndex:s,featureIndex:E,layoutVertexArrayOffset:0},w,c,p,m,n);return x}loadFeature(e){let{featureIndex:n,sourceLayerIndex:i}=e;this.loadVTLayers();let s=this.sourceLayerCoder.decode(i),l=this.vtFeatures[s];if(l[n])return l[n];let c=this.vtLayers[s].feature(n);return l[n]=c,c}hasLayer(e){for(let n of this.bucketLayerIDs)for(let i of n)if(e===i)return!0;return!1}getId(e,n){let i=e.id;if(this.promoteId){let s=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];s!=null&&(i=e.properties[s]),typeof i=="boolean"&&(i=Number(i))}return i}}function Pw(t,e,n,i,s){return Fo(t,(l,c)=>{let p=e instanceof Mn?e.get(c):null;return p&&p.evaluate?p.evaluate(n,i,s):p})}function A2(t,e){return e-t}q(Aw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var Cr=24;let ho=128;function c0(t,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new vt(t+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:i,interpolationType:s}=n,l=0;for(;l<i.length&&i[l]<=t;)l++;l=Math.max(0,l-1);let c=l;for(;c<i.length&&i[c]<t+1;)c++;c=Math.min(i.length-1,c);let p=i[l],m=i[c];return n.kind==="composite"?{kind:"composite",minZoom:p,maxZoom:m,interpolationType:s}:{kind:"camera",minZoom:p,maxZoom:m,minSize:n.evaluate(new vt(p)),maxSize:n.evaluate(new vt(m)),interpolationType:s}}}function Wm(t,{uSize:e,uSizeT:n},{lowerSize:i,upperSize:s}){return t.kind==="source"?i/ho:t.kind==="composite"?pt(i/ho,s/ho,n):e}function rh(t,e){let n=0,i=0;if(t.kind==="constant")i=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:s,minZoom:l,maxZoom:c}=t,p=s?St(ni.interpolationFactor(s,e,l,c),0,1):0;t.kind==="camera"?i=pt(t.minSize,t.maxSize,p):n=p}return{uSizeT:n,uSize:i}}var P2=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ho,evaluateSizeForFeature:Wm,evaluateSizeForZoom:rh,getSizeData:c0});function R2(t,e,n){return t.sections.forEach(i=>{i.text=function(s,l,c){let p=l.layout.get("text-transform").evaluate(c,{});return p==="uppercase"?s=s.toLocaleUpperCase():p==="lowercase"&&(s=s.toLocaleLowerCase()),Bt.applyArabicShaping&&(s=Bt.applyArabicShaping(s)),s}(i.text,e,n)}),t}let Ef={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function L2(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function O2(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}let u0=3;function k2(t,e,n){e.glyphs=[],t===1&&n.readMessage(F2,e)}function F2(t,e,n){if(t===3){let{id:i,bitmap:s,width:l,height:c,left:p,top:m,advance:x}=n.readMessage(N2,{});e.glyphs.push({id:i,bitmap:new Ha({width:l+2*u0,height:c+2*u0},s),metrics:{width:l,height:c,left:p,top:m,advance:x}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function N2(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}let Rw=u0,Ri={horizontal:1,vertical:2,horizontalOnly:3};class If{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let i=new If;return i.scale=e||1,i.fontStack=n,i}static forImage(e){let n=new If;return n.imageName=e,n}}class ih{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let i=new ih;for(let s=0;s<e.sections.length;s++){let l=e.sections[s];l.image?i.addImageSection(l):i.addTextSection(l,n)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,i){let s="";for(let l=0;l<n.length;l++){let c=n.charCodeAt(l+1)||null,p=n.charCodeAt(l-1)||null;s+=!i&&(c&&_e(c)&&!Ef[n[l+1]]||p&&_e(p)&&!Ef[n[l-1]])||!Ef[n[l]]?n[l]:Ef[n[l]]}return s}(this.text,e)}trim(){let e=0;for(let i=0;i<this.text.length&&Zm[this.text.charCodeAt(i)];i++)e++;let n=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&Zm[this.text.charCodeAt(i)];i--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let i=new ih;return i.text=this.text.substring(e,n),i.sectionIndex=this.sectionIndex.slice(e,n),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(If.forText(e.scale,e.fontStack||n));let i=this.sections.length-1;for(let s=0;s<e.text.length;++s)this.sectionIndex.push(i)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void Qn("Can't add FormattedSection with an empty image.");let i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(If.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Qn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function h0(t,e,n,i,s,l,c,p,m,x,w,E,D,S,A){let R=ih.fromFeature(t,s);E===Ri.vertical&&R.verticalizePunctuation(D);let O=[],z=function(ne,ue,de,ve,Ce,Te){if(!ne)return[];let Le=[],Ue=function(Ve,He,je,rt,Ge,We){let dt=0;for(let ht=0;ht<Ve.length();ht++){let ct=Ve.getSection(ht);dt+=Lw(Ve.getCodePoint(ht),ct,rt,Ge,He,We)}return dt/Math.max(1,Math.ceil(dt/je))}(ne,ue,de,ve,Ce,Te),Pe=ne.text.indexOf("\u200B")>=0,Be=0;for(let Ve=0;Ve<ne.length();Ve++){let He=ne.getSection(Ve),je=ne.getCodePoint(Ve);if(Zm[je]||(Be+=Lw(je,He,ve,Ce,ue,Te)),Ve<ne.length()-1){let rt=!((Se=je)<11904||!(ae["Bopomofo Extended"](Se)||ae.Bopomofo(Se)||ae["CJK Compatibility Forms"](Se)||ae["CJK Compatibility Ideographs"](Se)||ae["CJK Compatibility"](Se)||ae["CJK Radicals Supplement"](Se)||ae["CJK Strokes"](Se)||ae["CJK Symbols and Punctuation"](Se)||ae["CJK Unified Ideographs Extension A"](Se)||ae["CJK Unified Ideographs"](Se)||ae["Enclosed CJK Letters and Months"](Se)||ae["Halfwidth and Fullwidth Forms"](Se)||ae.Hiragana(Se)||ae["Ideographic Description Characters"](Se)||ae["Kangxi Radicals"](Se)||ae["Katakana Phonetic Extensions"](Se)||ae.Katakana(Se)||ae["Vertical Forms"](Se)||ae["Yi Radicals"](Se)||ae["Yi Syllables"](Se)));(z2[je]||rt||He.imageName)&&Le.push(kw(Ve+1,Be,Ue,Le,B2(je,ne.getCodePoint(Ve+1),rt&&Pe),!1))}}var Se;return Fw(kw(ne.length(),Be,Ue,Le,0,!0))}(R,x,l,e,i,S),{processBidirectionalText:W,processStyledBidirectionalText:X}=Bt;if(W&&R.sections.length===1){let ne=W(R.toString(),z);for(let ue of ne){let de=new ih;de.text=ue,de.sections=R.sections;for(let ve=0;ve<ue.length;ve++)de.sectionIndex.push(0);O.push(de)}}else if(X){let ne=X(R.text,R.sectionIndex,z);for(let ue of ne){let de=new ih;de.text=ue[0],de.sectionIndex=ue[1],de.sections=R.sections,O.push(de)}}else O=function(ne,ue){let de=[],ve=ne.text,Ce=0;for(let Te of ue)de.push(ne.substring(Ce,Te)),Ce=Te;return Ce<ve.length&&de.push(ne.substring(Ce,ve.length)),de}(R,z);let Y=[],re={positionedLines:Y,text:R.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ne,ue,de,ve,Ce,Te,Le,Ue,Pe,Be,Se,Ve){let He=0,je=0,rt=0,Ge=Ue==="right"?1:Ue==="left"?0:.5,We=!1;for(let At of Ce){let xt=At.getSections();for(let kt of xt){if(kt.imageName)continue;let Pt=ue[kt.fontStack];if(Pt&&(We=Pt.ascender!==void 0&&Pt.descender!==void 0,!We))break}if(!We)break}let dt=0;for(let At of Ce){At.trim();let xt=At.getMaxScale(),kt=(xt-1)*Cr,Pt={positionedGlyphs:[],lineOffset:0};ne.positionedLines[dt]=Pt;let Vt=Pt.positionedGlyphs,_t=0;if(!At.length()){je+=Te,++dt;continue}let xn=0,_n=0;for(let Yt=0;Yt<At.length();Yt++){let sn=At.getSection(Yt),An=At.getSectionIndex(Yt),Tn=At.getCodePoint(Yt),qn=sn.scale,Hn=null,Fr=null,Kn=null,Un=Cr,ar=0,vr=!(Pe===Ri.horizontal||!Se&&!ke(Tn)||Se&&(Zm[Tn]||(ht=Tn,ae.Arabic(ht)||ae["Arabic Supplement"](ht)||ae["Arabic Extended-A"](ht)||ae["Arabic Presentation Forms-A"](ht)||ae["Arabic Presentation Forms-B"](ht))));if(sn.imageName){let br=ve[sn.imageName];if(!br)continue;Kn=sn.imageName,ne.iconsInText=ne.iconsInText||!0,Fr=br.paddedRect;let Cn=br.displaySize;qn=qn*Cr/Ve,Hn={width:Cn[0],height:Cn[1],left:0,top:-Rw,advance:vr?Cn[1]:Cn[0],localGlyph:!1},ar=We?-Hn.height*qn:xt*Cr-17-Cn[1]*qn,Un=Hn.advance;let Qr=(vr?Cn[0]:Cn[1])*qn-Cr*xt;Qr>0&&Qr>_t&&(_t=Qr)}else{let br=de[sn.fontStack];if(!br)continue;br[Tn]&&(Fr=br[Tn]);let Cn=ue[sn.fontStack];if(!Cn)continue;let Qr=Cn.glyphs[Tn];if(!Qr)continue;if(Hn=Qr.metrics,Un=Tn!==8203?Cr:0,We){let Vs=Cn.ascender!==void 0?Math.abs(Cn.ascender):0,Qi=Cn.descender!==void 0?Math.abs(Cn.descender):0,yo=(Vs+Qi)*qn;xn<yo&&(xn=yo,_n=(Vs-Qi)/2*qn),ar=-Vs*qn}else ar=(xt-qn)*Cr-17}vr?(ne.verticalizable=!0,Vt.push({glyph:Tn,imageName:Kn,x:He,y:je+ar,vertical:vr,scale:qn,localGlyph:Hn.localGlyph,fontStack:sn.fontStack,sectionIndex:An,metrics:Hn,rect:Fr}),He+=Un*qn+Be):(Vt.push({glyph:Tn,imageName:Kn,x:He,y:je+ar,vertical:vr,scale:qn,localGlyph:Hn.localGlyph,fontStack:sn.fontStack,sectionIndex:An,metrics:Hn,rect:Fr}),He+=Hn.advance*qn+Be)}Vt.length!==0&&(rt=Math.max(He-Be,rt),We?Nw(Vt,Ge,_t,_n,Te*xt/2):Nw(Vt,Ge,_t,0,Te/2)),He=0;let on=Te*xt+_t;Pt.lineOffset=Math.max(_t,kt),je+=on,++dt}var ht;let ct=je,{horizontalAlign:qe,verticalAlign:ft}=d0(Le);(function(At,xt,kt,Pt,Vt,_t){let xn=(xt-kt)*Vt,_n=-_t*Pt;for(let on of At)for(let Yt of on.positionedGlyphs)Yt.x+=xn,Yt.y+=_n})(ne.positionedLines,Ge,qe,ft,rt,ct),ne.top+=-ft*ct,ne.bottom=ne.top+ct,ne.left+=-qe*rt,ne.right=ne.left+rt,ne.hasBaseline=We}(re,e,n,i,O,c,p,m,E,x,D,A),!function(ne){for(let ue of ne)if(ue.positionedGlyphs.length!==0)return!1;return!0}(Y)&&re}let Zm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},z2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Lw(t,e,n,i,s,l){if(e.imageName){let c=i[e.imageName];return c?c.displaySize[0]*e.scale*Cr/l+s:0}{let c=n[e.fontStack],p=c&&c.glyphs[t];return p?p.metrics.advance*e.scale+s:0}}function Ow(t,e,n,i){let s=Math.pow(t-e,2);return i?t<e?s/2:2*s:s+Math.abs(n)*n}function B2(t,e,n){let i=0;return t===10&&(i-=1e4),n&&(i+=150),t!==40&&t!==65288||(i+=50),e!==41&&e!==65289||(i+=50),i}function kw(t,e,n,i,s,l){let c=null,p=Ow(e,n,s,l);for(let m of i){let x=Ow(e-m.x,n,s,l)+m.badness;x<=p&&(c=m,p=x)}return{index:t,x:e,priorBreak:c,badness:p}}function Fw(t){return t?Fw(t.priorBreak).concat(t.index):[]}function d0(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Nw(t,e,n,i,s){if(!(e||n||i||s))return;let l=t.length-1,c=t[l],p=(c.x+c.metrics.advance*c.scale)*e;for(let m=0;m<=l;m++)t[m].x-=p,t[m].y+=n+i+s}function V2(t,e,n,i){let{horizontalAlign:s,verticalAlign:l}=d0(i),c=n[0]-t.displaySize[0]*s,p=n[1]-t.displaySize[1]*l;return{imagePrimary:t,imageSecondary:e,top:p,bottom:p+t.displaySize[1],left:c,right:c+t.displaySize[0]}}function zw(t,e,n,i,s,l){let c=t.imagePrimary,p;if(c.content){let O=c.content,z=c.pixelRatio||1;p=[O[0]/z,O[1]/z,c.displaySize[0]-O[2]/z,c.displaySize[1]-O[3]/z]}let m=e.left*l,x=e.right*l,w,E,D,S;n==="width"||n==="both"?(S=s[0]+m-i[3],E=s[0]+x+i[1]):(S=s[0]+(m+x-c.displaySize[0])/2,E=S+c.displaySize[0]);let A=e.top*l,R=e.bottom*l;return n==="height"||n==="both"?(w=s[1]+A-i[0],D=s[1]+R+i[2]):(w=s[1]+(A+R-c.displaySize[1])/2,D=w+c.displaySize[1]),{imagePrimary:c,imageSecondary:void 0,top:w,right:E,bottom:D,left:S,collisionPadding:p}}class Bs extends tt{constructor(e,n,i,s,l){super(e,n),this.angle=s,this.z=i,l!==void 0&&(this.segment=l)}clone(){return new Bs(this.x,this.y,this.z,this.angle,this.segment)}}function Bw(t,e,n,i,s){if(e.segment===void 0)return!0;let l=e,c=e.segment+1,p=0;for(;p>-n/2;){if(c--,c<0)return!1;p-=t[c].dist(l),l=t[c]}p+=t[c].dist(t[c+1]),c++;let m=[],x=0;for(;p<n/2;){let w=t[c],E=t[c+1];if(!E)return!1;let D=t[c-1].angleTo(w)-w.angleTo(E);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),m.push({distance:p,angleDelta:D}),x+=D;p-m[0].distance>i;)x-=m.shift().angleDelta;if(x>s)return!1;c++,p+=w.dist(E)}return!0}function Vw(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function jw(t,e,n){return t?.6*e*n:0}function Uw(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function j2(t,e,n,i,s,l){let c=jw(n,s,l),p=Uw(n,i)*l,m=0,x=Vw(t)/2;for(let w=0;w<t.length-1;w++){let E=t[w],D=t[w+1],S=E.dist(D);if(m+S>x){let A=(x-m)/S,R=pt(E.x,D.x,A),O=pt(E.y,D.y,A),z=new Bs(R,O,0,D.angleTo(E),w);return!c||Bw(t,z,p,c,e)?z:void 0}m+=S}}function U2(t,e,n,i,s,l,c,p,m){let x=jw(i,l,c),w=Uw(i,s),E=w*c,D=t[0].x===0||t[0].x===m||t[0].y===0||t[0].y===m;return e-E<e/4&&(e=E+e/4),Gw(t,D?e/2*p%e:(w/2+2*l)*c*p%e,e,x,n,E,D,!1,m)}function Gw(t,e,n,i,s,l,c,p,m){let x=l/2,w=Vw(t),E=0,D=e-n,S=[];for(let A=0;A<t.length-1;A++){let R=t[A],O=t[A+1],z=R.dist(O),W=O.angleTo(R);for(;D+n<E+z;){D+=n;let X=(D-E)/z,Y=pt(R.x,O.x,X),re=pt(R.y,O.y,X);if(Y>=0&&Y<m&&re>=0&&re<m&&D-x>=0&&D+x<=w){let ne=new Bs(Y,re,0,W,A);i&&!Bw(t,ne,l,i,s)||S.push(ne)}}E+=z}return p||S.length||c||(S=Gw(t,E/2,n,i,s,l,c,!0,m)),S}function $w(t,e,n,i,s){let l=[];for(let c=0;c<t.length;c++){let p=t[c],m;for(let x=0;x<p.length-1;x++){let w=p[x],E=p[x+1];w.x<e&&E.x<e||(w.x<e?w=new tt(e,w.y+(e-w.x)/(E.x-w.x)*(E.y-w.y))._round():E.x<e&&(E=new tt(e,w.y+(e-w.x)/(E.x-w.x)*(E.y-w.y))._round()),w.y<n&&E.y<n||(w.y<n?w=new tt(w.x+(n-w.y)/(E.y-w.y)*(E.x-w.x),n)._round():E.y<n&&(E=new tt(w.x+(n-w.y)/(E.y-w.y)*(E.x-w.x),n)._round()),w.x>=i&&E.x>=i||(w.x>=i?w=new tt(i,w.y+(i-w.x)/(E.x-w.x)*(E.y-w.y))._round():E.x>=i&&(E=new tt(i,w.y+(i-w.x)/(E.x-w.x)*(E.y-w.y))._round()),w.y>=s&&E.y>=s||(w.y>=s?w=new tt(w.x+(s-w.y)/(E.y-w.y)*(E.x-w.x),s)._round():E.y>=s&&(E=new tt(w.x+(s-w.y)/(E.y-w.y)*(E.x-w.x),s)._round()),m&&w.equals(m[m.length-1])||(m=[w],l.push(m)),m.push(E)))))}}return l}function Hw(t){let e=0,n=0;for(let c of t)e+=c.w*c.h,n=Math.max(n,c.w);t.sort((c,p)=>p.h-c.h);let i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],s=0,l=0;for(let c of t)for(let p=i.length-1;p>=0;p--){let m=i[p];if(!(c.w>m.w||c.h>m.h)){if(c.x=m.x,c.y=m.y,l=Math.max(l,c.y+c.h),s=Math.max(s,c.x+c.w),c.w===m.w&&c.h===m.h){let x=i.pop();p<i.length&&(i[p]=x)}else c.h===m.h?(m.x+=c.w,m.w-=c.w):c.w===m.w?(m.y+=c.h,m.h-=c.h):(i.push({x:m.x+c.w,y:m.y,w:m.w-c.w,h:c.h}),m.y+=c.h,m.h-=c.h);break}}return{w:s,h:l,fill:e/(s*l)||0}}q(Bs,"Anchor");let di=1;class f0{constructor(e,{pixelRatio:n,version:i,stretchX:s,stretchY:l,content:c}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=s,this.stretchY=l,this.content=c,this.version=i}get tl(){return[this.paddedRect.x+di,this.paddedRect.y+di]}get br(){return[this.paddedRect.x+this.paddedRect.w-di,this.paddedRect.y+this.paddedRect.h-di]}get displaySize(){return[(this.paddedRect.w-2*di)/this.pixelRatio,(this.paddedRect.h-2*di)/this.pixelRatio]}}class qw{constructor(e,n,i){let s={},l={};this.haveRenderCallbacks=[];let c=[];this.addImages(e,s,c),this.addImages(n,l,c);let{w:p,h:m}=Hw(c),x=new Pi({width:p||1,height:m||1});for(let w in e){let E=e[w],D=s[w].paddedRect;Pi.copy(E.data,x,{x:0,y:0},{x:D.x+di,y:D.y+di},E.data,i,E.sdf)}for(let w in n){let E=n[w],D=l[w].paddedRect,S=D.x+di,A=D.y+di,R=E.data.width,O=E.data.height;Pi.copy(E.data,x,{x:0,y:0},{x:S,y:A},E.data,i),Pi.copy(E.data,x,{x:0,y:O-1},{x:S,y:A-1},{width:R,height:1},i),Pi.copy(E.data,x,{x:0,y:0},{x:S,y:A+O},{width:R,height:1},i),Pi.copy(E.data,x,{x:R-1,y:0},{x:S-1,y:A},{width:1,height:O},i),Pi.copy(E.data,x,{x:0,y:0},{x:S+R,y:A},{width:1,height:O},i)}this.image=x,this.iconPositions=s,this.patternPositions=l}addImages(e,n,i){for(let s in e){let l=e[s],c={x:0,y:0,w:l.data.width+2*di,h:l.data.height+2*di};i.push(c),n[s]=new f0(c,l),l.hasRenderCallback&&this.haveRenderCallbacks.push(s)}}patchUpdatedImages(e,n,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s,i)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(let s in e.getUpdatedImages(i))this.patchUpdatedImage(this.iconPositions[s],e.getImage(s,i),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s,i),n)}patchUpdatedImage(e,n,i){if(!e||!n||e.version===n.version)return;e.version=n.version;let[s,l]=e.tl,c=!!Object.keys(this.patternPositions).length;i.update(n.data,{useMipmap:c},{x:s,y:l})}}q(f0,"ImagePosition"),q(qw,"ImageAtlas");let Df=1e20;function Ww(t,e,n,i,s,l,c,p,m){for(let x=e;x<e+i;x++)Zw(t,n*l+x,l,s,c,p,m);for(let x=n;x<n+s;x++)Zw(t,x*l+e,1,i,c,p,m)}function Zw(t,e,n,i,s,l,c){l[0]=0,c[0]=-Df,c[1]=Df,s[0]=t[e];for(let p=1,m=0,x=0;p<i;p++){s[p]=t[e+p*n];let w=p*p;do{let E=l[m];x=(s[p]-s[E]+w-E*E)/(p-E)/2}while(x<=c[m]&&--m>-1);m++,l[m]=p,c[m]=x,c[m+1]=Df}for(let p=0,m=0;p<i;p++){for(;c[m+1]<p;)m++;let x=l[m],w=p-x;t[e+p*n]=s[x]+w*w}}let fo=2,p0={none:0,ideographs:1,all:2};class oh{constructor(e,n,i){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,i){let s=[],l=this.urls[n]||Z.GLYPHS_URL;for(let c in e)for(let p of e[c])s.push({stack:c,id:p});$r(s,({stack:c,id:p},m)=>{let x=this.entries[c];x||(x=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=x.glyphs[p];if(w!==void 0)return void m(null,{stack:c,id:p,glyph:w});if(w=this._tinySDF(x,c,p),w)return x.glyphs[p]=w,void m(null,{stack:c,id:p,glyph:w});let E=Math.floor(p/256);if(256*E>65535)return void m(new Error("glyphs > 65535 not supported"));if(x.ranges[E])return void m(null,{stack:c,id:p,glyph:w});let D=x.requests[E];D||(D=x.requests[E]=[],oh.loadGlyphRange(c,E,l,this.requestManager,(S,A)=>{if(A){x.ascender=A.ascender,x.descender=A.descender;for(let R in A.glyphs)this._doesCharSupportLocalGlyph(+R)||(x.glyphs[+R]=A.glyphs[+R]);x.ranges[E]=!0}for(let R of D)R(S,A);delete x.requests[E]})),D.push((S,A)=>{S?m(S):A&&m(null,{stack:c,id:p,glyph:A.glyphs[p]||null})})},(c,p)=>{if(c)i(c);else if(p){let m={};for(let{stack:x,id:w,glyph:E}of p)m[x]===void 0&&(m[x]={}),m[x].glyphs===void 0&&(m[x].glyphs={}),m[x].glyphs[w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},m[x].ascender=this.entries[x].ascender,m[x].descender=this.entries[x].descender;i(null,m)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==p0.none&&(this.localGlyphMode===p0.all?!!this.localFontFamily:!!this.localFontFamily&&(ae["CJK Unified Ideographs"](e)||ae["Hangul Syllables"](e)||ae.Hiragana(e)||ae.Katakana(e)||ae["CJK Symbols and Punctuation"](e)||ae["CJK Unified Ideographs Extension A"](e)||ae["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,i){let s=this.localFontFamily;if(!s||!this._doesCharSupportLocalGlyph(i))return;let l=e.tinySDF;if(!l){let R="400";/bold/i.test(n)?R="900":/medium/i.test(n)?R="500":/light/i.test(n)&&(R="200"),l=e.tinySDF=new oh.TinySDF({fontFamily:s,fontWeight:R,fontSize:24*fo,buffer:3*fo,radius:8*fo}),l.fontWeight=R}if(this.localGlyphs[l.fontWeight][i])return this.localGlyphs[l.fontWeight][i];let c=String.fromCodePoint(i),{data:p,width:m,height:x,glyphWidth:w,glyphHeight:E,glyphLeft:D,glyphTop:S,glyphAdvance:A}=l.draw(c);return this.localGlyphs[l.fontWeight][i]={id:i,bitmap:new Ha({width:m,height:x},p),metrics:{width:w/fo,height:E/fo,left:D/fo,top:S/fo-27,advance:A/fo,localGlyph:!0}}}}oh.loadGlyphRange=function(t,e,n,i,s){let l=256*e,c=l+255,p=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${l}-${c}`),_u.Glyphs);zo(p,(m,x)=>{if(m)s(m);else if(x){let w={},E=function(D){return new nh(D).readFields(k2,{})}(x);for(let D of E.glyphs)w[D.id]=D;s(null,{glyphs:w,ascender:E.ascender,descender:E.descender})}})},oh.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:i=.25,fontFamily:s="sans-serif",fontWeight:l="normal",fontStyle:c="normal"}={}){this.buffer=e,this.cutoff=i,this.radius=n;let p=this.size=t+4*e,m=this._createCanvas(p),x=this.ctx=m.getContext("2d",{willReadFrequently:!0});x.font=`${c} ${l} ${t}px ${s}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(p*p),this.gridInner=new Float64Array(p*p),this.f=new Float64Array(p),this.z=new Float64Array(p+1),this.v=new Uint16Array(p)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:s,actualBoundingBoxRight:l}=this.ctx.measureText(t),c=Math.ceil(n),p=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-s))),m=Math.min(this.size-this.buffer,c+Math.ceil(i)),x=p+2*this.buffer,w=m+2*this.buffer,E=Math.max(x*w,0),D=new Uint8ClampedArray(E),S={data:D,width:x,height:w,glyphWidth:p,glyphHeight:m,glyphTop:c,glyphLeft:0,glyphAdvance:e};if(p===0||m===0)return S;let{ctx:A,buffer:R,gridInner:O,gridOuter:z}=this;A.clearRect(R,R,p,m),A.fillText(t,R,R+c);let W=A.getImageData(R,R,p,m);z.fill(Df,0,E),O.fill(0,0,E);for(let X=0;X<m;X++)for(let Y=0;Y<p;Y++){let re=W.data[4*(X*p+Y)+3]/255;if(re===0)continue;let ne=(X+R)*x+Y+R;if(re===1)z[ne]=0,O[ne]=Df;else{let ue=.5-re;z[ne]=ue>0?ue*ue:0,O[ne]=ue<0?ue*ue:0}}Ww(z,0,0,x,w,x,this.f,this.v,this.z),Ww(O,R,R,p,m,x,this.f,this.v,this.z);for(let X=0;X<E;X++){let Y=Math.sqrt(z[X])-Math.sqrt(O[X]);D[X]=Math.round(255-255*(Y/this.radius+this.cutoff))}return S}};let Za=di;function Xw(t,e,n,i){let s=[],l=t.imagePrimary,c=l.pixelRatio,p=l.paddedRect.w-2*Za,m=l.paddedRect.h-2*Za,x=t.right-t.left,w=t.bottom-t.top,E=l.stretchX||[[0,p]],D=l.stretchY||[[0,m]],S=(Te,Le)=>Te+Le[1]-Le[0],A=E.reduce(S,0),R=D.reduce(S,0),O=p-A,z=m-R,W=0,X=A,Y=0,re=R,ne=0,ue=O,de=0,ve=z;if(l.content&&i){let Te=l.content;W=Xm(E,0,Te[0]),Y=Xm(D,0,Te[1]),X=Xm(E,Te[0],Te[2]),re=Xm(D,Te[1],Te[3]),ne=Te[0]-W,de=Te[1]-Y,ue=Te[2]-Te[0]-X,ve=Te[3]-Te[1]-re}let Ce=(Te,Le,Ue,Pe)=>{let Be=Ym(Te.stretch-W,X,x,t.left),Se=Qm(Te.fixed-ne,ue,Te.stretch,A),Ve=Ym(Le.stretch-Y,re,w,t.top),He=Qm(Le.fixed-de,ve,Le.stretch,R),je=Ym(Ue.stretch-W,X,x,t.left),rt=Qm(Ue.fixed-ne,ue,Ue.stretch,A),Ge=Ym(Pe.stretch-Y,re,w,t.top),We=Qm(Pe.fixed-de,ve,Pe.stretch,R),dt=new tt(Be,Ve),ht=new tt(je,Ve),ct=new tt(je,Ge),qe=new tt(Be,Ge),ft=new tt(Se/c,He/c),At=new tt(rt/c,We/c),xt=e*Math.PI/180;if(xt){let _n=Math.sin(xt),on=Math.cos(xt),Yt=[on,-_n,_n,on];dt._matMult(Yt),ht._matMult(Yt),qe._matMult(Yt),ct._matMult(Yt)}let kt=Te.stretch+Te.fixed,Pt=Ue.stretch+Ue.fixed,Vt=Le.stretch+Le.fixed,_t=Pe.stretch+Pe.fixed,xn=t.imageSecondary;return{tl:dt,tr:ht,bl:qe,br:ct,texPrimary:{x:l.paddedRect.x+Za+kt,y:l.paddedRect.y+Za+Vt,w:Pt-kt,h:_t-Vt},texSecondary:xn?{x:xn.paddedRect.x+Za+kt,y:xn.paddedRect.y+Za+Vt,w:Pt-kt,h:_t-Vt}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ft,pixelOffsetBR:At,minFontScaleX:ue/c/x,minFontScaleY:ve/c/w,isSDF:n}};if(i&&(l.stretchX||l.stretchY)){let Te=Yw(E,O,A),Le=Yw(D,z,R);for(let Ue=0;Ue<Te.length-1;Ue++){let Pe=Te[Ue],Be=Te[Ue+1];for(let Se=0;Se<Le.length-1;Se++)s.push(Ce(Pe,Le[Se],Be,Le[Se+1]))}}else s.push(Ce({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:p+1},{fixed:0,stretch:m+1}));return s}function Xm(t,e,n){let i=0;for(let s of t)i+=Math.max(e,Math.min(n,s[1]))-Math.max(e,Math.min(n,s[0]));return i}function Yw(t,e,n){let i=[{fixed:-Za,stretch:0}];for(let[s,l]of t){let c=i[i.length-1];i.push({fixed:s-c.stretch,stretch:c.stretch}),i.push({fixed:s-c.stretch,stretch:c.stretch+(l-s)})}return i.push({fixed:e+Za,stretch:n}),i}function Ym(t,e,n,i){return t/e*n+i}function Qm(t,e,n,i){return t-e*n/i}function G2(t,e,n,i){let s=e+t.positionedLines[i].lineOffset;return i===0?n+s/2:n+(s+(e+t.positionedLines[i-1].lineOffset))/2}function $2(t,e=1,n=!1){let i=1/0,s=1/0,l=-1/0,c=-1/0,p=t[0];for(let S=0;S<p.length;S++){let A=p[S];(!S||A.x<i)&&(i=A.x),(!S||A.y<s)&&(s=A.y),(!S||A.x>l)&&(l=A.x),(!S||A.y>c)&&(c=A.y)}let m=Math.min(l-i,c-s),x=m/2,w=new Pd([],H2);if(m===0)return new tt(i,s);for(let S=i;S<l;S+=m)for(let A=s;A<c;A+=m)w.push(new sh(S+x,A+x,x,t));let E=function(S){let A=0,R=0,O=0,z=S[0];for(let W=0,X=z.length,Y=X-1;W<X;Y=W++){let re=z[W],ne=z[Y],ue=re.x*ne.y-ne.x*re.y;R+=(re.x+ne.x)*ue,O+=(re.y+ne.y)*ue,A+=3*ue}return new sh(R/A,O/A,0,S)}(t),D=w.length;for(;w.length;){let S=w.pop();(S.d>E.d||!E.d)&&(E=S,n&&console.log("found best %d after %d probes",Math.round(1e4*S.d)/1e4,D)),S.max-E.d<=e||(x=S.h/2,w.push(new sh(S.p.x-x,S.p.y-x,x,t)),w.push(new sh(S.p.x+x,S.p.y-x,x,t)),w.push(new sh(S.p.x-x,S.p.y+x,x,t)),w.push(new sh(S.p.x+x,S.p.y+x,x,t)),D+=4)}return n&&(console.log(`num probes: ${D}`),console.log(`best distance: ${E.d}`)),E.p}function H2(t,e){return e.max-t.max}class sh{constructor(e,n,i,s){this.p=new tt(e,n),this.h=i,this.d=function(l,c){let p=!1,m=1/0;for(let x=0;x<c.length;x++){let w=c[x];for(let E=0,D=w.length,S=D-1;E<D;S=E++){let A=w[E],R=w[S];A.y>l.y!=R.y>l.y&&l.x<(R.x-A.x)*(l.y-A.y)/(R.y-A.y)+A.x&&(p=!p),m=Math.min(m,rb(l,A,R))}}return(p?1:-1)*Math.sqrt(m)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}}let m0=Number.POSITIVE_INFINITY,q2=Math.sqrt(2);function Qw(t,[e,n]){let i=0,s=0;if(n===m0){e<0&&(e=0);let l=e/q2;switch(t){case"top-right":case"top-left":s=l-7;break;case"bottom-right":case"bottom-left":s=7-l;break;case"bottom":s=7-e;break;case"top":s=e-7}switch(t){case"top-right":case"bottom-right":i=-l;break;case"top-left":case"bottom-left":i=l;break;case"left":i=e;break;case"right":i=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":s=n-7;break;case"bottom-right":case"bottom-left":case"bottom":s=7-n}switch(t){case"top-right":case"bottom-right":case"right":i=-e;break;case"top-left":case"bottom-left":case"left":i=e}}return[i,s]}function g0(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function W2(t,e,n,i,s,l,c,p,m,x,w,E,D,S,A){let R=l.textMaxSize.evaluate(e,{},E);R===void 0&&(R=c);let O=t.layers[0].layout,z=O.get("icon-offset").evaluate(e,{},E),W=Jw(n.horizontal)||n.vertical,X=D.name==="globe",Y=Cr,re=c/Y,ne=t.tilePixelRatio*R/Y,ue=(Be=t.overscaling,t.zoom>18&&Be>2&&(Be>>=1),Math.max(Ye/(512*Be),1)*O.get("symbol-spacing")),de=O.get("text-padding")*t.tilePixelRatio,ve=O.get("icon-padding")*t.tilePixelRatio,Ce=qt(O.get("text-max-angle")),Te=O.get("text-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",Le=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",Ue=O.get("symbol-placement"),Pe=ue/2;var Be;let Se=O.get("icon-text-fit").evaluate(e,{},E),Ve=O.get("icon-text-fit-padding").evaluate(e,{},E),He=Se!=="none",je;t.hasAnyIconTextFit===!1&&He&&(t.hasAnyIconTextFit=!0),i&&He&&(t.allowVerticalPlacement&&n.vertical&&(je=zw(i,n.vertical,Se,Ve,z,re)),W&&(i=zw(i,W,Se,Ve,z,re)));let rt=(Ge,We,dt)=>{if(We.x<0||We.x>=Ye||We.y<0||We.y>=Ye)return;let ht=null;if(X){let{x:ct,y:qe,z:ft}=D.projectTilePoint(We.x,We.y,dt);ht={anchor:new Bs(ct,qe,ft,0,void 0),up:D.upVector(dt,We.x,We.y)}}(function(ct,qe,ft,At,xt,kt,Pt,Vt,_t,xn,_n,on,Yt,sn,An,Tn,qn,Hn,Fr,Kn,Un,ar,vr,br,Cn,Qr,Vs){let Qi=ct.addToLineVertexArray(qe,At),yo,tl,nl,vc,eE,tE,nE,rE=0,iE=0,oE=0,sE=0,H0=-1,q0=-1,Yo={},aE=jl(""),bc=ft?ft.anchor:qe,W0=_t.layout.get("icon-text-fit").evaluate(Un,{},Cn)!=="none",Z0=0,X0=0;if(_t._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Z0,X0]=_t.layout.get("text-offset").evaluate(Un,{},Cn).map(pi=>pi*Cr):(Z0=_t.layout.get("text-radial-offset").evaluate(Un,{},Cn)*Cr,X0=m0),ct.allowVerticalPlacement&&xt.vertical){let pi=xt.vertical;if(An)tE=_0(pi),Vt&&(nE=_0(Vt));else{let mi=_t.layout.get("text-rotate").evaluate(Un,{},Cn)+90;nl=Km(xn,bc,qe,_n,on,Yt,pi,sn,mi,Tn),Vt&&(vc=Km(xn,bc,qe,_n,on,Yt,Vt,Hn,mi))}}if(kt){let pi=_t.layout.get("icon-rotate").evaluate(Un,{},Cn),mi=Xw(kt,pi,vr,W0),mh=Vt?Xw(Vt,pi,vr,W0):void 0;tl=Km(xn,bc,qe,_n,on,Yt,kt,Hn,pi),rE=4*mi.length;let lE=ct.iconSizeData,wc=null;lE.kind==="source"?(wc=[ho*_t.layout.get("icon-size").evaluate(Un,{},Cn)],wc[0]>Xa&&Qn(`${ct.layerIds[0]}: Value for "icon-size" is >= ${Mf}. Reduce your "icon-size".`)):lE.kind==="composite"&&(wc=[ho*ar.compositeIconSizes[0].evaluate(Un,{},Cn),ho*ar.compositeIconSizes[1].evaluate(Un,{},Cn)],(wc[0]>Xa||wc[1]>Xa)&&Qn(`${ct.layerIds[0]}: Value for "icon-size" is >= ${Mf}. Reduce your "icon-size".`)),ct.addSymbols(ct.icon,mi,wc,Kn,Fr,Un,!1,ft,qe,Qi.lineStartIndex,Qi.lineLength,-1,br,Cn,Qr,Vs),H0=ct.icon.placedSymbolArray.length-1,mh&&(iE=4*mh.length,ct.addSymbols(ct.icon,mh,wc,Kn,Fr,Un,Ri.vertical,ft,qe,Qi.lineStartIndex,Qi.lineLength,-1,br,Cn,Qr,Vs),q0=ct.icon.placedSymbolArray.length-1)}for(let pi in xt.horizontal){let mi=xt.horizontal[pi];yo||(aE=jl(mi.text),An?eE=_0(mi):yo=Km(xn,bc,qe,_n,on,Yt,mi,sn,_t.layout.get("text-rotate").evaluate(Un,{},Cn),Tn));let mh=mi.positionedLines.length===1;if(oE+=Kw(ct,ft,qe,mi,Pt,_t,An,Un,Tn,Qi,xt.vertical?Ri.horizontal:Ri.horizontalOnly,mh?Object.keys(xt.horizontal):[pi],Yo,H0,ar,br,Cn,Qr),mh)break}xt.vertical&&(sE+=Kw(ct,ft,qe,xt.vertical,Pt,_t,An,Un,Tn,Qi,Ri.vertical,["vertical"],Yo,q0,ar,br,Cn,Qr));let rl=-1,Y0=(pi,mi)=>pi?Math.max(pi,mi):mi;rl=Y0(eE,rl),rl=Y0(tE,rl),rl=Y0(nE,rl);let vP=rl>-1?1:0;ct.glyphOffsetArray.length>=65535&&Qn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Un.sortKey!==void 0&&ct.addToSortKeyRanges(ct.symbolInstances.length,Un.sortKey),ct.symbolInstances.emplaceBack(qe.x,qe.y,bc.x,bc.y,bc.z,Yo.right>=0?Yo.right:-1,Yo.center>=0?Yo.center:-1,Yo.left>=0?Yo.left:-1,Yo.vertical>=0?Yo.vertical:-1,H0,q0,aE,yo!==void 0?yo:ct.collisionBoxArray.length,yo!==void 0?yo+1:ct.collisionBoxArray.length,nl!==void 0?nl:ct.collisionBoxArray.length,nl!==void 0?nl+1:ct.collisionBoxArray.length,tl!==void 0?tl:ct.collisionBoxArray.length,tl!==void 0?tl+1:ct.collisionBoxArray.length,vc||ct.collisionBoxArray.length,vc?vc+1:ct.collisionBoxArray.length,_n,oE,sE,rE,iE,vP,0,Z0,X0,rl,0,1,1,W0?1:0)})(t,We,ht,Ge,n,i,s,je,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,de,Te,m,0,ve,Le,z,e,l,x,w,E,S,A)};if(Ue==="line")for(let Ge of $w(e.geometry,0,0,Ye,Ye)){let We=U2(Ge,ue,Ce,n.vertical||W,i,Y,ne,t.overscaling,Ye);for(let dt of We)W&&Z2(t,W.text,Pe,dt)||rt(Ge,dt,E)}else if(Ue==="line-center"){for(let Ge of e.geometry)if(Ge.length>1){let We=j2(Ge,Ce,n.vertical||W,i,Y,ne);We&&rt(Ge,We,E)}}else if(e.type==="Polygon")for(let Ge of Om(e.geometry,0)){let We=$2(Ge,16);rt(Ge[0],new Bs(We.x,We.y,0,0,void 0),E)}else if(e.type==="LineString")for(let Ge of e.geometry)rt(Ge,new Bs(Ge[0].x,Ge[0].y,0,0,void 0),E);else if(e.type==="Point")for(let Ge of e.geometry)for(let We of Ge)rt([We],new Bs(We.x,We.y,0,0,void 0),E)}let Mf=255,Xa=Mf*ho;function Kw(t,e,n,i,s,l,c,p,m,x,w,E,D,S,A,R,O,z){let W=function(re,ne,ue,de,ve,Ce,Te,Le){let Ue=[];if(ne.positionedLines.length===0)return Ue;let Pe=de.layout.get("text-rotate").evaluate(Ce,{})*Math.PI/180,Be=function(rt){let Ge=rt[0],We=rt[1],dt=Ge*We;return dt>0?[Ge,-We]:dt<0?[-Ge,We]:Ge===0?[We,Ge]:[We,-Ge]}(ue),Se=Math.abs(ne.top-ne.bottom);for(let rt of ne.positionedLines)Se-=rt.lineOffset;let Ve=ne.positionedLines.length,He=Se/Ve,je=ne.top-ue[1];for(let rt=0;rt<Ve;++rt){let Ge=ne.positionedLines[rt];je=G2(ne,He,je,rt);for(let We of Ge.positionedGlyphs){if(!We.rect)continue;let dt=We.rect||{},ht=Rw+1,ct=!0,qe=1,ft=0;if(We.imageName){let Kn=Te[We.imageName];if(!Kn)continue;if(Kn.sdf){Qn("SDF images are not supported in formatted text and will be ignored.");continue}ct=!1,qe=Kn.pixelRatio,ht=di/qe}let At=(ve||Le)&&We.vertical,xt=We.metrics.advance*We.scale/2,kt=We.metrics,Pt=We.rect;if(Pt===null)continue;Le&&ne.verticalizable&&(ft=We.imageName?xt-We.metrics.width*We.scale/2:0);let Vt=ve?[We.x+xt,We.y]:[0,0],_t=[0,0],xn=[0,0],_n=!1;ve||(At?(xn=[We.x+xt+Be[0],We.y+Be[1]-ft],_n=!0):_t=[We.x+xt+ue[0],We.y+ue[1]-ft]);let on=Pt.w*We.scale/(qe*(We.localGlyph?fo:1)),Yt=Pt.h*We.scale/(qe*(We.localGlyph?fo:1)),sn,An,Tn,qn;if(At){let Kn=We.y-je,Un=new tt(-xt,xt-Kn),ar=-Math.PI/2,vr=new tt(...xn);sn=new tt(-xt+_t[0],_t[1]),sn._rotateAround(ar,Un)._add(vr),sn.x+=-Kn+xt,sn.y-=(kt.left-ht)*We.scale;let br=We.imageName?kt.advance*We.scale:Cr*We.scale,Cn=String.fromCodePoint(We.glyph);L2(Cn)?sn.x+=(1-ht)*We.scale:O2(Cn)?sn.x+=br-kt.height*We.scale+(-ht-1)*We.scale:sn.x+=We.imageName||kt.width+2*ht===Pt.w&&kt.height+2*ht===Pt.h?(br-Yt)/2:(br-(kt.height+2*ht)*We.scale)/2,An=new tt(sn.x,sn.y-on),Tn=new tt(sn.x+Yt,sn.y),qn=new tt(sn.x+Yt,sn.y-on)}else{let Kn=(kt.left-ht)*We.scale-xt+_t[0],Un=(-kt.top-ht)*We.scale+_t[1],ar=Kn+on,vr=Un+Yt;sn=new tt(Kn,Un),An=new tt(ar,Un),Tn=new tt(Kn,vr),qn=new tt(ar,vr)}if(Pe){let Kn;Kn=ve?new tt(0,0):_n?new tt(Be[0],Be[1]):new tt(ue[0],ue[1]),sn._rotateAround(Pe,Kn),An._rotateAround(Pe,Kn),Tn._rotateAround(Pe,Kn),qn._rotateAround(Pe,Kn)}let Hn=new tt(0,0),Fr=new tt(0,0);Ue.push({tl:sn,tr:An,bl:Tn,br:qn,texPrimary:dt,texSecondary:void 0,writingMode:ne.writingMode,glyphOffset:Vt,sectionIndex:We.sectionIndex,isSDF:ct,pixelOffsetTL:Hn,pixelOffsetBR:Fr,minFontScaleX:0,minFontScaleY:0})}}return Ue}(0,i,m,l,c,p,s,t.allowVerticalPlacement),X=t.textSizeData,Y=null;X.kind==="source"?(Y=[ho*l.layout.get("text-size").evaluate(p,{},O)],Y[0]>Xa&&Qn(`${t.layerIds[0]}: Value for "text-size" is >= ${Mf}. Reduce your "text-size".`)):X.kind==="composite"&&(Y=[ho*A.compositeTextSizes[0].evaluate(p,{},O),ho*A.compositeTextSizes[1].evaluate(p,{},O)],(Y[0]>Xa||Y[1]>Xa)&&Qn(`${t.layerIds[0]}: Value for "text-size" is >= ${Mf}. Reduce your "text-size".`)),t.addSymbols(t.text,W,Y,m,c,p,w,e,n,x.lineStartIndex,x.lineLength,S,R,O,z,!1);for(let re of E)D[re]=t.text.placedSymbolArray.length-1;return 4*W.length}function Jw(t){for(let e in t)return t[e];return null}function Km(t,e,n,i,s,l,c,p,m,x){let w=c.top,E=c.bottom,D=c.left,S=c.right,A=c.collisionPadding;if(A&&(D-=A[0],w-=A[1],S+=A[2],E+=A[3]),m){let R=new tt(D,w),O=new tt(S,w),z=new tt(D,E),W=new tt(S,E),X=qt(m),Y=new tt(0,0);x&&(Y=new tt(x[0],x[1])),R._rotateAround(X,Y),O._rotateAround(X,Y),z._rotateAround(X,Y),W._rotateAround(X,Y),D=Math.min(R.x,O.x,z.x,W.x),S=Math.max(R.x,O.x,z.x,W.x),w=Math.min(R.y,O.y,z.y,W.y),E=Math.max(R.y,O.y,z.y,W.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,D,w,S,E,p,i,s,l),t.length-1}function _0(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Z2(t,e,n,i){let s=t.compareText;if(e in s){let l=s[e];for(let c=l.length-1;c>=0;c--)if(i.dist(l[c])<n)return!0}else s[e]=[];return s[e].push(i),!1}function eT(t,e){let n=t.fovAboveCenter,i=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,s=(t._camera.position[2]*t.worldSize-i)/Math.cos(t._pitch),l=Math.sin(n)*s/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),c=Math.sin(t._pitch)*l+s;return Math.min(1.01*c,s*(1/t._horizonShift))}function mc(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let n=Math.pow(2,-t.z),i=t.x*n,s=(t.x+1)*n,l=t.y*n,c=(t.y+1)*n,p=ii(i),m=ii(s),x=xr(l),w=xr(c),E=e.project(p,x),D=e.project(m,x),S=e.project(m,w),A=e.project(p,w),R=Math.min(E.x,D.x,S.x,A.x),O=Math.min(E.y,D.y,S.y,A.y),z=Math.max(E.x,D.x,S.x,A.x),W=Math.max(E.y,D.y,S.y,A.y),X=n/16;function Y(ne,ue,de,ve,Ce,Te){let Le=(de+Ce)/2,Ue=(ve+Te)/2,Pe=e.project(ii(Le),xr(Ue)),Be=Math.max(0,R-Pe.x,O-Pe.y,Pe.x-z,Pe.y-W);R=Math.min(R,Pe.x),z=Math.max(z,Pe.x),O=Math.min(O,Pe.y),W=Math.max(W,Pe.y),Be>X&&(Y(ne,Pe,de,ve,Le,Ue),Y(Pe,ue,Le,Ue,Ce,Te))}Y(E,D,i,l,s,l),Y(D,S,s,l,s,c),Y(S,A,s,c,i,c),Y(A,E,i,c,i,l),R-=X,O-=X,z+=X,W+=X;let re=1/Math.max(z-R,W-O);return{scale:re,x:R*re,y:O*re,x2:z*re,y2:W*re,projection:e}}function tT(t,{x:e,y:n},i=0){return new tt(((e-i)*t.scale-t.x)*Ye,(n*t.scale-t.y)*Ye)}let X2=o.ad.identity(new Float32Array(16));class Ya{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new en(0,0)}projectTilePoint(e,n,i){return{x:e,y:n,z:0}}locationPoint(e,n,i=!0){return e._coordinatePoint(e.locationCoordinate(n),i)}pixelsPerMeter(e,n){return Yr(1,e)*n}pixelSpaceConversion(e,n,i){return 1}farthestPixelDistance(e){return eT(e,e.pixelsPerMeter)}pointCoordinate(e,n,i,s){let l=e.horizonLineFromTop(!1),c=new tt(n,Math.max(l,i));return e.rayIntersectionCoordinate(e.pointRayIntersection(c,s))}pointCoordinate3D(e,n,i){let s=new tt(n,i);if(e.elevation)return e.elevation.pointCoordinate(s);{let l=this.pointCoordinate(e,s.x,s.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);let i=e.horizonLineFromTop();return n.y<i}createInversionMatrix(e,n){return X2}createTileMatrix(e,n,i){let s,l,c,p=i.canonical,m=o.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let x=mc(p,this);s=1,l=x.x+i.wrap*x.scale,c=x.y,o.ad.scale(m,m,[s/x.scale,s/x.scale,e.pixelsPerMeter/n])}else s=n/e.zoomScale(p.z),l=(p.x+Math.pow(2,p.z)*i.wrap)*s,c=p.y*s;return o.ad.translate(m,m,[l,c,0]),o.ad.scale(m,m,[s/Ye,s/Ye,1]),m}upVector(e,n,i){return[0,0,1]}upVectorScale(e,n,i){return{metersToTile:1}}}class Y2 extends Ya{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,i]=this.parallels=e.parallels||[29.5,45.5],s=Math.sin(qt(n));this.n=(s+Math.sin(qt(i)))/2,this.c=1+s*(2*this.n-s),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:i,c:s,r0:l}=this,c=qt(e-this.center[0]),p=qt(n),m=Math.sqrt(s-2*i*Math.sin(p))/i;return{x:m*Math.sin(c*i),y:m*Math.cos(c*i)-l,z:0}}unproject(e,n){let{n:i,c:s,r0:l}=this,c=l+n,p=Math.atan2(e,Math.abs(c))*Math.sign(c);c*i<0&&(p-=Math.PI*Math.sign(e)*Math.sign(c));let m=qt(this.center[0])*i;p=ds(p,-Math.PI-m,Math.PI-m);let x=St(Ar(p/i)+this.center[0],-180,180),w=Math.asin(St((s-(e*e+c*c)*i*i)/(2*i),-1,1)),E=St(Ar(w),-nr,nr);return new en(x,E)}}let Cf=1.340264,Sf=-.081106,Af=893e-6,Pf=.003796,Jm=Math.sqrt(3)/2;class Q2 extends Ya{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let i=Math.asin(Jm*Math.sin(n)),s=i*i,l=s*s*s;return{x:.5*(e*Math.cos(i)/(Jm*(Cf+3*Sf*s+l*(7*Af+9*Pf*s)))/Math.PI+.5),y:1-.5*(i*(Cf+Sf*s+l*(Af+Pf*s))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let i=n=(2*(1-n)-1)*Math.PI,s=i*i,l=s*s*s;for(let w,E,D,S=0;S<12&&(E=i*(Cf+Sf*s+l*(Af+Pf*s))-n,D=Cf+3*Sf*s+l*(7*Af+9*Pf*s),w=E/D,i=St(i-w,-Math.PI/3,Math.PI/3),s=i*i,l=s*s*s,!(Math.abs(w)<1e-12));++S);let c=Jm*e*(Cf+3*Sf*s+l*(7*Af+9*Pf*s))/Math.cos(i),p=Math.asin(Math.sin(i)/Jm),m=St(180*c/Math.PI,-180,180),x=St(180*p/Math.PI,-nr,nr);return new en(m,x)}}class K2 extends Ya{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let i=360*(e-.5),s=St(360*(.5-n),-nr,nr);return new en(i,s)}}let ah=Math.PI/2;function eg(t){return Math.tan((ah+t)/2)}class J2 extends Ya{constructor(e){super(e),this.center=e.center||[0,30];let[n,i]=this.parallels=e.parallels||[30,30],s=qt(n),l=qt(i);this.southernCenter=s+l<0,this.southernCenter&&(s=-s,l=-l);let c=Math.cos(s),p=eg(s);this.n=s===l?Math.sin(s):Math.log(c/Math.cos(l))/Math.log(eg(l)/p),this.f=c*Math.pow(eg(s),this.n)/this.n}project(e,n){n=qt(n),this.southernCenter&&(n=-n),e=qt(e-this.center[0]);let i=1e-6,{n:s,f:l}=this;l>0?n<-ah+i&&(n=-ah+i):n>ah-i&&(n=ah-i);let c=l/Math.pow(eg(n),s),p=c*Math.sin(s*e),m=l-c*Math.cos(s*e);return p=.5*(p/Math.PI+.5),m=.5*(m/Math.PI+.5),{x:p,y:this.southernCenter?m:1-m,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:i,f:s}=this,l=s-n,c=Math.sign(l),p=Math.sign(i)*Math.sqrt(e*e+l*l),m=Math.atan2(e,Math.abs(l))*c;l*i<0&&(m-=Math.PI*Math.sign(e)*c);let x=St(Ar(m/i)+this.center[0],-180,180),w=St(Ar(2*Math.atan(Math.pow(s/p,1/i))-ah),-nr,nr);return new en(x,this.southernCenter?-w:w)}}class nT extends Ya{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:$o(e),y:Ho(n),z:0}}unproject(e,n){let i=ii(e),s=xr(n);return new en(i,s)}}let rT=qt(nr);class eA extends Ya{project(e,n){let i=(n=qt(n))*n,s=i*i;return{x:.5*((e=qt(e))*(.8707-.131979*i+s*(s*(.003971*i-.001529*s)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+i*(.015085+s*(.028874*i-.044475-.005916*s)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let i=n=(2*(1-n)-1)*Math.PI,s=25,l=0,c=i*i;do{c=i*i;let x=c*c;l=(i*(1.007226+c*(.015085+x*(.028874*c-.044475-.005916*x)))-n)/(1.007226+c*(.045255+x*(.259866*c-.311325-.005916*11*x))),i=St(i-l,-rT,rT)}while(Math.abs(l)>1e-6&&--s>0);c=i*i;let p=St(Ar(e/(.8707+c*(c*(c*c*c*(.003971-.001529*c)-.013791)-.131979))),-180,180),m=Ar(i);return new en(p,m)}}let iT=qt(nr);class tA extends Ya{project(e,n){n=qt(n),e=qt(e);let i=Math.cos(n),s=2/Math.PI,l=Math.acos(i*Math.cos(e/2)),c=Math.sin(l)/l,p=.5*(e*s+2*i*Math.sin(e/2)/c)||0,m=.5*(n+Math.sin(n)/c)||0;return{x:.5*(p/Math.PI+.5),y:1-.5*(m/Math.PI+1),z:0}}unproject(e,n){let i=e=(2*e-.5)*Math.PI,s=n=(2*(1-n)-1)*Math.PI,l=25,c=1e-6,p=0,m=0;do{let x=Math.cos(s),w=Math.sin(s),E=2*w*x,D=w*w,S=x*x,A=Math.cos(i/2),R=Math.sin(i/2),O=2*A*R,z=R*R,W=1-S*A*A,X=W?1/W:0,Y=W?Math.acos(x*A)*Math.sqrt(1/W):0,re=.5*(2*Y*x*R+2*i/Math.PI)-e,ne=.5*(Y*w+s)-n,ue=.5*X*(S*z+Y*x*A*D)+1/Math.PI,de=X*(O*E/4-Y*w*R),ve=.125*X*(E*R-Y*w*S*O),Ce=.5*X*(D*A+Y*z*x)+.5,Te=de*ve-Ce*ue;p=(ne*de-re*Ce)/Te,m=(re*ve-ne*ue)/Te,i=St(i-p,-Math.PI,Math.PI),s=St(s-m,-iT,iT)}while((Math.abs(p)>c||Math.abs(m)>c)&&--l>0);return new en(Ar(i),Ar(s))}}class oT extends Ya{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(qt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:i,cosPhi:s}=this;return{x:qt(e)*s*i+.5,y:-Math.sin(qt(n))/s*i+.5,z:0}}unproject(e,n){let{scale:i,cosPhi:s}=this,l=-(n-.5)/i,c=St(Ar((e-.5)/i)/s,-180,180),p=Math.asin(St(l*s,-1,1)),m=St(Ar(p),-nr,nr);return new en(c,m)}}class nA extends nT{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,i){let s=pf(e,n,i),l=mf(qo(i));return o._.transformMat4(s,s,l),{x:s[0],y:s[1],z:s[2]}}locationPoint(e,n){let i=uc(n.lat,n.lng),s=o._.normalize([],i),l=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,c=Yr(1,0)*Ye*l;o._.scaleAndAdd(i,i,s,c);let p=o.ad.identity(new Float64Array(16));return o.ad.multiply(p,e.pixelMatrix,e.globeMatrix),o._.transformMat4(i,i,p),new tt(i[0],i[1])}pixelsPerMeter(e,n){return Yr(1,0)*n}pixelSpaceConversion(e,n,i){let s=Yr(1,e)*n,l=pt(Yr(1,45)*n,s,i);return this.pixelsPerMeter(e,n)/l}createTileMatrix(e,n,i){let s=Zy(qo(i.canonical));return o.ad.multiply(new Float64Array(16),e.globeMatrix,s)}createInversionMatrix(e,n){let{center:i}=e,s=mf(qo(n));return o.ad.rotateY(s,s,qt(i.lng)),o.ad.rotateX(s,s,qt(i.lat)),o.ad.scale(s,s,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(s)}pointCoordinate(e,n,i,s){return db(e,n,i,!0)||new kr(0,0)}pointCoordinate3D(e,n,i){let s=this.pointCoordinate(e,n,i,0);return[s.x,s.y,s.z]}isPointAboveHorizon(e,n){return!db(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(s,l){let c=s.cameraToCenterDistance,p=s._centerAltitude*l,m=s._camera,x=s._camera.forward(),w=o._.add([],o._.scale([],x,-c),[0,0,p]),E=s.worldSize/(2*Math.PI),D=[0,0,-E],S=s.width/s.height,A=Math.tan(s.fovAboveCenter),R=o._.scale([],m.up(),A),O=o._.scale([],m.right(),A*S),z=o._.normalize([],o._.add([],o._.add([],x,R),O)),W=[],X;if(new Gy(w,z).closestPointOnSphere(D,E,W)){let Y=o._.add([],W,D),re=o._.sub([],Y,w);X=Math.cos(s.fovAboveCenter)*o._.length(re)}else{let Y=o._.sub([],w,D),re=o._.sub([],D,w);o._.normalize(re,re);let ne=o._.length(Y)-E;X=Math.sqrt(ne*(ne+2*E));let ue=Math.acos(X/(E+ne))-Math.acos(o._.dot(x,re));X*=Math.cos(ue)}return 1.01*X}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),i=Ns(e.zoom);if(i>0){let s=eT(e,Yr(1,e.center.lat)*e.worldSize),l=e.worldSize/(2*Math.PI),c=Math.max(e.width,e.height)/e.worldSize*Math.PI;return pt(n,s+l*(1-Math.cos(c)),Math.pow(i,10))}return n}upVector(e,n,i){return pf(n,i,e,1)}upVectorScale(e){return{metersToTile:Cm(Am(qo(e)))}}}function sT(t){let e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new nT(t);case"equirectangular":return new K2(t);case"naturalEarth":return new eA(t);case"equalEarth":return new Q2(t);case"winkelTripel":return new tA(t);case"albers":return n?new oT(t):new Y2(t);case"lambertConformalConic":return n?new oT(t):new J2(t);case"globe":return new nA(t)}throw new Error(`Invalid projection name: ${t.name}`)}let rA=(()=>{class t{constructor(n,i,s,l){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=n;let c=n.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!s,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||l||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;let i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})();class lh{constructor(e,n,i){this.func=e,this.mask=n,this.range=i}}lh.ReadOnly=!1,lh.ReadWrite=!0,lh.disabled=new lh(519,lh.ReadOnly,[0,1]);let y0=7680;class x0{constructor(e,n,i,s,l,c){this.test=e,this.ref=n,this.mask=i,this.fail=s,this.depthFail=l,this.pass=c}}x0.disabled=new x0({func:519,mask:0},0,0,y0,y0,y0);let Rf=771;class fi{constructor(e,n,i,s){this.blendFunction=e,this.blendColor=n,this.mask=i,this.blendEquation=s}}fi.Replace=[1,0,1,0],fi.disabled=new fi(fi.Replace,nn.transparent,[!1,!1,!1,!1]),fi.unblended=new fi(fi.Replace,nn.transparent,[!0,!0,!0,!0]),fi.alphaBlended=new fi([1,Rf,1,Rf],nn.transparent,[!0,!0,!0,!0]),fi.alphaBlendedNonPremultiplied=new fi([770,Rf,770,Rf],nn.transparent,[!0,!0,!0,!0]),fi.multiply=new fi([774,0,774,0],nn.transparent,[!0,!0,!0,!0]);let v0=1029,b0=2305;class po{constructor(e,n,i){this.enable=e,this.mode=n,this.frontFace=i}}po.disabled=new po(!1,v0,b0),po.backCCW=new po(!0,v0,b0),po.backCW=new po(!0,v0,2304),po.frontCW=new po(!0,1028,2304),po.frontCCW=new po(!0,1028,b0);let iA=Nm.types,oA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tg(t,e,n,i,s,l,c,p,m,x,w,E,D){let S=p?Math.min(Xa,Math.round(p[0])):0,A=p?Math.min(Xa,Math.round(p[1])):0;t.emplaceBack(e,n,Math.round(32*i),Math.round(32*s),l,c,(S<<1)+(m?1:0),A,16*x,16*w,256*E,256*D)}function ng(t,e,n){t.emplaceBack(e,n)}function rg(t,e,n,i,s,l,c){t.emplaceBack(e,n,i,s,l,c)}function ig(t,e,n,i,s){t.emplaceBack(e,n,i,s),t.emplaceBack(e,n,i,s),t.emplaceBack(e,n,i,s),t.emplaceBack(e,n,i,s)}function sA(t){for(let e of t.sections)if(Qe(e.text))return!0;return!1}class w0{constructor(e){this.layoutVertexArray=new dy,this.indexArray=new pr,this.programConfigurations=e,this.segments=new $n,this.dynamicLayoutVertexArray=new Na,this.opacityVertexArray=new py,this.occlusionQueryOpacityVertexArray=new ac,this.placedSymbolArray=new F1,this.iconTransitioningVertexArray=new Va,this.globeExtVertexArray=new fy,this.zOffsetVertexArray=new ac}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,i,s,l){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,a2.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,c2.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,oA,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,a0.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,u2.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,l2.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,pw.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||s)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}q(w0,"SymbolBuffers");class T0{constructor(e,n,i){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new i,this.segments=new $n,this.collisionVertexArray=new _y,this.collisionVertexArrayExt=new Na}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,h2.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,d2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}q(T0,"CollisionBuffers");class ch{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=o.ad.identity([]),this.placementViewportMatrix=o.ad.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=c0(this.zoom,n["text-size"]),this.iconSizeData=c0(this.zoom,n["icon-size"]);let i=this.layers[0].layout,s=i.get("symbol-sort-key"),l=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&s.constantOr(1)!==void 0,this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map(c=>Ri[c]),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=i.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new w0(new Ua(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new w0(new Ua(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new B1,this.lineVertexArray=new V1,this.symbolInstances=new z1}calculateGlyphDependencies(e,n,i,s,l){for(let c=0;c<e.length;c++){let p=e.codePointAt(c);if(p===void 0)break;if(n[p]=!0,s&&l&&p<=65535){let m=Ef[e.charAt(c)];m&&(n[m.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let i=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!o0(this.activeReplacements,i)&&(this.activeReplacements=i,!0)}populate(e,n,i,s){let l=this.layers[0],c=l.layout,p=this.projection.name==="globe",m=c.get("text-font"),x=c.get("text-field"),w=c.get("icon-image"),E=(x.value.kind!=="constant"||x.value.value instanceof yr&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),D=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,S=c.get("symbol-sort-key");if(this.features=[],!E&&!D)return;let A=n.iconDependencies,R=n.glyphDependencies,O=n.availableImages,z=new vt(this.zoom);for(let{feature:W,id:X,index:Y,sourceLayerIndex:re}of e){let ne=l._featureFilter.needGeometry,ue=ks(W,ne);if(!l._featureFilter.filter(z,ue,i))continue;if(ne||(ue.geometry=uo(W,i,s)),p&&W.type!==1&&i.z<=5){let Te=ue.geometry,Le=.98078528056,Ue=(Pe,Be)=>{let Se=pf(Pe.x,Pe.y,i,1),Ve=pf(Be.x,Be.y,i,1);return o._.dot(Se,Ve)<Le};for(let Pe=0;Pe<Te.length;Pe++)Te[Pe]=$C(Te[Pe],Ue)}let de,ve;if(E){let Te=l.getValueAndResolveTokens("text-field",ue,i,O),Le=yr.factory(Te);sA(Le)&&(this.hasRTLText=!0),(!this.hasRTLText||Gt()==="unavailable"||this.hasRTLText&&Bt.isParsed())&&(de=R2(Le,l,ue))}if(D){let Te=l.getValueAndResolveTokens("icon-image",ue,i,O);ve=Te instanceof ti?Te:ti.fromString(Te)}if(!de&&!ve)continue;let Ce=this.sortFeaturesByKey?S.evaluate(ue,{},i):void 0;if(this.features.push({id:X,text:de,icon:ve,index:Y,sourceLayerIndex:re,geometry:ue.geometry,properties:W.properties,type:iA[W.type],sortKey:Ce}),ve&&(A[ve.namePrimary]=!0,ve.nameSecondary&&(A[ve.nameSecondary]=!0)),de){let Te=m.evaluate(ue,{},i).join(","),Le=c.get("text-rotation-alignment")==="map"&&c.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ri.vertical)>=0;for(let Ue of de.sections)if(Ue.image)A[Ue.image.namePrimary]=!0;else{let Pe=Ee(de.toString()),Be=Ue.fontStack||Te,Se=R[Be]=R[Be]||{};this.calculateGlyphDependencies(Ue.text,Se,Le,this.allowVerticalPlacement,Pe)}}}c.get("symbol-placement")==="line"&&(this.features=function(W){let X={},Y={},re=[],ne=0;function ue(Te){re.push(W[Te]),ne++}function de(Te,Le,Ue){let Pe=Y[Te];return delete Y[Te],Y[Le]=Pe,re[Pe].geometry[0].pop(),re[Pe].geometry[0]=re[Pe].geometry[0].concat(Ue[0]),Pe}function ve(Te,Le,Ue){let Pe=X[Le];return delete X[Le],X[Te]=Pe,re[Pe].geometry[0].shift(),re[Pe].geometry[0]=Ue[0].concat(re[Pe].geometry[0]),Pe}function Ce(Te,Le,Ue){let Pe=Ue?Le[0][Le[0].length-1]:Le[0][0];return`${Te}:${Pe.x}:${Pe.y}`}for(let Te=0;Te<W.length;Te++){let Le=W[Te],Ue=Le.geometry,Pe=Le.text?Le.text.toString():null;if(!Pe){ue(Te);continue}let Be=Ce(Pe,Ue),Se=Ce(Pe,Ue,!0);if(Be in Y&&Se in X&&Y[Be]!==X[Se]){let Ve=ve(Be,Se,Ue),He=de(Be,Se,re[Ve].geometry);delete X[Be],delete Y[Se],Y[Ce(Pe,re[He].geometry,!0)]=He,re[Ve].geometry=null}else Be in Y?de(Be,Se,Ue):Se in X?ve(Be,Se,Ue):(ue(Te),X[Be]=ne-1,Y[Se]=ne-1)}return re.filter(Te=>Te.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,X)=>W.sortKey-X.sortKey)}update(e,n,i,s,l){let c=Object.keys(e).length!==0;if(c&&!this.stateDependentLayers.length)return;let p=c?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,p,i,s,l),this.icon.programConfigurations.updatePaintArrays(e,n,p,i,s,l)}updateOcclusionOpacities(e,n,i){if(!n.useOcclusionQueries)return!1;let s=this;if(s.projection.name==="globe")return!1;let l=!1;s.hasTextData()&&(l=l||s.text.occlusionQueryOpacityVertexArray.length!==0),s.hasIconData()&&(l=l||s.icon.occlusionQueryOpacityVertexArray.length!==0);let c=s.layers[0].paint,p=c.get("icon-occlusion-opacity").constantOr(0),m=c.get("text-occlusion-opacity").constantOr(0);if(!s.layers[0].hasInitialOcclusionOpacityProperties||p===1&&m===1)return!1;let x=!l;for(let S=0;S<s.symbolInstances.length;S++){let A=s.symbolInstances.get(S),R=A.occlusionOpacity;A.occlusionOpacity+=(A.occlusionState>.5?1:-1)*n.fadeSpeed*i*.001,A.occlusionOpacity=St(A.occlusionOpacity,0,1),x=x||A.occlusionOpacity!==R}if(!x)return!1;let w=0,E=0,D=(S,A,R,O)=>{let z=0,W=0;R?(z=E,E+=O,W=E):(z=w,w+=O,W=w),W>A.occlusionQueryOpacityVertexArray.length&&A.occlusionQueryOpacityVertexArray.resize(W);let X=S.occlusionOpacity;for(let Y=0;Y<O;Y++)A.occlusionQueryOpacityVertexArray.emplace(Y+z,X)};for(let S=0;S<s.symbolInstances.length;S++){let A=s.symbolInstances.get(S),{numHorizontalGlyphVertices:R,numVerticalGlyphVertices:O,numIconVertices:z}=A,W=z>0;if((R>0||O>0)&&(D(A,s.text,!1,R),D(A,s.text,!1,O)),W){let{placedIconSymbolIndex:X,verticalPlacedIconSymbolIndex:Y}=A;X>=0&&D(A,s.icon,!0,z),Y>=0&&D(A,s.icon,!0,A.numVerticalIconVertices)}}return s.hasTextData()&&s.text.occlusionQueryOpacityVertexBuffer&&(s.text.occlusionQueryOpacityVertexBuffer.length<s.text.occlusionQueryOpacityVertexArray.length?s.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(s.text.occlusionQueryOpacityVertexArray,a0.members,!0):s.text.occlusionQueryOpacityVertexBuffer.updateData(s.text.occlusionQueryOpacityVertexArray)),s.hasIconData()&&s.icon.occlusionQueryOpacityVertexBuffer&&(s.icon.occlusionQueryOpacityVertexBuffer.length<s.icon.occlusionQueryOpacityVertexArray.length?s.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(s.icon.occlusionQueryOpacityVertexArray,a0.members,!0):s.icon.occlusionQueryOpacityVertexBuffer.updateData(s.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){let e=(l,c,p)=>{i+=c,i>l.length&&l.resize(i);for(let m=-c;m<0;m++)l.emplace(m+i,p)},n=(l,c,p)=>{s+=c,s>l.length&&l.resize(s);for(let m=-c;m<0;m++)l.emplace(m+s,p)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,s=0;for(let l=0;l<this.symbolInstances.length;l++){let c=this.symbolInstances.get(l),{numHorizontalGlyphVertices:p,numVerticalGlyphVertices:m,numIconVertices:x}=c,w=c.zOffset,E=x>0;if((p>0||m>0)&&(e(this.text.zOffsetVertexArray,p,w),e(this.text.zOffsetVertexArray,m,w)),E){let{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:S}=c;D>=0&&n(this.icon.zOffsetVertexArray,x,w),S>=0&&n(this.icon.zOffsetVertexArray,c.numVerticalIconVertices,w)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=sT(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(let e of this.queries.values())e.destroy()}addToLineVertexArray(e,n){let i=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:s,y:l}of n)this.lineVertexArray.emplaceBack(s,l);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,n,i,s,l,c,p,m,x,w,E,D,S,A,R,O){let z=e.indexArray,W=e.layoutVertexArray,X=e.globeExtVertexArray,Y=e.segments.prepareSegment(4*n.length,W,z,this.canOverlap?c.sortKey:void 0),re=this.glyphOffsetArray.length,ne=Y.vertexLength,ue=this.allowVerticalPlacement&&p===Ri.vertical?Math.PI/2:0,de=c.text&&c.text.sections;for(let Ce=0;Ce<n.length;Ce++){let{tl:Te,tr:Le,bl:Ue,br:Pe,texPrimary:Be,texSecondary:Se,pixelOffsetTL:Ve,pixelOffsetBR:He,minFontScaleX:je,minFontScaleY:rt,glyphOffset:Ge,isSDF:We,sectionIndex:dt}=n[Ce],ht=Y.vertexLength,ct=Ge[1];if(tg(W,x.x,x.y,Te.x,ct+Te.y,Be.x,Be.y,i,We,Ve.x,Ve.y,je,rt),tg(W,x.x,x.y,Le.x,ct+Le.y,Be.x+Be.w,Be.y,i,We,He.x,Ve.y,je,rt),tg(W,x.x,x.y,Ue.x,ct+Ue.y,Be.x,Be.y+Be.h,i,We,Ve.x,He.y,je,rt),tg(W,x.x,x.y,Pe.x,ct+Pe.y,Be.x+Be.w,Be.y+Be.h,i,We,He.x,He.y,je,rt),m){let{x:qe,y:ft,z:At}=m.anchor,[xt,kt,Pt]=m.up;rg(X,qe,ft,At,xt,kt,Pt),rg(X,qe,ft,At,xt,kt,Pt),rg(X,qe,ft,At,xt,kt,Pt),rg(X,qe,ft,At,xt,kt,Pt),ig(e.dynamicLayoutVertexArray,qe,ft,At,ue)}else ig(e.dynamicLayoutVertexArray,x.x,x.y,x.z,ue);if(O){let qe=Se||Be;ng(e.iconTransitioningVertexArray,qe.x,qe.y),ng(e.iconTransitioningVertexArray,qe.x+qe.w,qe.y),ng(e.iconTransitioningVertexArray,qe.x,qe.y+qe.h),ng(e.iconTransitioningVertexArray,qe.x+qe.w,qe.y+qe.h)}z.emplaceBack(ht,ht+1,ht+2),z.emplaceBack(ht+1,ht+2,ht+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ge[0]),Ce!==n.length-1&&dt===n[Ce+1].sectionIndex||e.programConfigurations.populatePaintArrays(W.length,c,c.index,{},S,A,R,de&&de[dt])}let ve=m?m.anchor:x;e.placedSymbolArray.emplaceBack(ve.x,ve.y,ve.z,x.x,x.y,re,this.glyphOffsetArray.length-re,ne,w,E,x.segment,i?i[0]:0,i?i[1]:0,s[0],s[1],p,0,!1,0,D,0)}_commitLayoutVertex(e,n,i,s,l,c,p){e.emplaceBack(n,i,s,l,c,Math.round(p.x),Math.round(p.y))}_addCollisionDebugVertices(e,n,i,s,l,c,p){let m=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),x=m.vertexLength,w=p.tileAnchorX,E=p.tileAnchorY;for(let S=0;S<4;S++)i.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(i.collisionVertexArrayExt,n,e.padding,p.zOffset),this._commitLayoutVertex(i.layoutVertexArray,s,l,c,w,E,new tt(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,s,l,c,w,E,new tt(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,s,l,c,w,E,new tt(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,s,l,c,w,E,new tt(e.x1,e.y2)),m.vertexLength+=4;let D=i.indexArray;D.emplaceBack(x,x+1),D.emplaceBack(x+1,x+2),D.emplaceBack(x+2,x+3),D.emplaceBack(x+3,x),m.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,i,s,l,c){for(let p=s;p<l;p++){let m=i.get(p),x=this.getSymbolInstanceTextSize(e,c,n,p);this._addCollisionDebugVertices(m,x,this.textCollisionBox,m.projectedAnchorX,m.projectedAnchorY,m.projectedAnchorZ,c)}}_addIconDebugCollisionBoxes(e,n,i,s,l,c){for(let p=s;p<l;p++){let m=i.get(p),x=this.getSymbolInstanceIconSize(e,n,c.placedIconSymbolIndex);this._addCollisionDebugVertices(m,x,this.iconCollisionBox,m.projectedAnchorX,m.projectedAnchorY,m.projectedAnchorZ,c)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new T0(xm,mw.members,Va),this.iconCollisionBox=new T0(xm,mw.members,Va);let i=rh(this.iconSizeData,e),s=rh(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){let c=this.symbolInstances.get(l);this._addTextDebugCollisionBoxes(s,e,n,c.textBoxStartIndex,c.textBoxEndIndex,c),this._addTextDebugCollisionBoxes(s,e,n,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c),this._addIconDebugCollisionBoxes(i,e,n,c.iconBoxStartIndex,c.iconBoxEndIndex,c),this._addIconDebugCollisionBoxes(i,e,n,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c)}}getSymbolInstanceTextSize(e,n,i,s){let l=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:s),c=Wm(this.textSizeData,e,l)/Cr;return this.tilePixelRatio*c}getSymbolInstanceIconSize(e,n,i){let s=this.icon.placedSymbolArray.get(i),l=Wm(this.iconSizeData,e,s);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,n,i,s){e.emplaceBack(n,-i,-i,s),e.emplaceBack(n,i,-i,s),e.emplaceBack(n,i,i,s),e.emplaceBack(n,-i,i,s)}_updateTextDebugCollisionBoxes(e,n,i,s,l,c){for(let p=s;p<l;p++){let m=i.get(p),x=this.getSymbolInstanceTextSize(e,c,n,p);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,m.padding,c.zOffset)}}_updateIconDebugCollisionBoxes(e,n,i,s,l,c){for(let p=s;p<l;p++){let m=i.get(p),x=this.getSymbolInstanceIconSize(e,n,c.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,m.padding,c.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let i=rh(this.iconSizeData,e),s=rh(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){let c=this.symbolInstances.get(l);this._updateTextDebugCollisionBoxes(s,e,n,c.textBoxStartIndex,c.textBoxEndIndex,c),this._updateTextDebugCollisionBoxes(s,e,n,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c),this._updateIconDebugCollisionBoxes(i,e,n,c.iconBoxStartIndex,c.iconBoxEndIndex,c),this._updateIconDebugCollisionBoxes(i,e,n,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,i,s,l,c,p,m,x){let w={};if(n<i){let{x1:E,y1:D,x2:S,y2:A,padding:R,projectedAnchorX:O,projectedAnchorY:z,projectedAnchorZ:W,tileAnchorX:X,tileAnchorY:Y,featureIndex:re}=e.get(n);w.textBox={x1:E,y1:D,x2:S,y2:A,padding:R,projectedAnchorX:O,projectedAnchorY:z,projectedAnchorZ:W,tileAnchorX:X,tileAnchorY:Y},w.textFeatureIndex=re}if(s<l){let{x1:E,y1:D,x2:S,y2:A,padding:R,projectedAnchorX:O,projectedAnchorY:z,projectedAnchorZ:W,tileAnchorX:X,tileAnchorY:Y,featureIndex:re}=e.get(s);w.verticalTextBox={x1:E,y1:D,x2:S,y2:A,padding:R,projectedAnchorX:O,projectedAnchorY:z,projectedAnchorZ:W,tileAnchorX:X,tileAnchorY:Y},w.verticalTextFeatureIndex=re}if(c<p){let{x1:E,y1:D,x2:S,y2:A,padding:R,projectedAnchorX:O,projectedAnchorY:z,projectedAnchorZ:W,tileAnchorX:X,tileAnchorY:Y,featureIndex:re}=e.get(c);w.iconBox={x1:E,y1:D,x2:S,y2:A,padding:R,projectedAnchorX:O,projectedAnchorY:z,projectedAnchorZ:W,tileAnchorX:X,tileAnchorY:Y},w.iconFeatureIndex=re}if(m<x){let{x1:E,y1:D,x2:S,y2:A,padding:R,projectedAnchorX:O,projectedAnchorY:z,projectedAnchorZ:W,tileAnchorX:X,tileAnchorY:Y,featureIndex:re}=e.get(m);w.verticalIconBox={x1:E,y1:D,x2:S,y2:A,padding:R,projectedAnchorX:O,projectedAnchorY:z,projectedAnchorZ:W,tileAnchorX:X,tileAnchorY:Y},w.verticalIconFeatureIndex=re}return w}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let i=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let i=e.placedSymbolArray.get(n),s=i.vertexStartIndex+4*i.numGlyphs;for(let l=i.vertexStartIndex;l<s;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),i=Math.cos(e),s=[],l=[],c=[];for(let p=0;p<this.symbolInstances.length;++p){c.push(p);let m=this.symbolInstances.get(p);s.push(0|Math.round(n*m.tileAnchorX+i*m.tileAnchorY)),l.push(m.featureIndex)}return c.sort((p,m)=>s[p]-s[m]||l[m]-l[p]),c}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===n?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let i=this.symbolInstances.get(n);this.featureSortOrder.push(i.featureIndex);let{rightJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:c,verticalPlacedTextSymbolIndex:p,placedIconSymbolIndex:m,verticalPlacedIconSymbolIndex:x}=i;s>=0&&this.addIndicesForPlacedSymbol(this.text,s),l>=0&&l!==s&&this.addIndicesForPlacedSymbol(this.text,l),c>=0&&c!==l&&c!==s&&this.addIndicesForPlacedSymbol(this.text,c),p>=0&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&this.addIndicesForPlacedSymbol(this.icon,m),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}q(ch,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ch.addDynamicAttributes=ig;class Xi{constructor(e,n,i,s){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(n,s)}update(e,n,i){let{width:s,height:l}=e,{context:c}=this,{gl:p}=c;if(p.bindTexture(p.TEXTURE_2D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA&&(!n||n.premultiply!==!1)),this.useMipmap=!!(n&&n.useMipmap),i||this.size&&this.size[0]===s&&this.size[1]===l){let{x:m,y:x}=i||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)p.texSubImage2D(p.TEXTURE_2D,0,m,x,p.RGBA,p.UNSIGNED_BYTE,e);else{let w=this.format,E=p.UNSIGNED_BYTE;this.format===p.R32F&&(w=p.RED,E=p.FLOAT),p.texSubImage2D(p.TEXTURE_2D,0,m,x,s,l,w,E,e.data)}}else if(this.size=[s,l],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let m=this.format;this.format===p.R8&&(m=p.RED),p.texImage2D(p.TEXTURE_2D,0,this.format,m,p.UNSIGNED_BYTE,e)}else{let m=this.format,x=this.format,w=p.UNSIGNED_BYTE,E=!1;this.format===p.DEPTH_COMPONENT&&(m=p.DEPTH_COMPONENT16,w=p.UNSIGNED_SHORT),this.format===p.DEPTH_STENCIL&&(m=p.DEPTH24_STENCIL8,w=p.UNSIGNED_INT_24_8,E=!0),this.format===p.R8&&(x=p.RED),this.format===p.R32F&&(w=p.FLOAT,x=p.RED),!this.useMipmap&&E?p.texStorage2D(p.TEXTURE_2D,1,m,s,l):p.texImage2D(p.TEXTURE_2D,0,m,s,l,0,x,w,e.data)}this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,n,i=!1){let{context:s}=this,{gl:l}=s;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap&&!i?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,n),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,i,s){let{context:l}=this,{gl:c}=l;c.bindTexture(c.TEXTURE_2D,this.texture),n!==this.magFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),this.wrapS=i),s!==this.wrapT&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,s),this.wrapT=s)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class og{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:i}=this,{gl:s}=i;s.bindTexture(s.TEXTURE_2D,this.texture),e!==this.minFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,n),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,n),this.wrapS=n)}}let Yi=32,Zo=33,Qa=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,i=0,s=0,l=0,c=0,p=0;for(1&e?s=l=c=Yi:n=i=p=Yi;(e>>=1)>1;){let x=n+s>>1,w=i+l>>1;1&e?(s=n,l=i,n=c,i=p):(n=s,i=l,s=c,l=p),c=x,p=w}let m=4*t;Qa[m+0]=n,Qa[m+1]=i,Qa[m+2]=s,Qa[m+3]=l}let Xo=new Uint16Array(2178),Ka=new Uint8Array(1089),sg=new Uint16Array(1089);function aT(t){return t===0?-.03125:t===32?.03125:0}var ag=un([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),aA=un([{name:"a_index",type:"Int16",components:1}]);let lT={type:2,extent:Ye,loadGeometry:()=>[[new tt(0,0),new tt(Ye+1,0),new tt(Ye+1,Ye+1),new tt(0,Ye+1),new tt(0,0)]]};class lg{constructor(e,n,i,s,l){this.tileID=e,this.uid=lu(),this.uses=0,this.tileSize=n,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=l,s&&s.style&&(this._lastUpdatedBrightness=s.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",s&&s.transform&&(this.projection=s.transform.projection)}registerFadeDuration(e){let n=e+this.timeAdded;n<_r.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=mc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,i){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(s,l){let c={};if(!l)return c;for(let p of s){let m=p.layerIds.map(x=>l.getLayer(x)).filter(Boolean);if(m.length!==0){p.layers=m,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(x=>m.filter(w=>w.id===x)[0]));for(let x of m)c[x.fqid]=p}}return c}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let s in this.buckets){let l=this.buckets[s];if(l instanceof ch){if(this.hasSymbolBuckets=!0,!i)break;l.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let s in this.buckets){let l=this.buckets[s];if(l instanceof ch&&l.hasRTLText){this.hasRTLText=!0,Bt.isLoading()||Bt.isLoaded()||Gt()!=="deferred"||Ln();break}}this.queryPadding=0;for(let s in this.buckets){let l=this.buckets[s],c=n.style.getOwnLayer(s);if(!c)continue;let p=c.queryRadius(l);this.queryPadding=Math.max(this.queryPadding,p)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new Iy}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let s in this.buckets){let l=this.buckets[s];l.uploadPending()&&l.upload(e)}let n=e.gl,i=this.imageAtlas;if(i&&!i.uploaded){let s=!!Object.keys(i.patternPositions).length;this.imageAtlasTexture=new Xi(e,i.image,n.RGBA,{useMipmap:s}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Xi(e,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Xi(e,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,n,i){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,i),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let s=n.style.getBrightness();(this._lastUpdatedBrightness||s)&&(this._lastUpdatedBrightness&&s&&Math.abs(this._lastUpdatedBrightness-s)<.001||(this._lastUpdatedBrightness=s,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,i,s,l,c,p,m){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:s,pixelPosMatrix:p,transform:c,params:l,tileTransform:this.tileTransform},e,n,i):{}}querySourceFeatures(e,n){let i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;let s=i.loadVTLayers(),l=n?n.sourceLayer:"",c=s._geojsonTileLayer||s[l];if(!c)return;let p=Dr(n&&n.filter),{z:m,x,y:w}=this.tileID.canonical,E={z:m,x,y:w};for(let D=0;D<c.length;D++){let S=c.feature(D);if(p.needGeometry){let O=ks(S,!0);if(!p.filter(new vt(this.tileID.overscaledZ),O,this.tileID.canonical))continue}else if(!p.filter(new vt(this.tileID.overscaledZ),S))continue;let A=i.getId(S,l),R=new Sw(S,m,x,w,A);R.tile=E,e.push(R)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let i=sd(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let i=Date.now(),s=!1;if(this.expirationTime>i)s=!1;else if(n)if(this.expirationTime<n)s=!0;else{let l=this.expirationTime-n;l?this.expirationTime=i+Math.max(l,3e4):s=!0}else s=!0;s?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;let i=this.latestFeatureIndex.loadVTLayers(),s=n.style.listImages(),l=n.style.getBrightness();for(let c in this.buckets){if(!n.style.hasLayer(c))continue;let p=this.buckets[c],m=p.layers[0].sourceLayer||"_geojsonTileLayer",x=i[m],w={};if(e&&(w=e[m],!x||!w||Object.keys(w).length===0))continue;if(p.update(w,x,s,this.imageAtlas&&this.imageAtlas.patternPositions||{},l),p instanceof Gm||p instanceof km){let D=n.style.getOwnSourceCache(p.layers[0].source);n._terrain&&n._terrain.enabled&&D&&p.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(D.id,this.tileID)}let E=n&&n.style&&n.style.getOwnLayer(c);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_r.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=_r.now()+e}setTexture(e,n){let i=n.context,s=i.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Xi?this.texture.update(e,{useMipmap:!0}):(this.texture=new Xi(i,e,s.RGBA,{useMipmap:!0}),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE))}setDependencies(e,n){let i={};for(let s of n)i[s]=!0;this.dependencies[e]=i}hasDependency(e,n){for(let i of e){let s=this.dependencies[i];if(s){for(let l of n)if(s[l])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;let i=uo(lT,this.tileID.canonical,this.tileTransform)[0],s=new lo,l=new af;for(let c=0;c<i.length;c++){let{x:p,y:m}=i[c];s.emplaceBack(p,m),l.emplaceBack(c)}l.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(l),this._tileDebugBuffer=e.createVertexBuffer(s,ff.members),this._tileDebugSegments=$n.simpleSegment(0,0,s.length,l.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;let i=uo(lT,this.tileID.canonical,this.tileTransform)[0],s,l;if(this.isRaster){let c=function(p,m){let x=mc(p,m),w=Math.pow(2,p.z);for(let O=0;O<Zo;O++)for(let z=0;z<Zo;z++){let W=ii((p.x+(z+aT(z))/Yi)/w),X=xr((p.y+(O+aT(O))/Yi)/w),Y=m.project(W,X),re=O*Zo+z;Xo[2*re+0]=Math.round((Y.x*x.scale-x.x)*Ye),Xo[2*re+1]=Math.round((Y.y*x.scale-x.y)*Ye)}Ka.fill(0),sg.fill(0);for(let O=2045;O>=0;O--){let z=4*O,W=Qa[z+0],X=Qa[z+1],Y=Qa[z+2],re=Qa[z+3],ne=W+Y>>1,ue=X+re>>1,de=ne+ue-X,ve=ue+W-ne,Ce=X*Zo+W,Te=re*Zo+Y,Le=ue*Zo+ne,Ue=Math.hypot((Xo[2*Ce+0]+Xo[2*Te+0])/2-Xo[2*Le+0],(Xo[2*Ce+1]+Xo[2*Te+1])/2-Xo[2*Le+1])>=16;Ka[Le]=Ka[Le]||(Ue?1:0),O<1022&&(Ka[Le]=Ka[Le]||Ka[(X+ve>>1)*Zo+(W+de>>1)]||Ka[(re+ve>>1)*Zo+(Y+de>>1)])}let E=new Fa,D=new pr,S=0;function A(O,z){let W=z*Zo+O;return sg[W]===0&&(E.emplaceBack(Xo[2*W+0],Xo[2*W+1],O*Ye/Yi,z*Ye/Yi),sg[W]=++S),sg[W]-1}function R(O,z,W,X,Y,re){let ne=O+W>>1,ue=z+X>>1;if(Math.abs(O-Y)+Math.abs(z-re)>1&&Ka[ue*Zo+ne])R(Y,re,O,z,ne,ue),R(W,X,Y,re,ne,ue);else{let de=A(O,z),ve=A(W,X),Ce=A(Y,re);D.emplaceBack(de,ve,Ce)}}return R(0,0,Yi,Yi,Yi,0),R(Yi,Yi,0,0,0,Yi),{vertices:E,indices:D}}(this.tileID.canonical,n);s=c.vertices,l=c.indices}else{s=new Fa,l=new pr;for(let{x:p,y:m}of i)s.emplaceBack(p,m,0,0);let c=_f(s.int16,void 0,4);for(let p=0;p<c.length;p+=3)l.emplaceBack(c[p],c[p+1],c[p+2])}this._tileBoundsBuffer=e.createVertexBuffer(s,ag.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(l),this._tileBoundsSegments=$n.simpleSegment(0,0,s.length,l.length)}_makeGlobeTileDebugBuffers(e,n){let i=n.projection;if(!i||i.name!=="globe"||n.freezeTileCoverage)return;let s=this.tileID.canonical,l=mf(fb(s,n)),c=Ns(n.zoom),p;c>0&&(p=o.ad.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,s,n,l,p,c),this._makeGlobeTileDebugTextBuffer(e,s,n,l,p,c)}_globePoint(e,n,i,s,l,c,p){let m=pf(e,n,i);if(c){let x=1<<i.z,w=$o(s.center.lng),E=Ho(s.center.lat),D=(i.x+.5)/x-w,S=0;D>.5?S=-1:D<-.5&&(S=1);let A=(e/Ye+i.x)/x+S,R=(n/Ye+i.y)/x;A=(A-w)*s._pixelsPerMercatorPixel+w,R=(R-E)*s._pixelsPerMercatorPixel+E;let O=[A*s.worldSize,R*s.worldSize,0];o._.transformMat4(O,O,c),m=Fs(m,O,p)}return o._.transformMat4(m,m,l)}_makeGlobeTileDebugBorderBuffer(e,n,i,s,l,c){let p=new lo,m=new af,x=new gm,w=(D,S,A,R,O)=>{let z=(A-D)/(O-1),W=(R-S)/(O-1),X=p.length;for(let Y=0;Y<O;Y++){let re=D+Y*z,ne=S+Y*W;p.emplaceBack(re,ne);let ue=this._globePoint(re,ne,n,i,s,l,c);x.emplaceBack(ue[0],ue[1],ue[2]),m.emplaceBack(X+Y)}},E=Ye;w(0,0,E,0,16),w(E,0,E,E,16),w(E,E,0,E,16),w(0,E,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(m),this._tileDebugBuffer=e.createVertexBuffer(p,ff.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(x,hb.members),this._tileDebugSegments=$n.simpleSegment(0,0,p.length,m.length)}_makeGlobeTileDebugTextBuffer(e,n,i,s,l,c){let p=Ye/4,m=new lo,x=new pr,w=new gm,E=25;x.reserve(32),m.reserve(E),w.reserve(E);let D=(S,A)=>E*S+A;for(let S=0;S<E;S++){let A=S*p;for(let R=0;R<E;R++){let O=R*p;m.emplaceBack(O,A);let z=this._globePoint(O,A,n,i,s,l,c);w.emplaceBack(z[0],z[1],z[2])}}for(let S=0;S<4;S++)for(let A=0;A<4;A++){let R=D(S,A),O=D(S,A+1),z=D(S+1,A),W=D(S+1,A+1);x.emplaceBack(R,O,z),x.emplaceBack(z,O,W)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(x),this._tileDebugTextBuffer=e.createVertexBuffer(m,ff.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(w,hb.members),this._tileDebugTextSegments=$n.simpleSegment(0,0,E,32)}destroy(e=!1){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof Xi&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function lA(t,e,n){t===1?e.header_length=n.readFixed32():t===2?e.x=n.readVarint():t===3?e.y=n.readVarint():t===4?e.z=n.readVarint():t===5&&e.layers.push(function(i,s){return i.readFields(fA,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},s)}(n,n.readVarint()+n.pos))}function cA(t,e,n){t===1?(e.delta_filter=function(i,s){return i.readFields(uA,{block_size:0},s)}(n,n.readVarint()+n.pos),e.filter="delta_filter"):t===2?(n.readVarint(),e.filter="zigzag_filter"):t===3?(n.readVarint(),e.filter="bitshuffle_filter"):t===4&&(n.readVarint(),e.filter="byteshuffle_filter")}function uA(t,e,n){t===1&&(e.block_size=n.readVarint())}function hA(t,e,n){t===1?(n.readVarint(),e.codec="gzip_data"):t===2?(n.readVarint(),e.codec="jpeg_image"):t===3?(n.readVarint(),e.codec="webp_image"):t===4&&(n.readVarint(),e.codec="png_image")}function dA(t,e,n){t===1?e.first_byte=n.readFixed64():t===2?e.last_byte=n.readFixed64():t===3?e.filters.push(function(i,s){return i.readFields(cA,{},s)}(n,n.readVarint()+n.pos)):t===4?e.codec=function(i,s){return i.readFields(hA,{},s)}(n,n.readVarint()+n.pos):t===5?e.offset=n.readFloat():t===6?e.scale=n.readFloat():t===7&&e.bands.push(n.readString())}function fA(t,e,n){t===1?e.version=n.readVarint():t===2?e.name=n.readString():t===3?e.units=n.readString():t===4?e.tilesize=n.readVarint():t===5?e.buffer=n.readVarint():t===6?e.pixel_format=n.readVarint():t===7&&e.data_index.push(function(i,s){return i.readFields(dA,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},s)}(n,n.readVarint()+n.pos))}function pA(t,e,n){if(t===2)(function(i,s,l){i.readFields(mA,l,s)})(n,n.readVarint()+n.pos,e);else if(t===3)throw new Error("Not implemented")}function mA(t,e,n){if(t===1){let i=0,s=n.readVarint()+n.pos;for(;n.pos<s;)e[i++]=n.readVarint()}}class gA{constructor(e=0,n=0,i=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=i,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let n=this.items[e];delete this.items[e],this.size--,n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){let n=this.first;delete this.items[n.key],--this.size==0?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){let i=this.items[e];this.ttl>0&&i.expiry<=Date.now()?this.delete(e):(n=i.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){let e=[],n=this.first;for(;n!==null;)e.push(n.key),n=n.next;return e}set(e,n,i=!1,s=this.resetTtl){let l;if(i||this.has(e)){if(l=this.items[e],l.value=n,i===!1&&s&&(l.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==l){let c=this.last,p=l.next,m=l.prev;this.first===l&&(this.first=l.next),l.next=null,l.prev=this.last,c.next=l,m!==null&&(m.next=p),p!==null&&(p.prev=m)}}else this.max>0&&this.size===this.max&&this.evict(!0),l=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},++this.size==1?this.first=l:this.last.next=l;return this.last=l,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function _A(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let i=2;i>=1;i--){let s=i===1?1:0,l=i===2?1:0;for(let c=0;c<e[0];c++){let p=e[1]*c;for(let m=s;m<e[1];m++){let x=e[2]*(m+p);for(let w=l;w<e[2];w++){let E=e[3]*(w+x);for(let D=0;D<e[3];D++){let S=E+D;t[S]+=t[S-n]}}}}n*=e[i]}return t}function yA(t){for(let e=0,n=t.length;e<n;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function xA(t,e){switch(e){case"uint32":return t;case"uint16":for(let n=0;n<t.length;n+=2){let i=t[n],s=t[n+1];t[n]=(240&i)>>4|(61440&i)>>8|(240&s)<<4|61440&s,t[n+1]=15&i|(3840&i)>>4|(15&s)<<8|(3840&s)<<4}return t;case"uint8":for(let n=0;n<t.length;n+=4){let i=t[n],s=t[n+1],l=t[n+2],c=t[n+3];t[n+0]=(192&i)>>6|(192&s)>>4|(192&l)>>2|192&c,t[n+1]=(48&i)>>4|(48&s)>>2|48&l|(48&c)<<2,t[n+2]=(12&i)>>2|12&s|(12&l)<<2|(12&c)<<4,t[n+3]=3&i|(3&s)<<2|(3&l)<<4|(3&c)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Ja extends Error{constructor(e){super(e),this.name="MRTError"}}var Li=Uint8Array,uh=Uint16Array,vA=Int32Array,cT=new Li([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),uT=new Li([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),bA=new Li([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),hT=function(t,e){for(var n=new uh(31),i=0;i<31;++i)n[i]=e+=1<<t[i-1];var s=new vA(n[30]);for(i=1;i<30;++i)for(var l=n[i];l<n[i+1];++l)s[l]=l-n[i]<<5|i;return{b:n,r:s}},dT=hT(cT,2),fT=dT.b,wA=dT.r;fT[28]=258,wA[258]=28;for(var TA=hT(uT,0).b,E0=new uh(32768),or=0;or<32768;++or){var hh=(43690&or)>>1|(21845&or)<<1;E0[or]=((65280&(hh=(61680&(hh=(52428&hh)>>2|(13107&hh)<<2))>>4|(3855&hh)<<4))>>8|(255&hh)<<8)>>1}var Lf=function(t,e,n){for(var i=t.length,s=0,l=new uh(e);s<i;++s)t[s]&&++l[t[s]-1];var c,p=new uh(e);for(s=1;s<e;++s)p[s]=p[s-1]+l[s-1]<<1;if(n){c=new uh(1<<e);var m=15-e;for(s=0;s<i;++s)if(t[s])for(var x=s<<4|t[s],w=e-t[s],E=p[t[s]-1]++<<w,D=E|(1<<w)-1;E<=D;++E)c[E0[E]>>m]=x}else for(c=new uh(i),s=0;s<i;++s)t[s]&&(c[s]=E0[p[t[s]-1]++]>>15-t[s]);return c},Of=new Li(288);for(or=0;or<144;++or)Of[or]=8;for(or=144;or<256;++or)Of[or]=9;for(or=256;or<280;++or)Of[or]=7;for(or=280;or<288;++or)Of[or]=8;var pT=new Li(32);for(or=0;or<32;++or)pT[or]=5;var EA=Lf(Of,9,1),IA=Lf(pT,5,1),I0=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},mo=function(t,e,n){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(7&e)&n},D0=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},DA=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],go=function(t,e,n){var i=new Error(e||DA[t]);if(i.code=t,Error.captureStackTrace&&Error.captureStackTrace(i,go),!n)throw i;return i},MA=new Li(0),CA=typeof TextDecoder<"u"&&new TextDecoder;try{CA.decode(MA,{stream:!0})}catch{}let SA={gzip_data:"gzip"},AA={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},PA={uint32:1,uint16:2,uint8:4},RA={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class M0{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let n=new Uint8Array(e),i=new DataView(e);if(n[0]!==13)throw new Ja("File is not a valid MRT.");return i.getUint32(1,!0)}parseHeader(e){let n=new Uint8Array(e),i=this.getHeaderLength(e);if(n.length<i)throw new Ja(`Expected header with length >= ${i} but got buffer of length ${n.length}`);let s=function(l,c){return l.readFields(lA,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new nh(n.subarray(0,i)));if(!isNaN(this.x)&&(this.x!==s.x||this.y!==s.y||this.z!==s.z))throw new Ja(`Invalid attempt to parse header ${s.z}/${s.x}/${s.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=s.x,this.y=s.y,this.z=s.z;for(let l of s.layers)this.layers[l.name]=new LA(l,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let n=[],i=this.getLayer(e.layerName);for(let s=0;s<i.dataIndex.length;s++){let l=i.dataIndex[s],c=l.first_byte-e.firstByte,p=l.last_byte+1-e.firstByte;if(s<e.firstBlock||s>e.lastBlock||i._blocksInProgress.has(s))continue;let m={layerName:i.name,firstByte:c,lastByte:p,pixelFormat:i.pixelFormat,blockIndex:s,blockShape:[l.bands.length].concat(i.bandShape),buffer:i.buffer,codec:l.codec.codec,filters:l.filters.map(x=>x.filter)};i._blocksInProgress.add(s),n.push(m)}return new mT(n,()=>{n.forEach(s=>i._blocksInProgress.delete(s.blockIndex))},(s,l)=>{if(n.forEach(c=>i._blocksInProgress.delete(c.blockIndex)),s)throw s;l.forEach(c=>{this.getLayer(c.layerName).processDecodedData(c)})})}}class LA{constructor({version:e,name:n,units:i,tilesize:s,pixel_format:l,buffer:c,data_index:p},m){if(this.version=e,this.version!==1)throw new Ja(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=i,this.tileSize=s,this.buffer=c,this.pixelFormat=AA[l],this.dataIndex=p,this.bandShape=[s+2*c,s+2*c,PA[this.pixelFormat]],this._decodedBlocks=function(x=1e3,w=0,E=!1){if(isNaN(x)||x<0)throw new TypeError("Invalid max value");if(isNaN(w)||w<0)throw new TypeError("Invalid ttl value");if(typeof E!="boolean")throw new TypeError("Invalid resetTtl value");return new gA(x,w,E)}(m?m.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(let[i,s]of this.dataIndex.entries()){for(let[l,c]of s.bands.entries())if(c===e)return{bandIndex:n+l,blockIndex:i,blockBandIndex:l};n+=s.bands.length}break;case"number":for(let[i,s]of this.dataIndex.entries()){if(e>=n&&e<n+s.bands.length)return{bandIndex:e,blockIndex:i,blockBandIndex:e-n};n+=s.bands.length}break;default:throw new Ja(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Ja(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,i=-1/0,s=1/0,l=-1/0;for(let c of e){let{blockIndex:p}=this.getBlockForBand(c);if(p<0)throw new Ja(`Invalid band: ${JSON.stringify(c)}`);let m=this.dataIndex[p];s=Math.min(s,p),l=Math.max(l,p),n=Math.min(n,m.first_byte),i=Math.max(i,m.last_byte)}return{layerName:this.name,firstByte:n,lastByte:i,firstBlock:s,lastBlock:l}}hasBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){let{blockIndex:n,blockBandIndex:i}=this.getBlockForBand(e),s=this._decodedBlocks.get(n.toString());if(!s)throw new Ja(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let l=this.dataIndex[n],c=this.bandShape.reduce((x,w)=>x*w,1),p=i*c,m=s.subarray(p,p+c);return{data:m,bytes:new Uint8Array(m.buffer).subarray(m.byteOffset,m.byteOffset+m.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:l.offset,scale:l.scale}}}class mT{constructor(e,n,i){this.tasks=e,this._onCancel=n,this._onComplete=i,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}M0.performDecoding=function(t,e){return Promise.all(e.tasks.map(n=>{let{layerName:i,firstByte:s,lastByte:l,pixelFormat:c,blockShape:p,blockIndex:m,filters:x,codec:w}=n,E=new Uint8Array(t).subarray(s,l+1),D=new Uint32Array(p[0]*p[1]*p[2]),S;if(w!=="gzip_data")throw new Error(`Unhandled codec: ${w}`);return S=function(A,R){if(!globalThis.DecompressionStream&&R==="gzip_data")return Promise.resolve(((X=function(ne){ne[0]==31&&ne[1]==139&&ne[2]==8||go(6,"invalid gzip data");var ue=ne[3],de=10;4&ue&&(de+=2+(ne[10]|ne[11]<<8));for(var ve=(ue>>3&1)+(ue>>4&1);ve>0;ve-=!ne[de++]);return de+(2&ue)}(W=A))+8>W.length&&go(6,"invalid gzip data"),function(ne,ue,de,ve){var Ce=ne.length;if(!Ce||ue.f&&!ue.l)return de||new Li(0);var Te=!de,Le=Te||ue.i!=2,Ue=ue.i;Te&&(de=new Li(3*Ce));var Pe,Be,Se=function(tl){var nl=de.length;if(tl>nl){var vc=new Li(Math.max(2*nl,tl));vc.set(de),de=vc}},Ve=ue.f||0,He=ue.p||0,je=ue.b||0,rt=ue.l,Ge=ue.d,We=ue.m,dt=ue.n,ht=8*Ce;do{if(!rt){Ve=mo(ne,He,1);var ct=mo(ne,He+1,3);if(He+=3,!ct){var qe=ne[(Yt=4+((He+7)/8|0))-4]|ne[Yt-3]<<8,ft=Yt+qe;if(ft>Ce){Ue&&go(0);break}Le&&Se(je+qe),de.set(ne.subarray(Yt,ft),je),ue.b=je+=qe,ue.p=He=8*ft,ue.f=Ve;continue}if(ct==1)rt=EA,Ge=IA,We=9,dt=5;else if(ct==2){var At=mo(ne,He,31)+257,xt=mo(ne,He+10,15)+4,kt=At+mo(ne,He+5,31)+1;He+=14;for(var Pt=new Li(kt),Vt=new Li(19),_t=0;_t<xt;++_t)Vt[bA[_t]]=mo(ne,He+3*_t,7);He+=3*xt;var xn=I0(Vt),_n=(1<<xn)-1,on=Lf(Vt,xn,1);for(_t=0;_t<kt;){var Yt,sn=on[mo(ne,He,_n)];if(He+=15&sn,(Yt=sn>>4)<16)Pt[_t++]=Yt;else{var An=0,Tn=0;for(Yt==16?(Tn=3+mo(ne,He,3),He+=2,An=Pt[_t-1]):Yt==17?(Tn=3+mo(ne,He,7),He+=3):Yt==18&&(Tn=11+mo(ne,He,127),He+=7);Tn--;)Pt[_t++]=An}}var qn=Pt.subarray(0,At),Hn=Pt.subarray(At);We=I0(qn),dt=I0(Hn),rt=Lf(qn,We,1),Ge=Lf(Hn,dt,1)}else go(1);if(He>ht){Ue&&go(0);break}}Le&&Se(je+131072);for(var Fr=(1<<We)-1,Kn=(1<<dt)-1,Un=He;;Un=He){var ar=(An=rt[D0(ne,He)&Fr])>>4;if((He+=15&An)>ht){Ue&&go(0);break}if(An||go(2),ar<256)de[je++]=ar;else{if(ar==256){Un=He,rt=null;break}var vr=ar-254;ar>264&&(vr=mo(ne,He,(1<<(Qr=cT[_t=ar-257]))-1)+fT[_t],He+=Qr);var br=Ge[D0(ne,He)&Kn],Cn=br>>4;if(br||go(3),He+=15&br,Hn=TA[Cn],Cn>3){var Qr=uT[Cn];Hn+=D0(ne,He)&(1<<Qr)-1,He+=Qr}if(He>ht){Ue&&go(0);break}Le&&Se(je+131072);var Vs=je+vr;if(je<Hn){var Qi=0-Hn,yo=Math.min(Hn,Vs);for(Qi+je<0&&go(3);je<yo;++je)de[je]=(void 0)[Qi+je]}for(;je<Vs;++je)de[je]=de[je-Hn]}}ue.l=rt,ue.p=Un,ue.b=je,ue.f=Ve,rt&&(Ve=1,ue.m=We,ue.d=Ge,ue.n=dt)}while(!Ve);return je!=de.length&&Te?(Pe=de,((Be=je)==null||Be>Pe.length)&&(Be=Pe.length),new Li(Pe.subarray(0,Be))):de.subarray(0,je)}(W.subarray(X,-8),{i:2},new Li(((O=W)[(z=O.length)-4]|O[z-3]<<8|O[z-2]<<16|O[z-1]<<24)>>>0))));var O,z,W,X;let Y=SA[R];if(!Y)throw new Error(`Unhandled codec: ${R}`);let re=new globalThis.DecompressionStream(Y);return new Response(new Blob([A]).stream().pipeThrough(re)).arrayBuffer().then(ne=>new Uint8Array(ne))}(E,w).then(A=>(function(R,O){R.readFields(pA,O)}(new nh(A),D),new RA[c](D.buffer))),S.then(A=>{for(let R=x.length-1;R>=0;R--)switch(x[R]){case"delta_filter":_A(A,p);break;case"zigzag_filter":yA(A);break;case"bitshuffle_filter":xA(A,c);break;default:throw new Error(`Unhandled filter "${x[R]}"`)}return{layerName:i,blockIndex:m,data:A}}).catch(A=>{throw A})}))};class gT extends lg{constructor(e,n,i,s,l){super(e,n,i,s,l),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,n){let i=n.context,s=i.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Xi?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new Xi(i,e,s.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,n){let i=this._mrt=new M0(30),s=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=zo(s,(l,c,p,m)=>{if(l)n(l);else try{let x=i.getHeaderLength(c);if(x>e)return void(this.request=this.fetchHeader(x,n));i.parseHeader(c),this._isHeaderLoaded=!0;let w=0;for(let E of Object.values(i.layers))w=Math.max(w,E.dataIndex[E.dataIndex.length-1].last_byte);c.byteLength>=w&&(this.entireBuffer=c),n(null,this.entireBuffer||c,p,m)}catch(x){n(x)}}),this.request}fetchBand(e,n,i){let s=this._mrt;if(!this._isHeaderLoaded||!s)return void i(new Error("Tile header is not ready"));let l=this.actor;if(!l)return void i(new Error("Can't fetch tile band without an actor"));let c,p=(E,D)=>{c.complete(E,D),E?i(E):(this.updateTextureDescriptor(e,n),i(null,this.textureDescriptor&&this.textureDescriptor.img))},m=(E,D)=>{if(E)return i(E);let S=l.send("decodeRasterArray",{buffer:D,task:c},p,void 0,!0);this._workQueue.push(()=>{S&&S.cancel(),c.cancel()})},x=s.getLayer(e);if(!x)return void i(new Error(`Unknown sourceLayer "${e}"`));if(x.hasDataForBand(n))return this.updateTextureDescriptor(e,n),void i(null,this.textureDescriptor?this.textureDescriptor.img:null);let w=x.getDataRange([n]);if(c=s.createDecodingTask(w),!c||c.tasks.length)if(this.flushQueues(),this.entireBuffer)m(null,this.entireBuffer.slice(w.firstByte,w.lastByte+1));else{let E=Object.assign({},this.requestParams,{headers:{Range:`bytes=${w.firstByte}-${w.lastByte}`}}),D=zo(E,m);this._fetchQueue.push(()=>{D.cancel(),c.cancel()})}else i(null)}updateNeeded(e,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,n){if(!this._mrt)return;let i=this._mrt.getLayer(e);if(!i||!i.hasBand(n)||!i.hasDataForBand(n))return;let{bytes:s,tileSize:l,buffer:c,offset:p,scale:m}=i.getBandView(n),x=l+2*c,w={data:s,width:x,height:x},E=this.texture;E&&E instanceof Xi&&E.update(w,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:n,img:w,buffer:c,offset:p,tileSize:l,format:i.pixelFormat,mix:[m,256*m,65536*m,16777216*m]}}}class OA{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,i){let s=e.wrapped().key;this.data[s]===void 0&&(this.data[s]=[]);let l={value:n,timeout:void 0};if(i!==void 0&&(l.timeout=setTimeout(()=>{this.remove(e,l)},i)),this.data[s].push(l),this.order.push(s),this.order.length>this.max){let c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let i=e.wrapped().key,s=n===void 0?0:this.data[i].indexOf(n),l=this.data[i][s];return this.data[i].splice(s,1),l.timeout&&clearTimeout(l.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(l.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let i in this.data)for(let s of this.data[i])e(s.value)||n.push(s);for(let i of n)this.remove(i.value.tileID,i)}}class gc extends xs{constructor(e,n,i){super(),this.id=e,this._onlySymbols=i,n.on("data",s=>{s.dataType==="source"&&s.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&s.dataType==="source"&&s.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new OA(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new S2,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let i=this._tiles[n];i.upload(e),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return td(this._tiles).map(e=>e.tileID).sort(_T).map(e=>e.key)}getRenderableIds(e,n){let i=[];for(let s in this._tiles)this._isIdRenderable(+s,e,n)&&i.push(this._tiles[s]);return e?i.sort((s,l)=>{let c=s.tileID,p=l.tileID,m=new tt(c.canonical.x,c.canonical.y)._rotate(this.transform.angle),x=new tt(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return c.overscaledZ-p.overscaledZ||x.y-m.y||x.x-m.x}).map(s=>s.tileID.key):i.map(s=>s.tileID).sort(_T).map(s=>s.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(i||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){let i=this._tiles[e];i&&(i.state!=="loading"&&(i.state=n),this._loadTile(i,this._tileLoaded.bind(this,i,e,n)))}_tileLoaded(e,n,i,s){if(s)if(e.state="errored",s.status!==404)this._source.fire(new ro(s,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new ei("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let l=this.map.painter.terrain;this.update(this.transform,l.getScaledDemTileSize(),!0),l.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=_r.now(),i==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new ei("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let n=this.getRenderableIds();for(let s=0;s<n.length;s++){let l=n[s];if(e.neighboringTiles&&e.neighboringTiles[l]){let c=this.getTileByID(l);i(e,c),i(c,e)}}function i(s,l){if(!s.dem||s.dem.borderReady)return;s.needsHillshadePrepare=!0,s.needsDEMTextureUpload=!0;let c=l.tileID.canonical.x-s.tileID.canonical.x,p=l.tileID.canonical.y-s.tileID.canonical.y,m=Math.pow(2,s.tileID.canonical.z),x=l.tileID.key;c===0&&p===0||Math.abs(p)>1||(Math.abs(c)>1&&(Math.abs(c+m)===1?c+=m:Math.abs(c-m)===1&&(c-=m)),l.dem&&s.dem&&(s.dem.backfillBorder(l.dem,c,p),s.neighboringTiles&&s.neighboringTiles[x]&&(s.neighboringTiles[x].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,i,s){for(let l in this._tiles){let c=this._tiles[l];if(s[l]||!c.hasData()||c.tileID.overscaledZ<=n||c.tileID.overscaledZ>i)continue;let p=c.tileID;for(;c&&c.tileID.overscaledZ>n+1;){let x=c.tileID.scaledTo(c.tileID.overscaledZ-1);c=this._tiles[x.key],c&&c.hasData()&&(p=x)}let m=p;for(;m.overscaledZ>n;)if(m=m.scaledTo(m.overscaledZ-1),e[m.key]){s[p.key]=p;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=n?i:null}for(let i=e.overscaledZ-1;i>=n;i--){let s=e.scaledTo(i),l=this._getLoadedTile(s);if(l)return l}}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;let i=Math.ceil(e.width/n)+1,s=Math.ceil(e.height/n)+1,l=Math.floor(i*s*5),c=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,l):l,p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(p)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let i={};for(let s in this._tiles){let l=this._tiles[s];l.tileID=l.tileID.unwrapTo(l.tileID.wrap+n),i[l.tileID.key]=l}this._tiles=i;for(let s in this._timers)clearTimeout(this._timers[s]),delete this._timers[s];for(let s in this._tiles)this._setTileReloadTimer(+s,this._tiles[s])}}update(e,n,i,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!i)return;let l;if(this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(m=>new lr(m.canonical.z,m.wrap,m.canonical.z,m.canonical.x,m.canonical.y));else if(this.tileCoverLift!==0){let m=e.clone();m.tileCoverLift=this.tileCoverLift,l=m.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&e.projection.name==="globe"&&(l.push(new lr(1,0,1,0,0)),l.push(new lr(1,0,1,1,0)),l.push(new lr(1,0,1,0,1)),l.push(new lr(1,0,1,1,1)))}else if(l=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){let m=this._source.hasTile.bind(this._source);l=l.filter(x=>m(x))}}else l=[];if(l.length>0&&this.castsShadows&&s&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!C0(this._source.type)){let m=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!i}),x=Math.min(m,this._source.maxzoom),w=e.extendTileCoverForShadows(l,s,x);for(let E of w)this._shadowCasterTiles[E.key]=!0,l.push(E)}let c=this._updateRetainedTiles(l);if(C0(this._source.type)&&l.length!==0){let m={},x={},w=Object.keys(c);for(let D of w){let S=c[D],A=this._tiles[D];if(!A||A.fadeEndTime&&A.fadeEndTime<=_r.now())continue;let R=this.findLoadedParent(S,Math.max(S.overscaledZ-gc.maxOverzooming,this._source.minzoom));R&&(this._addTile(R.tileID),m[R.tileID.key]=R.tileID),x[D]=S}let E=l[l.length-1].overscaledZ;for(let D in this._tiles){let S=this._tiles[D];if(c[D]||!S.hasData())continue;let A=S.tileID;for(;A.overscaledZ>E;){A=A.scaledTo(A.overscaledZ-1);let R=this._tiles[A.key];if(R&&R.hasData()&&x[A.key]){c[D]=S.tileID;break}}}for(let D in m)c[D]||(this._coveredTiles[D]=!0,c[D]=m[D])}for(let m in c)this._tiles[m].clearFadeHold();let p=function(m,x){let w=[];for(let E in m)E in x||w.push(E);return w}(this._tiles,c);for(let m of p){let x=this._tiles[m];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+m)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let n={};if(e.length===0)return n;let i={},s=e.reduce((x,w)=>Math.min(x,w.overscaledZ),1/0),l=e[0].overscaledZ,c=Math.max(l-gc.maxOverzooming,this._source.minzoom),p=Math.max(l+gc.maxUnderzooming,this._source.minzoom),m={};for(let x of e){let w=this._addTile(x);n[x.key]=x,w.hasData()||s<this._source.maxzoom&&(m[x.key]=x)}this._retainLoadedChildren(m,s,p,n);for(let x of e){let w=this._tiles[x.key];if(w.hasData())continue;if(x.canonical.z>=this._source.maxzoom){let D=x.children(this._source.maxzoom)[0],S=this.getTile(D);if(S&&S.hasData()){n[D.key]=D;continue}}else{let D=x.children(this._source.maxzoom);if(n[D[0].key]&&n[D[1].key]&&n[D[2].key]&&n[D[3].key])continue}let E=w.wasRequested();for(let D=x.overscaledZ-1;D>=c;--D){let S=x.scaledTo(D);if(i[S.key]||(i[S.key]=!0,w=this.getTile(S),!w&&E&&(w=this._addTile(S)),w&&(n[S.key]=S,E=w.wasRequested(),w.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],i,s=this._tiles[e].tileID;for(;s.overscaledZ>0;){if(s.key in this._loadedParentTiles){i=this._loadedParentTiles[s.key];break}n.push(s.key);let l=s.scaledTo(s.overscaledZ-1);if(i=this._getLoadedTile(l),i)break;s=l}for(let l of n)this._loadedParentTiles[l]=i}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let i=!!n;if(!i){let s=this.map?this.map.painter:null,l=this._source.tileSize*e.overscaleFactor();n=this._source.type==="raster-array"?new gT(e,l,this.transform.tileZoom,s,this._isRaster):new lg(e,l,this.transform.tileZoom,s,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,i||this._source.fire(new ei("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let i=n.getExpiryTimeout();i&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},i))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,i){let s=[],l=this.transform;if(!l)return s;let c=l.projection.name==="globe",p=$o(l.center.lng);for(let m in this._tiles){let x=this._tiles[m];if(i&&x.clearQueryDebugViz(),x.holdingForFade())continue;let w;if(c){let E=x.tileID.canonical;if(E.z===0){let D=[Math.abs(St(p,...kf(E,-1))-p),Math.abs(St(p,...kf(E,1))-p)];w=[0,2*D.indexOf(Math.min(...D))-1]}else{let D=[Math.abs(St(p,...kf(E,-1))-p),Math.abs(St(p,...kf(E,0))-p),Math.abs(St(p,...kf(E,1))-p)];w=[D.indexOf(Math.min(...D))-1]}}else w=[0];for(let E of w){let D=e.containsTile(x,l,n,E);D&&s.push(D)}}return s}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){let i=this.getRenderableIds(e,n).map(l=>this._tiles[l].tileID),s=this.transform.projection.name==="globe";for(let l of i)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped()),l.expandedProjMatrix=s?this.transform.calculateProjMatrix(l.toUnwrapped(),!1,!0):l.projMatrix;return i}sortCoordinatesByDistance(e){let n=e.slice(),i=this.transform._camera.position,s=this.transform._camera.forward(),l={};for(let c of n){let p=1/(1<<c.canonical.z);l[c.key]=((c.canonical.x+.5)*p+c.wrap-i[0])*s[0]+((c.canonical.y+.5)*p-i[1])*s[1]-i[2]*s[2]}return n.sort((c,p)=>l[c.key]-l[p.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(C0(this._source.type))for(let e in this._tiles){let n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=_r.now())return!0}return!1}setFeatureState(e,n,i){this._state.updateState(e=e||"_geojsonTileLayer",n,i)}removeFeatureState(e,n,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,i)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,i){let s=this._tiles[e];s&&s.setDependencies(n,i)}reloadTilesForDependencies(e,n){for(let i in this._tiles)this._tiles[i].hasDependency(e,n)&&this._reloadTile(+i,"reloading");this._cache.filter(i=>!i.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){let p=()=>{this._sourceLoaded&&(this._source.off("data",p),this._preloadTiles(e,n))};return void this._source.on("data",p)}let i=new Map,s=Array.isArray(e)?e:[e],l=this.map.painter.terrain,c=this.usedForTerrain&&l?l.getScaledDemTileSize():this._source.tileSize;for(let p of s){let m=p.coveringTiles({tileSize:c,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let x of m)i.set(x.key,x);this.usedForTerrain&&p.updateElevation(!1)}$r(Array.from(i.values()),(p,m)=>{let x=new lg(p,this._source.tileSize*p.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(x,w=>{this._source.type==="raster-dem"&&x.dem&&this._backfillDEM(x),m(w,x)})},n)}}function _T(t,e){let n=Math.abs(2*t.wrap)-+(t.wrap<0),i=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||i-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function C0(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function kf(t,e){let n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}gc.maxOverzooming=10,gc.maxUnderzooming=3;let yT=new class extends it{possiblyEvaluate(t,e){return e=new vt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,i){return e=Pr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,i)}}($m.paint.properties["line-width"].specification);function xT(t,e){return e>0?e+2*t:t}yT.useIntegerZoom=!0;let kA=new ln({"symbol-placement":new Oe(be.layout_symbol["symbol-placement"]),"symbol-spacing":new Oe(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Oe(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new it(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Oe(be.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Oe(be.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Oe(be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Oe(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new Oe(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Oe(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new it(be.layout_symbol["icon-size"]),"icon-text-fit":new it(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new it(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new it(be.layout_symbol["icon-image"]),"icon-rotate":new it(be.layout_symbol["icon-rotate"]),"icon-padding":new Oe(be.layout_symbol["icon-padding"]),"icon-keep-upright":new Oe(be.layout_symbol["icon-keep-upright"]),"icon-offset":new it(be.layout_symbol["icon-offset"]),"icon-anchor":new it(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Oe(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Oe(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Oe(be.layout_symbol["text-rotation-alignment"]),"text-field":new it(be.layout_symbol["text-field"]),"text-font":new it(be.layout_symbol["text-font"]),"text-size":new it(be.layout_symbol["text-size"]),"text-max-width":new it(be.layout_symbol["text-max-width"]),"text-line-height":new it(be.layout_symbol["text-line-height"]),"text-letter-spacing":new it(be.layout_symbol["text-letter-spacing"]),"text-justify":new it(be.layout_symbol["text-justify"]),"text-radial-offset":new it(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Oe(be.layout_symbol["text-variable-anchor"]),"text-anchor":new it(be.layout_symbol["text-anchor"]),"text-max-angle":new Oe(be.layout_symbol["text-max-angle"]),"text-writing-mode":new Oe(be.layout_symbol["text-writing-mode"]),"text-rotate":new it(be.layout_symbol["text-rotate"]),"text-padding":new Oe(be.layout_symbol["text-padding"]),"text-keep-upright":new Oe(be.layout_symbol["text-keep-upright"]),"text-transform":new it(be.layout_symbol["text-transform"]),"text-offset":new it(be.layout_symbol["text-offset"]),"text-allow-overlap":new Oe(be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Oe(be.layout_symbol["text-ignore-placement"]),"text-optional":new Oe(be.layout_symbol["text-optional"]),visibility:new Oe(be.layout_symbol.visibility)});var S0={paint:new ln({"icon-opacity":new it(be.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new it(be.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new it(be.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new it(be.paint_symbol["text-emissive-strength"]),"icon-color":new it(be.paint_symbol["icon-color"]),"icon-halo-color":new it(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new it(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new it(be.paint_symbol["icon-halo-blur"]),"icon-translate":new Oe(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new Oe(be.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new it(be.paint_symbol["icon-image-cross-fade"]),"text-opacity":new it(be.paint_symbol["text-opacity"]),"text-occlusion-opacity":new it(be.paint_symbol["text-occlusion-opacity"]),"text-color":new it(be.paint_symbol["text-color"],{runtimeType:ui,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new it(be.paint_symbol["text-halo-color"]),"text-halo-width":new it(be.paint_symbol["text-halo-width"]),"text-halo-blur":new it(be.paint_symbol["text-halo-blur"]),"text-translate":new Oe(be.paint_symbol["text-translate"]),"text-translate-anchor":new Oe(be.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Oe(be.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Oe(be.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Oe(be.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Oe(be.paint_symbol["icon-color-brightness-max"])}),layout:kA};class vT{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ei,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}q(vT,"FormatSectionOverride",{omit:["defaultValue"]});class cg extends Mr{constructor(e,n,i,s){super(e,S0,n,i,s),this._colorAdjustmentMatrix=o.ad.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let i=this.layout.get("text-writing-mode");if(i){let s=[];for(let l of i)s.indexOf(l)<0&&s.push(l);this.layout._values["text-writing-mode"]=s}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,i,s){return this._saturation===e&&this._contrast===n&&this._brightnessMin===i&&this._brightnessMax===s||(this._colorAdjustmentMatrix=function(l,c,p,m){l=ma(l),c=fu(c);let x=o.ad.create(),w=l/3,E=1-2*w,D=[E,w,w,0,w,E,w,0,w,w,E,0,0,0,0,1],S=.5-.5*c,A=m-p;return o.ad.multiply(x,[A,0,0,0,0,A,0,0,0,0,A,0,p,p,p,1],[c,0,0,0,0,c,0,0,0,0,c,0,S,S,S,1]),o.ad.multiply(x,x,D),x}(e,n,i,s),this._saturation=e,this._contrast=n,this._brightnessMin=i,this._brightnessMax=s),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,i,s){let l=this.layout.get(e).evaluate(n,{},i,s),c=this._unevaluatedLayout._values[e];return c.isDataDriven()||F(c.value)||!l?l:function(p,m){return m.replace(/{([^{}]+)}/g,(x,w)=>w in p?String(p[w]):"")}(n.properties,l)}createBucket(e){return new ch(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of S0.paint.overridableProperties){if(!cg.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),i=new vT(n),s=new L(i,n.property.specification,this.scope,this.options),l=null;l=n.value.kind==="constant"||n.value.kind==="source"?new j("source",s):new U("composite",s,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new gn(n.property,l,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,i){return!(!this.layout||n.isDataDriven()||i.isDataDriven())&&cg.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let i=e.get("text-field"),s=S0.paint.properties[n],l=!1,c=p=>{for(let m of p)if(s.overrides&&s.overrides.hasOverride(m))return void(l=!0)};if(i.value.kind==="constant"&&i.value.value instanceof yr)c(i.value.value.sections);else if(i.value.kind==="source"){let p=x=>{l||(x instanceof io&&ir(x.value)===Gi?c(x.value.sections):x instanceof ql?c(x.sections):x.eachChild(p))},m=i.value;m._styleExpression&&p(m._styleExpression.expression)}return l}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,i=[];return e&&i.push("symbolIcon"),n&&i.push("symbolSDF"),i}getDefaultProgramParams(e,n,i){return{config:new cc(this,{zoom:n,lut:i}),overrideFog:!1}}}let FA=new ln({visibility:new Oe(be.layout_background.visibility)});var NA={paint:new ln({"background-color":new Oe(be.paint_background["background-color"]),"background-pattern":new Oe(be.paint_background["background-pattern"]),"background-opacity":new Oe(be.paint_background["background-opacity"]),"background-emissive-strength":new Oe(be.paint_background["background-emissive-strength"])}),layout:FA};let zA=new ln({visibility:new Oe(be.layout_raster.visibility)});var BA={paint:new ln({"raster-opacity":new Oe(be.paint_raster["raster-opacity"]),"raster-color":new dr(be.paint_raster["raster-color"]),"raster-color-mix":new Oe(be.paint_raster["raster-color-mix"]),"raster-color-range":new Oe(be.paint_raster["raster-color-range"]),"raster-hue-rotate":new Oe(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Oe(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Oe(be.paint_raster["raster-brightness-max"]),"raster-saturation":new Oe(be.paint_raster["raster-saturation"]),"raster-contrast":new Oe(be.paint_raster["raster-contrast"]),"raster-resampling":new Oe(be.paint_raster["raster-resampling"]),"raster-fade-duration":new Oe(be.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Oe(be.paint_raster["raster-emissive-strength"]),"raster-array-band":new Oe(be.paint_raster["raster-array-band"]),"raster-elevation":new Oe(be.paint_raster["raster-elevation"])}),layout:zA};function ug(t,e,n,i,s,l,c,p){let m=[t,e,1,n,i,1,s,l,1],x=[c,p,1],w=o.bC.adjoint([],m),[E,D,S]=o._.transformMat3(x,x,w);return o.bC.multiply(m,m,[E,0,0,0,D,0,0,0,S])}function bT(t,e,n,i,s,l,c,p){let m=function(x,w,E,D,S,A,R,O){let z=ug(0,0,1,0,1,1,0,1),W=ug(x,w,E,D,S,A,R,O),X=o.bC.adjoint([],z);return o.bC.multiply(W,W,X)}(t,e,n,i,s,l,c,p);return[m[2]/m[8]/Ye,m[5]/m[8]/Ye]}function hg(t){return[t[0],Math.min(Math.max(t[1],-nr),nr)]}class wT extends xs{constructor(e,n,i,s){super(),this.id=e,this.dispatcher=i,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(s),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new ei("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=_d(this.map._requestManager.transformRequest(this.url,_u.Image),(i,s)=>{this._imageRequest=null,this._loaded=!0,i?this.fire(new ro(i)):s&&(this.image=s instanceof HTMLImageElement?_r.getImageData(s):s,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new og(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ei("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof og||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],i=e[0][1];for(let l of e)l[1]>i&&(i=l[1]),l[1]<n&&(n=l[1]);let s=(i+n)/2;if(s>nr?this.onNorthPole=!0:s<-nr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let l=e.map(kr.fromLngLat);this.tileID=function(c){let p=1/0,m=1/0,x=-1/0,w=-1/0;for(let R of c)p=Math.min(p,R.x),m=Math.min(m,R.y),x=Math.max(x,R.x),w=Math.max(w,R.y);let E=Math.max(x-p,w-m),D=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),S=Math.pow(2,D),A=Math.floor((p+x)/2*S);return A>1&&(A-=1),new hc(D,A,Math.floor((m+w)/2*S))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ei("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let O in this.tiles){let z=this.tiles[O];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let n=mc(new hc(0,0,0),this.map.transform.projection),i=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(O){let z=O[1].x-O[0].x,W=O[1].y-O[0].y,X=O[2].x-O[1].x,Y=O[2].y-O[1].y,re=O[3].x-O[2].x,ne=O[3].y-O[2].y,ue=O[0].x-O[3].x,de=O[0].y-O[3].y,ve=z*Y-X*W,Ce=X*ne-re*Y,Te=re*de-ue*ne,Le=ue*W-z*de;return ve>0&&Ce>0&&Te>0&&Le>0||ve<0&&Ce<0&&Te<0&&Le<0}(i))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let s=mc(this.tileID,this.map.transform.projection),[l,c,p,m]=this.coordinates.map(O=>{let z=s.projection.project(O[0],O[1]);return tT(s,z)._round()});this.perspectiveTransform=bT(l.x,l.y,c.x,c.y,p.x,p.y,m.x,m.y);let x=this._boundsArray=new Fa;x.emplaceBack(l.x,l.y,0,0),x.emplaceBack(c.x,c.y,Ye,0),x.emplaceBack(m.x,m.y,0,Ye),x.emplaceBack(p.x,p.y,Ye,Ye),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(x,ag.members),this.boundsSegments=$n.simpleSegment(0,0,4,2);let w=[],E=function(O){return[hg(O[0]),hg(O[1]),hg(O[2]),hg(O[3])]}(this.coordinates),[D,S,A,R]=function(O){let z=O[0][0],W=z,X=O[0][1],Y=X;for(let re=1;re<O.length;re++)O[re][0]<z?z=O[re][0]:O[re][0]>W&&(W=O[re][0]),O[re][1]<X?X=O[re][1]:O[re][1]>Y&&(Y=O[re][1]);return[z,X,W-z,Y-X]}(E);{let O=new Fa,[z,W,X,Y]=function(Se){let Ve=Se[0].x,He=Ve,je=Se[0].y,rt=je;for(let Ge=1;Ge<Se.length;Ge++)Se[Ge].x<Ve?Ve=Se[Ge].x:Se[Ge].x>He&&(He=Se[Ge].x),Se[Ge].y<je?je=Se[Ge].y:Se[Ge].y>rt&&(rt=Se[Ge].y);return[Ve,je,He-Ve,rt-je]}(i),re=Se=>[(Se.x-z)/X,(Se.y-W)/Y],[ne,ue,de,ve]=i.map(re),Ce=function(Se,Ve,He,je,rt,Ge,We,dt){let ht=ug(0,0,1,0,1,1,0,1),ct=ug(Se,Ve,He,je,rt,Ge,We,dt),qe=o.bC.adjoint([],ct);return o.bC.multiply(ht,ht,qe)}(ne[0],ne[1],ue[0],ue[1],de[0],de[1],ve[0],ve[1]);this.elevatedGlobePerspectiveTransform=bT(ne[0],ne[1],ue[0],ue[1],de[0],de[1],ve[0],ve[1]);let Te=(Se,Ve)=>{w.push(Se.lng);let He=Math.round((Se.lng-D)/A*Ye),je=Math.round((Se.lat-S)/R*Ye),rt=re(Ve),Ge=o._.transformMat3([],[rt[0],rt[1],1],Ce),We=Math.round(Ge[0]/Ge[2]*Ye),dt=Math.round(Ge[1]/Ge[2]*Ye);O.emplaceBack(He,je,We,dt)},Le=i[3].x-i[0].x,Ue=i[3].y-i[0].y,Pe=i[2].x-i[1].x,Be=i[2].y-i[1].y;for(let Se=0;Se<65;Se++){let Ve=Se/64,He=[i[0].x+Ve*Le,i[0].y+Ve*Ue],je=[i[1].x+Ve*Pe,i[1].y+Ve*Be],rt=je[0]-He[0],Ge=je[1]-He[1];for(let We=0;We<65;We++){let dt=We/64,ht={x:He[0]+rt*dt,y:He[1]+Ge*dt,z:0};Te(n.projection.unproject(ht.x,ht.y),ht)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(O,ag.members)}{this.maxLongitudeTriangleSize=0;let O=[],z=new pr,W=(X,Y,re)=>{z.emplaceBack(X,Y,re);let ne=w[X],ue=w[Y],de=w[re],ve=Math.min(Math.min(ne,ue),de),Ce=Math.max(Math.max(ne,ue),de)-ve;Ce>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ce),O.push(ve+Ce/2)};for(let X=0;X<64;X++)for(let Y=0;Y<64;Y++){let re=65*X+Y,ne=re+1,ue=re+65,de=ue+1;W(re,ue,ne),W(ne,ue,de)}[O,z]=function(X,Y){let re=Array.from({length:X.length},(de,ve)=>ve);re.sort((de,ve)=>X[de]-X[ve]);let ne=[],ue=new pr;for(let de=0;de<re.length;de++){let ve=re[de];ne.push(X[ve]);let Ce=3*ve,Te=Ce+1;ue.emplaceBack(Y.uint16[Ce],Y.uint16[Te],Y.uint16[Te+1])}return[ne,ue]}(O,z),this.elevatedGlobeTrianglesCenterLongitudes=O,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(z)}this.elevatedGlobeSegments=$n.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,A/Ye,0,R/Ye,0,0,S,D,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,i=n.gl;!this._dirty||this.texture instanceof og||(this.texture?this.texture.update(this.image):(this.texture=new Xi(n,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;let i=this.elevatedGlobeTrianglesCenterLongitudes,s=(l=e+180)+360*Math.round((i[0]-l)/360);var l;let c=new $n,p=(E,D)=>{c.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:n.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},m=.51*this.maxLongitudeTriangleSize;if(Math.abs(i[0]-s)<=m){let E=du(i,0,i.length,s+m);return E===i.length||p(E,Tp(i,E+1,i.length,s+360-m)-E),c}s<i[0]&&(s+=360);let x=Tp(i,0,i.length,s-m);if(x===i.length)return p(0,i.length),c;p(0,x-0);let w=du(i,x+1,i.length,s+m);return w!==i.length&&p(w,i.length-w),c}}let VA=(Math.pow(256,2)-1)/16907520;class TT extends Mr{constructor(e,n,i,s){super(e,BA,n,i,s),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof wT&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let n=this._transitionablePaint._values["raster-color"].value.expression,[i,s]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(i)&&isNaN(s)||i===this._curRampRange[0]&&s===this._curRampRange[1]||(this.colorRamp=gf({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:i,end:s}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[i,s])}}let jA=new ln({visibility:new Oe(be["layout_raster-particle"].visibility)});var UA={paint:new ln({"raster-particle-array-band":new Oe(be["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Oe(be["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new dr(be["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Oe(be["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Oe(be["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Oe(be["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Oe(be["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:jA};class ET extends Mr{constructor(e,n,i,s){super(e,UA,n,i,s),this._updateColorRamp(),this.lastInvalidatedAt=_r.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=gf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=_r.now()}}class GA extends Mr{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let $A=new ln({visibility:new Oe(be.layout_sky.visibility)});var HA={paint:new ln({"sky-type":new Oe(be.paint_sky["sky-type"]),"sky-atmosphere-sun":new Oe(be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Oe(be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Oe(be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Oe(be.paint_sky["sky-gradient-radius"]),"sky-gradient":new dr(be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Oe(be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Oe(be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Oe(be.paint_sky["sky-opacity"])}),layout:$A};function A0(t,e,n){let i=[0,0,1],s=o.av.identity([]);return o.av.rotateY(s,s,n?-qt(t)+Math.PI:qt(t)),o.av.rotateX(s,s,-qt(e)),o._.transformQuat(i,i,s),o._.normalize(i,i)}var qA={paint:new ln({})};function IT(t,e){let n=dg(t.projection,t.zoom,t.width,t.height),i=function(l,c,p,m,x){let w=new en(p.lng-180*el,p.lat),E=new en(p.lng+180*el,p.lat),D=l.project(w.lng,w.lat),S=l.project(E.lng,E.lat),A=-Math.atan2(S.y-D.y,S.x-D.x),R=kr.fromLngLat(p);R.y=St(R.y,-1+el,1-el);let O=R.toLngLat(),z=l.project(O.lng,O.lat),W=kr.fromLngLat(O);W.x+=el;let X=W.toLngLat(),Y=l.project(X.lng,X.lat),re=CT(Y.x-z.x,Y.y-z.y,A),ne=kr.fromLngLat(O);ne.y+=el;let ue=ne.toLngLat(),de=l.project(ue.lng,ue.lat),ve=CT(de.x-z.x,de.y-z.y,A),Ce=Math.abs(re.x)/Math.abs(ve.y),Te=o.ad.identity([]);o.ad.rotateZ(Te,Te,-A*(1-(x?0:m)));let Le=o.ad.identity([]);return o.ad.scale(Le,Le,[1,1-(1-Ce)*m,1]),Le[4]=-ve.x/ve.y*m,o.ad.rotateZ(Le,Le,A),o.ad.multiply(Le,Te,Le),Le}(t.projection,0,t.center,n,e),s=DT(t);return o.ad.scale(i,i,[s,s,1]),i}function DT(t){let e=t.projection,n=dg(t.projection,t.zoom,t.width,t.height),i=MT(e,t.center),s=MT(e,en.convert(e.center));return Math.pow(2,i*n+(1-n)*s)}function dg(t,e,n,i,s=1/0){let l=t.range;if(!l)return 0;let c=Math.min(s,Math.max(n,i)),p=Math.log(c/1024)/Math.LN2;return Rl(l[0]+p,l[1]+p,e)}let el=1/4e4;function MT(t,e){let n=St(e.lat,-nr,nr),i=new en(e.lng-180*el,n),s=new en(e.lng+180*el,n),l=t.project(i.lng,n),c=t.project(s.lng,n),p=kr.fromLngLat(i),m=kr.fromLngLat(s),x=c.x-l.x,w=c.y-l.y,E=m.x-p.x,D=m.y-p.y,S=Math.sqrt((E*E+D*D)/(x*x+w*w));return Math.log(S)/Math.LN2}function CT(t,e,n){let i=Math.cos(n),s=Math.sin(n);return{x:t*i-e*s,y:t*s+e*i}}function ST(t,e,n){o.ad.identity(t),o.ad.rotateZ(t,t,qt(e[2])),o.ad.rotateX(t,t,qt(e[0])),o.ad.rotateY(t,t,qt(e[1])),o.ad.scale(t,t,n),o.ad.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function fg(t,e,n,i,s,l,c,p){let m=[n[0]-e[0],n[1]-e[1],0],x=[i[0]-e[0],i[1]-e[1],0];if(o._.length(m)<1e-12||o._.length(x)<1e-12)return o.av.identity(t);let w=o._.cross([],m,x);o._.normalize(w,w),o._.subtract(x,i,e),m[2]=(l-s)*p,x[2]=(c-s)*p;let E=m;return o._.cross(E,m,x),o._.normalize(E,E),o.av.rotationTo(t,w,E)}function P0(t,e,n=!1){let i=Ns(e.zoom),s=function(l,c,p){let m=c.worldSize,x=[l[12],l[13],l[14]],w=xr(x[1]/m),E=ii(x[0]/m),D=o.ad.identity([]),S=Yr(1,w)*m,A=Yr(1,0)*m*dc(w,c.zoom),R=1/Xy(m),O=A*R;if(p){let Y=dg(c.projection,c.zoom,c.width,c.height,1024);O=R*c.projection.pixelSpaceConversion(c.center.lat,m,Y)}let z=uc(w,E);o._.add(z,z,o._.scale([],o._.normalize([],z),S*O*x[2]));let W=function(Y){let re=[Y[0],Y[1],Y[2]],ne=[0,1,0],ue=o._.cross([],ne,re);return o._.cross(ne,re,ue),o._.squaredLength(ne)===0&&(ne=[0,1,0],o._.cross(ue,re,ne)),o._.normalize(ue,ue),o._.normalize(ne,ne),o._.normalize(re,re),[ue[0],ue[1],ue[2],0,ne[0],ne[1],ne[2],0,re[0],re[1],re[2],0,Y[0],Y[1],Y[2],1]}(z);o.ad.scale(D,D,[O,O,O*S]),o.ad.translate(D,D,[-x[0],-x[1],-x[2]]);let X=o.ad.multiply([],c.globeMatrix,W);return o.ad.multiply(X,X,D),o.ad.multiply(X,X,l),X}(t,e,n);if(i>0){let l=function(c,p){let m=p.worldSize,x=Yr(1,0)*m*dc(p.center.lat,p.zoom)/Xy(m),w=Yr(1,p.center.lat)*m,E=o.ad.identity([]);return o.ad.rotateY(E,E,qt(p.center.lng)),o.ad.rotateX(E,E,qt(p.center.lat)),o.ad.translate(E,E,[0,0,Xr]),o.ad.scale(E,E,[x,x,x*w]),o.ad.translate(E,E,[p.point.x-.5*m,p.point.y-.5*m,0]),o.ad.multiply(E,E,c),o.ad.multiply(E,p.globeMatrix,E)}(t,e);return function(c,p,m){let x=(A,R,O)=>{let z=o._.length(A),W=o._.length(R),X=Fs(A,R,O);return o._.scale(X,X,1/o._.length(X)*pt(z,W,O))},w=x([c[0],c[1],c[2]],[p[0],p[1],p[2]],m),E=x([c[4],c[5],c[6]],[p[4],p[5],p[6]],m),D=x([c[8],c[9],c[10]],[p[8],p[9],p[10]],m),S=Fs([c[12],c[13],c[14]],[p[12],p[13],p[14]],m);return[w[0],w[1],w[2],0,E[0],E[1],E[2],0,D[0],D[1],D[2],0,S[0],S[1],S[2],1]}(s,l,i)}return s}function AT(t,e,n,i){let s=Vn.projectAabbCorners(i,n),l=Number.MAX_VALUE,c=-1;for(let x=0;x<s.length;++x){let w=s[x];w[0]=(.5*w[0]+.5)*e.width,w[1]=(.5-.5*w[1])*e.height,w[2]<l&&(c=x,l=w[2])}let p=x=>new tt(s[x][0],s[x][1]),m;switch(c){case 0:case 6:m=[p(1),p(5),p(4),p(7),p(3),p(2),p(1)];break;case 1:case 7:m=[p(0),p(4),p(5),p(6),p(2),p(3),p(0)];break;case 3:case 5:m=[p(1),p(0),p(4),p(7),p(6),p(2),p(1)];break;default:m=[p(1),p(5),p(6),p(7),p(3),p(0),p(1)]}if(By(t,m))return l}let WA=un([{name:"a_pos_3f",components:3,type:"Float32"}]),ZA=un([{name:"a_color_3f",components:3,type:"Float32"}]),XA=un([{name:"a_color_4f",components:4,type:"Float32"}]),YA=un([{name:"a_uv_2f",components:2,type:"Float32"}]),QA=un([{name:"a_normal_3f",components:3,type:"Float32"}]),KA=un([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),JA=un([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class pg{constructor(e,n,i,s){this.message=(e?`${e}: `:"")+i,s&&(this.identifier=s),n!=null&&n.__line__&&(this.line=n.__line__)}}function PT(t,e){let n=t.indexOf("://")===-1;try{return new URL(t,n&&e?"http://example.com":void 0),!0}catch{return!1}}class RT{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class LT{constructor(){this.instancedDataArray=new wy,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class R0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,n){}populate(e,n,i,s){this.tileToMeter=Tm(i);let l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:c,id:p,index:m,sourceLayerIndex:x}of e){let w=p??(c.properties&&c.properties.hasOwnProperty("id")?c.properties.id:void 0),E=ks(c,l);if(!this.layers[0]._featureFilter.filter(new vt(this.zoom),E,i))continue;let D={id:w,sourceLayerIndex:x,index:m,geometry:l?E.geometry:uo(c,i,s),properties:c.properties,type:c.type,patterns:{}},S=this.addFeature(D,D.geometry,E);S&&n.featureIndex.insert(c,D.geometry,m,x,this.index,this.instancesPerModel[S].instancedDataArray.length,Ye/32)}this.lookup=null}update(e,n,i,s){for(let l in this.instancesPerModel){let c=this.instancesPerModel[l];for(let p in e)c.idToFeaturesIndex.hasOwnProperty(p)&&(this.evaluate(c.features[c.idToFeaturesIndex[p]],e[p],c,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let i=this.instancesPerModel[n];for(let s of i.features){let l=this.layers[0],c=s.feature,p=this.canonical,m=l.paint.get("model-rotation").evaluate(c,{},p),x=l.paint.get("model-scale").evaluate(c,{},p),w=l.paint.get("model-translation").evaluate(c,{},p);o._.exactEquals(s.rotation,m)&&o._.exactEquals(s.scale,x)&&o._.exactEquals(s.translation,w)||(this.evaluate(s,s.featureStates,i,!0),e=!0)}}return e}updateReplacement(e,n,i){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let s=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(o0(this.activeReplacements,s))return!1;this.activeReplacements=s;let l=!1;for(let c in this.instancesPerModel){let p=this.instancesPerModel[c],m=p.instancedDataArray;for(let x of p.features){let w=x.instancedDataOffset,E=x.instancedDataCount;for(let D=0;D<E;D++){let S=16*(D+w),A=m.float32[S+0];A=A>Ye?A-Ye:A;let R=Math.floor(A),O=m.float32[S+1],z=!1;for(let W of this.activeReplacements)if(!(W.order<i||W.order===1/0)&&W.clipMask&Kb.Model&&!(W.min.x>R||R>W.max.x||W.min.y>O||O>W.max.y)&&(z=$b(Gb(R,O,e.canonical,W.footprintTileId.canonical),W),z))break;m.float32[S]=z?A+Ye:A,l=l||z}}}return l}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let i=this.instancesPerModel[n];i.instancedDataArray.length<0||i.instancedDataArray.length===0||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=e.createVertexBuffer(i.instancedDataArray,KA.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let n in this.instancesPerModel){let i=this.instancesPerModel[n];i.instancedDataArray.length!==0&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,i){let s=this.layers[0],l=s.layout.get("model-id").evaluate(i,{},this.canonical);if(!l)return Qn(`modelId is not evaluated for layer ${s.id} and it is not going to get rendered.`),l;PT(l,!1)&&(this.modelUris.includes(l)||this.modelUris.push(l)),this.instancesPerModel[l]||(this.instancesPerModel[l]=new LT);let c=this.instancesPerModel[l],p=c.instancedDataArray,m=new RT(i,p.length);for(let x of n)for(let w of x){if(w.x<0||w.x>=Ye||w.y<0||w.y>=Ye)continue;let E=(this.lookupDim-1)/Ye,D=this.lookupDim*(w.y*E|0)+w.x*E|0;if(this.lookup){if(this.lookup[D]!==0)continue;this.lookup[D]=1}this.instanceCount++;let S=p.length;p.resize(S+1),c.instancesEvaluatedElevation.push(0),p.float32[16*S]=w.x,p.float32[16*S+1]=w.y}return m.instancedDataCount=c.instancedDataArray.length-m.instancedDataOffset,m.instancedDataCount>0&&(e.id&&(c.idToFeaturesIndex[e.id]=c.features.length),c.features.push(m),this.evaluate(m,{},c,!1)),l}getModelUris(){return this.modelUris}evaluate(e,n,i,s){let l=this.layers[0],c=e.feature,p=this.canonical,m=e.rotation=l.paint.get("model-rotation").evaluate(c,n,p),x=e.scale=l.paint.get("model-scale").evaluate(c,n,p),w=e.translation=l.paint.get("model-translation").evaluate(c,n,p),E=l.paint.get("model-color").evaluate(c,n,p);E.a=l.paint.get("model-color-mix-intensity").evaluate(c,n,p);let D=[];this.maxVerticalOffset<w[2]&&(this.maxVerticalOffset=w[2]),this.maxScale=Math.max(Math.max(this.maxScale,x[0]),Math.max(x[1],x[2])),ST(D,m,x);let S=Math.round(100*E.a)+E.b/1.05;for(let A=0;A<e.instancedDataCount;++A){let R=e.instancedDataOffset+A,O=16*R,z=i.instancedDataArray.float32,W=0;s&&(W=z[O+6]-i.instancesEvaluatedElevation[R]);let X=0|z[O+1];z[O]=(0|z[O])+E.r/1.05,z[O+1]=X+E.g/1.05,z[O+2]=S,z[O+3]=1/(p.z>10?this.tileToMeter:Tm(p,X)),z[O+4]=w[0],z[O+5]=w[1],z[O+6]=w[2]+W,z[O+7]=D[0],z[O+8]=D[1],z[O+9]=D[2],z[O+10]=D[4],z[O+11]=D[5],z[O+12]=D[6],z[O+13]=D[8],z[O+14]=D[9],z[O+15]=D[10],i.instancesEvaluatedElevation[R]=w[2]}}}q(R0,"ModelBucket",{omit:["layers"]}),q(LT,"PerModelAttributes"),q(RT,"ModelFeature");let eP=new ln({visibility:new Oe(be.layout_model.visibility),"model-id":new it(be.layout_model["model-id"])});var tP={paint:new ln({"model-opacity":new Oe(be.paint_model["model-opacity"]),"model-rotation":new it(be.paint_model["model-rotation"]),"model-scale":new it(be.paint_model["model-scale"]),"model-translation":new it(be.paint_model["model-translation"]),"model-color":new it(be.paint_model["model-color"]),"model-color-mix-intensity":new it(be.paint_model["model-color-mix-intensity"]),"model-type":new Oe(be.paint_model["model-type"]),"model-cast-shadows":new Oe(be.paint_model["model-cast-shadows"]),"model-receive-shadows":new Oe(be.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Oe(be.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new it(be.paint_model["model-emissive-strength"]),"model-roughness":new it(be.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new it(be.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Oe(be.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Oe(be.paint_model["model-front-cutoff"])}),layout:eP};let _c=64,dh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function OT(t,e,n,i,s,l,c,p,m,x=!1){let w=n.zoom,E=n.project(i),D=dc(i.lat,w),S=1/D;o.ad.identity(t),o.ad.translate(t,t,[E.x+c[0]*S,E.y+c[1]*S,c[2]]);let A=1,R=1,O=n.worldSize;if(x){if(n.projection.name==="mercator"){let Y=0;n.elevation&&(Y=n.elevation.getAtPointOrZero(new kr(E.x/O,E.y/O),0));let re=o.aA.transformMat4([],[E.x,E.y,Y,1],n.projMatrix)[3]/n.cameraToCenterDistance;A=re,R=re*dc(n.center.lat,w)}else if(n.projection.name==="globe"){let Y=P0(t,n),re=o.ad.multiply([],n.projMatrix,Y),ne=[0,0,0,1];o.aA.transformMat4(ne,ne,re);let ue=ne[3]/n.cameraToCenterDistance,de=Ns(w),ve=n.projection.pixelsPerMeter(i.lat,O)*dc(i.lat,w),Ce=n.projection.pixelsPerMeter(n.center.lat,O)*dc(n.center.lat,w);A=ue/pt(ve,K1(n.center.lat),de),R=ue*D/ve,A*=Ce,R*=Ce}}else A=S;o.ad.scale(t,t,[A,A,R]);let z=[...t],W=e.orientation,X=[];if(ST(X,[W[0]+s[0],W[1]+s[1],W[2]+s[2]],l),o.ad.multiply(t,z,X),p&&n.elevation){let Y=0,re=[];if(m&&n.elevation){Y=function(de,ve,Ce,Te,Le){let Ue=ve.elevation;if(!Ue)return 0;let Pe=Vn.projectAabbCorners(Ce,Te),Be=Yr(1,Le.lat)*ve.worldSize,Se=function(ft,At){let xt=[0,0,1],kt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Pt of kt){let Vt=ft[Pt.corners[0]],_t=ft[Pt.corners[1]],xn=ft[Pt.corners[2]],_n=[_t[0]-Vt[0],_t[1]-Vt[1],At*(_t[2]-Vt[2])],on=o._.cross(_n,_n,[xn[0]-Vt[0],xn[1]-Vt[1],At*(xn[2]-Vt[2])]);o._.normalize(on,on),Pt.dotProductWithUp=o._.dot(on,xt)}return kt.sort((Pt,Vt)=>Pt.dotProductWithUp-Vt.dotProductWithUp),kt[0].corners}(Pe,Be),Ve=Pe[Se[0]],He=Pe[Se[1]],je=Pe[Se[2]],rt=Pe[Se[3]],Ge=Ue.getAtPointOrZero(new kr(Ve[0]/ve.worldSize,Ve[1]/ve.worldSize),0),We=Ue.getAtPointOrZero(new kr(He[0]/ve.worldSize,He[1]/ve.worldSize),0),dt=Ue.getAtPointOrZero(new kr(je[0]/ve.worldSize,je[1]/ve.worldSize),0),ht=Ue.getAtPointOrZero(new kr(rt[0]/ve.worldSize,rt[1]/ve.worldSize),0),ct=(Ge+ht)/2,qe=(We+dt)/2;return ct>qe?We<dt?fg(de,He,rt,Ve,We,ht,Ge,Be):fg(de,je,Ve,rt,dt,Ge,ht,Be):Ge<ht?fg(de,Ve,He,je,Ge,We,dt,Be):fg(de,rt,je,He,ht,dt,We,Be),Math.max(ct,qe)}(re,n,e.aabb,t,i);let ne=o.ad.fromQuat([],re),ue=o.ad.multiply([],ne,X);o.ad.multiply(t,z,ue)}else Y=n.elevation.getAtPointOrZero(new kr(E.x/O,E.y/O),0);Y!==0&&(t[14]+=Y)}}function Ff(t,e,n=!1){t.uploaded||(t.gfxTexture=new Xi(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function nP(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,WA.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,QA.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,YA.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?ZA:XA).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,JA.members,!0)),t.segments=$n.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let i=t.material;i.pbrMetallicRoughness.baseColorTexture&&Ff(i.pbrMetallicRoughness.baseColorTexture,e),i.pbrMetallicRoughness.metallicRoughnessTexture&&Ff(i.pbrMetallicRoughness.metallicRoughnessTexture,e),i.normalTexture&&Ff(i.normalTexture,e),i.occlusionTexture&&Ff(i.occlusionTexture,e,n),i.emissionTexture&&Ff(i.emissionTexture,e)}function L0(t,e,n){if(t.meshes)for(let i of t.meshes)nP(i,e,n);if(t.children)for(let i of t.children)L0(i,e,n)}function mg(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)mg(e)}function O0(t){if(t.meshes)for(let n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let n of t.children)O0(n)}class rP{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class iP{constructor(){this.tasks={},this.taskQueue=[],uu(["process"],this),this.invoker=new rP(this.process),this.nextId=0}add(e,n){let i=this.nextId++,s=function({type:l,isSymbolTile:c,zoom:p}){return p=p||0,l==="message"?0:l!=="maybePrepare"||c?l!=="parseTile"||c?l==="parseTile"&&c?300-p:l==="maybePrepare"&&c?400-p:500:200-p:100-p}(n);if(s===0){try{e()}finally{}return null}return this.tasks[i]={fn:e,metadata:n,priority:s,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(i=>!!this.tasks[i]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let s=0;s<this.taskQueue.length;s++){let l=this.tasks[this.taskQueue[s]];l.priority<n&&(n=l.priority,e=s)}if(e===null)return null;let i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}class kT{constructor(e,n,i){this.target=e,this.parent=n,this.mapId=i,this.callbacks={},this.cancelCallbacks={},uu(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new iP}send(e,n,i,s,l=!1,c){let p=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=c,this.callbacks[p]=i);let m=new Set;return this.target.postMessage({id:p,type:e,hasCallback:!!i,targetMapId:s,mustQueue:l,sourceMapId:this.mapId,data:we(n,m)},m),{cancel:()=>{i&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(e){let n=e.data,i=n.id;if(i&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let s=this.cancelCallbacks[i];delete this.cancelCallbacks[i],s&&s.cancel()}else if(n.mustQueue||Ll()){let s=this.callbacks[i],l=this.scheduler.add(()=>this.processTask(i,n),s&&s.metadata||{type:"message"});l&&(this.cancelCallbacks[i]=l)}else this.processTask(i,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){let i=this.callbacks[e];delete this.callbacks[e],i&&(n.error?i(pe(n.error)):i(null,pe(n.data)))}else{let i=new Set,s=n.hasCallback?(c,p)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:c?we(c):null,data:we(p,i)},i)}:c=>{},l=pe(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,l,s);else if(this.parent.getWorkerSource){let c=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,c[0],l.source,l.scope)[c[1]](l,s)}else s(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let k0=(()=>{class t{constructor(n,i){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=lu();let s=this.workerPool.acquire(this.id);for(let l=0;l<s.length;l++){let c=new t.Actor(s[l],i,this.id);c.name=`Worker ${l}`,this.actors.push(c)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,i,s){$r(this.actors,(l,c)=>{l.send(n,i,c)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=kT,t})();var Nf={workerUrl:"",workerClass:null,workerParams:void 0};function oP(){return Nf.workerClass!=null?new Nf.workerClass:new self.Worker(Nf.workerUrl,Nf.workerParams)}let F0="mapboxgl_preloaded_worker_pool";class zf{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<zf.workerCount;)this.workers.push(new oP);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[F0]}numActive(){return Object.keys(this.active).length}}let Bf;function gg(){return Bf||(Bf=new zf),Bf}zf.workerCount=2;let _g,N0,_o,fh,z0,ph=null;function FT(){return Ll()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:N0||Z.DRACO_URL}function NT(){if(Ll()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(fh)return fh;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return fh=WebAssembly.validate(t)?Z.MESHOPT_SIMD_URL:Z.MESHOPT_URL,fh}let yg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},sP={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Vf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function zT(t,e,n){let i=n.json.bufferViews.length,s=n.buffers.length;e.bufferView=i,n.json.bufferViews[i]={buffer:s,byteLength:t.byteLength},n.buffers[s]=t}let B0="KHR_draco_mesh_compression";function aP(t,e){let n=t.extensions&&t.extensions[B0];if(!n)return;let i=new _o.Decoder,s=UT(e,n.bufferView),l=new _o.Mesh;if(!i.DecodeArrayToMesh(s,s.byteLength,l))throw new Error("Failed to decode Draco mesh");let c=e.json.accessors[t.indices],p=yg[c.componentType],m=c.count*p.BYTES_PER_ELEMENT,x=_o._malloc(m);p===Uint16Array?i.GetTrianglesUInt16Array(l,m,x):i.GetTrianglesUInt32Array(l,m,x),zT(_o.memory.buffer.slice(x,x+m),c,e),_o._free(x);for(let w of Object.keys(n.attributes)){let E=i.GetAttributeByUniqueId(l,n.attributes[w]),D=e.json.accessors[t.attributes[w]],S=sP[D.componentType],A=D.count*Vf[D.type]*yg[D.componentType].BYTES_PER_ELEMENT,R=_o._malloc(A);i.GetAttributeDataArrayForAllPoints(l,E,_o[S],A,R),zT(_o.memory.buffer.slice(R,R+A),D,e),_o._free(R)}i.destroy(),l.destroy(),delete t.extensions[B0]}let xg="EXT_meshopt_compression";function lP(t,e){if(!t.extensions||!t.extensions[xg])return;let n=t.extensions[xg],i=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),s=new Uint8Array(n.count*n.byteStride);z0.decodeGltfBuffer(s,n.count,n.byteStride,i,n.mode,n.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=s.buffer,delete t.extensions[xg]}let BT=1179937895,VT=new TextDecoder("utf8");function jT(t,e){return new URL(t,e).href}function cP(t,e,n,i){return fetch(jT(t.uri,i)).then(s=>s.arrayBuffer()).then(s=>{e.buffers[n]=s})}function UT(t,e){let n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function uP(t,e,n,i){if(t.uri){let s=jT(t.uri,i);return fetch(s).then(l=>l.blob()).then(l=>createImageBitmap(l)).then(l=>{e.images[n]=l})}if(t.bufferView!==void 0){let s=UT(e,t.bufferView),l=new Blob([s],{type:t.mimeType});return createImageBitmap(l).then(c=>{e.images[n]=c})}}function GT(t,e=0,n){let i={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===BT){let w=new Uint32Array(t,e),E=2,D=(w[E++]>>2)-3,S=w[E++]>>2;if(E++,i.json=JSON.parse(VT.decode(w.subarray(E,E+S))),E+=S,E<D){let A=w[E++];E++;let R=e+(E<<2);i.buffers[0]=t.slice(R,R+A)}}else i.json=JSON.parse(VT.decode(new Uint8Array(t,e)));let{buffers:s,images:l,meshes:c,extensionsUsed:p,bufferViews:m}=i.json,x=Promise.resolve();if(s){let w=[];for(let E=0;E<s.length;E++){let D=s[E];D.uri?w.push(cP(D,i,E,n)):i.buffers[E]||(i.buffers[E]=null)}x=Promise.all(w)}return x.then(()=>{let w=[],E=p&&p.includes(B0),D=p&&p.includes(xg);if(E&&w.push(function(){if(!_o)return _g||(_g=function(S){let A,R=null;function O(){A=new Uint8Array(R.buffer)}function z(){throw new Error("Unexpected Draco error.")}let W={a:{a:z,d:function(X,Y,re){return A.copyWithin(X,Y,Y+re)},c:function(X){let Y=A.length,re=Math.max(X>>>0,Math.ceil(1.2*Y)),ne=Math.ceil((re-Y)/65536);try{return R.grow(ne),O(),!0}catch{return!1}},b:z}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(S,W):S.then(X=>X.arrayBuffer()).then(X=>WebAssembly.instantiate(X,W))).then(X=>{let{Rb:Y,Qb:re,P:ne,T:ue,X:de,Ja:ve,La:Ce,Qa:Te,Va:Le,Wa:Ue,eb:Pe,jb:Be,f:Se,e:Ve,yb:He,zb:je,Ab:rt,Bb:Ge,Db:We,Gb:dt}=X.instance.exports;R=Ve;let ht=(()=>{let ct=0,qe=0,ft=0,At=0;return xt=>{ft&&(Y(At),Y(ct),qe+=ft,ft=ct=0),ct||(qe+=128,ct=re(qe));let kt=xt.length+7&-8,Pt=ct;kt>=qe&&(ft=kt,Pt=At=re(kt));for(let Vt=0;Vt<xt.length;Vt++)A[Pt+Vt]=xt[Vt];return Pt}})();return O(),Se(),{memory:Ve,_free:Y,_malloc:re,Mesh:class{constructor(){this.ptr=ne()}destroy(){ue(this.ptr)}},Decoder:class{constructor(){this.ptr=ve()}destroy(){Be(this.ptr)}DecodeArrayToMesh(ct,qe,ft){let At=ht(ct),xt=Ce(this.ptr,At,qe,ft.ptr);return!!de(xt)}GetAttributeByUniqueId(ct,qe){return{ptr:Te(this.ptr,ct.ptr,qe)}}GetTrianglesUInt16Array(ct,qe,ft){Le(this.ptr,ct.ptr,qe,ft)}GetTrianglesUInt32Array(ct,qe,ft){Ue(this.ptr,ct.ptr,qe,ft)}GetAttributeDataArrayForAllPoints(ct,qe,ft,At,xt){Pe(this.ptr,ct.ptr,qe.ptr,ft,At,xt)}},DT_INT8:He(),DT_UINT8:je(),DT_INT16:rt(),DT_UINT16:Ge(),DT_UINT32:We(),DT_FLOAT32:dt()}})}(fetch(FT())),_g.then(S=>{_o=S,_g=void 0}))}()),D&&w.push(function(){if(z0)return;let S=function(A){let R,O=WebAssembly.instantiateStreaming(A,{}).then(X=>{R=X.instance,R.exports.__wasm_call_ctors()}),z={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},W={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:O,supported:!0,decodeGltfBuffer(X,Y,re,ne,ue,de){(function(ve,Ce,Te,Le,Ue,Pe,Be){let Se=ve.exports.sbrk,Ve=Le+3&-4,He=Se(Ve*Ue),je=Se(Pe.length),rt=new Uint8Array(ve.exports.memory.buffer);rt.set(Pe,je);let Ge=Ce(He,Le,Ue,je,Pe.length);if(Ge===0&&Be&&Be(He,Ve,Ue),Te.set(rt.subarray(He,He+Le*Ue)),Se(He-Se(0)),Ge!==0)throw new Error(`Malformed buffer data: ${Ge}`)})(R,R.exports[W[ue]],X,Y,re,ne,R.exports[z[de]])}}}(fetch(NT()));return S.ready.then(()=>{z0=S})}()),l)for(let S=0;S<l.length;S++)w.push(uP(l[S],i,S,n));return(w.length?Promise.all(w):Promise.resolve()).then(()=>{if(E&&c)for(let{primitives:S}of c)for(let A of S)aP(A,i);if(D&&c&&m)for(let S of m)lP(S,i);return i})})}function yc(t,e){let n=t.json.bufferViews[e.bufferView],i=yg[e.componentType];return new i(t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==Vf[e.type]*i.BYTES_PER_ELEMENT?n.byteStride/i.BYTES_PER_ELEMENT:Vf[e.type]))}function V0(t,e,n,i){let s=yg[e.componentType],l=function(w){switch(w){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(s),c=t.json.bufferViews[e.bufferView],p=c.byteStride?c.byteStride/s.BYTES_PER_ELEMENT:Vf[e.type],m=n.float32,x=m.length/n.capacity;for(let w=0,E=0;w<e.count*p;w+=p,E+=x)for(let D=0;D<x;D++)m[E+D]=i[w+D]*l;n._trim()}function hP(t,e,n){let i=t.indices,s=t.attributes,l={};l.indexArray=new pr;let c=e.json.accessors[i],p=c.count/3;l.indexArray.reserve(p);let m=yc(e,c);for(let D=0;D<p;D++)l.indexArray.emplaceBack(m[3*D],m[3*D+1],m[3*D+2]);l.indexArray._trim(),l.vertexArray=new za;let x=e.json.accessors[s.POSITION];l.vertexArray.reserve(x.count);let w=yc(e,x);for(let D=0;D<x.count;D++)l.vertexArray.emplaceBack(w[3*D],w[3*D+1],w[3*D+2]);if(l.vertexArray._trim(),l.aabb=new Vn(x.min,x.max),l.centroid=function(D,S){let A=[0,0,0],R=D.length;if(R>0){for(let O=0;O<R;O++){let z=3*D[O];A[0]+=S[z],A[1]+=S[z+1],A[2]+=S[z+2]}A[0]/=R,A[1]/=R,A[2]/=R}return A}(m,w),s.COLOR_0!==void 0){let D=e.json.accessors[s.COLOR_0],S=Vf[D.type],A=yc(e,D);l.colorArray=S===3?new za:new Na,l.colorArray.resize(D.count),V0(e,D,l.colorArray,A)}if(s.NORMAL!==void 0){l.normalArray=new za;let D=e.json.accessors[s.NORMAL];l.normalArray.resize(D.count);let S=yc(e,D);V0(e,D,l.normalArray,S)}if(s.TEXCOORD_0!==void 0&&n.length>0){l.texcoordArray=new $u;let D=e.json.accessors[s.TEXCOORD_0];l.texcoordArray.resize(D.count);let S=yc(e,D);V0(e,D,l.texcoordArray,S)}if(s._FEATURE_ID_RGBA4444!==void 0){let D=e.json.accessors[s._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(l.featureData=yc(e,D))}s._FEATURE_RGBA4444!==void 0&&(l.featureData=new Uint32Array(yc(e,e.json.accessors[s._FEATURE_RGBA4444]).buffer));let E=t.material;return l.material=function(D,S){let{emissiveFactor:A=[0,0,0],alphaMode:R="OPAQUE",alphaCutoff:O=.5,normalTexture:z,occlusionTexture:W,emissiveTexture:X,doubleSided:Y}=D,{baseColorFactor:re=[1,1,1,1],metallicFactor:ne=1,roughnessFactor:ue=1,baseColorTexture:de,metallicRoughnessTexture:ve}=D.pbrMetallicRoughness||{},Ce=W?S[W.index]:void 0;if(W&&W.extensions&&W.extensions.KHR_texture_transform&&Ce){let Te=W.extensions.KHR_texture_transform;Ce.offsetScale=[Te.offset[0],Te.offset[1],Te.scale[0],Te.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new nn(...re),metallicFactor:ne,roughnessFactor:ue,baseColorTexture:de?S[de.index]:void 0,metallicRoughnessTexture:ve?S[ve.index]:void 0},doubleSided:Y,emissiveFactor:A,alphaMode:R,alphaCutoff:O,normalTexture:z?S[z.index]:void 0,occlusionTexture:Ce,emissionTexture:X?S[X.index]:void 0,defined:D.defined===void 0}}(E!==void 0?e.json.materials[E]:{defined:!1},n),l}function $T(t,e,n){let{matrix:i,rotation:s,translation:l,scale:c,mesh:p,extras:m,children:x}=t,w={};if(w.matrix=i||o.ad.fromRotationTranslationScale([],s||[0,0,0,1],l||[0,0,0],c||[1,1,1]),p!==void 0){w.meshes=n[p];let E=w.anchor=[0,0];for(let D of w.meshes){let{min:S,max:A}=D.aabb;E[0]+=S[0]+A[0],E[1]+=S[1]+A[1]}E[0]=Math.floor(E[0]/w.meshes.length/2),E[1]=Math.floor(E[1]/w.meshes.length/2)}if(m&&(m.id&&(w.id=m.id),m.lights&&(w.lights=function(E){if(!E.length)return[];let D=function(z){let W=atob(z),X=new Uint8Array(W.length);for(let Y=0;Y<W.length;Y++)X[Y]=W.codePointAt(Y);return X}(E),S=[],A=D.length/24,R=new Uint16Array(D.buffer),O=new Float32Array(D.buffer);for(let z=0;z<A;z++){let W=R[2*z*6]/30,X=R[2*z*6+1]/30,Y=R[2*z*6+10]/100,re=O[6*z+1],ne=O[6*z+2],ue=O[6*z+3],de=O[6*z+4],ve=ue-re,Ce=de-ne,Te=Math.hypot(ve,Ce);S.push({pos:[re+.5*ve,ne+.5*Ce,X],normal:[Ce/Te,-ve/Te,0],width:Te,height:W,depth:Y,points:[re,ne,ue,de]})}return S}(m.lights))),x){let E=[];for(let D of x)E.push($T(e.json.nodes[D],e,n));w.children=E}return w}function dP(t){if(t.vertices.length===0||t.indices.length===0)return null;let e=new n0(t.vertices,t.indices,8,256),[n,i]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:n,max:i}}function fP(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let i=[];for(let c of n){if(!Array.isArray(c)||c.length!==2)continue;let p=c[0],m=c[1];typeof p=="number"&&typeof m=="number"&&i.push(new tt(p,m))}if(i.length<3)return null;i.length>1&&i[i.length-1].equals(i[0])&&i.pop();let s=0;for(let c=0;c<i.length;c++){let p=i[c],m=i[(c+1)%i.length],x=i[(c+2)%i.length];s+=(p.x-m.x)*(x.y-m.y)-(x.x-m.x)*(p.y-m.y)}s>0&&i.reverse();let l=_f(i.flatMap(c=>[c.x,c.y]),[]);return l.length===0?null:{vertices:i,indices:l}}function pP(t,e){let n=[],i=[],s=0,l=[];for(let c of t){s=n.length;let p=c.vertexArray.float32,m=c.indexArray.uint16;for(let x=0;x<c.vertexArray.length;x++)l[0]=p[3*x+0],l[1]=p[3*x+1],l[2]=p[3*x+2],o._.transformMat4(l,l,e),n.push(new tt(l[0],l[1]));for(let x=0;x<3*c.indexArray.length;x++)i.push(m[x]+s)}if(i.length%3!=0)return null;for(let c=0;c<i.length;c+=3){let p=n[i[c+0]],m=n[i[c+1]],x=n[i[c+2]];(p.x-m.x)*(x.y-m.y)-(x.x-m.x)*(p.y-m.y)>0&&([i[c+1],i[c+2]]=[i[c+2],i[c+1]])}return{vertices:n,indices:i}}function HT(t){let e=function(m,x){let w=[],E=WebGL2RenderingContext;if(m.json.textures)for(let D of m.json.textures){let S={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};D.sampler!==void 0&&Object.assign(S,m.json.samplers[D.sampler]),w.push({image:x[D.source],sampler:S,uploaded:!1})}return w}(t,t.images),n=function(m,x){let w=[];for(let E of m.json.meshes){let D=[];for(let S of E.primitives)D.push(hP(S,m,x));w.push(D)}return w}(t,e),{scenes:i,scene:s,nodes:l}=t.json,c=i?i[s||0].nodes:l,p=[];for(let m of c)p.push($T(l[m],t,n));return function(m,x,w){let E={},D=new Set;for(let S=0;S<m.length;S++){let A=w[x[S]];if(!A.extras)continue;let R=A.extras["mapbox:footprint:version"],O=A.extras["mapbox:footprint:id"];(R||O)&&D.add(S),R==="1.0.0"&&O&&(E[O]=S)}for(let S=0;S<m.length;S++){if(D.has(S))continue;let A=m[S],R=w[x[S]];if(!R.extras)continue;let O=null;A.id in E&&(O=pP(m[E[A.id]].meshes,A.matrix)),O||(O=fP(R)),O&&(A.footprint=dP(O))}if(D.size>0){let S=Array.from(D.values()).sort((A,R)=>A-R);for(let A=S.length-1;A>=0;A--)m.splice(S[A],1)}}(p,c,t.json.nodes),p}function mP(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,n=t.aabb.min[0]-1,i=t.aabb.min[1]-1,s=_c/(t.aabb.max[0]-n+2),l=_c/(t.aabb.max[1]-i+2);for(let c=0;c<e.length;c+=3){let p=e[c+2],m=(e[c+0]-n)*s|0,x=(e[c+1]-i)*l|0;p>t.heightmap[x*_c+m]&&(t.heightmap[x*_c+m]=p)}}function gP(t,e){let n={};n.indexArray=new pr,n.indexArray.reserve(4*t.length),n.vertexArray=new za,n.vertexArray.reserve(10*t.length),n.colorArray=new Na,n.vertexArray.reserve(10*t.length);let i=0;for(let c of t){let p=Math.min(10,Math.max(4,1.3*c.height))*e,m=[-c.normal[1],c.normal[0],0],x=Math.min(.29,.1*c.width/c.depth),w=c.width-2*c.depth*e*(x+.01),E=o._.scaleAndAdd([],c.pos,m,w/2),D=o._.scaleAndAdd([],c.pos,m,-w/2),S=[E[0],E[1],E[2]+c.height],A=[D[0],D[1],D[2]+c.height],R=o._.scaleAndAdd([],c.normal,m,x);o._.scale(R,R,p);let O=o._.scaleAndAdd([],c.normal,m,-x);o._.scale(O,O,p),o._.add(R,E,R),o._.add(O,D,O),E[2]+=.1,D[2]+=.1,n.vertexArray.emplaceBack(R[0],R[1],R[2]),n.vertexArray.emplaceBack(O[0],O[1],O[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(S[0],S[1],S[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(R[0],R[1],R[2]),n.vertexArray.emplaceBack(O[0],O[1],O[2]);let z=w/p/2;n.colorArray.emplaceBack(-z-x,-1,z,.8),n.colorArray.emplaceBack(z+x,-1,z,.8),n.colorArray.emplaceBack(-z,0,z,1.3),n.colorArray.emplaceBack(z,0,z,1.3),n.colorArray.emplaceBack(z+x,-.8,z,.7),n.colorArray.emplaceBack(z+x,-.8,z,.7),n.colorArray.emplaceBack(0,0,z,1.3),n.colorArray.emplaceBack(0,0,z,1.3),n.colorArray.emplaceBack(z+x,-1.2,z,.8),n.colorArray.emplaceBack(z+x,-1.2,z,.8),n.indexArray.emplaceBack(6+i,4+i,8+i),n.indexArray.emplaceBack(7+i,9+i,5+i),n.indexArray.emplaceBack(0+i,1+i,2+i),n.indexArray.emplaceBack(1+i,3+i,2+i),i+=10}let s={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=nn.white,s.pbrMetallicRoughness=l,n.material=s,n.aabb=new Vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}let j0=new Float32Array(262144),xc=new Uint8Array(262144);function qT(t){let e=0;if(t.meshes)for(let n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(let n of t.children)e=Math.max(e,qT(n));return e}function WT(t,e,n){if(t.meshes)for(let i of t.meshes)i.aabb.min[0]!==1/0&&n.insert(e,i.aabb.min[0],i.aabb.min[1],i.aabb.max[0],i.aabb.max[1]);if(t.children)for(let i of t.children)WT(i,e,n)}let ZT=["","wall","door","roof","window","lamp","logo"];class XT{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:qT(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,n=new Vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let i of this.node.meshes)this.node.lightMeshIndex!==e&&(i.transformedAabb=Vn.applyTransformFast(i.aabb,this.node.matrix),n.encapsulate(i.transformedAabb)),e++;this.aabb=n}return this.aabb}}class vg{constructor(e,n,i,s,l,c){this.id=n,this.modelTraits|=dh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=dh.HasMapboxMeshFeatures),s&&(this.modelTraits|=dh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=l,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let p of e)this.nodesInfo.push(new XT(p)),WT(p,c.featureIndexArray.length,c.grid),c.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,c.bucketLayerIDs.length-1,0)}updateFootprints(e,n){for(let i of this.getNodesInfo()){let s=i.node;s.footprint&&n.push({footprint:s.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let i of n){let s=i.node;this.uploaded?this.updatePbrBuffer(s):L0(s,e,!0)}for(let i of n)mg(i.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let i of e.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),n=!0);return n}needsReEvaluation(e,n,i){let s=e.transform.projectionOptions,l=e.style.getBrightness(),c=this.brightness!==l;return!!(!this.uploaded||this.dirty||s.name!==this.projection.name||jf(i.paint.get("model-color").value,c)||jf(i.paint.get("model-color-mix-intensity").value,c)||jf(i.paint.get("model-roughness").value,c)||jf(i.paint.get("model-emissive-strength").value,c)||jf(i.paint.get("model-height-based-emissive-strength-multiplier").value,c))&&(this.projection=s,this.brightness=l,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let i=this.getNodesInfo(),s=this.id.canonical;for(let l of i){let c=l.feature;l.evaluatedScale=n.paint.get("model-scale").evaluate(c,{},s)}}evaluate(e){let n=this.getNodesInfo();for(let i of n){if(!i.node.meshes)continue;let s=i.feature,l=i.node.meshes&&i.node.meshes[0].featureData,c=i.evaluatedColor[2],p=i.evaluatedRMEA[2],m=this.id.canonical;if(i.hasTranslucentParts=!1,l){for(let x=0;x<ZT.length;x++){let w=ZT[x];w.length&&(s.properties.part=w);let E=e.paint.get("model-color").evaluate(s,{},m).toRenderColor(null),D=e.paint.get("model-color-mix-intensity").evaluate(s,{},m);i.evaluatedColor[x]=[E.r,E.g,E.b,D],i.evaluatedRMEA[x][0]=e.paint.get("model-roughness").evaluate(s,{},m),i.evaluatedRMEA[x][2]=e.paint.get("model-emissive-strength").evaluate(s,{},m),i.evaluatedRMEA[x][3]=E.a,i.emissionHeightBasedParams[x]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(s,{},m),!i.hasTranslucentParts&&E.a<1&&(i.hasTranslucentParts=!0)}delete s.properties.part,yP(i,c!==i.evaluatedColor[2]||p!==i.evaluatedRMEA[2],this.modelTraits)}else i.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(s,{},m);i.evaluatedScale=e.paint.get("model-scale").evaluate(s,{},m),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,i,s){let l=e.findDEMTileFor(i);if(l&&(l.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;let c=Ju.create(e,i,l);if(!c)return;this.modelTraits&dh.HasMapboxMeshFeatures&&this.updateDEM(e,c,i,s);for(let p of this.getNodesInfo()){let m=p.node;if(!m.footprint||!m.footprint.vertices||!m.footprint.vertices.length)continue;let x=m.footprint.vertices,w=c.getElevationAt(x[0].x,x[0].y,!0,!0);for(let E=1;E<x.length;E++)w=Math.min(w,c.getElevationAt(x[E].x,x[E].y,!0,!0));m.elevation=w}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,i,s){let l=n._dem._modifiedForSources[s];if(l===void 0&&(n._dem._modifiedForSources[s]=[],l=n._dem._modifiedForSources[s]),l.includes(i.canonical))return;let c=n._dem.dim;l.push(i.canonical);let p=!1;for(let m of this.getNodesInfo()){let x=m.node;if(!x.footprint||!x.footprint.grid)continue;let w=x.footprint.grid,E=n.tileCoordToPixel(w.min.x,w.min.y),D=n.tileCoordToPixel(w.max.x,w.max.y),S=Math.min(Math.min(c-D.y,E.x),Math.min(E.y,c-D.x));if(S<0)continue;let A=St(S,2,5),R=Math.max(0,E.x-A),O=Math.max(0,E.y-A),z=Math.min(D.x+A,c-1),W=Math.min(D.y+A,c-1);for(let ne=O;ne<=W;++ne)for(let ue=R;ue<=z;++ue)xc[ne*c+ue]=255;let X=0,Y=0;for(let ne=0;ne<w.cellsY;++ne)for(let ue=0;ue<w.cellsX;++ue){if(!w.cells[ne*w.cellsX+ue])continue;let de=n.tileCoordToPixel(w.min.x+ue/w.xScale,w.min.y+ne/w.yScale),ve=n.tileCoordToPixel(w.min.x+(ue+1)/w.xScale,w.min.y+(ne+1)/w.yScale);for(let Ce=de.y;Ce<=Math.min(ve.y+1,c-1);++Ce)for(let Te=de.x;Te<=Math.min(ve.x+1,c-1);++Te)xc[Ce*c+Te]===255&&(xc[Ce*c+Te]=0,X+=n.getElevationAtPixel(Te,Ce),Y++)}let re=X/Y;R=Math.max(1,E.x-A),O=Math.max(1,E.y-A),z=Math.min(D.x+A,c-2),W=Math.min(D.y+A,c-2),p=!0;for(let ne=O;ne<=W;++ne)for(let ue=R;ue<=z;++ue)xc[ne*c+ue]===0&&(j0[ne*c+ue]=n._dem.set(ue,ne,re));for(let ne=1;ne<A;++ne){R=Math.max(1,E.x-ne),O=Math.max(1,E.y-ne),z=Math.min(D.x+ne,c-2),W=Math.min(D.y+ne,c-2);for(let ue=O;ue<=W;++ue)for(let de=R;de<=z;++de){let ve=ue*c+de;if(xc[ve]===255){let Ce=0,Te=0,Le=-1,Ue=-1;for(let Pe=-1;Pe<=1;++Pe)for(let Be=-1;Be<=1;++Be){let Se=(ue+Pe)*c+de+Be;if(xc[Se]>=ne)continue;let Ve=j0[Se],He=Math.abs(Ve);He>Te&&(Ce=Ve,Te=He,Le=Be,Ue=Pe)}if(Te>.1){let Pe=1-(ne+.5*Math.abs(Le*Ue))/A,Be=n._dem.get(de,ue)+Ce*Pe,Se=n._dem.get(de+Le,ue+Ue),Ve=n._dem.get(de-Le,ue-Ue,!0);(Be-Se)*(Be-Ve)>0&&(Be=(Se+Ve)/2),j0[ve]=n._dem.set(de,ue,Be),xc[ve]=ne}}}}}p&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=_r.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let n of e)mg(n.node),O0(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let i=n.getReplacementRegionsForTile(e.toUnwrapped()),s=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){let c=s[l].node;s[l].hiddenByReplacement=!!c.footprint&&!i.find(p=>p.footprint===c.footprint)}}getHeightAtTileCoord(e,n){let i=this.getNodesInfo(),s=[],l=[0,0,0],c=o.ad.identity([]);for(let p=0;p<this.nodesInfo.length;p++){let m=i[p],x=m.node.meshes[0],w=x.transformedAabb;if(e<w.min[0]||n<w.min[1]||e>w.max[0]||n>w.max[1])continue;if(m.node.hidden===!0)return{height:0,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};o.ad.invert(c,m.node.matrix),l[0]=e,l[1]=n,o._.transformMat4(l,l,c);let E=(l[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*_c|0,D=Math.min(63,(l[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*_c|0)*_c+Math.min(63,E),S=x.heightmap[D];if(!(S<0&&m.node.footprint))return m.hiddenByReplacement?void 0:{height:S,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};if(m.node.footprint.grid.query(new tt(e,n),new tt(e,n),s),s.length>0)return{height:void 0,maxHeight:m.feature.properties.height,hidden:m.hiddenByReplacement,verticalScale:m.evaluatedScale[2]}}}}function jf(t,e){return!t.isLightConstant&&e}function _P(t,e,n,i,s,l,c,p){let m=(61440&e|(61440&e)>>4)>>8,x=(3840&e|(3840&e)>>4)>>4,w=240&e|(240&e)>>4;n[3]>0&&(m=pt(m,255*n[0],n[3]),x=pt(x,255*n[1],n[3]),w=pt(w,255*n[2],n[3]));let E=m<<8|x,D=w<<8|Math.floor(255*i[3]),S=function(ne){let ue=St(ne,0,2);return Math.min(Math.round(.5*ue*255),255)}(i[2])<<8|15*i[0]<<4|15*i[1],A=St(s[0],0,1),R=St(s[1],0,1),O=St(s[2],0,1),z=St(s[3],0,1),W,X,Y,re;if(A!==R&&c!==l&&R!==A){let ne=c-l;X=1/(ne*(R-A)),Y=-(l+ne*A)/(ne*(R-A));let ue=St(s[4],-1,1);re=Math.pow(10,ue),W=255*O<<8|255*z}else W=65535,X=0,Y=1,re=1;if(t.emplaceBack(E,D,S,W,X,Y,re),p){let ne=p.length;p.clear();for(let ue=0;ue<ne;ue++)p.emplaceBack(E,D,S,W,X,Y,re)}}function yP(t,e,n){let i=t.node,s=0,l=n&dh.HasMeshoptCompression;for(let c of i.meshes){if(i.lights&&i.lightMeshIndex===s||!c.featureData)continue;c.featureArray=new vm,c.featureArray.reserve(c.featureData.length);let p=e;for(let m of c.featureData){let x=l?65535&m:m>>16&65535,w=l?m>>16&65535:65535&m,E=(15&w)<8?15&w:0,D=t.evaluatedRMEA[E],S=t.evaluatedColor[E],A=t.emissionHeightBasedParams[E],R;if(p&&E===2&&i.lights&&(R=new vm,R.resize(10*i.lights.length)),_P(c.featureArray,x,S,D,A,c.aabb.min[2],c.aabb.max[2],R),R&&p){p=!1;let O=i.meshes[i.lightMeshIndex];O.featureArray=R,O.featureArray._trim()}}c.featureArray._trim(),s++}}function YT(t,e,n,i){let s=1<<t.z;e.lat=xr((i/Ye+t.y)/s),e.lng=ii((n/Ye+t.x)/s)}q(vg,"Tiled3dModelBucket",{omit:["layers"]}),q(XT,"Tiled3dModelFeature");let xP={circle:class extends Mr{constructor(t,e,n,i){super(t,QC,e,n,i)}createBucket(t){return new zy(t)}queryRadius(t){let e=t;return Yu("circle-radius",this,e)+Yu("circle-stroke-width",this,e)+Dm(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,i,s,l,c,p){let m=ab(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return wb(t,i,l,c,p,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",m,x)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,n){let i=bb(this);return{config:new cc(this,{zoom:e,lut:n}),defines:i,overrideFog:!1}}},heatmap:class extends Mr{createBucket(t){return new Eb(t)}constructor(t,e,n,i){super(t,lS,e,n,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Yu("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,i,s,l,c,p){let m=this.paint.get("heatmap-radius").evaluate(e,n);return wb(t,i,l,c,p,!0,!0,new tt(0,0),m)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,n){return t==="heatmap"?{config:new cc(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends Mr{constructor(t,e,n,i){super(t,uS,e,n,i)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},fill:class extends Mr{constructor(t,e,n,i){super(t,ES,e,n,i)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e,n){return{config:new cc(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new km(t)}queryRadius(){return Dm(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,i,s,l){return!t.queryGeometry.isAboveHorizon&&nb(sb(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends Mr{constructor(t,e,n,i){super(t,e2,e,n,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Um(t)}queryRadius(){return Dm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,i,s,l,c,p,m){let x=ab(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),w=this.paint.get("fill-extrusion-height").evaluate(e,n),E=this.paint.get("fill-extrusion-base").evaluate(e,n),D=[0,0],S=p&&l.elevation,A=l.elevation?l.elevation.exaggeration():1,R=t.tile.getBucket(this);if(S&&R instanceof Um){let Y=R.centroidVertexArray,re=m+1;re<Y.length&&(D[0]=Y.geta_centroid_pos0(re),D[1]=Y.geta_centroid_pos1(re))}if(D[0]===0&&D[1]===1)return!1;l.projection.name==="globe"&&(i=hw([i],[new tt(0,0),new tt(Ye,Ye)],t.tileID.canonical).map(Y=>Y.polygon).flat());let O=S?p:null,[z,W]=function(Y,re,ne,ue,de,ve,Ce,Te,Le,Ue,Pe){return Y.projection.name==="globe"?function(Be,Se,Ve,He,je,rt,Ge,We,dt,ht,ct){let qe=[],ft=[],At=Be.projection.upVectorScale(ct,Be.center.lat,Be.worldSize).metersToTile,xt=[0,0,0,1],kt=[0,0,0,1],Pt=(_t,xn,_n,on)=>{_t[0]=xn,_t[1]=_n,_t[2]=on,_t[3]=1},Vt=uw();Ve>0&&(Ve+=Vt),He+=Vt;for(let _t of Se){let xn=[],_n=[];for(let on of _t){let Yt=on.x+je.x,sn=on.y+je.y,An=Be.projection.projectTilePoint(Yt,sn,ct),Tn=Be.projection.upVector(ct,on.x,on.y),qn=Ve,Hn=He;if(Ge){let Fr=fw(Yt,sn,Ve,He,Ge,We,dt,ht);qn+=Fr.base,Hn+=Fr.top}Ve!==0?Pt(xt,An.x+Tn[0]*At*qn,An.y+Tn[1]*At*qn,An.z+Tn[2]*At*qn):Pt(xt,An.x,An.y,An.z),Pt(kt,An.x+Tn[0]*At*Hn,An.y+Tn[1]*At*Hn,An.z+Tn[2]*At*Hn),o._.transformMat4(xt,xt,rt),o._.transformMat4(kt,kt,rt),xn.push(new pc(xt[0],xt[1],xt[2])),_n.push(new pc(kt[0],kt[1],kt[2]))}qe.push(xn),ft.push(_n)}return[qe,ft]}(Y,re,ne,ue,de,ve,Ce,Te,Le,Ue,Pe):Ce?function(Be,Se,Ve,He,je,rt,Ge,We,dt){let ht=[],ct=[],qe=[0,0,0,1];for(let ft of Be){let At=[],xt=[];for(let kt of ft){let Pt=kt.x+He.x,Vt=kt.y+He.y,_t=fw(Pt,Vt,Se,Ve,rt,Ge,We,dt);qe[0]=Pt,qe[1]=Vt,qe[2]=_t.base,qe[3]=1,o.aA.transformMat4(qe,qe,je),qe[3]=Math.max(qe[3],1e-5);let xn=new pc(qe[0]/qe[3],qe[1]/qe[3],qe[2]/qe[3]);qe[0]=Pt,qe[1]=Vt,qe[2]=_t.top,qe[3]=1,o.aA.transformMat4(qe,qe,je),qe[3]=Math.max(qe[3],1e-5);let _n=new pc(qe[0]/qe[3],qe[1]/qe[3],qe[2]/qe[3]);At.push(xn),xt.push(_n)}ht.push(At),ct.push(xt)}return[ht,ct]}(re,ne,ue,de,ve,Ce,Te,Le,Ue):function(Be,Se,Ve,He,je){let rt=[],Ge=[],We=je[8]*Se,dt=je[9]*Se,ht=je[10]*Se,ct=je[11]*Se,qe=je[8]*Ve,ft=je[9]*Ve,At=je[10]*Ve,xt=je[11]*Ve;for(let kt of Be){let Pt=[],Vt=[];for(let _t of kt){let xn=_t.x+He.x,_n=_t.y+He.y,on=je[0]*xn+je[4]*_n+je[12],Yt=je[1]*xn+je[5]*_n+je[13],sn=je[2]*xn+je[6]*_n+je[14],An=je[3]*xn+je[7]*_n+je[15],Tn=on+We,qn=Yt+dt,Hn=sn+ht,Fr=Math.max(An+ct,1e-5),Kn=on+qe,Un=Yt+ft,ar=sn+At,vr=Math.max(An+xt,1e-5);Pt.push(new pc(Tn/Fr,qn/Fr,Hn/Fr)),Vt.push(new pc(Kn/vr,Un/vr,ar/vr))}rt.push(Pt),Ge.push(Vt)}return[rt,Ge]}(re,ne,ue,de,ve)}(l,i,E,w,x,c,O,D,A,l.center.lat,t.tileID.canonical),X=t.queryGeometry;return function(Y,re,ne){let ue=1/0;nb(ne,re)&&(ue=dw(ne,re[0]));for(let de=0;de<re.length;de++){let ve=re[de],Ce=Y[de];for(let Te=0;Te<ve.length-1;Te++){let Le=ve[Te],Ue=[Le,ve[Te+1],Ce[Te+1],Ce[Te],Le];By(ne,Ue)&&(ue=Math.min(ue,dw(ne,Ue)))}}return ue!==1/0&&ue}(z,W,X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends Mr{constructor(t,e,n,i){super(t,$m,e,n,i),$m.layout&&(this.layout=new Mn($m.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Is,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=yT.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Gm(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,n){let i=bw(this);return{config:new cc(this,{zoom:e,lut:n}),defines:i,overrideFog:!1}}queryRadius(t){let e=t,n=xT(Yu("line-width",this,e),Yu("line-gap-width",this,e)),i=Yu("line-offset",this,e);return n/2+Math.abs(i)+Dm(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,i,s,l){if(t.queryGeometry.isAboveHorizon)return!1;let c=sb(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),p=t.pixelToTileUnitsFactor/2*xT(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),m=this.paint.get("line-offset").evaluate(e,n);return m&&(i=function(x,w){let E=[],D=new tt(0,0);for(let S=0;S<x.length;S++){let A=x[S],R=[];for(let O=0;O<A.length;O++){let z=A[O],W=A[O+1],X=O===0?D:z.sub(A[O-1])._unit()._perp(),Y=O===A.length-1?D:W.sub(z)._unit()._perp(),re=X._add(Y)._unit();re._mult(1/(re.x*Y.x+re.y*Y.y)),R.push(re._mult(w)._add(z))}E.push(R)}return E}(i,m*t.pixelToTileUnitsFactor)),function(x,w,E){for(let D=0;D<w.length;D++){let S=w[D];if(x.length>=3){for(let A=0;A<S.length;A++)if($a(x,S[A]))return!0}if(WC(x,S,E))return!0}return!1}(c,i,p)}isTileClipped(){return!0}isDraped(t){let e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:cg,background:class extends Mr{constructor(t,e,n,i){super(t,NA,e,n,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},raster:TT,"raster-particle":ET,sky:class extends Mr{constructor(t,e,n,i){super(t,HA,e,n,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=gf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let i=this.paint.get("sky-atmosphere-sun"),s=!i,l=t.style.light,c=l.properties.get("position");return s&&l.properties.get("anchor")==="viewport"&&Qn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),s?A0(c.azimuthal,90-c.polar,e):A0(i[0],90-i[1],e)}let n=this.paint.get("sky-gradient-center");return A0(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends Mr{constructor(t,e,n,i){super(t,qA,e,null)}},model:class extends Mr{constructor(t,e,n,i){super(t,tP,e,n,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new R0(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof vg?Ye-1:0}queryIntersectsFeature(t,e,n,i,s,l){if(!this.modelManager)return!1;let c=this.modelManager,p=t.tile.getBucket(this);if(!(p&&p instanceof R0))return!1;let m=p;for(let x in m.instancesPerModel){let w=m.instancesPerModel[x],E=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(w.idToFeaturesIndex.hasOwnProperty(E)){let D=w.features[w.idToFeaturesIndex[E]],S=c.getModel(x,this.scope);if(!S)return!1;let A=o.ad.create(),R=new en(0,0),O=m.canonical,z=Number.MAX_VALUE;for(let W=0;W<D.instancedDataCount;++W){let X=16*(D.instancedDataOffset+W),Y=w.instancedDataArray.float32,re=[Y[X+4],Y[X+5],Y[X+6]];YT(O,R,Y[X],0|Y[X+1]),OT(A,S,l,R,D.rotation,D.scale,re,!1,!1,!1),l.projection.name==="globe"&&(A=P0(A,l));let ne=o.ad.multiply([],l.projMatrix,A),ue=t.queryGeometry,de=AT(ue.isPointQuery()?ue.screenBounds:ue.screenGeometry,l,ne,S.aabb);de!=null&&(z=Math.min(de,z))}return z!==Number.MAX_VALUE&&z}}return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof U}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,n,i){let s=t.tile,l=s.getBucket(this),c=null,p=Number.MAX_VALUE;if(!(l&&l instanceof vg))return{queryFeature:c,intersectionZ:p};let m=l.getNodesInfo()[e];if(m.hiddenByReplacement||!m.node.meshes||!n.filter(new vt(s.tileID.overscaledZ),m.feature,s.tileID.canonical))return{queryFeature:c,intersectionZ:p};let x=m.node,w=i.calculatePosMatrix(s.tileID.toUnwrapped(),i.worldSize),E=m.evaluatedScale,D=0;i.elevation&&x.elevation&&(D=x.elevation*i.elevation.exaggeration()),o.ad.translate(w,w,[(x.anchor?x.anchor[0]:0)*(E[0]-1),(x.anchor?x.anchor[1]:0)*(E[1]-1),D]),o.ad.scale(w,w,E),o.ad.multiply(w,w,x.matrix);let S=t.queryGeometry,A=S.isPointQuery()?S.screenBounds:S.screenGeometry,R=function(z){let W=o.ad.multiply([],w,z.matrix),X=o.ad.multiply(W,i.expandedFarZProjMatrix,W);for(let Y=0;Y<z.meshes.length;++Y){let re=z.meshes[Y];if(Y===z.lightMeshIndex)continue;let ne=AT(A,i,X,re.aabb);ne!=null&&(p=Math.min(ne,p))}if(z.children)for(let Y of z.children)R(Y)};if(R(x),p===Number.MAX_VALUE)return{queryFeature:c,intersectionZ:p};let O=new en(0,0);return YT(s.tileID.canonical,O,m.node.anchor[0],m.node.anchor[1]),c={type:"Feature",geometry:{type:"Point",coordinates:[O.lng,O.lat]},properties:m.feature.properties,id:m.feature.id,state:{},layer:this.serialize()},{queryFeature:c,intersectionZ:p}}},clip:class extends Mr{constructor(t,e,n,i){super(t,DS,e,n,i)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new Rb(t)}isTileClipped(){return!0}is3D(){return!0}}};q(mT,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let QT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class U0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,i]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let s=i>>4;if(s!==1)throw new Error(`Got v${s} data when expected v1.`);let l=QT[15&i];if(!l)throw new Error("Unrecognized array type.");let[c]=new Uint16Array(e,2,1),[p]=new Uint32Array(e,4,1);return new U0(p,c,l,e)}constructor(e,n=64,i=Float64Array,s){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let l=QT.indexOf(this.ArrayType),c=2*e*this.ArrayType.BYTES_PER_ELEMENT,p=e*this.IndexArrayType.BYTES_PER_ELEMENT,m=(8-p%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${i}.`);s&&s instanceof ArrayBuffer?(this.data=s,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+p+m,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+c+p+m),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+p+m,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=n,i}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return G0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:l,coords:c,nodeSize:p}=this,m=[0,l.length-1,0],x=[];for(;m.length;){let w=m.pop()||0,E=m.pop()||0,D=m.pop()||0;if(E-D<=p){for(let O=D;O<=E;O++){let z=c[2*O],W=c[2*O+1];z>=e&&z<=i&&W>=n&&W<=s&&x.push(l[O])}continue}let S=D+E>>1,A=c[2*S],R=c[2*S+1];A>=e&&A<=i&&R>=n&&R<=s&&x.push(l[S]),(w===0?e<=A:n<=R)&&(m.push(D),m.push(S-1),m.push(1-w)),(w===0?i>=A:s>=R)&&(m.push(S+1),m.push(E),m.push(1-w))}return x}within(e,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:s,coords:l,nodeSize:c}=this,p=[0,s.length-1,0],m=[],x=i*i;for(;p.length;){let w=p.pop()||0,E=p.pop()||0,D=p.pop()||0;if(E-D<=c){for(let O=D;O<=E;O++)JT(l[2*O],l[2*O+1],e,n)<=x&&m.push(s[O]);continue}let S=D+E>>1,A=l[2*S],R=l[2*S+1];JT(A,R,e,n)<=x&&m.push(s[S]),(w===0?e-i<=A:n-i<=R)&&(p.push(D),p.push(S-1),p.push(1-w)),(w===0?e+i>=A:n+i>=R)&&(p.push(S+1),p.push(E),p.push(1-w))}return m}}function G0(t,e,n,i,s,l){if(s-i<=n)return;let c=i+s>>1;KT(t,e,c,i,s,l),G0(t,e,n,i,c-1,1-l),G0(t,e,n,c+1,s,1-l)}function KT(t,e,n,i,s,l){for(;s>i;){if(s-i>600){let x=s-i+1,w=n-i+1,E=Math.log(x),D=.5*Math.exp(2*E/3),S=.5*Math.sqrt(E*D*(x-D)/x)*(w-x/2<0?-1:1);KT(t,e,n,Math.max(i,Math.floor(n-w*D/x+S)),Math.min(s,Math.floor(n+(x-w)*D/x+S)),l)}let c=e[2*n+l],p=i,m=s;for(Uf(t,e,i,n),e[2*s+l]>c&&Uf(t,e,i,s);p<m;){for(Uf(t,e,p,m),p++,m--;e[2*p+l]<c;)p++;for(;e[2*m+l]>c;)m--}e[2*i+l]===c?Uf(t,e,i,m):(m++,Uf(t,e,m,s)),m<=n&&(i=m+1),n<=m&&(s=m-1)}}function Uf(t,e,n,i){$0(t,n,i),$0(e,2*n,2*i),$0(e,2*n+1,2*i+1)}function $0(t,e,n){let i=t[e];t[e]=t[n],t[n]=i}function JT(t,e,n,i){let s=t-n,l=e-i;return s*s+l*l}o.$=Rl,o.A=rc,o.B=nc,o.C=nn,o.D=Lr,o.E=xs,o.G=fr,o.H=f,o.I=rA,o.J=u,o.K=function(t){let e=t.value,n=[];if(!e)return n;let i=bs(e);return i!=="string"?(n=n.concat([new pg(t.key,e,`string expected, "${i}" found`)]),n):(PT(e,!0)||(n=n.concat([new pg(t.key,e,`invalid url "${e}"`)])),n)},o.L=be,o.M=class{constructor(t,e,n,i){this.id=t,this.position=e!=null?new en(e[0],e[1]):new en(0,0),this.orientation=n??[0,0,0],this.nodes=i,this.uploaded=!1,this.aabb=new Vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(o.ad.multiply(t.matrix,e,t.matrix),t.meshes)for(let n of t.meshes){let i=Vn.applyTransformFast(n.aabb,t.matrix);this.aabb.encapsulate(i)}if(t.children)for(let n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){let t=o.ad.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,n,i,s,l,c=!1){OT(this.matrix,this,t.transform,this.position,e,n,i,s,l,c)}upload(t){if(!this.uploaded){for(let e of this.nodes)L0(e,t);for(let e of this.nodes)mg(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)O0(t)}},o.N=ln,o.O=Oe,o.P=tt,o.Q=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Rr(t.expression.evaluate(e))}interpolate(t,e,n){return{x:pt(t.x,e.x,n),y:pt(t.y,e.y,n),z:pt(t.z,e.z,n),azimuthal:pt(t.azimuthal,e.azimuthal,n),polar:pt(t.polar,e.polar,n)}}},o.R=_u,o.S=Ty,o.T=Xi,o.U=$t,o.V=pg,o.W=Pr,o.X=vt,o.Y=kr,o.Z=U,o.a=fi,o.a$=function(t){let{x:e,y:n}=t.point,{lng:i,lat:s}=t._center;return yb(e,n,t.worldSize,i,s)},o.a0=Mn,o.a1=Ns,o.a2=pt,o.a3=Ye,o.a4=Np,o.a5=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,i]){let s=Rr([1,n,i]);return{x:s.x,y:s.y,z:s.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:pt(t.x,e.x,n),y:pt(t.y,e.y,n),z:pt(t.z,e.z,n)}}},o.a6=cf,o.a7=wm,o.a8=Ls,o.a9=q1,o.aB=function(t,e){let{x:n,y:i}=t.point,s=yb(n,i,t.worldSize/t._pixelsPerMercatorPixel,0,0);return o.ad.multiply(s,s,Zy(qo(e)))},o.aD=rh,o.aE=Ri,o.aF=Wm,o.aG=function(t,e,n,i,s){let l=5*e+2;t.float32[l+0]=n,t.float32[l+1]=i,t.float32[l+2]=s},o.aH=ig,o.aI=en,o.aJ=sT,o.aK=Y1,o.aL=lr,o.aM=Hy,o.aN=DT,o.aO=hc,o.aP=mb,o.aQ=function(t,e,n,i,s,l,c,p,m){if(m.name==="globe")return mb(t,e,new hc(n,i,s),!1);let x=mc({z:n,x:i,y:s},m);return new Vn([(l+x.x/x.scale)*e,e*(x.y/x.scale),c],[(l+x.x2/x.scale)*e,e*(x.y2/x.scale),p])},o.aR=function(t,e,n){let i=0;for(let s=0;s<2;++s)t[s]>0&&(i+=(t[s]-0)*(t[s]-0)),e[s]<0&&(i+=(0-e[s])*(0-e[s]));return i},o.aS=nr,o.aT=Gy,o.aU=Z1,o.aV=function(t){let e=o.ad.identity(new Float64Array(16));o.ad.multiply(e,t.pixelMatrix,t.globeMatrix);let n=[0,Wi,0],i=[0,Zi,0];return o._.transformMat4(n,n,e),o._.transformMat4(i,i,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Yy(t,new en(t.center.lat,90)),i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!Yy(t,new en(t.center.lat,-90))]},o.aW=function(t,e){let{scale:n}=t.tileTransform,i=n*Ye/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return o.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[i,i])},o.aX=dg,o.aY=IT,o.aZ=function(t){let e=IT(t,!0);return o.aC.invert([],[e[0],e[1],e[4],e[5]])},o.a_=$y,o.aa=Zr,o.ab=qt,o.ac=function(t,e,n){let i=Math.sqrt(t*t+e*e+n*n),s=i>0?Math.acos(n/i)*au:0,l=t!==0||e!==0?Math.atan2(-e,-t)*au+90:0;return l<0&&(l+=360),[i,l,s]},o.ae=lh,o.af=po,o.ag=x0,o.ah=function(t,e){let n={};for(let i=0;i<e.length;i++){let s=e[i];s in t&&(n[s]=t[s])}return n},o.ai=Ga,o.aj=$o,o.ak=Ho,o.al=Uu,o.am=function(t){fd++,fd>Ip&&(t.getActor().send("enforceCacheSizeLimit",hd),fd=0)},o.an=vd,o.ao=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,i){let s=this.entries[t]=this.entries[t]||{callbacks:[]};if(s.result){let[l,c]=s.result;return this.scheduler?this.scheduler.add(()=>{i(l,c)},e):i(l,c),()=>{}}return s.callbacks.push(i),s.cancel||(s.cancel=n((l,c)=>{s.result=[l,c];for(let p of s.callbacks)this.scheduler?this.scheduler.add(()=>{p(l,c)},e):p(l,c);setTimeout(()=>delete this.entries[t],3e3)})),()=>{s.result||(s.callbacks=s.callbacks.filter(l=>l!==i),s.callbacks.length||(s.cancel(),delete this.entries[t]))}}},o.ap=function(t,e,n){let i=JSON.stringify(t.request);return t.data&&(this.deduped.entries[i]={result:[null,t.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},s=>{let l=zo(t.request,(c,p,m,x)=>{c?s(c):p&&s(null,{vectorTile:n?void 0:new r0(new nh(p)),rawData:p,cacheControl:m,expires:x})});return()=>{l.cancel(),s()}},e)},o.aq=My,o.ar=class extends Rs{constructor(t){super(t),this.current=LC}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let i=0;i<9;i++)if(n[i]!==this.current[i]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},o.as=Cy,o.at=St,o.au=ds,o.aw=Ol,o.ax=Yr,o.ay=xr,o.az=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},o.b=$n,o.b$=Wa,o.b0=Ar,o.b1=Py,o.b2=function(t){let e=Math.round((t+45+360)%360/90)%4;return bp[e]},o.b3=45,o.b4=Oy,o.b5=Tm,o.b6=Vn,o.b7=Rr,o.b8=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},o.b9=Pl,o.bA=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},o.bB=yw,o.bD=_b,o.bE=ma,o.bF=fu,o.bG=256,o.bH=function(t,e){let n=[0,0,0],i=mf(qo(e.canonical));return o._.transformMat4(n,n,i),o._.transformMat4(n,n,t),n},o.bI=t=>({u_camera_to_center_distance:new Zr(t),u_extrude_scale:new Sy(t),u_device_pixel_ratio:new Zr(t),u_matrix:new cf(t),u_inv_rot_matrix:new cf(t),u_merc_center:new Ls(t),u_tile_id:new My(t),u_zoom_transition:new Zr(t),u_up_dir:new My(t),u_emissive_strength:new Zr(t)}),o.bJ=t=>({u_matrix:new cf(t),u_pixels_to_tile_units:new Sy(t),u_device_pixel_ratio:new Zr(t),u_units_to_pixels:new Ls(t),u_dash_image:new wm(t),u_gradient_image:new wm(t),u_image_height:new Zr(t),u_texsize:new Ls(t),u_tile_units_to_pixels:new Zr(t),u_alpha_discard_threshold:new Zr(t),u_trim_offset:new Ls(t),u_trim_fade_range:new Ls(t),u_trim_color:new Cy(t),u_emissive_strength:new Zr(t)}),o.bK=t=>({u_matrix:new cf(t),u_texsize:new Ls(t),u_pixels_to_tile_units:new Sy(t),u_device_pixel_ratio:new Zr(t),u_image:new wm(t),u_units_to_pixels:new Ls(t),u_tile_units_to_pixels:new Zr(t),u_alpha_discard_threshold:new Zr(t),u_trim_offset:new Ls(t)}),o.bL=gy,o.bM=f2,o.bN=Cr,o.bO=P2,o.bP=Qw,o.bQ=d0,o.bR=bb,o.bS=(t,e,n,i,s,l)=>{let c=t.transform,p=c.projection.name==="globe",m;if(l.paint.get("circle-pitch-alignment")==="map")if(p){let w=_b(c.zoom,e.canonical)*c._pixelsPerMercatorPixel;m=Float32Array.from([w,0,0,w])}else m=c.calculatePixelsToTileUnitsMatrix(n);else m=new Float32Array([c.pixelsToGLUnits[0],0,0,c.pixelsToGLUnits[1]]);let x={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(c.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:_r.devicePixelRatio,u_extrude_scale:m,u_inv_rot_matrix:rS,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(p){x.u_inv_rot_matrix=i,x.u_merc_center=s,x.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],x.u_zoom_transition=Ns(c.zoom);let w=s[0]*Ye,E=s[1]*Ye;x.u_up_dir=c.projection.upVector(new hc(0,0,0),w,E)}return x},o.bT=bw,o.bU=(t,e,n,i,s,l)=>{let c=t.transform;return{u_matrix:vw(t,e,n,i),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:c.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:s,u_image:0,u_tile_units_to_pixels:xw(e,c),u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:l}},o.bV=(t,e,n,i,s,l,c)=>{let p=t.transform,m=p.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:vw(t,e,n,i),u_pixels_to_tile_units:m,u_device_pixel_ratio:l,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:s,u_texsize:ww(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:xw(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:c,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength")}},o.bW=nd,o.bX=gf,o.bY=uw,o.bZ=jC,o.b_=Um,o.ba=function(t,e,n){let i=Ns(n.zoom),s=t.style.map._antialias,l=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return i===0&&!s&&!l},o.bb=function(t){let e=t.pixelsPerMeter,n=e/Yr(1,t.center.lat),i=o.ad.identity(new Float64Array(16));return o.ad.translate(i,i,[t.point.x,t.point.y,0]),o.ad.scale(i,i,[n,n,e]),Float32Array.from(i)},o.bc=Sm,o.bd=function(t){let e=nr-5;t=St(t,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(qt(t))),3);return Math.round(n*(Ry.length-1))},o.be=function(t,e,n,i){let s=e.getNorth(),l=e.getSouth(),c=e.getWest(),p=e.getEast(),m=1<<t.z,x=p-c,w=s-l,E=x/qu,D=-w/Ry[n],S=[0,E,0,D,0,0,s,c,0];if(t.z>0){let A=180/i;o.bC.multiply(S,S,[A/x+1,0,0,0,A/w+1,0,-.5*A/E,.5*A/D,1])}return S[2]=m,S[5]=t.x,S[8]=t.y,S},o.bf=mf,o.bg=qo,o.bh=function(t,e,n){let i=o.ad.identity(new Float64Array(16)),s=(e/(1<<t)-.5)*Math.PI*2;return o.ad.rotateY(i,n.globeMatrix,s),Float32Array.from(i)},o.bi=pu,o.bj=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.bk=TT,o.bl=ET,o.bm=wT,o.bn=function(t,e){let n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let i=0;i<t.length;i++){let s=document.createElement("source");Cp(t[i])||(n.crossOrigin="Anonymous"),s.src=t[i],n.appendChild(s)}return{cancel:()=>{}}},o.bo=og,o.bp=uu,o.bq=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let n=e.getSource().maxzoom,i=1<<n,s=Math.floor(t.x),l=Math.floor((t.x-s)*i),c=Math.floor(t.y*i),p=this.findDEMTileFor(new lr(n,s,n,l,c));return!(!p||!p.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let i=this._source();if(!i||t.y<0||t.y>1)return e;let s=i.getSource().maxzoom,l=1<<s,c=Math.floor(t.x),p=t.x-c,m=new lr(s,c,s,Math.floor(p*l),Math.floor(t.y*l)),x=this.findDEMTileFor(m);if(!x||!x.dem)return e;let w=x.dem,E=1<<x.tileID.canonical.z,D=(p*E-x.tileID.canonical.x)*w.dim,S=(t.y*E-x.tileID.canonical.y)*w.dim,A=Math.floor(D),R=Math.floor(S);return(n?this.exaggeration():1)*pt(pt(w.get(A,R),w.get(A,R+1),S-R),pt(w.get(A+1,R),w.get(A+1,R+1),S-R),D-A)}getAtTileOffset(t,e,n){let i=1<<t.canonical.z;return this.getAtPointOrZero(new kr(t.wrap+(t.canonical.x+e/Ye)/i,(t.canonical.y+n/Ye)/i))}getAtTileOffsetFunc(t,e,n,i){return s=>{let l=this.getAtTileOffset(t,s.x,s.y),c=i.upVector(t.canonical,s.x,s.y),p=i.upVectorScale(t.canonical,e,n).metersToTile;return o._.scale(c,c,l*p),c}}getForTilePoints(t,e,n,i){if(this.isUsingMockSource())return!1;let s=Ju.create(this,t,i);return!!s&&(e.forEach(l=>{l[2]=this.exaggeration()*s.getElevationAt(l[0],l[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let n=e.dem.tree,i=e.tileID,s=1<<t.canonical.z-i.canonical.z,l=t.canonical.x/s-i.canonical.x,c=t.canonical.y/s-i.canonical.y,p=0;for(let m=0;m<t.canonical.z-i.canonical.z&&!n.leaves[p];m++){l*=2,c*=2;let x=2*Math.floor(c)+Math.floor(l);p=n.childOffsets[p]+x,l%=1,c%=1}return{min:this.exaggeration()*n.minimums[p],max:this.exaggeration()*n.maximums[p]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,n=Number.MAX_VALUE,i=Number.MIN_VALUE;for(let s of t){let l=this.getMinMaxForTile(s.tileID);l&&(n=Math.min(n,l.min),i=Math.max(i,l.max),e=!0)}return e?{min:n,max:i}:null}},o.br=ff,o.bs=Cm,o.bt=lo,o.bu=pr,o.bv=gc,o.bw=k0,o.bx=gg,o.by=lg,o.bz=Mb,o.c=HT,o.c$=zl,o.c0=450,o.c1=7,o.c2=VA,o.c3=gT,o.c4=256,o.c5=fb,o.c6=Zy,o.c7=un,o.c8=za,o.c9=lc,o.cA=function(t){let e=1/0,n=1/0,i=-1/0,s=-1/0;for(let l of t)e=Math.min(e,l.x),n=Math.min(n,l.y),i=Math.max(i,l.x),s=Math.max(s,l.y);return{min:new tt(e,n),max:new tt(i,s)}},o.cB=$a,o.cC=eb,o.cD=Xr,o.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.cF=$w,o.cG=By,o.cH=Gb,o.cI=$b,o.cJ=g0,o.cK=U0,o.cL=function(t){return t({pluginStatus:Ae,pluginURL:at}),It.on("pluginStateChange",t),t},o.cM=oh,o.cN=p0,o.cO=md,o.cP=Lt,o.cQ=ye,o.cR=cd,o.cS=jl,o.cT=Vi,o.cU=function(t){let e=t.indexOf(ka);return e>=0?t.slice(0,e):t},o.cV=function(t){return t.indexOf(ka)>=0},o.cW=function(t){let e=t.indexOf(ka);return e>=0?t.slice(e+1):""},o.cX=function(t){let e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},o.cY=function(t,e,n,i){return t.type==="custom"?new GA(t,e):new xP[t.type](t,e,n,i)},o.cZ=id,o.c_=It,o.ca=1,o.cb=Rf,o.cc=0,o.cd=vy,o.ce=function(t,e,n,i,s){return St((t-e)/(n-e)*(s-i)+i,i,s)},o.cf=nf,o.cg=dc,o.ch=class{constructor(t,e,n,i){this.context=t,this.format=i,this.size=n,this.texture=t.gl.createTexture();let[s,l,c]=this.size,{gl:p}=t;p.bindTexture(p.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1);let m=this.format,x=p.UNSIGNED_BYTE;this.format===p.DEPTH_COMPONENT&&(m=p.DEPTH_COMPONENT16,x=p.UNSIGNED_SHORT),this.format===p.R8&&(i=p.RED),this.format===p.R32F&&(x=p.FLOAT,i=p.RED),p.texImage3D(p.TEXTURE_3D,0,m,s,l,c,0,i,x,e.data)}bind(t,e){let{context:n}=this,{gl:i}=n;i.bindTexture(i.TEXTURE_3D,this.texture),t!==this.minFilter&&(i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MAG_FILTER,t),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_S,e),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},o.ci=P0,o.cj=[1,1,1],o.ck=Ju,o.cl=dh,o.cm=Va,o.cn=$u,o.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new tt(1/0,1/0),max:new tt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){let n=Vb(new tt(0,0),new tt(Ye,Ye),t),i=[];if(e&&!i0(n,this._globalClipBounds))return i;for(let s of this._activeRegions){if(s.hiddenByOverlap||!i0(n,s))continue;let l=VS(s.min,s.max,t);i.push({min:l.min,max:l.max,sourceId:this._sourceIds[s.priority],footprint:s.footprint,footprintTileId:s.tileId,order:s.order,clipMask:s.clipMask})}return i}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let n=[];for(let i of e.cache.getVisibleCoordinates()){let s=e.cache.getTile(i).buckets[e.layer];s&&s.updateFootprints(i.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(t){let e=t.getFootprints();if(e.length===0)return;let n=t.getOrder(),i=t.getClipMask();for(let s of e){if(!s.footprint)continue;let l=Vb(s.footprint.min,s.footprint.max,s.id);this._activeRegions.push({min:l.min,max:l.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:s.id,footprint:s.footprint,order:n,clipMask:i})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||Bm(e.min,n.min)||Bm(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){let n=this._activeRegions[e],i=this._prevRegions[e];t=n.priority!==i.priority||!Bb(n,i)||n.order!==i.order||n.clipMask!==i.clipMask,++e}}if(t){++this._updateTime;for(let n of this._activeRegions)n.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));let e=n=>{let i=this._activeRegions;if(n>=i.length)return n;let s=i[n].priority;for(;n<i.length&&i[n].priority===s;)++n;return n};if(this._sourceIds.length>1){let n=0,i=e(n);for(;n!==i;){let s=n,l=n;for(;s!==i;){let c=this._activeRegions[s];c.hiddenByOverlap=!1;for(let p=0;p<l;p++){let m=this._activeRegions[p];if(!m.hiddenByOverlap&&c.order===1/0&&i0(c,m)&&(c.hiddenByOverlap=Ub(c.footprint,c.tileId,m.footprint,m.tileId),c.hiddenByOverlap))break}++s}n=i,i=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},o.cp=Fa,o.cq=ag,o.cr=af,o.cs=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let n=new lo,i=new pr,s=[],l=t+1+2,c=e[0]+1,p=e[0]+1+(1+e.length),m=(x,w,E)=>{let D=x===l-1?x-2:x===0?x:x-1;return D+=E?24575:0,[D,w]};for(let x=0;x<l;++x)n.emplaceBack(...m(x,0,!0));for(let x=0;x<c;++x)for(let w=0;w<l;++w)n.emplaceBack(...m(w,x,(w===0||w===l-1)&&!0));for(let x=0;x<e.length;++x){let w=e[x];for(let E=0;E<l;++E)n.emplaceBack(...m(E,w,!0))}for(let x=0;x<e.length;++x){let w=i.length,E=e[x]+1+2,D=new pr;for(let R=0;R<E-1;R++){let O=R===E-2,z=O?l*(p-e.length+x-R):l;for(let W=0;W<l-1;W++){let X=R*l+W;R===0||O||W===0||W===l-2?(D.emplaceBack(X+1,X,X+z),D.emplaceBack(X+z,X+z+1,X+1)):(i.emplaceBack(X+1,X,X+z),i.emplaceBack(X+z,X+z+1,X+1))}}let S=$n.simpleSegment(0,w,n.length,i.length-w);for(let R=0;R<D.uint16.length;R+=3)i.emplaceBack(D.uint16[R],D.uint16[R+1],D.uint16[R+2]);let A=$n.simpleSegment(0,w,n.length,i.length-w);s.push({withoutSkirts:S,withSkirts:A})}return{vertices:n,indices:i,segments:s}}_createGrid(t){let e=this._fillGridMeshWithLods(qu,Ry);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,ff.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new pr;for(let c=0;c<=qu;c++)e.emplaceBack(0,c+1,c+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let n=new lc,i=new lc,s=new lc,l=new lc;this._poleSegments=[];for(let c=0,p=0;c<Py;c++){let m=360/(1<<c);n.emplaceBack(0,-Xr,0,.5,0),i.emplaceBack(0,-Xr,0,.5,1),s.emplaceBack(0,-Xr,0,.5,.5),l.emplaceBack(0,-Xr,0,.5,.5);for(let x=0;x<=qu;x++){let w=x/qu,E=0,D=pt(0,m,w),[S,A,R]=Wu(tS,nS,D,Xr);n.emplaceBack(S,A,R,w,E),i.emplaceBack(S,A,R,w,1-E);let O=qt(D);w=.5+.5*Math.sin(O),E=.5+.5*Math.cos(O),s.emplaceBack(S,A,R,w,E),l.emplaceBack(S,A,R,w,1-E)}this._poleSegments.push($n.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,Mm,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(i,Mm,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(s,Mm,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(l,Mm,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},o.ct=function(t){return ys.has(t)},o.cu=Kb,o.cv=function(t,e,n=0,i=!0){let s=new tt(n,n),l=t.sub(s),c=e.add(s),p=[l,new tt(c.x,l.y),c,new tt(l.x,c.y)];return i&&p.push(l.clone()),p},o.cw=function(t,e){let n=[];for(let i=0;i<t.length;i++){let s=ds(i-1,-1,t.length-1),l=ds(i+1,-1,t.length-1),c=t[i],p=t[l],m=t[s].sub(c).unit(),x=p.sub(c).unit(),w=x.angleWithSep(m.x,m.y),E=m.add(x).unit().mult(-1*e/Math.sin(w/2));n.push(c.add(E))}return n},o.cx=tT,o.cy=ob,o.cz=function(t,e,n=0){return o._.fromValues(((e.x-n)*t.scale-t.x)*Ye,(e.y*t.scale-t.y)*Ye,Q1(e.z,e.y))},o.d=ro,o.d$=su,o.d0=hs,o.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.d2=Z_,o.d3=J1,o.d4=uc,o.d5=function([t,e,n]){let i=Math.hypot(t,e,n),s=Math.atan2(t,n),l=.5*Math.PI-Math.acos(-e/i);return new en(Ar(s),Ar(l))},o.d6=ii,o.d7=Zu,o.d8=Z,o.d9=Yy,o.dA=function(t){let e=dd();if(!e)return;let n=e.delete(ud);t&&n.catch(t).then(()=>t())},o.dB=Nf,o.dC=FT,o.dD=function(t){N0=_r.resolveURL(t),ph||(ph=new k0(gg(),new xs)),ph.broadcast("setDracoUrl",N0)},o.dE=NT,o.dF=function(t){fh=_r.resolveURL(t),ph||(ph=new k0(gg(),new xs)),ph.broadcast("setMeshoptUrl",fh)},o.dG=td,o.dH=q,o.dI=Ha,o.dJ=fo,o.dK=mc,o.dL=Iy,o.dM=Tw,o.dN=Aw,o.dO=gw,o.dP=Fo,o.dQ=qw,o.dR=ch,o.dS=function(t,e,n,i,s,l,c,p,m,x,w){t.createArrays(),t.tilePixelRatio=Ye/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let E=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,S={};if(t.textSizeData.kind==="composite"){let{minZoom:z,maxZoom:W}=t.textSizeData;S.compositeTextSizes=[D["text-size"].possiblyEvaluate(new vt(z),p),D["text-size"].possiblyEvaluate(new vt(W),p)]}if(t.iconSizeData.kind==="composite"){let{minZoom:z,maxZoom:W}=t.iconSizeData;S.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new vt(z),p),D["icon-size"].possiblyEvaluate(new vt(W),p)]}S.layoutTextSize=D["text-size"].possiblyEvaluate(new vt(m+1),p),S.layoutIconSize=D["icon-size"].possiblyEvaluate(new vt(m+1),p),S.textMaxSize=D["text-size"].possiblyEvaluate(new vt(18),p);let A=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",R=E.get("text-size"),O=!1;for(let z of t.features)if(z.icon&&z.icon.nameSecondary){O=!0;break}for(let z of t.features){let W=E.get("text-font").evaluate(z,{},p).join(","),X=R.evaluate(z,{},p),Y=S.layoutTextSize.evaluate(z,{},p),re=(S.layoutIconSize.evaluate(z,{},p),{horizontal:{},vertical:void 0}),ne=z.text,ue,de=[0,0];if(ne){let Te=ne.toString(),Le=E.get("text-letter-spacing").evaluate(z,{},p)*Cr,Ue=E.get("text-line-height").evaluate(z,{},p)*Cr,Pe=Fe(Te)?Le:0,Be=E.get("text-anchor").evaluate(z,{},p),Se=E.get("text-variable-anchor");if(!Se){let Ge=E.get("text-radial-offset").evaluate(z,{},p);de=Ge?Qw(Be,[Ge*Cr,m0]):E.get("text-offset").evaluate(z,{},p).map(We=>We*Cr)}let Ve=A?"center":E.get("text-justify").evaluate(z,{},p),He=E.get("symbol-placement")==="point",je=He?E.get("text-max-width").evaluate(z,{},p)*Cr:1/0,rt=Ge=>{t.allowVerticalPlacement&&Ee(Te)&&(re.vertical=h0(ne,e,n,s,W,je,Ue,Be,Ge,Pe,de,Ri.vertical,!0,Y,X))};if(!A&&Se){let Ge=Ve==="auto"?Se.map(dt=>g0(dt)):[Ve],We=!1;for(let dt=0;dt<Ge.length;dt++){let ht=Ge[dt];if(!re.horizontal[ht])if(We)re.horizontal[ht]=re.horizontal[0];else{let ct=h0(ne,e,n,s,W,je,Ue,"center",ht,Pe,de,Ri.horizontal,!1,Y,X);ct&&(re.horizontal[ht]=ct,We=ct.positionedLines.length===1)}}rt("left")}else{if(Ve==="auto"&&(Ve=g0(Be)),He||E.get("text-writing-mode").indexOf("horizontal")>=0||!Ee(Te)){let Ge=h0(ne,e,n,s,W,je,Ue,Be,Ve,Pe,de,Ri.horizontal,!1,Y,X);Ge&&(re.horizontal[Ve]=Ge)}rt(He?"left":Ve)}}let ve=!1;if(z.icon&&z.icon.namePrimary){let Te=i[z.icon.namePrimary];Te&&(ue=V2(s[z.icon.namePrimary],z.icon.nameSecondary?s[z.icon.nameSecondary]:void 0,E.get("icon-offset").evaluate(z,{},p),E.get("icon-anchor").evaluate(z,{},p)),ve=Te.sdf,t.sdfIcons===void 0?t.sdfIcons=Te.sdf:t.sdfIcons!==Te.sdf&&Qn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Te.pixelRatio!==t.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let Ce=Jw(re.horizontal)||re.vertical;t.iconsInText||(t.iconsInText=!!Ce&&Ce.iconsInText),(Ce||ue)&&W2(t,z,re,ue,i,S,Y,0,de,ve,c,p,x,w,O)}l&&t.generateCollisionDebugBuffers(m,t.collisionBoxArray)},o.dT=Gm,o.dU=km,o.dV=r0,o.dW=nh,o.dX=Vm,o.dY=M0,o.dZ=Nm,o.d_=Fm,o.da=xb,o.db=function(t){let e=[0,0,0],n=o.ad.identity(new Float64Array(16));return o.ad.multiply(n,t.pixelMatrix,t.globeMatrix),o._.transformMat4(e,e,n),new tt(e[0],e[1])},o.dc=Zt,o.dd=mt,o.de=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(No==null){let i=n.navigator?n.navigator.userAgent:null;No=!!n.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return No}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.df=lu,o.dg=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",yd,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!ye(t))return t;let n=Ti(t);return n.params.push(`sdk=js-${k}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!ye(t))return t;let n=Ti(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!ye(t))return t;let n=Ti(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,i){if(!ye(t))return t;let s=Ti(t);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),n&&s.params.push(`language=${n}`),i&&s.params.push(`worldview=${i}`),this._makeAPIURL(s,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,i){let s=Ti(t);return ye(t)?(s.path=`/styles/v1${s.path}/sprite${e}${n}`,this._makeAPIURL(s,this._customAccessToken||i)):(s.path+=`${e}${n}`,_s(s))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ye(t))return t;let i=Ti(t);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&i.authority!=="raster"&&n===512?"@2x":""}${Fl.supported?".webp":"$1"}`),i.authority==="raster"?i.path=`/${Z.RASTER_URL_PREFIX}${i.path}`:i.authority==="rasterarrays"?i.path=`/${Z.RASTERARRAYS_URL_PREFIX}${i.path}`:i.authority==="3dtiles"?i.path=`/${Z.TILES3D_URL_PREFIX}${i.path}`:(i.path=i.path.replace(/^.+\/v4\//,"/"),i.path=`/${Z.TILE_URL_VERSION}${i.path}`);let s=this._customAccessToken||function(l){for(let c of l){let p=c.match(/^access_token=(.*)$/);if(p)return p[1]}return null}(i.params)||Z.ACCESS_TOKEN;return Z.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&i.params.push(`sku=${this._skuToken}`),this._makeAPIURL(i,s)}canonicalizeTileURL(t,e){let n=Ti(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let i="mapbox://";n.path.match(/^\/raster\/v1\//)?i+=`raster/${n.path.replace(`/${Z.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?i+=`rasterarrays/${n.path.replace(`/${Z.RASTERARRAYS_URL_PREFIX}/`,"")}`:i+=`tiles/${n.path.replace(`/${Z.TILE_URL_VERSION}/`,"")}`;let s=n.params;return e&&(s=s.filter(l=>!l.match(/^access_token=/))),s.length&&(i+=`?${s.join("&")}`),i}canonicalizeTileset(t,e){let n=!!e&&ye(e),i=[];for(let s of t.tiles||[])me(s)?i.push(this.canonicalizeTileURL(s,n)):i.push(s);return i}_makeAPIURL(t,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",i=Ti(Z.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,t.protocol==="http"){let s=t.params.indexOf("secure");s>=0&&t.params.splice(s,1)}if(i.path!=="/"&&(t.path=`${i.path}${t.path}`),!Z.REQUIRE_ACCESS_TOKEN)return _s(t);if(e=e||Z.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(s=>s.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),_s(t)}},o.dh=function(t,e){e?ys.add(t):ys.delete(t)},o.di=Fl,o.dj=wu,o.dk=Op,o.dl=xd,o.dm=X_,o.dn=bd,o.dp=function(t){ys.delete(t)},o.dq=_a,o.dr=bu,o.ds=$r,o.dt=k,o.du=function(t,e){hd=t,Ip=e},o.dv=function(t,e,n=!1){if(Ae===Ke||Ae===nt||Ae===Je)throw new Error("setRTLTextPlugin cannot be called multiple times.");at=_r.resolveURL(t),Ae=Ke,Ze=e,gt(),n||Ln()},o.dw=Gt,o.dx=function(){gg().acquire(F0)},o.dy=function(){let t=Bf;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(F0),Bf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.dz=zf,o.e=_r,o.e0=Ew,o.e1=Rt,o.e2=zo,o.e3=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==BT){let n=new Uint32Array(t,0,7),[,,i,s,l,c]=n;e=n.byteLength+s+l+c+l,(i!==t.byteLength||e>=t.byteLength)&&Qn("Invalid b3dm header information.")}return GT(t,e)},o.e4=function(t,e){let n=HT(t);for(let i of n){for(let s of i.meshes)mP(s);i.lights&&(i.lightMeshIndex=i.meshes.length,i.meshes.push(gP(i.lights,e)))}return n},o.e5=vg,o.e6=kT,o.e7=Bt,o.e8=function(t){kl(),no&&no.then(e=>{e.keys().then(n=>{for(let i=0;i<n.length-t;i++)e.delete(n[i])})})},o.f=ei,o.g=function(t,e){return zl(Pr(t,{type:"json"}),e)},o.h=_d,o.i=Pi,o.j=Hw,o.k=f0,o.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>GT(e,0,t))},o.m=class extends pg{},o.n=bs,o.o=Id,o.p=aA,o.q=of,o.r=r,o.s=a,o.t=F,o.u=Or,o.v=Ir,o.w=Qn,o.x=G,o.y=N,o.z=Ou}),v(["./shared"],function(o){function k(fe){let B=fe?fe.url.toString():void 0;return B?performance.getEntriesByName(B):[]}function V(fe){if(typeof fe=="number"||typeof fe=="boolean"||typeof fe=="string"||fe==null)return JSON.stringify(fe);if(Array.isArray(fe)){let H="[";for(let te of fe)H+=`${V(te)},`;return`${H}]`}let B="{";for(let H of Object.keys(fe).sort())B+=`${H}:${V(fe[H])},`;return`${B}}`}function Z(fe){let B="";for(let H of o.cE)B+=`/${V(fe[H])}`;return B}class me{constructor(B){this.keyCache={},this._layers={},this._layerConfigs={},B&&this.replace(B)}replace(B,H){this._layerConfigs={},this._layers={},this.update(B,[],H)}update(B,H,te){this._options=te;for(let le of B)this._layerConfigs[le.id]=le,(this._layers[le.id]=o.cY(le,this.scope,null,this._options)).compileFilter(),this.keyCache[le.id]&&delete this.keyCache[le.id];for(let le of H)delete this.keyCache[le],delete this._layerConfigs[le],delete this._layers[le];this.familiesBySource={};let se=function(le,xe){let Ie={};for(let Me=0;Me<le.length;Me++){let Xe=xe&&xe[le[Me].id]||Z(le[Me]);xe&&(xe[le[Me].id]=Xe);let $e=Ie[Xe];$e||($e=Ie[Xe]=[]),$e.push(le[Me])}let ge=[];for(let Me in Ie)ge.push(Ie[Me]);return ge}(o.dG(this._layerConfigs),this.keyCache);for(let le of se){let xe=le.map(ut=>this._layers[ut.id]),Ie=xe[0];if(Ie.visibility==="none")continue;let ge=Ie.source||"",Me=this.familiesBySource[ge];Me||(Me=this.familiesBySource[ge]={});let Xe=Ie.sourceLayer||"_geojsonTileLayer",$e=Me[Xe];$e||($e=Me[Xe]=[]),$e.push(xe)}}}let ye=1*o.dJ;class Ne{constructor(B){let H={},te=[];for(let Ie in B){let ge=B[Ie],Me=H[Ie]={};for(let Xe in ge.glyphs){let $e=ge.glyphs[+Xe];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;let ut=$e.metrics.localGlyph?ye:1,yt={x:0,y:0,w:$e.bitmap.width+2*ut,h:$e.bitmap.height+2*ut};te.push(yt),Me[Xe]=yt}}let{w:se,h:le}=o.j(te),xe=new o.dI({width:se||1,height:le||1});for(let Ie in B){let ge=B[Ie];for(let Me in ge.glyphs){let Xe=ge.glyphs[+Me];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;let $e=H[Ie][Me],ut=Xe.metrics.localGlyph?ye:1;o.dI.copy(Xe.bitmap,xe,{x:0,y:0},{x:$e.x+ut,y:$e.y+ut},Xe.bitmap)}}this.image=xe,this.positions=H}}o.dH(Ne,"GlyphAtlas");class ot{constructor(B){this.tileID=new o.aL(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.tileZoom=B.tileZoom,this.uid=B.uid,this.zoom=B.zoom,this.lut=B.lut,this.canonical=B.tileID.canonical,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.scope=B.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=B.showCollisionBoxes,this.collectResourceTiming=!!B.collectResourceTiming,this.promoteId=B.promoteId,this.isSymbolTile=B.isSymbolTile,this.tileTransform=o.dK(B.tileID.canonical,B.projection),this.projection=B.projection,this.brightness=B.brightness,this.extraShadowCaster=!!B.extraShadowCaster,this.tessellationStep=B.tessellationStep}parse(B,H,te,se,le){this.status="parsing",this.data=B,this.collisionBoxArray=new o.dL;let xe=new o.dM(Object.keys(B.layers).sort()),Ie=new o.dN(this.tileID,this.promoteId);Ie.bucketLayerIDs=[];let ge={},Me=new o.dO(256,256),Xe={featureIndex:Ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Me,availableImages:te,brightness:this.brightness},$e=H.familiesBySource[this.source];for(let lt in $e){let Nn=B.layers[lt];if(!Nn)continue;let mn=!1,Kt=!1,er=!1;for(let Tr of $e[lt])Tr[0].type==="symbol"?mn=!0:Kt=!0,Tr[0].is3D()&&Tr[0].type!=="model"&&(er=!0);if(this.extraShadowCaster&&!er||this.isSymbolTile===!0&&!mn||this.isSymbolTile===!1&&!Kt)continue;Nn.version===1&&o.w(`Vector tile source "${this.source}" layer "${lt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let zn=xe.encode(lt),sr=[];for(let Tr=0;Tr<Nn.length;Tr++){let Er=Nn.feature(Tr),us=Ie.getId(Er,lt);sr.push({feature:Er,id:us,index:Tr,sourceLayerIndex:zn})}for(let Tr of $e[lt]){let Er=Tr[0];(!this.extraShadowCaster||Er.is3D()&&Er.type!=="model")&&(this.isSymbolTile!==void 0&&Er.type==="symbol"!==this.isSymbolTile||Er.minzoom&&this.zoom<Math.floor(Er.minzoom)||Er.maxzoom&&this.zoom>=Er.maxzoom||Er.visibility!=="none"&&(et(Tr,this.zoom,Xe.brightness,te),(ge[Er.id]=Er.createBucket({index:Ie.bucketLayerIDs.length,layers:Tr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:zn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(sr,Xe,this.tileID.canonical,this.tileTransform),Ie.bucketLayerIDs.push(Tr.map(us=>us.id))))}}let ut,yt,Ft,Nt;Me.trim();let Ct={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Xt=()=>{if(ut)return this.status="done",le(ut);if(this.extraShadowCaster)this.status="done",le(null,{buckets:o.dG(ge).filter(lt=>!lt.isEmpty()),featureIndex:Ie,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Xe.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(yt&&Ft&&Nt){let lt=new Ne(yt),Nn=new o.dQ(Ft,Nt,this.lut);for(let mn in ge){let Kt=ge[mn];Kt instanceof o.dR?(et(Kt.layers,this.zoom,Xe.brightness,te),o.dS(Kt,yt,lt.positions,Ft,Nn.iconPositions,this.showCollisionBoxes,te,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Kt.hasPattern&&(Kt instanceof o.dT||Kt instanceof o.dU||Kt instanceof o.b_)&&(et(Kt.layers,this.zoom,Xe.brightness,te),Kt.addFeatures(Xe,this.tileID.canonical,Nn.patternPositions,te,this.tileTransform,this.brightness))}this.status="done",le(null,{buckets:o.dG(ge).filter(mn=>!mn.isEmpty()),featureIndex:Ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:lt.image,lineAtlas:Me,imageAtlas:Nn,brightness:Xe.brightness})}};if(!this.extraShadowCaster){let lt=o.dP(Xe.glyphDependencies,Kt=>Object.keys(Kt).map(Number));Object.keys(lt).length?se.send("getGlyphs",{uid:this.uid,stacks:lt,scope:this.scope},(Kt,er)=>{ut||(ut=Kt,yt=er,Xt())},void 0,!1,Ct):yt={};let Nn=Object.keys(Xe.iconDependencies);Nn.length?se.send("getImages",{icons:Nn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Kt,er)=>{ut||(ut=Kt,Ft=er,Xt())},void 0,!1,Ct):Ft={};let mn=Object.keys(Xe.patternDependencies);mn.length?se.send("getImages",{icons:mn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Kt,er)=>{ut||(ut=Kt,Nt=er,Xt())},void 0,!1,Ct):Nt={}}Xt()}}function et(fe,B,H,te){let se=new o.X(B,{brightness:H});for(let le of fe)le.recalculate(se,te)}class mt extends o.E{constructor(B,H,te,se,le,xe){super(),this.actor=B,this.layerIndex=H,this.availableImages=te,this.loadVectorData=le||o.ap,this.loading={},this.loaded={},this.deduped=new o.ao(B.scheduler),this.isSpriteLoaded=se,this.scheduler=B.scheduler,this.brightness=xe}loadTile(B,H){let te=B.uid,se=B&&B.request,le=se&&se.collectResourceTiming,xe=this.loading[te]=new ot(B);xe.abort=this.loadVectorData(B,(Ie,ge)=>{let Me=!this.loading[te];if(delete this.loading[te],Me||Ie||!ge)return xe.status="done",Me||(this.loaded[te]=xe),H(Ie);let Xe=ge.rawData,$e={};ge.expires&&($e.expires=ge.expires),ge.cacheControl&&($e.cacheControl=ge.cacheControl),xe.vectorTile=ge.vectorTile||new o.dV(new o.dW(Xe));let ut=()=>{xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.actor,(yt,Ft)=>{if(yt||!Ft)return H(yt);let Nt={};if(le){let Ct=k(se);Ct.length>0&&(Nt.resourceTiming=JSON.parse(JSON.stringify(Ct)))}H(null,o.W({rawTileData:Xe.slice(0)},Ft,$e,Nt))})};this.isSpriteLoaded?ut():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ut,{type:"parseTile",isSymbolTile:B.isSymbolTile,zoom:B.tileZoom}):ut()}),this.loaded=this.loaded||{},this.loaded[te]=xe})}reloadTile(B,H){let te=this.loaded,se=B.uid;if(te&&te[se]){let le=te[se];le.showCollisionBoxes=B.showCollisionBoxes,le.projection=B.projection,le.brightness=B.brightness,le.tileTransform=o.dK(B.tileID.canonical,B.projection),le.extraShadowCaster=B.extraShadowCaster,le.lut=B.lut;let xe=(Ie,ge)=>{let Me=le.reloadCallback;Me&&(delete le.reloadCallback,le.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor,Me)),H(Ie,ge)};le.status==="parsing"?le.reloadCallback=xe:le.status==="done"&&(le.vectorTile?le.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor,xe):xe())}else H(null,void 0)}abortTile(B,H){let te=B.uid,se=this.loading[te];se&&(se.abort&&se.abort(),delete this.loading[te]),H()}removeTile(B,H){let te=this.loaded,se=B.uid;te&&te[se]&&delete te[se],H()}}class Zt{loadTile(B,H){let{uid:te,encoding:se,rawImageData:le,padding:xe}=B,Ie=ImageBitmap&&le instanceof ImageBitmap?this.getImageData(le,xe):le;H(null,new o.dX(te,Ie,se,xe<1))}getImageData(B,H){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(B.width,B.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=B.width,this.offscreenCanvas.height=B.height,this.offscreenCanvasContext.drawImage(B,0,0,B.width,B.height);let te=this.offscreenCanvasContext.getImageData(-H,-H,B.width+2*H,B.height+2*H);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),te}}class jt{decodeRasterArray({task:B,buffer:H},te){o.dY.performDecoding(H,B).then(se=>{te(null,se)},se=>{te(se)})}}let Rt=o.dZ.prototype.toGeoJSON,an=class{constructor(fe){this._feature=fe,this.extent=o.a3,this.type=fe.type,this.properties=fe.tags,"id"in fe&&!isNaN(fe.id)&&(this.id=parseInt(fe.id,10))}loadGeometry(){if(this._feature.type===1){let fe=[];for(let B of this._feature.geometry)fe.push([new o.P(B[0],B[1])]);return fe}{let fe=[];for(let B of this._feature.geometry){let H=[];for(let te of B)H.push(new o.P(te[0],te[1]));fe.push(H)}return fe}}toGeoJSON(fe,B,H){return Rt.call(this,fe,B,H)}},Ut=class{constructor(fe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.a3,this.length=fe.length,this._features=fe}feature(fe){return new an(this._features[fe])}},pn=64/4096;class mr{constructor(){this.features=new Map}clear(){this.features.clear()}load(B=[],H){for(let te of B){let se=te.id;if(se==null)continue;let le=this.features.get(se);le&&this.updateCache(le,H),te.geometry?(le=Sr(te),this.updateCache(le,H),this.features.set(se,le)):this.features.delete(se),this.updateCache(le,H)}}updateCache(B,H){for(let{canonical:te,uid:se}of Object.values(H)){let{z:le,x:xe,y:Ie}=te;Yn(B,Math.pow(2,le),xe,Ie)&&delete H[se]}}getTile(B,H,te){let se=Math.pow(2,B),le=[];for(let xe of this.features.values())Yn(xe,se,H,te)&&le.push(qc(xe,se,H,te));return{features:le}}getFeatures(){return[...this.features.values()]}}function Yn({minX:fe,minY:B,maxX:H,maxY:te},se,le,xe){return fe<(le+1+pn)/se&&B<(xe+1+pn)/se&&H>(le-pn)/se&&te>(xe-pn)/se}function Sr(fe){let{id:B,geometry:H,properties:te}=fe;if(!H)return;if(H.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:se,coordinates:le}=H,xe={id:B,type:1,geometry:[],tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ie=xe.geometry;if(se==="Point")cn(le,Ie,xe);else if(se==="MultiPoint")for(let ge of le)cn(ge,Ie,xe);else if(se==="LineString")xe.type=2,Ao(le,Ie,xe);else if(se==="MultiLineString")xe.type=2,Qt(le,Ie,xe);else if(se==="Polygon")xe.type=3,Qt(le,Ie,xe,!0);else{if(se!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");xe.type=3;for(let ge of le)Qt(ge,Ie,xe,!0)}return xe}function cn([fe,B],H,te){let se=o.aj(fe),le=o.ak(B);le=le<0?0:le>1?1:le,H.push(se,le),te.minX=Math.min(te.minX,se),te.minY=Math.min(te.minY,le),te.maxX=Math.max(te.maxX,se),te.maxY=Math.max(te.maxY,le)}function Ao(fe,B,H,te=!1,se=!1){let le=[];for(let xe of fe)cn(xe,le,H);B.push(le),te&&function(xe,Ie){let ge=0;for(let Me=0,Xe=xe.length,$e=Xe-2;Me<Xe;$e=Me,Me+=2)ge+=(xe[Me]-xe[$e])*(xe[Me+1]+xe[$e+1]);if(ge>0===Ie)for(let Me=0,Xe=xe.length;Me<Xe/2;Me+=2){let $e=xe[Me],ut=xe[Me+1];xe[Me]=xe[Xe-2-Me],xe[Me+1]=xe[Xe-1-Me],xe[Xe-2-Me]=$e,xe[Xe-1-Me]=ut}}(le,se)}function Qt(fe,B,H,te=!1){for(let se=0;se<fe.length;se++)Ao(fe[se],B,H,te,se===0)}function qc(fe,B,H,te){let{id:se,type:le,geometry:xe,tags:Ie}=fe,ge=[];if(le===1)yl(xe,B,H,te,ge);else for(let Me of xe)ge.push(yl(Me,B,H,te));return{id:se,type:le,geometry:ge,tags:Ie}}function yl(fe,B,H,te,se=[]){for(let le=0;le<fe.length;le+=2)se.push(Wc(fe[le],fe[le+1],B,H,te));return se}function Wc(fe,B,H,te,se){return[Math.round(o.a3*(fe*H-te)),Math.round(o.a3*(B*H-se))]}var bn={exports:{}},xl=o.d$,si=o.d_.VectorTileFeature,Zc=vl;function vl(fe,B){this.options=B||{},this.features=fe,this.length=fe.length}function is(fe,B){this.id=typeof fe.id=="number"?fe.id:void 0,this.type=fe.type,this.rawGeometry=fe.type===1?[fe.geometry]:fe.geometry,this.properties=fe.tags,this.extent=B||4096}vl.prototype.feature=function(fe){return new is(this.features[fe],this.options.extent)},is.prototype.loadGeometry=function(){var fe=this.rawGeometry;this.geometry=[];for(var B=0;B<fe.length;B++){for(var H=fe[B],te=[],se=0;se<H.length;se++)te.push(new xl(H[se][0],H[se][1]));this.geometry.push(te)}return this.geometry},is.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var fe=this.geometry,B=1/0,H=-1/0,te=1/0,se=-1/0,le=0;le<fe.length;le++)for(var xe=fe[le],Ie=0;Ie<xe.length;Ie++){var ge=xe[Ie];B=Math.min(B,ge.x),H=Math.max(H,ge.x),te=Math.min(te,ge.y),se=Math.max(se,ge.y)}return[B,te,H,se]},is.prototype.toGeoJSON=si.prototype.toGeoJSON;var fn=o.e0,Ys=Zc;function wr(fe){var B=new fn;return function(H,te){for(var se in H.layers)te.writeMessage(3,Xc,H.layers[se])}(fe,B),B.finish()}function Xc(fe,B){var H;B.writeVarintField(15,fe.version||1),B.writeStringField(1,fe.name||""),B.writeVarintField(5,fe.extent||4096);var te={keys:[],values:[],keycache:{},valuecache:{}};for(H=0;H<fe.length;H++)te.feature=fe.feature(H),B.writeMessage(2,Yc,te);var se=te.keys;for(H=0;H<se.length;H++)B.writeStringField(3,se[H]);var le=te.values;for(H=0;H<le.length;H++)B.writeMessage(4,Kc,le[H])}function Yc(fe,B){var H=fe.feature;H.id!==void 0&&B.writeVarintField(1,H.id),B.writeMessage(2,Qc,fe),B.writeVarintField(3,H.type),B.writeMessage(4,Fn,H)}function Qc(fe,B){var H=fe.feature,te=fe.keys,se=fe.values,le=fe.keycache,xe=fe.valuecache;for(var Ie in H.properties){var ge=H.properties[Ie],Me=le[Ie];if(ge!==null){Me===void 0&&(te.push(Ie),le[Ie]=Me=te.length-1),B.writeVarint(Me);var Xe=typeof ge;Xe!=="string"&&Xe!=="boolean"&&Xe!=="number"&&(ge=JSON.stringify(ge));var $e=Xe+":"+ge,ut=xe[$e];ut===void 0&&(se.push(ge),xe[$e]=ut=se.length-1),B.writeVarint(ut)}}}function wt(fe,B){return(B<<3)+(7&fe)}function Qs(fe){return fe<<1^fe>>31}function Fn(fe,B){for(var H=fe.loadGeometry(),te=fe.type,se=0,le=0,xe=H.length,Ie=0;Ie<xe;Ie++){var ge=H[Ie],Me=1;te===1&&(Me=ge.length),B.writeVarint(wt(1,Me));for(var Xe=te===3?ge.length-1:ge.length,$e=0;$e<Xe;$e++){$e===1&&te!==1&&B.writeVarint(wt(2,Xe-1));var ut=ge[$e].x-se,yt=ge[$e].y-le;B.writeVarint(Qs(ut)),B.writeVarint(Qs(yt)),se+=ut,le+=yt}te===3&&B.writeVarint(wt(7,1))}}function Kc(fe,B){var H=typeof fe;H==="string"?B.writeStringField(1,fe):H==="boolean"?B.writeBooleanField(7,fe):H==="number"&&(fe%1!=0?B.writeDoubleField(3,fe):fe<0?B.writeSVarintField(6,fe):B.writeVarintField(5,fe))}bn.exports=wr,bn.exports.fromVectorTileJs=wr,bn.exports.fromGeojsonVt=function(fe,B){B=B||{};var H={};for(var te in fe)H[te]=new Ys(fe[te].features,B),H[te].name=te,H[te].version=B.version,H[te].extent=B.extent;return wr({layers:H})},bn.exports.GeoJSONWrapper=Ys;var Jc=o.e1(bn.exports);let eu={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:fe=>fe},bl=Math.fround||(Ks=new Float32Array(1),fe=>(Ks[0]=+fe,Ks[0]));var Ks;let bi=3,wi=5,wl=6;class bt{constructor(B){this.options=Object.assign(Object.create(eu),B),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(B){let{log:H,minZoom:te,maxZoom:se}=this.options;H&&console.time("total time");let le=`prepare ${B.length} points`;H&&console.time(le),this.points=B;let xe=[];for(let ge=0;ge<B.length;ge++){let Me=B[ge];if(!Me.geometry)continue;let[Xe,$e]=Me.geometry.coordinates,ut=bl(Gr(Xe)),yt=bl(os($e));xe.push(ut,yt,1/0,ge,-1,1),this.options.reduce&&xe.push(0)}let Ie=this.trees[se+1]=this._createTree(xe);H&&console.timeEnd(le);for(let ge=se;ge>=te;ge--){let Me=+Date.now();Ie=this.trees[ge]=this._createTree(this._cluster(Ie,ge)),H&&console.log("z%d: %d clusters in %dms",ge,Ie.numItems,+Date.now()-Me)}return H&&console.timeEnd("total time"),this}getClusters(B,H){let te=((B[0]+180)%360+360)%360-180,se=Math.max(-90,Math.min(90,B[1])),le=B[2]===180?180:((B[2]+180)%360+360)%360-180,xe=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)te=-180,le=180;else if(te>le){let $e=this.getClusters([te,se,180,xe],H),ut=this.getClusters([-180,se,le,xe],H);return $e.concat(ut)}let Ie=this.trees[this._limitZoom(H)],ge=Ie.range(Gr(te),os(xe),Gr(le),os(se)),Me=Ie.data,Xe=[];for(let $e of ge){let ut=this.stride*$e;Xe.push(Me[ut+wi]>1?Tt(Me,ut,this.clusterProps):this.points[Me[ut+bi]])}return Xe}getChildren(B){let H=this._getOriginId(B),te=this._getOriginZoom(B),se="No cluster with the specified id.",le=this.trees[te];if(!le)throw new Error(se);let xe=le.data;if(H*this.stride>=xe.length)throw new Error(se);let Ie=this.options.radius/(this.options.extent*Math.pow(2,te-1)),ge=le.within(xe[H*this.stride],xe[H*this.stride+1],Ie),Me=[];for(let Xe of ge){let $e=Xe*this.stride;xe[$e+4]===B&&Me.push(xe[$e+wi]>1?Tt(xe,$e,this.clusterProps):this.points[xe[$e+bi]])}if(Me.length===0)throw new Error(se);return Me}getLeaves(B,H,te){let se=[];return this._appendLeaves(se,B,H=H||10,te=te||0,0),se}getTile(B,H,te){let se=this.trees[this._limitZoom(B)],le=Math.pow(2,B),{extent:xe,radius:Ie}=this.options,ge=Ie/xe,Me=(te-ge)/le,Xe=(te+1+ge)/le,$e={features:[]};return this._addTileFeatures(se.range((H-ge)/le,Me,(H+1+ge)/le,Xe),se.data,H,te,le,$e),H===0&&this._addTileFeatures(se.range(1-ge/le,Me,1,Xe),se.data,le,te,le,$e),H===le-1&&this._addTileFeatures(se.range(0,Me,ge/le,Xe),se.data,-1,te,le,$e),$e.features.length?$e:null}getClusterExpansionZoom(B){let H=this._getOriginZoom(B)-1;for(;H<=this.options.maxZoom;){let te=this.getChildren(B);if(H++,te.length!==1)break;B=te[0].properties.cluster_id}return H}_appendLeaves(B,H,te,se,le){let xe=this.getChildren(H);for(let Ie of xe){let ge=Ie.properties;if(ge&&ge.cluster?le+ge.point_count<=se?le+=ge.point_count:le=this._appendLeaves(B,ge.cluster_id,te,se,le):le<se?le++:B.push(Ie),B.length===te)break}return le}_createTree(B){let H=new o.cK(B.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<B.length;te+=this.stride)H.add(B[te],B[te+1]);return H.finish(),H.data=B,H}_addTileFeatures(B,H,te,se,le,xe){for(let Ie of B){let ge=Ie*this.stride,Me=H[ge+wi]>1,Xe,$e,ut;if(Me)Xe=Js(H,ge,this.clusterProps),$e=H[ge],ut=H[ge+1];else{let Nt=this.points[H[ge+bi]];Xe=Nt.properties;let[Ct,Xt]=Nt.geometry.coordinates;$e=Gr(Ct),ut=os(Xt)}let yt={type:1,geometry:[[Math.round(this.options.extent*($e*le-te)),Math.round(this.options.extent*(ut*le-se))]],tags:Xe},Ft;Ft=Me||this.options.generateId?H[ge+bi]:this.points[H[ge+bi]].id,Ft!==void 0&&(yt.id=Ft),xe.features.push(yt)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(Math.floor(+B),this.options.maxZoom+1))}_cluster(B,H){let{radius:te,extent:se,reduce:le,minPoints:xe}=this.options,Ie=te/(se*Math.pow(2,H)),ge=B.data,Me=[],Xe=this.stride;for(let $e=0;$e<ge.length;$e+=Xe){if(ge[$e+2]<=H)continue;ge[$e+2]=H;let ut=ge[$e],yt=ge[$e+1],Ft=B.within(ge[$e],ge[$e+1],Ie),Nt=ge[$e+wi],Ct=Nt;for(let Xt of Ft){let lt=Xt*Xe;ge[lt+2]>H&&(Ct+=ge[lt+wi])}if(Ct>Nt&&Ct>=xe){let Xt,lt=ut*Nt,Nn=yt*Nt,mn=-1,Kt=($e/Xe<<5)+(H+1)+this.points.length;for(let er of Ft){let zn=er*Xe;if(ge[zn+2]<=H)continue;ge[zn+2]=H;let sr=ge[zn+wi];lt+=ge[zn]*sr,Nn+=ge[zn+1]*sr,ge[zn+4]=Kt,le&&(Xt||(Xt=this._map(ge,$e,!0),mn=this.clusterProps.length,this.clusterProps.push(Xt)),le(Xt,this._map(ge,zn)))}ge[$e+4]=Kt,Me.push(lt/Ct,Nn/Ct,1/0,Kt,-1,Ct),le&&Me.push(mn)}else{for(let Xt=0;Xt<Xe;Xt++)Me.push(ge[$e+Xt]);if(Ct>1)for(let Xt of Ft){let lt=Xt*Xe;if(!(ge[lt+2]<=H)){ge[lt+2]=H;for(let Nn=0;Nn<Xe;Nn++)Me.push(ge[lt+Nn])}}}}return Me}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,H,te){if(B[H+wi]>1){let xe=this.clusterProps[B[H+wl]];return te?Object.assign({},xe):xe}let se=this.points[B[H+bi]].properties,le=this.options.map(se);return te&&le===se?Object.assign({},le):le}}function Tt(fe,B,H){return{type:"Feature",id:fe[B+bi],properties:Js(fe,B,H),geometry:{type:"Point",coordinates:[(te=fe[B],360*(te-.5)),ea(fe[B+1])]}};var te}function Js(fe,B,H){let te=fe[B+wi],se=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,le=fe[B+wl],xe=le===-1?{}:Object.assign({},H[le]);return Object.assign(xe,{cluster:!0,cluster_id:fe[B+bi],point_count:te,point_count_abbreviated:se})}function Gr(fe){return fe/360+.5}function os(fe){let B=Math.sin(fe*Math.PI/180),H=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return H<0?0:H>1?1:H}function ea(fe){let B=(180-360*fe)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function ta(fe,B,H,te){let se=te,le=B+(H-B>>1),xe,Ie=H-B,ge=fe[B],Me=fe[B+1],Xe=fe[H],$e=fe[H+1];for(let ut=B+3;ut<H;ut+=3){let yt=Tl(fe[ut],fe[ut+1],ge,Me,Xe,$e);if(yt>se)xe=ut,se=yt;else if(yt===se){let Ft=Math.abs(ut-le);Ft<Ie&&(xe=ut,Ie=Ft)}}se>te&&(xe-B>3&&ta(fe,B,xe,te),fe[xe+2]=se,H-xe>3&&ta(fe,xe,H,te))}function Tl(fe,B,H,te,se,le){let xe=se-H,Ie=le-te;if(xe!==0||Ie!==0){let ge=((fe-H)*xe+(B-te)*Ie)/(xe*xe+Ie*Ie);ge>1?(H=se,te=le):ge>0&&(H+=xe*ge,te+=Ie*ge)}return xe=fe-H,Ie=B-te,xe*xe+Ie*Ie}function Po(fe,B,H,te){let se={id:fe??null,type:B,geometry:H,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(B==="Point"||B==="MultiPoint"||B==="LineString")ss(se,H);else if(B==="Polygon")ss(se,H[0]);else if(B==="MultiLineString")for(let le of H)ss(se,le);else if(B==="MultiPolygon")for(let le of H)ss(se,le[0]);return se}function ss(fe,B){for(let H=0;H<B.length;H+=3)fe.minX=Math.min(fe.minX,B[H]),fe.minY=Math.min(fe.minY,B[H+1]),fe.maxX=Math.max(fe.maxX,B[H]),fe.maxY=Math.max(fe.maxY,B[H+1])}function as(fe,B,H,te){if(!B.geometry)return;let se=B.geometry.coordinates;if(se&&se.length===0)return;let le=B.geometry.type,xe=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2),Ie=[],ge=B.id;if(H.promoteId?ge=B.properties[H.promoteId]:H.generateId&&(ge=te||0),le==="Point")El(se,Ie);else if(le==="MultiPoint")for(let Me of se)El(Me,Ie);else if(le==="LineString")na(se,Ie,xe,!1);else if(le==="MultiLineString"){if(H.lineMetrics){for(let Me of se)Ie=[],na(Me,Ie,xe,!1),fe.push(Po(ge,"LineString",Ie,B.properties));return}ra(se,Ie,xe,!1)}else if(le==="Polygon")ra(se,Ie,xe,!0);else{if(le!=="MultiPolygon"){if(le==="GeometryCollection"){for(let Me of B.geometry.geometries)as(fe,{id:ge,geometry:Me,properties:B.properties},H,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Me of se){let Xe=[];ra(Me,Xe,xe,!0),Ie.push(Xe)}}fe.push(Po(ge,le,Ie,B.properties))}function El(fe,B){B.push(ai(fe[0]),tu(fe[1]),0)}function na(fe,B,H,te){let se,le,xe=0;for(let ge=0;ge<fe.length;ge++){let Me=ai(fe[ge][0]),Xe=tu(fe[ge][1]);B.push(Me,Xe,0),ge>0&&(xe+=te?(se*Xe-Me*le)/2:Math.sqrt(Math.pow(Me-se,2)+Math.pow(Xe-le,2))),se=Me,le=Xe}let Ie=B.length-3;B[2]=1,ta(B,0,Ie,H),B[Ie+2]=1,B.size=Math.abs(xe),B.start=0,B.end=B.size}function ra(fe,B,H,te){for(let se=0;se<fe.length;se++){let le=[];na(fe[se],le,H,te),B.push(le)}}function ai(fe){return fe/360+.5}function tu(fe){let B=Math.sin(fe*Math.PI/180),H=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return H<0?0:H>1?1:H}function Et(fe,B,H,te,se,le,xe,Ie){if(te/=B,le>=(H/=B)&&xe<te)return fe;if(xe<H||le>=te)return null;let ge=[];for(let Me of fe){let Xe=Me.geometry,$e=Me.type,ut=se===0?Me.minX:Me.minY,yt=se===0?Me.maxX:Me.maxY;if(ut>=H&&yt<te){ge.push(Me);continue}if(yt<H||ut>=te)continue;let Ft=[];if($e==="Point"||$e==="MultiPoint")Il(Xe,Ft,H,te,se);else if($e==="LineString")Zn(Xe,Ft,H,te,se,!1,Ie.lineMetrics);else if($e==="MultiLineString")ls(Xe,Ft,H,te,se,!1);else if($e==="Polygon")ls(Xe,Ft,H,te,se,!0);else if($e==="MultiPolygon")for(let Nt of Xe){let Ct=[];ls(Nt,Ct,H,te,se,!0),Ct.length&&Ft.push(Ct)}if(Ft.length){if(Ie.lineMetrics&&$e==="LineString"){for(let Nt of Ft)ge.push(Po(Me.id,$e,Nt,Me.tags));continue}$e!=="LineString"&&$e!=="MultiLineString"||(Ft.length===1?($e="LineString",Ft=Ft[0]):$e="MultiLineString"),$e!=="Point"&&$e!=="MultiPoint"||($e=Ft.length===3?"Point":"MultiPoint"),ge.push(Po(Me.id,$e,Ft,Me.tags))}}return ge.length?ge:null}function Il(fe,B,H,te,se){for(let le=0;le<fe.length;le+=3){let xe=fe[le+se];xe>=H&&xe<=te&&Ni(B,fe[le],fe[le+1],fe[le+2])}}function Zn(fe,B,H,te,se,le,xe){let Ie=ia(fe),ge=se===0?zi:Dl,Me,Xe,$e=fe.start;for(let Ct=0;Ct<fe.length-3;Ct+=3){let Xt=fe[Ct],lt=fe[Ct+1],Nn=fe[Ct+2],mn=fe[Ct+3],Kt=fe[Ct+4],er=se===0?Xt:lt,zn=se===0?mn:Kt,sr=!1;xe&&(Me=Math.sqrt(Math.pow(Xt-mn,2)+Math.pow(lt-Kt,2))),er<H?zn>H&&(Xe=ge(Ie,Xt,lt,mn,Kt,H),xe&&(Ie.start=$e+Me*Xe)):er>te?zn<te&&(Xe=ge(Ie,Xt,lt,mn,Kt,te),xe&&(Ie.start=$e+Me*Xe)):Ni(Ie,Xt,lt,Nn),zn<H&&er>=H&&(Xe=ge(Ie,Xt,lt,mn,Kt,H),sr=!0),zn>te&&er<=te&&(Xe=ge(Ie,Xt,lt,mn,Kt,te),sr=!0),!le&&sr&&(xe&&(Ie.end=$e+Me*Xe),B.push(Ie),Ie=ia(fe)),xe&&($e+=Me)}let ut=fe.length-3,yt=fe[ut],Ft=fe[ut+1],Nt=se===0?yt:Ft;Nt>=H&&Nt<=te&&Ni(Ie,yt,Ft,fe[ut+2]),ut=Ie.length-3,le&&ut>=3&&(Ie[ut]!==Ie[0]||Ie[ut+1]!==Ie[1])&&Ni(Ie,Ie[0],Ie[1],Ie[2]),Ie.length&&B.push(Ie)}function ia(fe){let B=[];return B.size=fe.size,B.start=fe.start,B.end=fe.end,B}function ls(fe,B,H,te,se,le){for(let xe of fe)Zn(xe,B,H,te,se,le,!1)}function Ni(fe,B,H,te){fe.push(B,H,te)}function zi(fe,B,H,te,se,le){let xe=(le-B)/(te-B);return Ni(fe,le,H+(se-H)*xe,1),xe}function Dl(fe,B,H,te,se,le){let xe=(le-H)/(se-H);return Ni(fe,B+(te-B)*xe,le,1),xe}function Ro(fe,B){let H=[];for(let te=0;te<fe.length;te++){let se=fe[te],le=se.type,xe;if(le==="Point"||le==="MultiPoint"||le==="LineString")xe=Lo(se.geometry,B);else if(le==="MultiLineString"||le==="Polygon"){xe=[];for(let Ie of se.geometry)xe.push(Lo(Ie,B))}else if(le==="MultiPolygon"){xe=[];for(let Ie of se.geometry){let ge=[];for(let Me of Ie)ge.push(Lo(Me,B));xe.push(ge)}}H.push(Po(se.id,le,xe,se.tags))}return H}function Lo(fe,B){let H=[];H.size=fe.size,fe.start!==void 0&&(H.start=fe.start,H.end=fe.end);for(let te=0;te<fe.length;te+=3)H.push(fe[te]+B,fe[te+1],fe[te+2]);return H}function oa(fe,B){if(fe.transformed)return fe;let H=1<<fe.z,te=fe.x,se=fe.y;for(let le of fe.features){let xe=le.geometry,Ie=le.type;if(le.geometry=[],Ie===1)for(let ge=0;ge<xe.length;ge+=2)le.geometry.push(sa(xe[ge],xe[ge+1],B,H,te,se));else for(let ge=0;ge<xe.length;ge++){let Me=[];for(let Xe=0;Xe<xe[ge].length;Xe+=2)Me.push(sa(xe[ge][Xe],xe[ge][Xe+1],B,H,te,se));le.geometry.push(Me)}}return fe.transformed=!0,fe}function sa(fe,B,H,te,se,le){return[Math.round(H*(fe*te-se)),Math.round(H*(B*te-le))]}function nu(fe,B,H,te,se){let le=B===se.maxZoom?0:se.tolerance/((1<<B)*se.extent),xe={features:[],numPoints:0,numSimplified:0,numFeatures:fe.length,source:null,x:H,y:te,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Ie of fe)aa(xe,Ie,le,se);return xe}function aa(fe,B,H,te){let se=B.geometry,le=B.type,xe=[];if(fe.minX=Math.min(fe.minX,B.minX),fe.minY=Math.min(fe.minY,B.minY),fe.maxX=Math.max(fe.maxX,B.maxX),fe.maxY=Math.max(fe.maxY,B.maxY),le==="Point"||le==="MultiPoint")for(let Ie=0;Ie<se.length;Ie+=3)xe.push(se[Ie],se[Ie+1]),fe.numPoints++,fe.numSimplified++;else if(le==="LineString")li(xe,se,fe,H,!1,!1);else if(le==="MultiLineString"||le==="Polygon")for(let Ie=0;Ie<se.length;Ie++)li(xe,se[Ie],fe,H,le==="Polygon",Ie===0);else if(le==="MultiPolygon")for(let Ie=0;Ie<se.length;Ie++){let ge=se[Ie];for(let Me=0;Me<ge.length;Me++)li(xe,ge[Me],fe,H,!0,Me===0)}if(xe.length){let Ie=B.tags||null;if(le==="LineString"&&te.lineMetrics){Ie={};for(let Me in B.tags)Ie[Me]=B.tags[Me];Ie.mapbox_clip_start=se.start/se.size,Ie.mapbox_clip_end=se.end/se.size}let ge={geometry:xe,type:le==="Polygon"||le==="MultiPolygon"?3:le==="LineString"||le==="MultiLineString"?2:1,tags:Ie};B.id!==null&&(ge.id=B.id),fe.features.push(ge)}}function li(fe,B,H,te,se,le){let xe=te*te;if(te>0&&B.size<(se?xe:te))return void(H.numPoints+=B.length/3);let Ie=[];for(let ge=0;ge<B.length;ge+=3)(te===0||B[ge+2]>xe)&&(H.numSimplified++,Ie.push(B[ge],B[ge+1])),H.numPoints++;se&&function(ge,Me){let Xe=0;for(let $e=0,ut=ge.length,yt=ut-2;$e<ut;yt=$e,$e+=2)Xe+=(ge[$e]-ge[yt])*(ge[$e+1]+ge[yt+1]);if(Xe>0===Me)for(let $e=0,ut=ge.length;$e<ut/2;$e+=2){let yt=ge[$e],Ft=ge[$e+1];ge[$e]=ge[ut-2-$e],ge[$e+1]=ge[ut-1-$e],ge[ut-2-$e]=yt,ge[ut-1-$e]=Ft}}(Ie,le),fe.push(Ie)}let Oo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ci{constructor(B,H){let te=(H=this.options=function(le,xe){for(let Ie in xe)le[Ie]=xe[Ie];return le}(Object.create(Oo),H)).debug;if(te&&console.time("preprocess data"),H.maxZoom<0||H.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(H.promoteId&&H.generateId)throw new Error("promoteId and generateId cannot be used together.");let se=function(le,xe){let Ie=[];if(le.type==="FeatureCollection")for(let ge=0;ge<le.features.length;ge++)as(Ie,le.features[ge],xe,ge);else as(Ie,le.type==="Feature"?le:{geometry:le},xe);return Ie}(B,H);this.tiles={},this.tileCoords=[],te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",H.indexMaxZoom,H.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),se=function(le,xe){let Ie=xe.buffer/xe.extent,ge=le,Me=Et(le,1,-1-Ie,Ie,0,-1,2,xe),Xe=Et(le,1,1-Ie,2+Ie,0,-1,2,xe);return(Me||Xe)&&(ge=Et(le,1,-Ie,1+Ie,0,-1,2,xe)||[],Me&&(ge=Ro(Me,1).concat(ge)),Xe&&(ge=ge.concat(Ro(Xe,-1)))),ge}(se,H),se.length&&this.splitTile(se,0,0,0),te&&(se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(B,H,te,se,le,xe,Ie){let ge=[B,H,te,se],Me=this.options,Xe=Me.debug;for(;ge.length;){se=ge.pop(),te=ge.pop(),H=ge.pop(),B=ge.pop();let $e=1<<H,ut=gr(H,te,se),yt=this.tiles[ut];if(!yt&&(Xe>1&&console.time("creation"),yt=this.tiles[ut]=nu(B,H,te,se,Me),this.tileCoords.push({z:H,x:te,y:se}),Xe)){Xe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",H,te,se,yt.numFeatures,yt.numPoints,yt.numSimplified),console.timeEnd("creation"));let sr=`z${H}`;this.stats[sr]=(this.stats[sr]||0)+1,this.total++}if(yt.source=B,le==null){if(H===Me.indexMaxZoom||yt.numPoints<=Me.indexMaxPoints)continue}else{if(H===Me.maxZoom||H===le)continue;if(le!=null){let sr=le-H;if(te!==xe>>sr||se!==Ie>>sr)continue}}if(yt.source=null,B.length===0)continue;Xe>1&&console.time("clipping");let Ft=.5*Me.buffer/Me.extent,Nt=.5-Ft,Ct=.5+Ft,Xt=1+Ft,lt=null,Nn=null,mn=null,Kt=null,er=Et(B,$e,te-Ft,te+Ct,0,yt.minX,yt.maxX,Me),zn=Et(B,$e,te+Nt,te+Xt,0,yt.minX,yt.maxX,Me);B=null,er&&(lt=Et(er,$e,se-Ft,se+Ct,1,yt.minY,yt.maxY,Me),Nn=Et(er,$e,se+Nt,se+Xt,1,yt.minY,yt.maxY,Me),er=null),zn&&(mn=Et(zn,$e,se-Ft,se+Ct,1,yt.minY,yt.maxY,Me),Kt=Et(zn,$e,se+Nt,se+Xt,1,yt.minY,yt.maxY,Me),zn=null),Xe>1&&console.timeEnd("clipping"),ge.push(lt||[],H+1,2*te,2*se),ge.push(Nn||[],H+1,2*te,2*se+1),ge.push(mn||[],H+1,2*te+1,2*se),ge.push(Kt||[],H+1,2*te+1,2*se+1)}}getTile(B,H,te){B=+B,H=+H,te=+te;let se=this.options,{extent:le,debug:xe}=se;if(B<0||B>24)return null;let Ie=1<<B,ge=gr(B,H=H+Ie&Ie-1,te);if(this.tiles[ge])return oa(this.tiles[ge],le);xe>1&&console.log("drilling down to z%d-%d-%d",B,H,te);let Me,Xe=B,$e=H,ut=te;for(;!Me&&Xe>0;)Xe--,$e>>=1,ut>>=1,Me=this.tiles[gr(Xe,$e,ut)];return Me&&Me.source?(xe>1&&(console.log("found parent tile z%d-%d-%d",Xe,$e,ut),console.time("drilling down")),this.splitTile(Me.source,Xe,$e,ut,B,H,te),xe>1&&console.timeEnd("drilling down"),this.tiles[ge]?oa(this.tiles[ge],le):null):null}}function gr(fe,B,H){return 32*((1<<fe)*H+B)+fe}function ru(fe,B){let H=fe.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);let te=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!te)return B(null,null);let se=new Ut(te.features),le=Jc(se);le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),B(null,{vectorTile:se,rawData:le.buffer})}class cs extends mt{constructor(B,H,te,se,le,xe){super(B,H,te,se,ru,xe),le&&(this.loadGeoJSON=le),this._dynamicIndex=new mr}loadData(B,H){let te=B&&B.request,se=te&&te.collectResourceTiming;this.loadGeoJSON(B,(le,xe)=>{if(le||!xe)return H(le);if(typeof xe!="object")return H(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{try{if(B.filter){let ge=o.y(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ge.result==="error")throw new Error(ge.value.map(Me=>`${Me.key}: ${Me.message}`).join(", "));xe.features=xe.features.filter(Me=>ge.value.evaluate({zoom:0},Me))}B.dynamic?(xe.type==="Feature"&&(xe={type:"FeatureCollection",features:[xe]}),B.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(xe.features,this.loaded),B.cluster&&(xe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=B.cluster?new bt(function({superclusterOptions:ge,clusterProperties:Me}){if(!Me||!ge)return ge;let Xe={},$e={},ut={accumulated:null,zoom:0},yt={properties:null},Ft=Object.keys(Me);for(let Nt of Ft){let[Ct,Xt]=Me[Nt],lt=o.y(Xt),Nn=o.y(typeof Ct=="string"?[Ct,["accumulated"],["get",Nt]]:Ct);Xe[Nt]=lt.value,$e[Nt]=Nn.value}return ge.map=Nt=>{yt.properties=Nt;let Ct={};for(let Xt of Ft)Ct[Xt]=Xe[Xt].evaluate(ut,yt);return Ct},ge.reduce=(Nt,Ct)=>{yt.properties=Ct;for(let Xt of Ft)ut.accumulated=Nt[Xt],Nt[Xt]=$e[Xt].evaluate(ut,yt)},ge}(B)).load(xe.features):B.dynamic?this._dynamicIndex:function(ge,Me){return new ci(ge,Me)}(xe,B.geojsonVtOptions)}catch(ge){return H(ge)}let Ie={};if(se){let ge=k(te);ge&&(Ie.resourceTiming={},Ie.resourceTiming[B.source]=JSON.parse(JSON.stringify(ge)))}H(null,Ie)}})}reloadTile(B,H){let te=this.loaded;return te&&te[B.uid]?B.partial?H(null,void 0):super.reloadTile(B,H):this.loadTile(B,H)}loadGeoJSON(B,H){if(B.request)o.g(B.request,H);else{if(typeof B.data!="string")return H(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));try{return H(null,JSON.parse(B.data))}catch{return H(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(B,H){try{H(null,this._geoJSONIndex.getClusterExpansionZoom(B.clusterId))}catch(te){H(te)}}getClusterChildren(B,H){try{H(null,this._geoJSONIndex.getChildren(B.clusterId))}catch(te){H(te)}}getClusterLeaves(B,H){try{H(null,this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset))}catch(te){H(te)}}}class la{constructor(B,H){this.tileID=new o.aL(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.tileZoom=B.tileZoom,this.uid=B.uid,this.zoom=B.zoom,this.canonical=B.tileID.canonical,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=B.projection,this.brightness=H}parse(B,H,te,se){this.status="parsing";let le=new o.aL(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),xe={},Ie=H.familiesBySource[te.source],ge=new o.dN(le,te.promoteId);return ge.bucketLayerIDs=[],ge.is3DTile=!0,o.e3(B).then(Me=>{if(!Me)return se(new Error("Could not parse tile"));let Xe=o.e4(Me,1/o.b5(te.tileID.canonical)),$e=Me.json.extensionsUsed&&Me.json.extensionsUsed.includes("MAPBOX_mesh_features")||Me.json.asset.extras&&Me.json.asset.extras.MAPBOX_mesh_features,ut=Me.json.extensionsUsed&&Me.json.extensionsUsed.includes("EXT_meshopt_compression"),yt=new o.X(this.zoom,{brightness:this.brightness});for(let Ft in Ie)for(let Nt of Ie[Ft]){let Ct=Nt[0];ge.bucketLayerIDs.push(Nt.map(lt=>lt.id)),Ct.recalculate(yt,[]);let Xt=new o.e5(Xe,le,$e,ut,this.brightness,ge);$e||(Xt.needsUpload=!0),xe[Ct.fqid]=Xt,Xt.evaluate(Ct)}this.status="done",se(null,{buckets:xe,featureIndex:ge})}).catch(Me=>se(new Error(Me.message)))}}class Ml{constructor(B,H,te,se,le,xe){this.actor=B,this.layerIndex=H,this.brightness=xe,this.loading={},this.loaded={}}loadTile(B,H){let te=B.uid,se=this.loading[te]=new la(B,this.brightness);o.e2(B.request,(le,xe)=>{let Ie=!this.loading[te];return delete this.loading[te],Ie||le?(se.status="done",Ie||(this.loaded[te]=se),H(le)):xe&&xe.byteLength!==0?void se.parse(xe,this.layerIndex,B,(ge,Me)=>{se.status="done",this.loaded=this.loaded||{},this.loaded[te]=se,ge||!Me?H(ge):H(null,Me)}):(se.status="done",this.loaded[te]=se,H())})}reloadTile(B,H){let te=this.loaded,se=B.uid;if(te&&te[se]){let le=te[se];le.projection=B.projection,le.brightness=B.brightness;let xe=(Ie,ge)=>{le.reloadCallback&&(delete le.reloadCallback,this.loadTile(B,H)),H(Ie,ge)};le.status==="parsing"?le.reloadCallback=xe:le.status==="done"&&this.loadTile(B,H)}}abortTile(B,H){let te=B.uid;this.loading[te]&&delete this.loading[te],H()}removeTile(B,H){let te=this.loaded,se=B.uid;te&&te[se]&&delete te[se],H()}}class ca{constructor(B){this.self=B,this.actor=new o.e6(B,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.aJ({name:"mercator"}),this.workerSourceTypes={vector:mt,geojson:cs,"batched-model":Ml},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(H,te)=>{if(this.workerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.workerSourceTypes[H]=te},this.self.registerRTLTextPlugin=H=>{if(o.e7.isParsed())throw new Error("RTL text plugin already registered.");o.e7.applyArabicShaping=H.applyArabicShaping,o.e7.processBidirectionalText=H.processBidirectionalText,o.e7.processStyledBidirectionalText=H.processStyledBidirectionalText}}clearCaches(B,H,te){delete this.layerIndexes[B],delete this.availableImages[B],delete this.workerSources[B],delete this.demWorkerSources[B],delete this.rasterArrayWorkerSource,te()}checkIfReady(B,H,te){te()}setReferrer(B,H){this.referrer=H}spriteLoaded(B,{scope:H,isLoaded:te}){if(this.isSpriteLoaded[B]||(this.isSpriteLoaded[B]={}),this.isSpriteLoaded[B][H]=te,this.workerSources[B]&&this.workerSources[B][H])for(let se in this.workerSources[B][H]){let le=this.workerSources[B][H][se];for(let xe in le){let Ie=le[xe];Ie instanceof mt&&(Ie.isSpriteLoaded=te,Ie.fire(new o.f("isSpriteLoaded")))}}}setImages(B,{scope:H,images:te},se){if(this.availableImages[B]||(this.availableImages[B]={}),this.availableImages[B][H]=te,this.workerSources[B]&&this.workerSources[B][H]){for(let le in this.workerSources[B][H]){let xe=this.workerSources[B][H][le];for(let Ie in xe)xe[Ie].availableImages=te}se()}else se()}setProjection(B,H){this.projections[B]=o.aJ(H)}setBrightness(B,H,te){this.brightness=H,te()}setLayers(B,H,te){this.getLayerIndex(B,H.scope).replace(H.layers,H.options),te()}updateLayers(B,H,te){this.getLayerIndex(B,H.scope).update(H.layers,H.removedIds,H.options),te()}loadTile(B,H,te){H.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,H.type,H.source,H.scope).loadTile(H,te)}loadDEMTile(B,H,te){this.getDEMWorkerSource(B,H.source,H.scope).loadTile(H,te)}decodeRasterArray(B,H,te){this.getRasterArrayWorkerSource().decodeRasterArray(H,te)}reloadTile(B,H,te){H.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,H.type,H.source,H.scope).reloadTile(H,te)}abortTile(B,H,te){this.getWorkerSource(B,H.type,H.source,H.scope).abortTile(H,te)}removeTile(B,H,te){this.getWorkerSource(B,H.type,H.source,H.scope).removeTile(H,te)}removeSource(B,H,te){if(!(this.workerSources[B]&&this.workerSources[B][H.scope]&&this.workerSources[B][H.scope][H.type]&&this.workerSources[B][H.scope][H.type][H.source]))return;let se=this.workerSources[B][H.scope][H.type][H.source];delete this.workerSources[B][H.scope][H.type][H.source],se.removeSource!==void 0?se.removeSource(H,te):te()}loadWorkerSource(B,H,te){try{this.self.importScripts(H.url),te()}catch(se){te(se.toString())}}syncRTLPluginState(B,H,te){try{o.e7.setState(H);let se=o.e7.getPluginURL();if(o.e7.isLoaded()&&!o.e7.isParsed()&&se!=null){this.self.importScripts(se);let le=o.e7.isParsed();te(le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${se}`),le)}}catch(se){te(se.toString())}}setDracoUrl(B,H){this.dracoUrl=H}getAvailableImages(B,H){this.availableImages[B]||(this.availableImages[B]={});let te=this.availableImages[B][H];return te||(te=[]),te}getLayerIndex(B,H){this.layerIndexes[B]||(this.layerIndexes[B]={});let te=this.layerIndexes[B][H];return te||(te=this.layerIndexes[B][H]=new me,te.scope=H),te}getWorkerSource(B,H,te,se){return this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][se]||(this.workerSources[B][se]={}),this.workerSources[B][se][H]||(this.workerSources[B][se][H]={}),this.isSpriteLoaded[B]||(this.isSpriteLoaded[B]={}),this.workerSources[B][se][H][te]||(this.workerSources[B][se][H][te]=new this.workerSourceTypes[H]({send:(le,xe,Ie,ge,Me,Xe)=>{this.actor.send(le,xe,Ie,B,Me,Xe)},scheduler:this.actor.scheduler},this.getLayerIndex(B,se),this.getAvailableImages(B,se),this.isSpriteLoaded[B][se],void 0,this.brightness)),this.workerSources[B][se][H][te]}getDEMWorkerSource(B,H,te){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][te]||(this.demWorkerSources[B][te]={}),this.demWorkerSources[B][te][H]||(this.demWorkerSources[B][te][H]=new Zt),this.demWorkerSources[B][te][H]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new jt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(B,H){o.e8(H)}getWorkerPerformanceMetrics(B,H,te){te(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ca(self)),ca}),v(["./shared"],function(o){function k(u,r){if(Array.isArray(u)){if(!Array.isArray(r)||u.length!==r.length)return!1;for(let a=0;a<u.length;a++)if(!k(u[a],r[a]))return!1;return!0}if(typeof u=="object"&&u!==null&&r!==null){if(typeof r!="object"||Object.keys(u).length!==Object.keys(r).length)return!1;for(let a in u)if(!k(u[a],r[a]))return!1;return!0}return u===r}var V=Z;function Z(u){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,g,y=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(y);try{g=new Worker(b),f=!0}catch{f=!1}return g&&g.terminate(),URL.revokeObjectURL(b),f}()?function(){var f=document.createElement("canvas");f.width=f.height=1;var g=f.getContext("2d");if(!g)return!1;var y=g.getImageData(0,0,1,1);return y&&y.width===f.width}()?(me[a=r&&r.failIfMajorPerformanceCaveat]===void 0&&(me[a]=function(f){var g,y=function(b){var T=document.createElement("canvas"),M=Object.create(Z.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=b,T.getContext("webgl2",M)}(f);if(!y)return!1;try{g=y.createShader(y.VERTEX_SHADER)}catch{return!1}return!(!g||y.isContextLost())&&(y.shaderSource(g,"void main() {}"),y.compileShader(g),y.getShaderParameter(g,y.COMPILE_STATUS)===!0)}(a)),me[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var a}(u)}var me={};function ye(u,r,a){let f=document.createElement(u);return r!=null&&(f.className=r),a&&a.appendChild(f),f}function Ne(u,r,a){let f=document.createElementNS("http://www.w3.org/2000/svg",u);for(let g of Object.keys(r))f.setAttributeNS(null,g,String(r[g]));return a&&a.appendChild(f),f}Z.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let ot=typeof document<"u"?document.documentElement&&document.documentElement.style:null,et=ot&&ot.userSelect!==void 0?"userSelect":"WebkitUserSelect",mt;function Zt(){ot&&et&&(mt=ot[et],ot[et]="none")}function jt(){ot&&et&&(ot[et]=mt)}function Rt(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",Rt,!0)}function an(){window.addEventListener("click",Rt,!0),window.setTimeout(()=>{window.removeEventListener("click",Rt,!0)},0)}function Ut(u,r){let a=u.getBoundingClientRect();return Yn(u,a,r)}function pn(u,r){let a=u.getBoundingClientRect(),f=[];for(let g=0;g<r.length;g++)f.push(Yn(u,a,r[g]));return f}function mr(u){return window.InstallTrigger!==void 0&&u.button===2&&u.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:u.button}function Yn(u,r,a){let f=u.offsetWidth===r.width?1:u.offsetWidth/r.width;return new o.P((a.clientX-r.left)*f,(a.clientY-r.top)*f)}class Sr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,a){this._updatedSourceCaches[r]=a,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){let a=r.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(r.id),this.setDirty()}removeLayer(r){let a=r.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][r.id]=r,this._updatedLayers[a].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){let r={};for(let a in this._updatedLayers)r[a]=r[a]||{},r[a].updatedIds=Array.from(this._updatedLayers[a].values());for(let a in this._removedLayers)r[a]=r[a]||{},r[a].removedIds=Object.keys(this._removedLayers[a]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(r){this._updatedImages.add(r),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let cn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ao{constructor(r,a,f,g,y,b){this.length=a.length,this.attributes=f,this.itemSize=a.bytesPerElement,this.dynamicDraw=g,this.instanceCount=b,this.context=r;let T=r.gl;this.buffer=T.createBuffer(),r.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||y||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){let a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,a){for(let f=0;f<this.attributes.length;f++){let g=a.attributes[this.attributes[f].name];g!==void 0&&r.enableVertexAttribArray(g)}}setVertexAttribPointers(r,a,f){for(let g=0;g<this.attributes.length;g++){let y=this.attributes[g],b=a.attributes[y.name];b!==void 0&&r.vertexAttribPointer(b,y.components,r[cn[y.type]],!1,this.itemSize,y.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(r,a,f){for(let g=0;g<this.attributes.length;g++){let y=a.attributes[this.attributes[g].name];y!==void 0&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(y,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Qt{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qc extends Qt{getDefault(){return o.C.transparent}set(r){let a=this.current;(r.r!==a.r||r.g!==a.g||r.b!==a.b||r.a!==a.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class yl extends Qt{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Wc extends Qt{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class bn extends Qt{getDefault(){return[!0,!0,!0,!0]}set(r){let a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||r[3]!==a[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class xl extends Qt{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class si extends Qt{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Zc extends Qt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){let a=this.current;(r.func!==a.func||r.ref!==a.ref||r.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class vl extends Qt{getDefault(){let r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){let a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class is extends Qt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;r?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=r,this.dirty=!1}}class fn extends Qt{getDefault(){return[0,1]}set(r){let a=this.current;(r[0]!==a[0]||r[1]!==a[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Ys extends Qt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;r?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=r,this.dirty=!1}}class wr extends Qt{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Xc extends Qt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;r?a.enable(a.BLEND):a.disable(a.BLEND),this.current=r,this.dirty=!1}}class Yc extends Qt{getDefault(){let r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){let a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||r[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Qc extends Qt{getDefault(){return o.C.transparent}set(r){let a=this.current;(r.r!==a.r||r.g!==a.g||r.b!==a.b||r.a!==a.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class wt extends Qt{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class Qs extends Qt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;r?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=r,this.dirty=!1}}class Fn extends Qt{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Kc extends Qt{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Jc=class extends Qt{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class eu extends Qt{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class bl extends Qt{getDefault(){let r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){let a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||r[3]!==a[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Ks extends Qt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class bi extends Qt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class wi extends Qt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;a.bindTexture(a.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class wl extends Qt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class bt extends Qt{getDefault(){return null}set(r){let a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Tt extends Qt{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class Js extends Qt{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Gr extends Qt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class os extends Qt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class ea extends Qt{constructor(r,a){super(r),this.context=r,this.parent=a}getDefault(){return null}}class ta extends ea{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Tl extends ea{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Po extends ea{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class ss extends Tl{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class as{constructor(r,a,f,g,y){this.context=r,this.width=a,this.height=f;let b=this.framebuffer=r.gl.createFramebuffer();g&&(this.colorAttachment=new ta(r,b)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new Tl(r,b):new Po(r,b))}destroy(){let r=this.context.gl;if(this.colorAttachment){let a=this.colorAttachment.get();a&&r.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let a=this.depthAttachment.get();a&&r.deleteRenderbuffer(a)}else{let a=this.depthAttachment.get();a&&r.deleteTexture(a)}r.deleteFramebuffer(this.framebuffer)}}class El{constructor(r,a){this.gl=r,this.clearColor=new qc(this),this.clearDepth=new yl(this),this.clearStencil=new Wc(this),this.colorMask=new bn(this),this.depthMask=new xl(this),this.stencilMask=new si(this),this.stencilFunc=new Zc(this),this.stencilOp=new vl(this),this.stencilTest=new is(this),this.depthRange=new fn(this),this.depthTest=new Ys(this),this.depthFunc=new wr(this),this.blend=new Xc(this),this.blendFunc=new Yc(this),this.blendColor=new Qc(this),this.blendEquation=new wt(this),this.cullFace=new Qs(this),this.cullFaceSide=new Fn(this),this.frontFace=new Kc(this),this.program=new Jc(this),this.activeTexture=new eu(this),this.viewport=new bl(this),this.bindFramebuffer=new Ks(this),this.bindRenderbuffer=new bi(this),this.bindTexture=new wi(this),this.bindVertexBuffer=new wl(this),this.bindElementBuffer=new bt(this),this.bindVertexArrayOES=new Tt(this),this.pixelStoreUnpack=new Js(this),this.pixelStoreUnpackPremultiplyAlpha=new Gr(this),this.pixelStoreUnpackFlipY=new os(this),this.options=a?Br({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,a,f){return new o.I(this,r,a,f)}createVertexBuffer(r,a,f,g,y){return new Ao(this,r,a,f,g,y)}createRenderbuffer(r,a,f){let g=this.gl,y=g.createRenderbuffer();return this.bindRenderbuffer.set(y),g.renderbufferStorage(g.RENDERBUFFER,r,a,f),this.bindRenderbuffer.set(null),y}createFramebuffer(r,a,f,g){return new as(this,r,a,f,g)}clear({color:r,depth:a,stencil:f,colorMask:g}){let y=this.gl,b=0;r&&(b|=y.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set(g||[!0,!0,!0,!0])),a!==void 0&&(b|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),f!==void 0&&(b|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),y.clear(b)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){k(r.blendFunction,o.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class na{constructor(r){this._gl=r.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){let r=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,r}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class ra{constructor(r){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,r.registerParameter(this,["Symbols"],"useOcclusionQueries"),r.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),r.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),r.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),r.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),r.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class ai{constructor(r,a,f,g){let y={width:f[0],height:f[1],data:null},b=r.gl;this.targetColorTexture=new o.T(r,y,b.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new o.T(r,y,b.RGBA,{useMipmap:!1}),this.context=r,this.updateParticleTexture(a,g),this.lastInvalidatedAt=0}updateParticleTexture(r,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let f=this.context.gl,g=a.width*a.height;this.particleTexture0=new o.T(this.context,a,f.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,a,f.RGBA,{premultiply:!1,useMipmap:!1});let y=new o.S;y.reserve(g);for(let b=0;b<g;b++)y.emplaceBack(b);this.particleIndexBuffer=this.context.createVertexBuffer(y,o.p.members,!0),this.particleSegment=o.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=o.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class tu extends o.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.numModelsLoading={}}loadModel(r,a){return o.l(this.requestManager.transformRequest(a,o.R.Model).url).then(f=>{if(!f)return;let g=o.c(f),y=new o.M(r,void 0,void 0,g);return y.computeBoundsAndApplyParent(),y}).catch(f=>{if(f&&f.status===404)return null;this.fire(new o.d(new Error(`Could not load model ${r} from ${a}: ${f.message}`)))})}load(r,a){this.models[a]||(this.models[a]={});let f=Object.keys(r);this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+f.length;let g=[];for(let y of f)g.push(this.loadModel(y,r[y]));Promise.allSettled(g).then(y=>{for(let b=0;b<y.length;b++){let{status:T,value:M}=y[b];T==="fulfilled"&&M&&(this.models[a][f[b]]={model:M,numReferences:1})}this.numModelsLoading[a]-=f.length,this.fire(new o.f("data",{dataType:"style"}))}).catch(y=>{this.fire(new o.d(new Error(`Could not load models: ${y.message}`)))})}isLoaded(){for(let r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,a){return!!this.getModel(r,a)}getModel(r,a){return this.models[a]||(this.models[a]={}),this.models[a][r]?this.models[a][r].model:void 0}addModel(r,a,f){this.models[f]||(this.models[f]={}),this.hasModel(r,f)&&this.models[f][r].numReferences++,this.load({[r]:this.requestManager.normalizeModelURL(a)},f)}addModels(r,a){this.models[a]||(this.models[a]={});let f={};for(let g in r)this.models[a][g]={},f[g]=this.requestManager.normalizeModelURL(r[g]);this.load(f,a)}addModelsFromBucket(r,a){this.models[a]||(this.models[a]={});let f={};for(let g of r)this.hasModel(g,a)?this.models[a][g].numReferences++:f[g]=this.requestManager.normalizeModelURL(g);this.load(f,a)}removeModel(r,a){if(this.models[a]&&this.models[a][r]&&(this.models[a][r].numReferences--,this.models[a][r].numReferences===0)){let f=this.models[a][r].model;delete this.models[a][r],f.destroy()}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,a){this.models[a]||(this.models[a]={});for(let f in this.models[a])this.models[a][f].model&&this.models[a][f].model.upload(r.context)}}function Et(u){let{userImage:r}=u;return!!(r&&r.render&&r.render())&&(u.data.replace(new Uint8Array(r.data.buffer)),!0)}class Il extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(r){this.images[r]={},this.loaded[r]=!1,this.updatedImages[r]={},this.patterns[r]={},this.callbackDispatchedThisFrame[r]={},this.atlasImage[r]=new o.i({width:1,height:1})}isLoaded(){for(let r in this.loaded)if(!this.loaded[r])return!1;return!0}setLoaded(r,a){if(this.loaded[a]!==r&&(this.loaded[a]=r,r)){for(let{ids:f,callback:g}of this.requestors)this._notify(f,a,g);this.requestors=[]}}hasImage(r,a){return!!this.getImage(r,a)}getImage(r,a){return this.images[a][r]}addImage(r,a,f){this._validate(r,f)&&(this.images[a][r]=f)}_validate(r,a){let f=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new o.d(new Error(`Image "${r}" has invalid "stretchX" value`))),f=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new o.d(new Error(`Image "${r}" has invalid "stretchY" value`))),f=!1),this._validateContent(a.content,a)||(this.fire(new o.d(new Error(`Image "${r}" has invalid "content" value`))),f=!1),f}_validateStretch(r,a){if(!r)return!0;let f=0;for(let g of r){if(g[0]<f||g[1]<g[0]||a<g[1])return!1;f=g[1]}return!0}_validateContent(r,a){return!(r&&(r.length!==4||r[0]<0||a.data.width<r[0]||r[1]<0||a.data.height<r[1]||r[2]<0||a.data.width<r[2]||r[3]<0||a.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,a,f){f.version=this.images[a][r].version+1,this.images[a][r]=f,this.updatedImages[a][r]=!0}removeImage(r,a){let f=this.images[a][r];delete this.images[a][r],delete this.patterns[a][r],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(r){return Object.keys(this.images[r])}getImages(r,a,f){let g=!0,y=!!this.loaded[a];if(!y)for(let b of r)this.images[a][b]||(g=!1);y||g?this._notify(r,a,f):this.requestors.push({ids:r,scope:a,callback:f})}getUpdatedImages(r){return this.updatedImages[r]}_notify(r,a,f){let g={};for(let y of r){this.images[a][y]||this.fire(new o.f("styleimagemissing",{id:y}));let b=this.images[a][y];b?g[y]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:o.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,g)}getPixelSize(r){let{width:a,height:f}=this.atlasImage[r];return{width:a,height:f}}getPattern(r,a,f){let g=this.patterns[a][r],y=this.getImage(r,a);if(!y)return null;if(g&&g.position.version===y.version)return g.position;if(g)g.position.version=y.version;else{let b={w:y.data.width+2,h:y.data.height+2,x:0,y:0},T=new o.k(b,y);this.patterns[a][r]={bin:b,position:T}}return this._updatePatternAtlas(a,f),this.patterns[a][r].position}bind(r,a){let f=r.gl,g=this.atlasTexture[a];g?this.dirty&&(g.update(this.atlasImage[a]),this.dirty=!1):(g=new o.T(r,this.atlasImage[a],f.RGBA),this.atlasTexture[a]=g),g.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(r,a){let f=[];for(let T in this.patterns[r])f.push(this.patterns[r][T].bin);let{w:g,h:y}=o.j(f),b=this.atlasImage[r];b.resize({width:g||1,height:y||1});for(let T in this.patterns[r]){let{bin:M}=this.patterns[r][T],C=M.x+1,P=M.y+1,L=this.images[r][T].data,F=L.width,N=L.height;o.i.copy(L,b,{x:0,y:0},{x:C,y:P},{width:F,height:N},a),o.i.copy(L,b,{x:0,y:N-1},{x:C,y:P-1},{width:F,height:1},a),o.i.copy(L,b,{x:0,y:0},{x:C,y:P+N},{width:F,height:1},a),o.i.copy(L,b,{x:F-1,y:0},{x:C-1,y:P},{width:1,height:N},a),o.i.copy(L,b,{x:0,y:0},{x:C+F,y:P},{width:1,height:N},a)}this.dirty=!0}beginFrame(){for(let r in this.images)this.callbackDispatchedThisFrame[r]={}}dispatchRenderCallbacks(r,a){for(let f of r){if(this.callbackDispatchedThisFrame[a][f])continue;this.callbackDispatchedThisFrame[a][f]=!0;let g=this.images[a][f];Et(g)&&this.updateImage(f,a,g)}}}function Zn(u){let r=u.key,a=u.value,f=u.valueSpec||{},g=u.objectElementValidators||{},y=u.style,b=u.styleSpec,T=[],M=o.n(a);if(M!=="object")return[new o.V(r,a,`object expected, ${M} found`)];for(let C in a){let P=C.split(".")[0],L;g[P]?L=g[P]:f[P]?L=B:g["*"]?L=g["*"]:f["*"]&&(L=B),L?T=T.concat(L({key:(r&&`${r}.`)+C,value:a[C],valueSpec:f[P]||f["*"],style:y,styleSpec:b,object:a,objectKey:C},a)):T.push(new o.m(r,a[C],`unknown property "${C}"`))}for(let C in f)g[C]||f[C].required&&f[C].default===void 0&&a[C]===void 0&&T.push(new o.V(r,a,`missing required property "${C}"`));return T}function ia(u){let r=u.value,a=u.valueSpec,f=u.style,g=u.styleSpec,y=u.key,b=u.arrayElementValidator||B;if(o.n(r)!=="array")return[new o.V(y,r,`array expected, ${o.n(r)} found`)];if(a.length&&r.length!==a.length)return[new o.V(y,r,`array length ${a.length} expected, length ${r.length} found`)];if(a["min-length"]&&r.length<a["min-length"])return[new o.V(y,r,`array length at least ${a["min-length"]} expected, length ${r.length} found`)];let T={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};g.$version<7&&(T.function=a.function),o.n(a.value)==="object"&&(T=a.value);let M=[];for(let C=0;C<r.length;C++)M=M.concat(b({array:r,arrayIndex:C,value:r[C],valueSpec:T,style:f,styleSpec:g,key:`${y}[${C}]`},!0));return M}function ls(u){let r=u.key,a=u.value,f=u.valueSpec,g=o.n(a);if(g==="number"&&a!=a&&(g="NaN"),g!=="number")return[new o.V(r,a,`number expected, ${g} found`)];if("minimum"in f){let y=f.minimum;if(o.n(f.minimum)==="array"&&(y=f.minimum[u.arrayIndex]),a<y)return[new o.V(r,a,`${a} is less than the minimum value ${y}`)]}if("maximum"in f){let y=f.maximum;if(o.n(f.maximum)==="array"&&(y=f.maximum[u.arrayIndex]),a>y)return[new o.V(r,a,`${a} is greater than the maximum value ${y}`)]}return[]}function Ni(u){let r=u.valueSpec,a=o.u(u.value.type),f,g,y,b={},T=a!=="categorical"&&u.value.property===void 0,M=!T,C=o.n(u.value.stops)==="array"&&o.n(u.value.stops[0])==="array"&&o.n(u.value.stops[0][0])==="object",P=Zn({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(N){if(a==="identity")return[new o.V(N.key,N.value,'identity function may not have a "stops" property')];let j=[],U=N.value;return j=j.concat(ia({key:N.key,value:U,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:L})),o.n(U)==="array"&&U.length===0&&j.push(new o.V(N.key,U,"array must have at least one stop")),j},default:function(N){return B({key:N.key,value:N.value,valueSpec:r,style:N.style,styleSpec:N.styleSpec})}}});return a==="identity"&&T&&P.push(new o.V(u.key,u.value,'missing required property "property"')),a==="identity"||u.value.stops||P.push(new o.V(u.key,u.value,'missing required property "stops"')),a==="exponential"&&u.valueSpec.expression&&!o.s(u.valueSpec)&&P.push(new o.V(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(M&&!o.q(u.valueSpec)?P.push(new o.V(u.key,u.value,"property functions not supported")):T&&!o.r(u.valueSpec)&&P.push(new o.V(u.key,u.value,"zoom functions not supported"))),a!=="categorical"&&!C||u.value.property!==void 0||P.push(new o.V(u.key,u.value,'"property" property is required')),P;function L(N){let j=[],U=N.value,G=N.key;if(o.n(U)!=="array")return[new o.V(G,U,`array expected, ${o.n(U)} found`)];if(U.length!==2)return[new o.V(G,U,`array length 2 expected, length ${U.length} found`)];if(C){if(o.n(U[0])!=="object")return[new o.V(G,U,`object expected, ${o.n(U[0])} found`)];if(U[0].zoom===void 0)return[new o.V(G,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new o.V(G,U,"object stop key must have value")];let $=o.u(U[0].zoom);if(typeof $!="number")return[new o.V(G,U[0].zoom,"stop zoom values must be numbers")];if(y&&y>$)return[new o.V(G,U[0].zoom,"stop zoom values must appear in ascending order")];$!==y&&(y=$,g=void 0,b={}),j=j.concat(Zn({key:`${G}[0]`,value:U[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:ls,value:F}}))}else j=j.concat(F({key:`${G}[0]`,value:U[0],valueSpec:{},style:N.style,styleSpec:N.styleSpec},U));return o.t(o.v(U[1]))?j.concat([new o.V(`${G}[1]`,U[1],"expressions are not allowed in function stops.")]):j.concat(B({key:`${G}[1]`,value:U[1],valueSpec:r,style:N.style,styleSpec:N.styleSpec}))}function F(N,j){let U=o.n(N.value),G=o.u(N.value),$=N.value!==null?N.value:j;if(f){if(U!==f)return[new o.V(N.key,$,`${U} stop domain type must match previous stop domain type ${f}`)]}else f=U;if(U!=="number"&&U!=="string"&&U!=="boolean"&&typeof G!="number"&&typeof G!="string"&&typeof G!="boolean")return[new o.V(N.key,$,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&a!=="categorical"){let Q=`number expected, ${U} found`;return o.q(r)&&a===void 0&&(Q+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(N.key,$,Q)]}return a!=="categorical"||U!=="number"||typeof G=="number"&&isFinite(G)&&Math.floor(G)===G?a!=="categorical"&&U==="number"&&typeof G=="number"&&typeof g=="number"&&g!==void 0&&G<g?[new o.V(N.key,$,"stop domain values must appear in ascending order")]:(g=G,a==="categorical"&&G in b?[new o.V(N.key,$,"stop domain values must be unique")]:(b[G]=!0,[])):[new o.V(N.key,$,`integer expected, found ${String(G)}`)]}}function zi(u){let r=(u.expressionContext==="property"?o.x:o.y)(o.v(u.value),u.valueSpec);if(r.result==="error")return r.value.map(f=>new o.V(`${u.key}${f.key}`,u.value,f.message));let a=r.value.expression||r.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!a.outputDefined())return[new o.V(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!o.z(a))return[new o.V(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return Dl(a,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!o.A(a,["zoom","feature-state"]))return[new o.V(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!o.B(a))return[new o.V(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Dl(u,r){let a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(let g of r.valueSpec.expression.parameters)a.delete(g);if(a.size===0)return[];let f=[];return u instanceof o.D&&a.has(u.name)?[new o.V(r.key,r.value,`["${u.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(u.eachChild(g=>{f.push(...Dl(g,r))}),f)}function Ro(u){let r=u.key,a=u.value,f=u.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(o.u(a))===-1&&g.push(new o.V(r,a,`expected one of [${f.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(f.values).indexOf(o.u(a))===-1&&g.push(new o.V(r,a,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(a)} found`)),g}function Lo(u){return o.G(o.v(u.value))?zi(o.o({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):oa(u)}function oa(u){let r=u.value,a=u.key;if(o.n(r)!=="array")return[new o.V(a,r,`array expected, ${o.n(r)} found`)];let f=u.styleSpec,g,y=[];if(r.length<1)return[new o.V(a,r,"filter array must have at least 1 element")];switch(y=y.concat(Ro({key:`${a}[0]`,value:r[0],valueSpec:f.filter_operator,style:u.style,styleSpec:u.styleSpec})),o.u(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&o.u(r[1])==="$type"&&y.push(new o.V(a,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&y.push(new o.V(a,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(g=o.n(r[1]),g!=="string"&&y.push(new o.V(`${a}[1]`,r[1],`string expected, ${g} found`)));for(let b=2;b<r.length;b++)g=o.n(r[b]),o.u(r[1])==="$type"?y=y.concat(Ro({key:`${a}[${b}]`,value:r[b],valueSpec:f.geometry_type,style:u.style,styleSpec:u.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&y.push(new o.V(`${a}[${b}]`,r[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<r.length;b++)y=y.concat(oa({key:`${a}[${b}]`,value:r[b],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":g=o.n(r[1]),r.length!==2?y.push(new o.V(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="string"&&y.push(new o.V(`${a}[1]`,r[1],`string expected, ${g} found`))}return y}function sa(u,r){let a=u.key,f=u.style,g=u.layer,y=u.styleSpec,b=u.value,T=u.objectKey,M=y[`${r}_${u.layerType}`];if(!M)return[];let C=T.match(/^(.*)-transition$/);if(r==="paint"&&C&&M[C[1]]&&M[C[1]].transition)return B({key:a,value:b,valueSpec:y.transition,style:f,styleSpec:y});let P=u.valueSpec||M[T];if(!P)return[new o.m(a,b,`unknown property "${T}"`)];let L;if(o.n(b)==="string"&&o.q(P)&&!P.tokens&&(L=/^{([^}]+)}$/.exec(b))){let N=`\`{ "type": "identity", "property": ${L?JSON.stringify(L[1]):'"_"'} }\``;return[new o.V(a,b,`"${T}" does not support interpolation syntax
Use an identity property function instead: ${N}.`)]}let F=[];if(u.layerType==="symbol")T!=="text-field"||!f||f.glyphs||f.imports||F.push(new o.V(a,b,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&o.H(o.v(b))&&o.u(b.type)==="identity"&&F.push(new o.V(a,b,'"text-font" does not support identity functions'));else if(u.layerType==="model"&&r==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&o.q(P)&&(o.J(P)||o.r(P))){let N=o.x(o.v(b),P),j=N.value.expression||N.value._styleExpression.expression;j&&!o.A(j,["measure-light"])&&(T==="model-emissive-strength"&&o.B(j)&&o.z(j)||F.push(new o.V(a,b,`${T} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return F.concat(B({key:u.key,value:b,valueSpec:P,style:f,styleSpec:y,expressionContext:"property",propertyType:r,propertyKey:T}))}function nu(u){return sa(u,"paint")}function aa(u){return sa(u,"layout")}function li(u){let r=[],a=u.value,f=u.key,g=u.style,y=u.styleSpec;a.type||a.ref||r.push(new o.V(f,a,'either "type" or "ref" is required'));let b=o.u(a.type),T=o.u(a.ref);if(a.id){let M=o.u(a.id);for(let C=0;C<u.arrayIndex;C++){let P=g.layers[C];o.u(P.id)===M&&r.push(new o.V(f,a.id,`duplicate layer id "${a.id}", previously used at line ${P.id.__line__}`))}}if("ref"in a){let M;["type","source","source-layer","filter","layout"].forEach(C=>{C in a&&r.push(new o.V(f,a[C],`"${C}" is prohibited for ref layers`))}),g.layers.forEach(C=>{o.u(C.id)===T&&(M=C)}),M?M.ref?r.push(new o.V(f,a.ref,"ref cannot reference another ref layer")):b=o.u(M.type):typeof T=="string"&&r.push(new o.V(f,a.ref,`ref layer "${T}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(a.source){let M=g.sources&&g.sources[a.source],C=M&&o.u(M.type);M?C==="vector"&&b==="raster"?r.push(new o.V(f,a.source,`layer "${a.id}" requires a raster source`)):C==="raster"&&b!=="raster"?r.push(new o.V(f,a.source,`layer "${a.id}" requires a vector source`)):C!=="vector"||a["source-layer"]?C==="raster-dem"&&b!=="hillshade"?r.push(new o.V(f,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="raster-array"||["raster","raster-particle"].includes(b)?b!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||C==="geojson"&&M.lineMetrics?b==="raster-particle"&&C!=="raster-array"&&r.push(new o.V(f,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):r.push(new o.V(f,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new o.V(f,a.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new o.V(f,a,`layer "${a.id}" must specify a "source-layer"`)):r.push(new o.V(f,a.source,`source "${a.source}" not found`))}else r.push(new o.V(f,a,'missing required property "source"'));return r=r.concat(Zn({key:f,value:a,valueSpec:y.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>B({key:`${f}.type`,value:a.type,valueSpec:y.layer.type,style:u.style,styleSpec:u.styleSpec,object:a,objectKey:"type"}),filter:M=>Lo(o.o({layerType:b},M)),layout:M=>Zn({layer:a,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":C=>aa(o.o({layerType:b},C))}}),paint:M=>Zn({layer:a,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":C=>nu(o.o({layerType:b,layer:a},C))}})}})),r}function Oo(u){let r=u.value,a=u.key,f=o.n(r);return f!=="string"?[new o.V(a,r,`string expected, ${f} found`)]:[]}let ci={promoteId:function({key:u,value:r}){if(o.n(r)==="string")return Oo({key:u,value:r});{let a=[];for(let f in r)a.push(...Oo({key:`${u}.${f}`,value:r[f]}));return a}}};function gr(u){let r=u.value,a=u.key,f=u.styleSpec,g=u.style;if(!r.type)return[new o.V(a,r,'"type" is required')];let y=o.u(r.type),b=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&(r.url||r.tiles||b.push(new o.m(a,r,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(Zn({key:a,value:r,valueSpec:f[`source_${y.replace("-","_")}`],style:u.style,styleSpec:f,objectElementValidators:ci})),b;case"geojson":if(b=Zn({key:a,value:r,valueSpec:f.source_geojson,style:g,styleSpec:f,objectElementValidators:ci}),r.cluster)for(let T in r.clusterProperties){let[M,C]=r.clusterProperties[T],P=typeof M=="string"?[M,["accumulated"],["get",T]]:M;b.push(...zi({key:`${a}.${T}.map`,value:C,expressionContext:"cluster-map"})),b.push(...zi({key:`${a}.${T}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return b;case"video":return Zn({key:a,value:r,valueSpec:f.source_video,style:g,styleSpec:f});case"image":return Zn({key:a,value:r,valueSpec:f.source_image,style:g,styleSpec:f});case"canvas":return[new o.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ro({key:`${a}.type`,value:r.type,valueSpec:{values:ru(f)},style:g,styleSpec:f})}}function ru(u){return u.source.reduce((r,a)=>{let f=u[a];return f.type.type==="enum"&&(r=r.concat(Object.keys(f.type.values))),r},[])}function cs(u){let r=u.value,a=u.styleSpec,f=a.light,g=u.style,y=[],b=o.n(r);if(r===void 0)return y;if(b!=="object")return y=y.concat([new o.V("light",r,`object expected, ${b} found`)]),y;for(let T in r){let M=T.match(/^(.*)-transition$/);y=y.concat(M&&f[M[1]]&&f[M[1]].transition?B({key:T,value:r[T],valueSpec:a.transition,style:g,styleSpec:a}):f[T]?B({key:T,value:r[T],valueSpec:f[T],style:g,styleSpec:a}):[new o.V(T,r[T],`unknown property "${T}"`)])}return y}function la(u){let r=u.value,a=[];if(!r)return a;let f=o.n(r);if(f!=="object")return a=a.concat([new o.V("light-3d",r,`object expected, ${f} found`)]),a;let g=u.styleSpec,y=g["light-3d"],b=u.key,T=u.style,M=u.style.lights;for(let L of["type","id"])if(!(L in r))return a=a.concat([new o.V("light-3d",r,`missing property ${L} on light`)]),a;if(r.type&&M)for(let L=0;L<u.arrayIndex;L++){let F=o.u(r.type),N=M[L];o.u(N.type)===F&&a.push(new o.V(b,r.id,`duplicate light type "${r.type}", previously defined at line ${N.id.__line__}`))}let C=`properties_light_${r.type}`;if(!(C in g))return a=a.concat([new o.V("light-3d",r,`Invalid light type ${r.type}`)]),a;let P=g[C];for(let L in r)if(L==="properties"){let F=r[L],N=o.n(F);if(N!=="object")return a=a.concat([new o.V("properties",F,`object expected, ${N} found`)]),a;for(let j in F)a=a.concat(P[j]?B({key:j,value:F[j],valueSpec:P[j],style:T,styleSpec:g}):[new o.m(u.key,F[j],`unknown property "${j}"`)])}else{let F=L.match(/^(.*)-transition$/);a=a.concat(F&&y[F[1]]&&y[F[1]].transition?B({key:L,value:r[L],valueSpec:g.transition,style:T,styleSpec:g}):y[L]?B({key:L,value:r[L],valueSpec:y[L],style:T,styleSpec:g}):[new o.m(L,r[L],`unknown property "${L}"`)])}return a}function Ml(u){let r=u.value,a=u.key,f=u.style,g=u.styleSpec,y=g.terrain,b=[],T=o.n(r);if(r===void 0||T==="null")return b;if(T!=="object")return b=b.concat([new o.V("terrain",r,`object expected, ${T} found`)]),b;for(let M in r){let C=M.match(/^(.*)-transition$/);b=b.concat(C&&y[C[1]]&&y[C[1]].transition?B({key:M,value:r[M],valueSpec:g.transition,style:f,styleSpec:g}):y[M]?B({key:M,value:r[M],valueSpec:y[M],style:f,styleSpec:g}):[new o.m(M,r[M],`unknown property "${M}"`)])}if(r.source){let M=f.sources&&f.sources[r.source],C=M&&o.u(M.type);M?C!=="raster-dem"&&b.push(new o.V(a,r.source,`terrain cannot be used with a source of type ${String(C)}, it only be used with a "raster-dem" source type`)):b.push(new o.V(a,r.source,`source "${r.source}" not found`))}else b.push(new o.V(a,r,'terrain is missing required property "source"'));return b}function ca(u){let r=u.value,a=u.style,f=u.styleSpec,g=f.fog,y=[],b=o.n(r);if(r===void 0)return y;if(b!=="object")return y=y.concat([new o.V("fog",r,`object expected, ${b} found`)]),y;for(let T in r){let M=T.match(/^(.*)-transition$/);y=y.concat(M&&g[M[1]]&&g[M[1]].transition?B({key:T,value:r[T],valueSpec:f.transition,style:a,styleSpec:f}):g[T]?B({key:T,value:r[T],valueSpec:g[T],style:a,styleSpec:f}):[new o.m(T,r[T],`unknown property "${T}"`)])}return y}let fe={"*":()=>[],array:ia,boolean:function(u){let r=u.value,a=u.key,f=o.n(r);return f!=="boolean"?[new o.V(a,r,`boolean expected, ${f} found`)]:[]},number:ls,color:function(u){let r=u.key,a=u.value,f=o.n(a);return f!=="string"?[new o.V(r,a,`color expected, ${f} found`)]:o.F(a)===null?[new o.V(r,a,`color expected, "${a}" found`)]:[]},enum:Ro,filter:Lo,function:Ni,layer:li,object:Zn,source:gr,model:o.K,light:cs,"light-3d":la,terrain:Ml,fog:ca,string:Oo,formatted:function(u){return Oo(u).length===0?[]:zi(u)},resolvedImage:function(u){return Oo(u).length===0?[]:zi(u)},projection:function(u){let r=u.value,a=u.styleSpec,f=a.projection,g=u.style,y=[],b=o.n(r);if(b==="object")for(let T in r)y=y.concat(B({key:T,value:r[T],valueSpec:f[T],style:g,styleSpec:a}));else b!=="string"&&(y=y.concat([new o.V("projection",r,`object or string expected, ${b} found`)]));return y},import:function(u){let{value:r,styleSpec:a}=u,b=r,{data:f}=b,g=J0(b,["data"]);Object.defineProperty(g,"__line__",{value:r.__line__,enumerable:!1});let y=Zn(o.o({},u,{value:g,valueSpec:a.import}));return o.u(g.id)===""&&y.push(new o.V(`${u.key}.id`,g,"import id can't be an empty string")),f&&(y=y.concat(te(f,a,{key:`${u.key}.data`}))),y}};function B(u,r=!1){let a=u.value,f=u.valueSpec,g=u.styleSpec;if(f.expression&&o.H(o.u(a)))return Ni(u);if(f.expression&&o.t(o.v(a)))return zi(u);if(f.type&&fe[f.type]){let y=fe[f.type](u);return r===!0&&y.length>0&&o.n(u.value)==="array"?zi(u):y}return Zn(o.o({},u,{valueSpec:f.type?g[f.type]:f}))}function H(u){let r=u.value,a=u.key,f=Oo(u);return f.length||(r.indexOf("{fontstack}")===-1&&f.push(new o.V(a,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&f.push(new o.V(a,r,'"glyphs" url must include a "{range}" token'))),f}function te(u,r=o.L,a={}){return B({key:a.key||"",value:u,valueSpec:r.$root,styleSpec:r,style:u,objectElementValidators:{glyphs:H,"*":()=>[]}})}function se(u,r=o.L){return Nt(te(u,r))}let le=u=>Nt(gr(u)),xe=u=>Nt(cs(u)),Ie=u=>Nt(la(u)),ge=u=>Nt(Ml(u)),Me=u=>Nt(ca(u)),Xe=u=>Nt(li(u)),$e=u=>Nt(Lo(u)),ut=u=>Nt(nu(u)),yt=u=>Nt(aa(u)),Ft=u=>Nt(o.K(u));function Nt(u){return u.slice().sort((r,a)=>r.line&&a.line?r.line-a.line:0)}function Ct(u,r){let a=!1;if(r&&r.length)for(let f of r)f instanceof o.m?o.w(f.message):(u.fire(new o.d(new Error(f.message))),a=!0);return a}let Xt=new o.N({anchor:new o.O(o.L.light.anchor),position:new o.Q(o.L.light.position),color:new o.O(o.L.light.color),intensity:new o.O(o.L.light.intensity)});class lt extends o.E{constructor(r,a="flat"){super(),this._transitionable=new o.U(Xt),this.setLight(r,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,a,f={}){this._validate(xe,r,f)||(this._transitionable.setTransitionOrValue(r),this.id=a)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,a,f){return(!f||f.validate!==!1)&&Ct(this,r.call(se,o.W({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.L})))}}let Nn=new o.N({source:new o.O(o.L.terrain.source),exaggeration:new o.O(o.L.terrain.exaggeration)}),mn=class extends o.E{constructor(u,r,a,f){super(),this.scope=a,this._transitionable=new o.U(Nn,a,f),this._transitionable.setTransitionOrValue(u,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(u,r){this._transitionable.setTransitionOrValue(u,r)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}getExaggeration(u){return this._transitioning.possiblyEvaluate(new o.X(u)).get("exaggeration")}isZoomDependent(){let u=this._transitionable._values.exaggeration;return u!=null&&u.value!=null&&u.value.expression!=null&&u.value.expression instanceof o.Z}},Kt=45,er=65,zn=.05;function sr(u,r,a,f){let g=o.$(Kt,er,a),[y,b]=Tr(u,f),T=1-Math.min(1,Math.exp((r-y)/(b-y)*-6));return T*=T*T,T=Math.min(1,1.00747*T),T*g*u.alpha}function Tr(u,r){let a=.5/Math.tan(.5*r);return[u.range[0]+a,u.range[1]+a]}function Er(u,r,a,f,g){let y=o._.transformMat4([],[r,a,f],g.mercatorFogMatrix);return sr(u,o._.length(y),g.pitch,g._fov)}function us(u,r,a,f,g,y,b){let T=[[a,f,0],[g,f,0],[g,y,0],[a,y,0]],M=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let P of T){let L=o._.transformMat4([],P,r),F=o._.length(L);M=Math.min(M,F),C=Math.max(C,F)}return[sr(u,M,b.pitch,b._fov),sr(u,C,b.pitch,b._fov)]}let jh=new o.N({range:new o.O(o.L.fog.range),color:new o.O(o.L.fog.color),"high-color":new o.O(o.L.fog["high-color"]),"space-color":new o.O(o.L.fog["space-color"]),"horizon-blend":new o.O(o.L.fog["horizon-blend"]),"star-intensity":new o.O(o.L.fog["star-intensity"]),"vertical-range":new o.O(o.L.fog["vertical-range"])});class gp extends o.E{constructor(r,a,f,g){super(),this._transitionable=new o.U(jh,f,new Map(g)),this.set(r,g),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new o.a0(jh),this.scope=f}get state(){let r=this._transform,a=r.projection.name==="globe",f=o.a1(r.zoom),g=this.properties.get("range"),y=[.5,3];return{range:a?[o.a2(y[0],g[0],f),o.a2(y[1],g[1],f)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,a,f={}){if(this._validate(Me,r,f))return;let g=o.W({},r);for(let y of Object.keys(o.L.fog))g[y]===void 0&&(g[y]=o.L.fog[y].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;let a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.$(Kt,er,r))*a.a}getOpacityAtLatLng(r,a){return this._transform.projection.supportsFog?function(f,g,y){let b=o.Y.fromLngLat(g),T=y.elevation?y.elevation.getAtPointOrZero(b):0;return Er(f,b.x,b.y,T,y)}(this.state,r,a):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];let a=this._transform.calculateFogTileMatrix(r.toUnwrapped());return us(this.state,a,0,0,o.a3,o.a3,this._transform)}getOpacityForBounds(r,a,f,g,y){return this._transform.projection.supportsFog?us(this.state,r,a,f,g,y,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Tr(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;let a=[4,5,6,7];for(let f of a){let g=r.points[f],y;if(g[2]>=0)y=g;else{let b=r.points[f-4];y=o.a4(b,g,b[2]/(b[2]-g[2]))}if(Er(this.state,y[0],y[1],0,this._transform)>=zn)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,a,f){return(!f||f.validate!==!1)&&Ct(this,r.call(se,o.W({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.L})))}}class Cl extends o.E{constructor(r,a,f,g){super(),this.scope=f,this._options=r,this.properties=new o.a0(a),this._transitionable=new o.U(a,f,new Map(g)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,a){this._options=r,this._transitionable.setTransitionOrValue(r.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Ot=new o.N({color:new o.O(o.L.properties_light_ambient.color),intensity:new o.O(o.L.properties_light_ambient.intensity)}),Uh=new o.N({direction:new o.a5(o.L.properties_light_directional.direction),color:new o.O(o.L.properties_light_directional.color),intensity:new o.O(o.L.properties_light_directional.intensity),"cast-shadows":new o.O(o.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new o.O(o.L.properties_light_directional["shadow-intensity"])});var ko=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Gh=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,$h=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Hh="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",qh=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform highp sampler2D u_depth;uniform vec2 u_depth_size_inv;uniform vec2 u_depth_range_unpack;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
#ifdef TERRAIN_DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef TERRAIN_DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;
#ifdef TERRAIN_DEPTH_D24
vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Wh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Zh=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Xh=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Yh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Qh=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,_p=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let ua=[];ha(ko,ua),ha($h,ua),ha(Gh,ua);let iu={"_prelude_fog.vertex.glsl":Wh,"_prelude_terrain.vertex.glsl":qh,"_prelude_shadow.vertex.glsl":Qh,"_prelude_fog.fragment.glsl":Zh,"_prelude_shadow.fragment.glsl":_p,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Xh,"_prelude_raster_particle.glsl":Yh},ou={};Ht("",qh),Ht(Zh,Wh),Ht(_p,Qh),Ht(Xh,""),Ht(Yh,"");let yp=Ht(Gh,$h),xp=ko;var vp={background:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ht("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ht(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ht(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ht("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ht("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ht("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ht(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ht(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ht(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ht(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ht("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ht("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ht(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Ht(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:Ht(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Ht(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ht("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ht(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Hh),skyboxGradient:Ht(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Hh),skyboxCapture:Ht(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ht(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ht(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;
#ifdef TERRAIN_DEPTH_D24
float unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef TERRAIN_DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ht(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ht(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:Ht("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function ha(u,r){let a=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of a)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let g=f.split(" ");for(let y of g)r.includes(y)||r.push(y)}}function Ht(u,r){let a=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,g=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);g&&(g=g.map(C=>{let P=C.split(" ");return P[P.length-1]}),g=[...new Set(g)]);let y={},b=[],T=[];if(u=u.replace(a,(C,P)=>(T.push(P),"")),(r=r.replace(a,(C,P)=>(b.push(P),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let M=[...ua];ha(u,M),ha(r,M);for(let C of[...b,...T])iu[C]||console.error(`Undefined include: ${C}`),ou[C]||(ou[C]=[],ha(iu[C],ou[C])),M=[...M,...ou[C]];return{fragmentSource:u=u.replace(f,(C,P,L,F,N)=>(y[N]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${L} ${F} ${N};
#else
uniform ${L} ${F} u_${N};
#endif
`:P==="initialize"?`
#ifdef HAS_UNIFORM_u_${N}
    ${L} ${F} ${N} = u_${N};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${L} ${F} ${N};
#endif
`:P==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(f,(C,P,L,F,N)=>{let j=F==="float"?"vec2":F,U=N.match(/color/)?"color":j;return P==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${N}
in ${L} ${F} a_${N};
#endif
`:y[N]?P==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${L} ${j} a_${N};
out ${L} ${F} ${N};
#else
uniform ${L} ${F} u_${N};
#endif
`:P==="initialize"?U==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${L} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${U}(a_${N}, u_${N}_t);
#else
    ${L} ${F} ${N} = u_${N};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${L} ${F} a_${N};
    out ${L} ${F} ${N};
#endif
`:P==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${N} = a_${N};
#endif
`:void 0:P==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${L} ${j} a_${N};
#else
uniform ${L} ${F} u_${N};
#endif
`:P==="define-instanced"?U==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${N}0;
in vec4 a_${N}1;
in vec4 a_${N}2;
in vec4 a_${N}3;
#else
uniform ${L} ${F} u_${N};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${L} ${j} a_${N};
#else
uniform ${L} ${F} u_${N};
#endif
`:P==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${L} ${F} ${N} = a_${N};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${L} ${F} ${N} = a_${N};
#else
    ${L} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${L} ${F} ${N} = unpack_mix_${U}(a_${N}, u_${N}_t);
#else
    ${L} ${F} ${N} = u_${N};
#endif
`}),staticAttributes:g,usedDefines:M,vertexIncludes:b,fragmentIncludes:T}}class H_{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,a,f,g,y,b,T,M){this.context=r;let C=this.boundPaintVertexBuffers.length!==g.length;for(let L=0;!C&&L<g.length;L++)this.boundPaintVertexBuffers[L]!==g[L]&&(C=!0);let P=this.boundDynamicVertexBuffers.length!==T.length;for(let L=0;!P&&L<T.length;L++)this.boundDynamicVertexBuffers[L]!==T[L]&&(P=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==f||C||P||this.boundIndexBuffer!==y||this.boundVertexOffset!==b)this.freshBind(a,f,g,y,b,T,M);else{r.bindVertexArrayOES.set(this.vao);for(let L of T)L&&(L.bind(),M&&L.instanceCount&&L.setVertexAttribDivisor(r.gl,a,M));y&&y.dynamicDraw&&y.bind()}}freshBind(r,a,f,g,y,b,T){let M=r.numAttributes,C=this.context,P=C.gl;this.vao&&this.destroy(),this.vao=C.gl.createVertexArray(),C.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=b,a.enableAttributes(P,r),a.bind(),a.setVertexAttribPointers(P,r,y);for(let L of f)L.enableAttributes(P,r),L.bind(),L.setVertexAttribPointers(P,r,y);for(let L of b)L&&(L.enableAttributes(P,r),L.bind(),L.setVertexAttribPointers(P,r,y),T&&L.instanceCount&&L.setVertexAttribDivisor(P,r,T));g&&g.bind(),C.currentNumAttributes=M}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function q_(u,r){let a=Math.pow(2,r.canonical.z),f=r.canonical.y;return[new o.Y(0,f/a).toLngLat().lat,new o.Y(0,(f+1)/a).toLngLat().lat]}function W_(u,r,a,f,g,y,b){let T=u.context,M=T.gl,C=a.hillshadeFBO;if(!C)return;u.prepareDrawTile();let P=u.isTileAffectedByFog(r),L=u.getOrCreateProgram("hillshade",{overrideFog:P});T.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,C.colorAttachment.get());let F=((G,$,Q,K)=>{let J=Q.paint.get("hillshade-shadow-color"),oe=Q.paint.get("hillshade-highlight-color"),ie=Q.paint.get("hillshade-accent-color"),ce=Q.paint.get("hillshade-emissive-strength"),q=o.ab(Q.paint.get("hillshade-illumination-direction"));if(Q.paint.get("hillshade-illumination-anchor")==="viewport")q-=G.transform.angle;else if(G.style&&G.style.enable3dLights()&&G.style.directionalLight){let he=G.style.directionalLight.properties.get("direction"),we=o.ac(he.x,he.y,he.z);q=o.ab(we[1])}let ee=!G.options.moving;return{u_matrix:K||G.transform.calculateProjMatrix($.tileID.toUnwrapped(),ee),u_image:0,u_latrange:q_(0,$.tileID),u_light:[Q.paint.get("hillshade-exaggeration"),q],u_shadow:J.toRenderColor(Q.lut),u_highlight:oe.toRenderColor(Q.lut),u_emissive_strength:ce,u_accent:ie.toRenderColor(Q.lut)}})(u,a,f,u.terrain?r.projMatrix:null);u.uploadCommonUniforms(T,L,r.toUnwrapped());let{tileBoundsBuffer:N,tileBoundsIndexBuffer:j,tileBoundsSegments:U}=u.getTileBoundsBuffers(a);L.draw(u,M.TRIANGLES,g,y,b,o.af.disabled,F,f.id,N,j,U)}function Kh(u,r,a){if(!r.needsDEMTextureUpload)return;let f=u.context,g=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||u.getTileTexture(a.stride);let y=a.getPixels();r.demTexture?r.demTexture.update(y,{premultiply:!1}):r.demTexture=new o.T(f,y,g.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Bi(u,r,a){let f=u.context,g=f.gl;if(!r.dem)return;let y=r.dem;if(f.activeTexture.set(g.TEXTURE1),Kh(u,r,y),!r.demTexture)return;r.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);let b=y.dim;f.activeTexture.set(g.TEXTURE0);let T=r.hillshadeFBO;if(!T){let F=new o.T(f,{width:b,height:b,data:null},g.RGBA);F.bind(g.LINEAR,g.CLAMP_TO_EDGE),T=r.hillshadeFBO=f.createFramebuffer(b,b,!0,"renderbuffer"),T.colorAttachment.set(F.texture)}f.bindFramebuffer.set(T.framebuffer),f.viewport.set([0,0,b,b]);let{tileBoundsBuffer:M,tileBoundsIndexBuffer:C,tileBoundsSegments:P}=u.getMercatorTileBoundsBuffers(),L=[];u.linearFloatFilteringSupported()&&L.push("TERRAIN_DEM_FLOAT_FORMAT"),u.getOrCreateProgram("hillshadePrepare",{defines:L}).draw(u,g.TRIANGLES,o.ae.disabled,o.ag.disabled,o.a.unblended,o.af.disabled,((F,N)=>{let j=N.stride,U=o.ad.create();return o.ad.ortho(U,0,o.a3,-o.a3,0,0,1),o.ad.translate(U,U,[0,-o.a3,0]),{u_matrix:U,u_image:1,u_dimension:[j,j],u_zoom:F.overscaledZ}})(r.tileID,y),a.id,M,C,P),r.needsHillshadePrepare=!1}function Jh(u,r,a,f,g){let y=function(b,T){if(b)return g(b);if(T){if(u.url&&T.tiles&&u.tiles&&delete u.tiles,T.variants){if(!Array.isArray(T.variants))return g(new Error("variants must be an array"));for(let C of T.variants){if(C==null||typeof C!="object"||C.constructor!==Object)return g(new Error("variant must be an object"));if(!Array.isArray(C.capabilities))return g(new Error("capabilities must be an array"));if(C.capabilities.length===1&&C.capabilities[0]==="meshopt"){T=o.W(T,C);break}}}let M=o.ah(o.W(T,u),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(M.vectorLayers=T.vector_layers,M.vectorLayerIds=M.vectorLayers.map(C=>C.id)),T.raster_layers&&(M.rasterLayers=T.raster_layers,M.rasterLayerIds=M.rasterLayers.map(C=>C.id)),M.tiles=r.canonicalizeTileset(M,u.url),g(null,M)}};return u.url?o.g(r.transformRequest(r.normalizeSourceURL(u.url,null,a,f),o.R.Source),y):o.e.frame(()=>y(null,u))}class Sl{constructor(r,a,f){this.bounds=o.ai.convert(this.validateBounds(r)),this.minzoom=a||0,this.maxzoom=f||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){let a=Math.pow(2,r.z),f=Math.floor(o.aj(this.bounds.getWest())*a),g=Math.floor(o.ak(this.bounds.getNorth())*a),y=Math.ceil(o.aj(this.bounds.getEast())*a),b=Math.ceil(o.ak(this.bounds.getSouth())*a);return r.x>=f&&r.x<y&&r.y>=g&&r.y<b}}class Al extends o.E{constructor(r,a,f,g){super(),this.id=r,this.dispatcher=f,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.W({type:"raster"},a),o.W(this,o.ah(a,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new o.f("dataloading",{dataType:"source"})),this._tileJSONRequest=Jh(this._options,this.map._requestManager,null,null,(a,f)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new o.d(a)):f&&(o.W(this,f),f.bounds&&(this.tileBounds=new Sl(f.bounds,this.minzoom,this.maxzoom)),o.an(f.tiles),this.fire(new o.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.f("data",{dataType:"source",sourceDataType:"content"}))),r&&r(a)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();let r=o.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return o.W({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,a){let f=o.e.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);r.request=o.h(this.map._requestManager.transformRequest(g,o.R.Tile),(y,b,T,M)=>(delete r.request,r.aborted?(r.state="unloaded",a(null)):y?(r.state="errored",a(y)):b?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:T,expires:M}),r.setTexture(b,this.map.painter),r.state="loaded",o.am(this.dispatcher),void a(null)):a(null)))}abortTile(r,a){r.request&&(r.request.cancel(),delete r.request),a&&a()}unloadTile(r,a){r.texture&&r.texture instanceof o.T?(r.destroy(!0),r.texture&&r.texture instanceof o.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class su extends o.E{constructor(r,a,f,g){if(super(),this.id=r,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.W(this,o.ah(a,["url","scheme","tileSize","promoteId"])),this._options=o.W({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new o.ao}load(r){this._loaded=!1,this.fire(new o.f("dataloading",{dataType:"source"}));let a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=Jh(this._options,this.map._requestManager,a,f,(g,y)=>{this._tileJSONRequest=null,this._loaded=!0,g?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new o.d(g))):y&&(o.W(this,y),y.bounds&&(this.tileBounds=new Sl(y.bounds,this.minzoom,this.maxzoom)),o.an(y.tiles,this.map._requestManager._customAccessToken),this.fire(new o.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.f("data",{dataType:"source",sourceDataType:"content"}))),r&&r(g)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();let r=o.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return o.W({},this._options)}loadTile(r,a){let f=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),g=this.map._requestManager.transformRequest(f,o.R.Tile),y=this.map.style?this.map.style.getLut(this.scope):null,b={request:g,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,lut:y?{image:y.image.clone()}:null,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(b.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=a:r.request=r.actor.send("reloadTile",b,T.bind(this));else if(r.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",b,T.bind(this),void 0,!0);else{let M=o.ap.call({deduped:this._deduped},b,(C,P)=>{C||!P?T.call(this,C):(b.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},r.actor&&r.actor.send("loadTile",b,T.bind(this),void 0,!0))},!0);r.request={cancel:M}}function T(M,C){return delete r.request,r.aborted?a(null):M&&M.status!==404?a(M):(C&&C.resourceTiming&&(r.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&r.setExpiryData(C),r.loadVectorData(C,this.map.painter),o.am(this.dispatcher),a(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,a){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let da=(u,r,a)=>({u_matrix:u,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:a}),tt=(u,r,a,f,g,y,b,T,M,C,P,L,F,N,j,U)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:a,u_zoom_transition:g,u_merc_center:y,u_image0:0,u_frustum_tl:b,u_frustum_tr:T,u_frustum_br:M,u_frustum_bl:C,u_globe_pos:P,u_globe_radius:L,u_viewport:F,u_grid_matrix:U?Float32Array.from(U):new Float32Array(9),u_skirt_height:N,u_far_z_cutoff:j});class ed{constructor(r=0,a=0,f=0,g=0){if(isNaN(r)||r<0||isNaN(a)||a<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=a,this.left=f,this.right=g}interpolate(r,a,f){return a.top!=null&&r.top!=null&&(this.top=o.a2(r.top,a.top,f)),a.bottom!=null&&r.bottom!=null&&(this.bottom=o.a2(r.bottom,a.bottom,f)),a.left!=null&&r.left!=null&&(this.left=o.a2(r.left,a.left,f)),a.right!=null&&r.right!=null&&(this.right=o.a2(r.right,a.right,f)),this}getCenter(r,a){let f=o.at((this.left+r-this.right)/2,0,r),g=o.at((this.top+a-this.bottom)/2,0,a);return new o.P(f,g)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new ed(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function au(u,r){let a=o.aw(u,3);o.ad.fromQuat(u,r),o.az(u,3,a)}function qt(u,r){let a=o.av.identity([]);return o.av.rotateZ(a,a,-r),o.av.rotateX(a,a,-u),a}function Ar(u,r){let a=[u[0],u[1],0],f=[r[0],r[1],0];if(o._.length(a)>=1e-15){let b=o._.normalize([],a);o._.scale(f,b,o._.dot(f,b)),r[0]=f[0],r[1]=f[1]}let g=o._.cross([],r,u);if(o._.len(g)<1e-15)return null;let y=Math.atan2(-g[1],g[0]);return qt(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),y)}class bp{constructor(r,a){this.position=r,this.orientation=a}get position(){return this._position}set position(r){if(r){let a=r instanceof o.Y?r:new o.Y(r[0],r[1],r[2]);this._renderWorldCopies&&(a.x=o.au(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(r,a){if(this.orientation=null,!this.position)return;let f=this.position,g=this._elevation?this._elevation.getAtPointOrZero(o.Y.fromLngLat(r)):0,y=o.Y.fromLngLat(r,g),b=[y.x-f.x,y.y-f.y,y.z-f.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Ar(b,a)}setPitchBearing(r,a){this.orientation=qt(o.ab(r),o.ab(-a))}}class Pl{constructor(r,a){this._transform=o.ad.identity([]),this.orientation=a,this.position=r}get mercatorPosition(){let r=this.position;return new o.Y(r[0],r[1],r[2])}get position(){let r=o.aw(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var a;r&&o.az(this._transform,3,[(a=r)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.av.identity([]),r&&au(this._transform,this._orientation)}getPitchBearing(){let r=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,a){this._orientation=qt(r,a),au(this._transform,this._orientation)}forward(){let r=o.aw(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){let r=o.aw(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){let r=o.aw(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,a){let f=new Float64Array(16);return o.ad.invert(f,this.getWorldToCamera(r,a)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,a,f){let g=this.position;o._.scale(g,g,-r);let y=new Float64Array(16);return o.ad.fromScaling(y,[f,f,f]),o.ad.translate(y,y,g),y[10]*=a,y}getWorldToCamera(r,a){let f=new Float64Array(16),g=new Float64Array(4),y=this.position;return o.av.conjugate(g,this._orientation),o._.scale(y,y,-r),o.ad.fromQuat(f,g),o.ad.translate(f,f,y),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=a,f[9]*=a,f[10]*=a,f[11]*=a,f}getCameraToClipPerspective(r,a,f,g){let y=new Float64Array(16);return o.ad.perspective(y,r,a,f,g),y}getCameraToClipOrthographic(r,a,f,g,y,b){let T=new Float64Array(16);return o.ad.ortho(T,r,a,f,g,y,b),T}getDistanceToElevation(r,a=!1){let f=r===0?0:o.ax(r,a?o.ay(this.position[1]):this.position[1]),g=this.forward();return(f-this.position[2])/g[2]}clone(){return new Pl([...this.position],[...this.orientation])}}let hs={unknown:0,flipRequired:1,flipNotRequired:2},Z_=Math.tan(85*Math.PI/180);function St(u,r,a,f,g,y,b){let T=o.ad.create();if(a)if(y.name==="globe"){let M=o.aB(g,r);o.ad.multiply(T,T,M)}else{let M=o.aC.invert([],b);T[0]=M[0],T[1]=M[1],T[4]=M[2],T[5]=M[3],f||o.ad.rotateZ(T,T,g.angle)}else o.ad.multiply(T,g.labelPlaneMatrix,u);return T}function Rl(u,r,a,f,g,y,b){let T=St(u,r,a,f,g,y,b);return y.name==="globe"&&a||(T[2]=T[6]=T[10]=T[14]=0),T}function ds(u,r,a,f,g,y,b){if(a){if(y.name==="globe"){let T=St(u,r,a,f,g,y,b);return o.ad.invert(T,T),o.ad.multiply(T,u,T),T}{let T=o.ad.clone(u),M=o.ad.identity([]);return M[0]=b[0],M[1]=b[1],M[4]=b[2],M[5]=b[3],o.ad.multiply(T,T,M),f||o.ad.rotateZ(T,T,-g.angle),T}}return g.glCoordMatrix}function $r(u,r,a,f){let g=[u,r,a,1];a?o.aA.transformMat4(g,g,f):id(g,g,f);let y=g[3];return g[0]/=y,g[1]/=y,g[2]/=y,g}function td(u,r){return Math.min(.5+u/r*.5,1.5)}function Pr(u,r){let a=u[0]/u[3],f=u[1]/u[3];return a>=-r[0]&&a<=r[0]&&f>=-r[1]&&f<=r[1]}function wp(u,r,a,f,g,y,b,T,M,C){let P=a.transform,L=f?u.textSizeData:u.iconSizeData,F=o.aD(L,a.transform.zoom),N=P.projection.name==="globe",j=[256/a.width*2+1,256/a.height*2+1],U=f?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;U.clear();let G=null;N&&(G=f?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);let $=u.lineVertexArray,Q=f?u.text.placedSymbolArray:u.icon.placedSymbolArray,K=a.transform.width/a.transform.height,J,oe=!1;for(let ie=0;ie<Q.length;ie++){let ce=Q.get(ie),{numGlyphs:q,writingMode:ee}=ce;if(ee!==o.aE.vertical||oe||J===o.aE.horizontal||(oe=!0),J=ee,(ce.hidden||ee===o.aE.vertical)&&!oe){Fo(q,U);continue}oe=!1;let he=new o.P(ce.tileAnchorX,ce.tileAnchorY),{x:we,y:pe,z:ae}=P.projection.projectTilePoint(he.x,he.y,C.canonical);if(M){let[nt,Je,Ze]=M(he);we+=nt,pe+=Je,ae+=Ze}let Ee=[we,pe,ae,1];if(o.aA.transformMat4(Ee,Ee,r),!Pr(Ee,j)){Fo(q,U);continue}let Fe=Ee[3],ze=td(a.transform.getCameraToCenterDistance(P.projection),Fe),ke=o.aF(L,F,ce),_e=b?ke/ze:ke*ze,De=$r(we,pe,ae,g);if(De[3]<=0){Fo(q,U);continue}let Re={},Qe=b?null:M,Ke=nd(ce,_e,!1,T,r,g,y,u.glyphOffsetArray,$,U,G,De,he,Re,K,Qe,P.projection,C,b);oe=Ke.useVertical,Qe&&Ke.needsFlipping&&(Re={}),(Ke.notEnoughRoom||oe||Ke.needsFlipping&&nd(ce,_e,!0,T,r,g,y,u.glyphOffsetArray,$,U,G,De,he,Re,K,Qe,P.projection,C,b).notEnoughRoom)&&Fo(q,U)}f?(u.text.dynamicLayoutVertexBuffer.updateData(U),G&&u.text.globeExtVertexBuffer&&u.text.globeExtVertexBuffer.updateData(G)):(u.icon.dynamicLayoutVertexBuffer.updateData(U),G&&u.icon.globeExtVertexBuffer&&u.icon.globeExtVertexBuffer.updateData(G))}function lu(u,r,a,f,g,y,b,T,M,C,P,L,F,N,j,U){let{lineStartIndex:G,glyphStartIndex:$,segment:Q}=T,K=$+T.numGlyphs,J=G+T.lineLength,oe=r.getoffsetX($),ie=r.getoffsetX(K-1),ce=fs(u*oe,a,f,g,y,b,Q,G,J,M,C,P,L,F,!0,N,j,U);if(!ce)return null;let q=fs(u*ie,a,f,g,y,b,Q,G,J,M,C,P,L,F,!0,N,j,U);return q?{first:ce,last:q}:null}function cu(u,r,a,f){return u===o.aE.horizontal&&Math.abs(f)>Math.abs(a)?{useVertical:!0}:u===o.aE.vertical?f>0?{needsFlipping:!0}:null:r!==hs.unknown&&function(g,y){return g===0||Math.abs(y/g)>Z_}(a,f)?r===hs.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function nd(u,r,a,f,g,y,b,T,M,C,P,L,F,N,j,U,G,$,Q){let K=r/24,J=u.lineOffsetX*K,oe=u.lineOffsetY*K,{lineStartIndex:ie,glyphStartIndex:ce,numGlyphs:q,segment:ee,writingMode:he,flipState:we}=u,pe=ie+u.lineLength,ae=Ee=>{if(P){let[_e,De,Re]=Ee.up,Qe=C.length;o.aG(P,Qe+0,_e,De,Re),o.aG(P,Qe+1,_e,De,Re),o.aG(P,Qe+2,_e,De,Re),o.aG(P,Qe+3,_e,De,Re)}let[Fe,ze,ke]=Ee.point;o.aH(C,Fe,ze,ke,Ee.angle)};if(q>1){let Ee=lu(K,T,J,oe,a,L,F,u,M,y,N,U,!1,G,$,Q);if(!Ee)return{notEnoughRoom:!0};if(f&&!a){let[Fe,ze,ke]=Ee.first.point,[_e,De,Re]=Ee.last.point;[Fe,ze]=$r(Fe,ze,ke,b),[_e,De]=$r(_e,De,Re,b);let Qe=cu(he,we,(_e-Fe)*j,De-ze);if(u.flipState=Qe&&Qe.needsFlipping?hs.flipRequired:hs.flipNotRequired,Qe)return Qe}ae(Ee.first);for(let Fe=ce+1;Fe<ce+q-1;Fe++){let ze=fs(K*T.getoffsetX(Fe),J,oe,a,L,F,ee,ie,pe,M,y,N,U,!1,!1,G,$,Q);if(!ze)return C.length-=4*(Fe-ce),{notEnoughRoom:!0};ae(ze)}ae(Ee.last)}else{if(f&&!a){let Fe=$r(F.x,F.y,0,g),ze=ie+ee+1,ke=new o.P(M.getx(ze),M.gety(ze)),_e=$r(ke.x,ke.y,0,g),De=_e[3]>0?_e:uu(F,ke,Fe,1,g,void 0,G,$.canonical),Re=cu(he,we,(De[0]-Fe[0])*j,De[1]-Fe[1]);if(u.flipState=Re&&Re.needsFlipping?hs.flipRequired:hs.flipNotRequired,Re)return Re}let Ee=fs(K*T.getoffsetX(ce),J,oe,a,L,F,ee,ie,pe,M,y,N,U,!1,!1,G,$,Q);if(!Ee)return{notEnoughRoom:!0};ae(Ee)}return{}}function rd(u,r,a,f,g){let{x:y,y:b,z:T}=f.projectTilePoint(u.x,u.y,r);if(!g)return $r(y,b,T,a);let[M,C,P]=g(u);return $r(y+M,b+C,T+P,a)}function uu(u,r,a,f,g,y,b,T){let M=rd(u.sub(r)._unit()._add(u),T,g,b,y);return o._.sub(M,a,M),o._.normalize(M,M),o._.scaleAndAdd(M,a,M,f)}function fs(u,r,a,f,g,y,b,T,M,C,P,L,F,N,j,U,G,$){let Q=f?u-r:u+r,K=Q>0?1:-1,J=0;f&&(K*=-1,J=Math.PI),K<0&&(J+=Math.PI);let oe=T+b+(K>0?0:1)|0,ie=g,ce=g,q=0,ee=0,he=Math.abs(Q),we=[],pe=[],ae=y,Ee=ae,Fe=()=>uu(Ee,ae,ce,he-q+1,P,F,U,G.canonical);for(;q+ee<=he;){if(oe+=K,oe<T||oe>=M)return null;if(ce=ie,Ee=ae,we.push(ce),N&&pe.push(Ee),ae=new o.P(C.getx(oe),C.gety(oe)),ie=L[oe],!ie){let Je=rd(ae,G.canonical,P,U,F);ie=Je[3]>0?L[oe]=Je:Fe()}q+=ee,ee=o._.distance(ce,ie)}j&&F&&(L[oe]&&(ie=Fe(),ee=o._.distance(ce,ie)),L[oe]=ie);let ze=(he-q)/ee,ke=ae.sub(Ee)._mult(ze)._add(Ee),_e=o._.sub([],ie,ce),De=o._.scaleAndAdd([],ce,_e,ze),Re=[0,0,1],Qe=_e[0],Ke=_e[1];if($&&(Re=U.upVector(G.canonical,ke.x,ke.y),Re[0]!==0||Re[1]!==0||Re[2]!==1)){let Je=[Re[2],0,-Re[0]],Ze=o._.cross([],Re,Je);o._.normalize(Je,Je),o._.normalize(Ze,Ze),Qe=o._.dot(_e,Je),Ke=o._.dot(_e,Ze)}if(a){let Je=o._.cross([],Re,_e);o._.normalize(Je,Je),o._.scaleAndAdd(De,De,Je,a*K)}let nt=J+Math.atan2(Ke,Qe);return we.push(De),N&&pe.push(ke),{point:De,angle:nt,path:we,tilePath:pe,up:Re}}function Fo(u,r){let a=r.length,f=a+4*u;r.resize(f),r.float32.fill(-1/0,4*a,4*f)}function id(u,r,a){let f=r[0],g=r[1];return u[0]=a[0]*f+a[4]*g+a[12],u[1]=a[1]*f+a[5]*g+a[13],u[3]=a[3]*f+a[7]*g+a[15],u}let Vi=(u,r,a)=>(1-a)*u+a*r,od=u=>u*u*u*u*u;class Qn{constructor(r,a,f,g,y,b,T){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=r||0,this._maxZoom=a||22,this._minPitch=f??0,this._maxPitch=g??60,this.setProjection(b),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new o.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ed,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Pl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let r=new Qn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,a=!1){let f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(r||f)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return o.ah(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};let a=this.projection?this.getProjection():void 0;this.projection=o.aJ(this.projectionOptions);let f=!k(a,this.getProjection());return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){let r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.aJ({name:"mercator"});let a=r!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){let r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.au(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){let a=-r*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=o.aC.create(),o.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){let a=o.at(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=o.ab(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){let a=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){let r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let f=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let r=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop(),g=0,y=0;for(let b=0;b<a.length;b++){let T=new o.P(a[b][0]*this.width,f+a[b][1]*(this.height-f)),M=r.pointCoordinate(T);if(!M)continue;let C=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);g+=M[3]*C,y+=C}return y===0?NaN:g/y}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let r=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*a,g=this._mercatorZfromZoom(r),y=this._mercatorZfromZoom(this._maxZoom),b=Math.max(g-f,y);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){let a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude())),f;f=r.z<this._camera.position[2]?[a.x,a.y,a.z]:[r.x,r.y,r.z];let g=o._.length(o._.sub([],this._camera.position,f));return o.at(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let a=!1;if(r.orientation&&!o.av.exactEquals(r.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(r.orientation)),r.position){let f=[r.position.x,r.position.y,r.position.z];o._.exactEquals(f,this._camera.position)||(this._setCameraPosition(f),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let r=this._camera.position,a=new bp;return a.position=new o.Y(r[0],r[1],r[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(r){if(!o.av.length(r))return!1;o.av.normalize(r,r);let a=o._.transformQuat([],[0,0,-1],r),f=o._.transformQuat([],[0,-1,0],r);if(f[2]<0)return!1;let g=Ar(a,f);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(r){let a=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;r[2]=o.at(r[2],g/f,g/a),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,a,f){this._unmodified=!1,this._edgeInsets.interpolate(r,a,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){let a=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(r){let a=[new o.aK(0,r)];if(this.renderWorldCopies){let f=this.pointCoordinate(new o.P(0,0)),g=this.pointCoordinate(new o.P(this.width,0)),y=this.pointCoordinate(new o.P(this.width,this.height)),b=this.pointCoordinate(new o.P(0,this.height)),T=Math.floor(Math.min(f.x,g.x,y.x,b.x)),M=Math.floor(Math.max(f.x,g.x,y.x,b.x)),C=1;for(let P=T-C;P<=M+C;P++)P!==0&&a.push(new o.aK(P,r))}return a}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(r,a,f){let g=[];if(a[0]===0&&a[1]===0)return g;for(let b of r){let T=b.canonical,M=b.overscaledZ,C=b.wrap,P=1<<T.z,L=T.x+1<P,F=T.x>0,N=T.y+1<P,j=T.y>0,U=b.wrap-(F?0:1),G=b.wrap+(L?0:1),$=F?T.x-1:P-1,Q=L?T.x+1:0;a[0]<0?(g.push(new o.aL(M,G,T.z,Q,T.y)),a[1]<0&&N&&(g.push(new o.aL(M,C,T.z,T.x,T.y+1)),g.push(new o.aL(M,G,T.z,Q,T.y+1))),a[1]>0&&j&&(g.push(new o.aL(M,C,T.z,T.x,T.y-1)),g.push(new o.aL(M,G,T.z,Q,T.y-1)))):a[0]>0?(g.push(new o.aL(M,U,T.z,$,T.y)),a[1]<0&&N&&(g.push(new o.aL(M,C,T.z,T.x,T.y+1)),g.push(new o.aL(M,U,T.z,$,T.y+1))),a[1]>0&&j&&(g.push(new o.aL(M,C,T.z,T.x,T.y-1)),g.push(new o.aL(M,U,T.z,$,T.y-1)))):a[1]<0&&N?g.push(new o.aL(M,C,T.z,T.x,T.y+1)):j&&g.push(new o.aL(M,C,T.z,T.x,T.y-1))}if(g.length>1){g.sort((M,C)=>M.overscaledZ-C.overscaledZ||M.wrap-C.wrap||M.canonical.z-C.canonical.z||M.canonical.x-C.canonical.x||M.canonical.y-C.canonical.y);let b=0,T=0;for(;T<g.length;)g[T].equals(g[b])?++T:g[++b]=g[T++];g.length=b+1}let y=[];for(let b of g)g.some(T=>b.isChildOf(T))||y.push(b);return g=y.filter(b=>!r.some(T=>!!(b.overscaledZ<f&&T.isChildOf(b))||b.equals(T)||b.isChildOf(T))),g}coveringTiles(r){let a=this.coveringZoomLevel(r),f=a,g=this.elevation&&this.elevation.exaggeration(),y=g&&!r.isTerrainDEM,b=this.projection.name==="mercator";if(r.minzoom!==void 0&&a<r.minzoom)return[];r.maxzoom!==void 0&&a>r.maxzoom&&(a=r.maxzoom);let T=this.locationCoordinate(this.center),M=this.center.lat,C=1<<a,P=[C*T.x,C*T.y,0],L=this.projection.name==="globe",F=!L,N=o.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,F),j=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=C*o.ax(1,this.center.lat),G=this._camera.position[2]/o.ax(1,this.center.lat),$=[C*j.x,C*j.y,G*(F?1:U)],Q=L||g,K=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),J=this.isLODDisabled(!0)?a:0,oe;if(this._elevation&&r.isTerrainDEM)oe=1e4*this._elevation.exaggeration();else if(this._elevation){let _e=this._elevation.getMinMaxForVisibleTiles();oe=_e?_e.max:this._centerAltitude}else oe=this._centerAltitude;let ie=r.isTerrainDEM?-oe:this._elevation?this._elevation.getMinElevationBelowMSL():0,ce=this.projection.isReprojectedInTileSpace?o.aN(this):1,q=_e=>{let Re=new o.Y(_e.x+25e-6,_e.y,_e.z),Qe=new o.Y(_e.x,_e.y+25e-6,_e.z),Ke=_e.toLngLat(),nt=Re.toLngLat(),Je=Qe.toLngLat(),Ze=this.locationCoordinate(Ke),Ae=this.locationCoordinate(nt),at=this.locationCoordinate(Je),Lt=Math.hypot(Ae.x-Ze.x,Ae.y-Ze.y),gt=Math.hypot(at.x-Ze.x,at.y-Ze.y);return Math.sqrt(Lt*gt)*ce/25e-6},ee=_e=>{let De=oe,Re=ie;return{aabb:o.aQ(this,C,0,0,0,_e,Re,De,this.projection),zoom:0,x:0,y:0,minZ:Re,maxZ:De,wrap:_e,fullyVisible:!1}},he=[],we=[],pe=a,ae=r.reparseOverscaled?f:a,Ee=(G-this._centerAltitude)*U,Fe=_e=>{if(!this._elevation||!_e.tileID||!b)return;let De=this._elevation.getMinMaxForTile(_e.tileID),Re=_e.aabb;De?(Re.min[2]=De.min,Re.max[2]=De.max,Re.center[2]=(Re.min[2]+Re.max[2])/2):(_e.shouldSplit=ke(_e),_e.shouldSplit||(Re.min[2]=Re.max[2]=Re.center[2]=this._centerAltitude))},ze=(_e,De)=>{if(.707*De<_e)return 1;let Re=De/_e;return Re/(1.4144271570014144+(Math.pow(1.1,Re-1.4144271570014144+1)-1)/(1.1-1)-1)},ke=_e=>{if(_e.zoom<J)return!0;if(_e.zoom===pe)return!1;if(_e.shouldSplit!=null)return _e.shouldSplit;let De=_e.aabb.distanceX($),Re=_e.aabb.distanceY($),Qe=Ee,Ke=1;if(L){Qe=_e.aabb.distanceZ($);let gt=Math.pow(2,_e.zoom),It=o.ay((_e.y+1)/gt),Gt=o.ay(_e.y/gt),Ln=Math.min(Math.max(M,It),Gt),Bt=o.b4(Ln)/o.b4(M);if(Ke=Ln===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Bt/this._mercatorScaleRatio),this.zoom<=o.b1&&_e.zoom===pe-1&&Bt>=.9)return!0}else if(y&&(Qe=_e.aabb.distanceZ($)*U),this.projection.isReprojectedInTileSpace&&f<=5){let gt=Math.pow(2,_e.zoom),It=q(new o.Y((_e.x+.5)/gt,(_e.y+.5)/gt));Ke=It>.85?1:It}if(!b){let gt=Math.sqrt(De*De+Re*Re+Qe*Qe),It=(1<<pe-_e.zoom)*K*Ke;return It*=ze(Math.max(Qe,Ee),gt),gt<It}let nt=Number.MAX_VALUE,Je=0,Ze=_e.aabb.getCorners(),Ae=[];for(let gt of Ze){o._.sub(Ae,gt,$),L||(y?Ae[2]*=U:Ae[2]=Ee);let It=o._.dot(Ae,this._camera.forward());It<nt&&(nt=It,Je=Math.abs(Ae[2]))}let at=(1<<pe-_e.zoom)*K*Ke;if(at*=ze(Math.max(Je,Ee),nt),nt<at)return!0;let Lt=_e.aabb.closestPoint(P);return Lt[0]===P[0]&&Lt[1]===P[1]};if(this.renderWorldCopies)for(let _e=1;_e<=3;_e++)he.push(ee(-_e)),he.push(ee(_e));for(he.push(ee(0));he.length>0;){let _e=he.pop(),De=_e.x,Re=_e.y,Qe=_e.fullyVisible,Ke=()=>this.projection.name==="globe"&&(_e.y===0||_e.y===(1<<_e.zoom)-1);if(!Qe){let nt=Q?_e.aabb.intersects(N):_e.aabb.intersectsFlat(N);if(nt===0&&Ke()){let Je=new o.aO(_e.zoom,De,Re);nt=o.aP(this,C,Je,!0).intersects(N)}if(nt===0)continue;Qe=nt===2}if(_e.zoom!==pe&&ke(_e))for(let nt=0;nt<4;nt++){let Je=(De<<1)+nt%2,Ze=(Re<<1)+(nt>>1),Ae={aabb:b?_e.aabb.quadrant(nt):o.aQ(this,C,_e.zoom+1,Je,Ze,_e.wrap,_e.minZ,_e.maxZ,this.projection),zoom:_e.zoom+1,x:Je,y:Ze,wrap:_e.wrap,fullyVisible:Qe,tileID:void 0,shouldSplit:void 0,minZ:_e.minZ,maxZ:_e.maxZ};y&&!L&&(Ae.tileID=new o.aL(_e.zoom+1===pe?ae:_e.zoom+1,_e.wrap,_e.zoom+1,Je,Ze),Fe(Ae)),he.push(Ae)}else{let nt=_e.zoom===pe?ae:_e.zoom;if(r.minzoom&&r.minzoom>nt)continue;if(!Qe){let at=Q?_e.aabb.intersectsPrecise(N):_e.aabb.intersectsPreciseFlat(N);if(at===0&&Ke()){let Lt=new o.aO(_e.zoom,De,Re);at=o.aP(this,C,Lt,!0).intersectsPrecise(N)}if(at===0)continue}let Je=P[0]-(.5+De+(_e.wrap<<_e.zoom))*(1<<a-_e.zoom),Ze=P[1]-.5-Re,Ae=_e.tileID?_e.tileID:new o.aL(nt,_e.wrap,_e.zoom,De,Re);we.push({tileID:Ae,distanceSq:Je*Je+Ze*Ze})}}if(this.fogCullDistSq){let _e=this.fogCullDistSq,De=this.horizonLineFromTop();we=we.filter(Re=>{let Qe=[0,0,0,1],Ke=[o.a3,o.a3,0,1],nt=this.calculateFogTileMatrix(Re.tileID.toUnwrapped());o.aA.transformMat4(Qe,Qe,nt),o.aA.transformMat4(Ke,Ke,nt);let Je=o.aA.min([],Qe,Ke),Ze=o.aA.max([],Qe,Ke),Ae=o.aR(Je,Ze);if(Ae===0)return!0;let at=!1,Lt=this._elevation;if(Lt&&Ae>_e&&De!==0){let gt=this.calculateProjMatrix(Re.tileID.toUnwrapped()),It;r.isTerrainDEM||(It=Lt.getMinMaxForTile(Re.tileID)),It||(It={min:ie,max:oe});let Gt=o.b2(this.rotation),Ln=[Gt[0]*o.a3,Gt[1]*o.a3,It.max];o._.transformMat4(Ln,Ln,gt),at=(1-Ln[1])*this.height*.5<De}return Ae<_e||at})}return we.sort((_e,De)=>_e.distanceSq-De.distanceSq).map(_e=>_e.tileID)}resize(r,a){this.width=r,this.height=a,this.pixelsToGLUnits=[2/r,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){let a=o.at(r.lat,-o.aS,o.aS),f=this.projection.project(r.lng,a);return new o.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,a){let f,g,y=this.centerPoint;if(this.projection.name==="globe"){let T=this.worldSize;f=(a.x-y.x)/T,g=(a.y-y.y)/T}else{let T=this.pointCoordinate(a),M=this.pointCoordinate(y);f=T.x-M.x,g=T.y-M.y}let b=this.locationCoordinate(r);this.setLocation(new o.Y(b.x-f,b.y-g))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,a){let f=a?o.ax(a,r.lat):void 0,g=this.projection.project(r.lng,r.lat);return new o.Y(g.x,g.y,f)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,a){let f=a??this._centerAltitude,g=[r.x,r.y,0,1],y=[r.x,r.y,1,1];o.aA.transformMat4(g,g,this.pixelMatrixInverse),o.aA.transformMat4(y,y,this.pixelMatrixInverse);let b=y[3];o.aA.scale(g,g,1/g[3]),o.aA.scale(y,y,1/b);let T=g[2],M=y[2];return{p0:g,p1:y,t:T===M?0:(f-T)/(M-T)}}screenPointToMercatorRay(r){let a=[r.x,r.y,0,1],f=[r.x,r.y,1,1];return o.aA.transformMat4(a,a,this.pixelMatrixInverse),o.aA.transformMat4(f,f,this.pixelMatrixInverse),o.aA.scale(a,a,1/a[3]),o.aA.scale(f,f,1/f[3]),a[2]=o.ax(a[2],this._center.lat)*this.worldSize,f[2]=o.ax(f[2],this._center.lat)*this.worldSize,o.aA.scale(a,a,1/this.worldSize),o.aA.scale(f,f,1/this.worldSize),new o.aT([a[0],a[1],a[2]],o._.normalize([],o._.sub([],f,a)))}rayIntersectionCoordinate(r){let{p0:a,p1:f,t:g}=r,y=o.ax(a[2],this._center.lat),b=o.ax(f[2],this._center.lat);return new o.Y(o.a2(a[0],f[0],g)/this.worldSize,o.a2(a[1],f[1],g)/this.worldSize,o.a2(y,b,g))}pointCoordinate(r,a=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,a)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let a=this.projection.pointCoordinate3D(this,r.x,r.y);if(a)return new o.Y(a[0],a[1],a[2]);let f=0,g=this.horizonLineFromTop();if(r.y>g)return this.pointCoordinate(r);let y=.02*g,b=r.clone();for(let T=0;T<10&&g-f>y;T++){b.y=o.a2(f,g,.66);let M=this.projection.pointCoordinate3D(this,b.x,b.y);M?(g=b.y,a=M):f=b.y}return a?new o.Y(a[0],a[1],a[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=o.aU)return!this.isPointAboveHorizon(r);let a=this.pointCoordinate(r);return a.y>=0&&a.y<=1}_coordinatePoint(r,a){let f=a&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,g=[r.x*this.worldSize,r.y*this.worldSize,f+r.toAltitude(),1];return o.aA.transformMat4(g,g,this.pixelMatrix),g[3]>0?new o.P(g[0]/g[3],g[1]/g[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:r,left:a}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,y=this.pointLocation3D(new o.P(a,r)),b=this.pointLocation3D(new o.P(g,r)),T=this.pointLocation3D(new o.P(g,f)),M=this.pointLocation3D(new o.P(a,f)),C=Math.min(y.lng,b.lng,T.lng,M.lng),P=Math.max(y.lng,b.lng,T.lng,M.lng),L=Math.min(y.lat,b.lat,T.lat,M.lat),F=Math.max(y.lat,b.lat,T.lat,M.lat),N=Math.pow(2,-this.zoom)/16*270,j=this.projection.name==="globe"?1:4,U=(G,$,Q,K,J)=>{let oe=(G+Q)/2,ie=($+K)/2,ce=new o.P(oe,ie),{lng:q,lat:ee}=this.pointLocation3D(ce),he=Math.max(0,C-q,L-ee,q-P,ee-F);C=Math.min(C,q),P=Math.max(P,q),L=Math.min(L,ee),F=Math.max(F,ee),(J<j||he>N)&&(U(G,$,oe,ie,J+1),U(oe,ie,Q,K,J+1))};if(U(a,r,g,r,1),U(g,r,g,f,1),U(g,f,a,f,1),U(a,f,a,r,1),this.projection.name==="globe"){let[G,$]=o.aV(this);G?(F=90,P=180,C=-180):$&&(L=-90,P=180,C=-180)}return new o.ai(new o.aI(C,L),new o.aI(P,F))}_getBoundsRectangular(r,a){let{top:f,left:g}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,T=new o.P(g,f),M=new o.P(b,f),C=new o.P(b,y),P=new o.P(g,y),L=this.pointCoordinate(T,r),F=this.pointCoordinate(M,r),N=this.pointCoordinate(C,a),j=this.pointCoordinate(P,a),U=(G,$)=>($.y-G.y)/($.x-G.x);return L.y>1&&F.y>=0?L=new o.Y((1-j.y)/U(j,L)+j.x,1):L.y<0&&F.y<=1&&(L=new o.Y(-j.y/U(j,L)+j.x,0)),F.y>1&&L.y>=0?F=new o.Y((1-N.y)/U(N,F)+N.x,1):F.y<0&&L.y<=1&&(F=new o.Y(-N.y/U(N,F)+N.x,0)),new o.ai().extend(this.coordinateLocation(L)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(N))}_getBoundsRectangularTerrain(){let r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);let a=r.visibleDemTiles.reduce((f,g)=>{if(g.dem){let y=g.dem.tree;f.min=Math.min(f.min,y.minimums[0]),f.max=Math.max(f.max,y.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*r.exaggeration(),a.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){let a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-a*(1-this._horizonShift);return r?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.aS,this.maxLat=o.aS,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aj(this.minLng)*this.tileSize,this.worldMaxX=o.aj(this.maxLng)*this.tileSize,this.worldMinY=o.ak(this.maxLat)*this.tileSize,this.worldMaxY=o.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,a){return this.projection.createTileMatrix(this,a,r)}calculateDistanceTileData(r){let a=r.key,f=this._distanceTileDataCache;if(f[a])return f[a];let g=r.canonical,y=1/this.height,b=this.cameraWorldSize,T=b/this.zoomScale(g.z),M=(g.x+Math.pow(2,g.z)*r.wrap)*T,C=g.y*T,P=this.point;P.x*=b/this.worldSize,P.y*=b/this.worldSize;let L=this.angle,F=Math.sin(-L),N=-Math.cos(-L);return f[a]={bearing:[F,N],center:[(P.x-M)*y,(P.y-C)*y],scale:T/o.a3*y},f[a]}calculateFogTileMatrix(r){let a=r.key,f=this._fogTileMatrixCache;if(f[a])return f[a];let g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return o.ad.multiply(g,this.worldToFogMatrix,g),f[a]=new Float32Array(g),f[a]}calculateProjMatrix(r,a=!1,f=!1){let g=r.key,y;if(y=f?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,y[g])return y[g];let b=this.calculatePosMatrix(r,this.worldSize),T;return T=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,o.ad.multiply(b,T,b),y[g]=new Float32Array(b),y[g]}calculatePixelsToTileUnitsMatrix(r){let a=r.tileID.key,f=this._pixelsToTileUnitsCache;if(f[a])return f[a];let g=o.aW(r,this);return f[a]=g,f[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let r=1/this.worldSize,a=o.ad.fromScaling([],[r,r,r]);return o.ad.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let r=this._elevation;this._updateCameraState();let a=o.ax(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(a),g=this._camera.forward(),y=o.ax(1,this._center.lat);f[2]/=y,g[2]/=y,o._.normalize(g,g);let b=r.raycast(f,g,r.exaggeration());if(b){let T=o._.scaleAndAdd([],f,g,b),M=new o.Y(T[0],T[1],o.ax(T[2],o.ay(T[1]))),C=(M.z+o._.length([M.x-f[0],M.y-f[1],M.z-f[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(C),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;let a=this._elevation,f=o.ax(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(f),y=a.getAtPointOrZero(new o.Y(...g)),b=this.pixelsPerMeter/this.worldSize*y,T=this._minimumHeightOverTerrain(),M=g[2]-b;if(M<=T)if(M<0||r){let C=this.locationCoordinate(this._center,this._centerAltitude),P=[g[0],g[1],C.z-g[2]],L=o._.length(P);P[2]-=(T-M)/this._pixelsPerMercatorPixel;let F=o._.length(P);if(F===0)return;o._.scale(P,P,L/F*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],C.z*this._pixelsPerMercatorPixel-P[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){let F=this.center;return F.lat=o.at(F.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(F.lng=o.at(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}let a=this._unmodified,{x:f,y:g}=this.point,y=0,b=f,T=g,M=this.width/2,C=this.height/2,P=this.worldMinY*this.scale,L=this.worldMaxY*this.scale;if(g-C<P&&(T=P+C),g+C>L&&(T=L-C),L-P<this.height&&(y=Math.max(y,this.height/(L-P)),T=(L+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let F=this.worldMinX*this.scale,N=this.worldMaxX*this.scale,j=this.worldSize/2-(F+N)/2;b=(f+j+this.worldSize)%this.worldSize-j,b-M<F&&(b=F+M),b+M>N&&(b=N-M),N-F<this.width&&(y=Math.max(y,this.width/(N-F)),b=(N+F)/2)}b===f&&T===g||(this.center=this.unproject(new o.P(b,T))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let r=this.centerOffset,a=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.ax(1,this.center.lat)/o.ax(1,o.b3));let g=o.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let y=this.projection.zAxisUnit==="meters"?f:1,b=this._camera.getWorldToCamera(this.worldSize,y),T,M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(M[8]=2*-r.x/this.width,M[9]=2*r.y/this.height,this.isOrthographic){let ee=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),he=ee*this.aspect,we=-he,pe=-ee;he-=r.x,we-=r.x,ee+=r.y,pe+=r.y,T=this._camera.getCameraToClipOrthographic(we,he,pe,ee,this._nearZ,this._farZ),((ae,Ee,Fe,ze)=>{for(let ke=0;ke<16;ke++)ae[ke]=Vi(Ee[ke],Fe[ke],ze)})(T,T,M,od(this.pitch>=15?1:this.pitch/15))}else T=M;let C=o.ad.mul([],M,b),P=o.ad.mul([],T,b);if(this.projection.isReprojectedInTileSpace){let ee=this.locationCoordinate(this.center),he=o.ad.identity([]);o.ad.translate(he,he,[ee.x*this.worldSize,ee.y*this.worldSize,0]),o.ad.multiply(he,he,o.aY(this)),o.ad.translate(he,he,[-ee.x*this.worldSize,-ee.y*this.worldSize,0]),o.ad.multiply(P,P,he),o.ad.multiply(C,C,he),this.inverseAdjustmentMatrix=o.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.ad.scale([],P,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=P,this.invProjMatrix=o.ad.invert(new Float64Array(16),this.projMatrix),a){let ee=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ee[8]=2*-r.x/this.width,ee[9]=2*r.y/this.height,this.expandedFarZProjMatrix=o.ad.mul([],ee,b)}else this.expandedFarZProjMatrix=this.projMatrix;let L=o.ad.invert([],T);this.frustumCorners=o.a_.fromInvProjectionMatrix(L,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);let F=new Float32Array(16);o.ad.identity(F),o.ad.scale(F,F,[1,-1,1]),o.ad.rotateX(F,F,this._pitch),o.ad.rotateZ(F,F,this.angle);let N=o.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.ad.clone(N);let j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;N[8]=2*-r.x/this.width,N[9]=2*(r.y+j)/this.height,this.skyboxMatrix=o.ad.multiply(F,N,F);let U=this.point,G=U.x,$=U.y,Q=this.width%2/2,K=this.height%2/2,J=Math.cos(this.angle),oe=Math.sin(this.angle),ie=G-Math.round(G)+J*Q+oe*K,ce=$-Math.round($)+J*K+oe*Q,q=new Float64Array(P);if(o.ad.translate(q,q,[ie>.5?ie-1:ie,ce>.5?ce-1:ce,0]),this.alignedProjMatrix=q,P=o.ad.create(),o.ad.scale(P,P,[this.width/2,-this.height/2,1]),o.ad.translate(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=o.ad.create(),o.ad.scale(P,P,[1,-1,1]),o.ad.translate(P,P,[-1,-1,0]),o.ad.scale(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=o.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,C),this._calcFogMatrices(),this._distanceTileDataCache={},P=o.ad.invert(new Float64Array(16),this.pixelMatrix),!P)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=P,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.a$(this);let ee=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o._.transformMat4(ee,ee,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=P;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let r=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,f=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,y=[r,r,a];o._.scale(y,y,g),o._.scale(f,f,-1),o._.multiply(f,f,y);let b=o.ad.create();o.ad.translate(b,b,f),o.ad.scale(b,b,y),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,a,g)}_computeCameraPosition(r){let a=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),g=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-r/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-f[0]*y,g.y/this.worldSize-f[1]*y,r/this.worldSize*this._centerAltitude-f[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){let a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],g=r[2],y=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(y=Math.min((a-f)/g,1)),this._camera.position=o._.scaleAndAdd([],this._camera.position,r,y),this._updateStateFromCamera()}_updateStateFromCamera(){let r=this._camera.position,a=this._camera.forward(),{pitch:f,bearing:g}=this._camera.getPitchBearing(),y=o.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.ab(this._maxPitch)),T=Math.max((r[2]-y)/Math.cos(f),b),M=this._zoomFromMercatorZ(T);o._.scaleAndAdd(r,r,a,T),this._pitch=o.at(f,o.ab(this.minPitch),o.ab(this.maxPitch)),this.angle=o.au(g,-Math.PI,Math.PI),this._setZoom(o.at(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.Y(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){let r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let a=0,f=o.aU,g=0,y=1/0;for(;f-a>1e-6&&f>a;){let b=a+.5*(f-a),T=this.tileSize*Math.pow(2,b),M=this.getCameraToCenterDistance(this.projection,b,T),C=this.scaleZoom(M/(r*this.tileSize)),P=Math.abs(b-C);P<y&&(y=P,g=b),b<C?a=b:f=b}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,a){let f=Math.min(r.x,a.x),g=Math.max(r.x,a.x),y=Math.min(r.y,a.y),b=Math.max(r.y,a.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let T=[new o.P(f,y),new o.P(g,b),new o.P(f,b),new o.P(g,y)],M=this.renderWorldCopies?-3:0,C=this.renderWorldCopies?4:1;for(let P of T){let L=this.pointRayIntersection(P);if(L.t<0)return!0;let F=this.rayIntersectionCoordinate(L);if(F.x<M||F.y<0||F.x>C||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(r,a){let f=o._.length(o._.sub([],this._camera.position,r)),g=this._zoomFromMercatorZ(f)+a;return f-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){let r=function([a,f,g],y){let b=[a,f,g,1];o.aA.transformMat4(b,b,y);let T=b[3]=Math.max(b[3],1e-6);return b[0]/=T,b[1]/=T,b[2]/=T,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(r[0],r[1])}{let r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,r))}}getCameraToCenterDistance(r,a=this.zoom,f=this.worldSize){let g=o.aX(r,a,this.width,this.height,1024),y=r.pixelSpaceConversion(this.center.lat,f,g),b=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(b=Vi(1,b,od(this.pitch>=15?1:this.pitch/15))),b}getWorldToCameraMatrix(){let r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.ad.multiply(r,r,this.globeMatrix),r}getFrustum(r){return o.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}let rr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},ps=(u,r)=>{if(r>0&&u.terrain&&o.w("Cutoff is currently disabled on terrain"),r<=0||u.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let a=u.transform,f=Math.max(Math.abs(a._zoom-(u.minCutoffZoom-1)),1),g=a.isLODDisabled(!1)?o.$(60,45,a.pitch):o.$(30,15,a.pitch),y=a._farZ-a._nearZ,b=r*a.height,T=((1-(M=g))*a.cameraToCenterDistance+M*(a._farZ+b))*f;var M;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(T-a._nearZ)/y,(T-b-a._nearZ)/y]}}},Rr={cascadeCount:2,shadowMapResolution:2048};class Ll{constructor(r,a){this.aabb=r,this.lastCascade=a}}class sd{add(r,a){let f=this.receivers[r.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],a.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],a.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],a.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],a.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],a.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],a.max[2])):this.receivers[r.key]=new Ll(a,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,a,f){let g=o.b6.fromPoints(r.points),y=0;for(let b in this.receivers){let T=this.receivers[b];if(!T||!g.intersectsAabb(T.aabb))continue;T.aabb.min=g.closestPoint(T.aabb.min),T.aabb.max=g.closestPoint(T.aabb.max);let M=T.aabb.getCorners();for(let C=0;C<f.length;C++){let P=!0;for(let L of M){let F=[L[0]*a,L[1]*a,L[2]];if(o._.transformMat4(F,F,f[C].matrix),F[0]<-1||F[0]>1||F[1]<-1||F[1]>1){P=!1;break}}if(T.lastCascade=C,y=Math.max(y,C),P)break}}return y+1}}class ad{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new sd,this._depthMode=new o.ae(r.context.gl.LEQUAL,o.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,r.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),r.tp.registerParameter(Rr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(Rr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),r.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,a){let f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;let g=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||g<=0||(this._shadowLayerCount=f.style.order.reduce((j,U)=>{let G=f.style._mergedLayers[U];return j+(G.hasShadowPass()&&!G.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let y=f.context,b=Rr.shadowMapResolution,T=Rr.shadowMapResolution;if(this._cascades.length===0||Rr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let j=0;j<Rr.cascadeCount;++j){let U=f._shadowMapDebug,G=y.gl,$=y.createFramebuffer(b,T,U,"texture"),Q=new o.T(y,{width:b,height:T,data:null},G.DEPTH_COMPONENT);if($.depthAttachment.set(Q.texture),U){let K=new o.T(y,{width:b,height:T,data:null},G.RGBA);$.colorAttachment.set(K.texture)}this._cascades.push({framebuffer:$,texture:Q,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.aM,scale:0})}}this.shadowDirection=hu(a);let M=0;if(r.elevation){let j=r.elevation,U=[1e4,-1e4];j.visibleDemTiles.filter(G=>G.dem).forEach(G=>{let $=G.dem.tree;U[0]=Math.min(U[0],$.minimums[0]),U[1]=Math.max(U[1],$.maximums[0])}),U[0]!==1e4&&(M=(U[1]-U[0])*j.exaggeration())}let C=1.5*r.cameraToCenterDistance,P=3*C,L=new Float64Array(16);for(let j=0;j<this._cascades.length;++j){let U=this._cascades[j],G=r.height/50,$=1;Rr.cascadeCount===1?$=P:j===0?$=C:(G=C,$=P);let[Q,K]=gs(r,this.shadowDirection,G,$,Rr.shadowMapResolution,M);U.scale=r.scale,U.matrix=Q,U.boundingSphereRadius=K,o.ad.invert(L,U.matrix),U.frustum=o.aM.fromInvProjectionMatrix(L,1,0,!0),U.far=$}let F=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[F].far,this._cascades[F].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Rr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Rr.shadowMapResolution,this._uniformValues.u_shadowmap_0=rr.ShadowMap0,this._uniformValues.u_shadowmap_1=rr.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let N=f.transform.elevation;for(let j of this._groundShadowTiles){let U={min:0,max:0};if(N){let G=N.getMinMaxForTile(j);G&&(U=G)}this.addShadowReceiver(j.toUnwrapped(),U.min,U.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,a){if(!this.enabled)return;let f=this.painter,g=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),g.viewport.set([0,0,Rr.shadowMapResolution,Rr.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){f.currentShadowCascade=y,g.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),g.clear({color:o.C.white,depth:1});for(let b of r.order){let T=r._mergedLayers[b];if(!T.hasShadowPass()||T.isHidden(f.transform.zoom))continue;let M=r.getLayerSourceCache(T),C=M?a[M.id]:void 0;(T.type==="model"||C&&C.length)&&f.renderLayer(f,M,T,C)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let r=this.painter,a=r.style,f=r.context,g=a.directionalLight,y=a.ambientLight;if(!g||!y)return;let b=[],T=ps(r,r.longestCutoffRange);T.shouldRenderCutoff&&b.push("RENDER_CUTOFF");let M=fa(a,g,y),C=new o.ae(f.gl.LEQUAL,o.ae.ReadOnly,r.depthRangeFor3D);for(let P of this._groundShadowTiles){let L=P.toUnwrapped(),F=r.isTileAffectedByFog(P),N=r.getOrCreateProgram("groundShadow",{defines:b,overrideFog:F});this.setupShadows(L,N),r.uploadCommonUniforms(f,N,L,null,T);let j={u_matrix:r.transform.calculateProjMatrix(L),u_ground_shadow_factor:M};N.draw(r,f.gl.TRIANGLES,C,o.ag.disabled,o.a.multiply,o.af.disabled,j,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,{},r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?o.a.unblended:o.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){let a=this.painter.transform,f=a.calculatePosMatrix(r,a.worldSize);return o.ad.multiply(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(r){return o.ad.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,a,f,g=0){if(!this.enabled)return;let y=this.painter.transform,b=this.painter.context,T=b.gl,M=this._uniformValues,C=new Float64Array(16),P=y.calculatePosMatrix(r,y.worldSize);for(let L=0;L<this._cascades.length;L++)o.ad.multiply(C,this._cascades[L].matrix,P),M[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),b.activeTexture.set(T.TEXTURE0+rr.ShadowMap0+L),this._cascades[L].texture.bind(T.NEAREST,T.CLAMP_TO_EDGE);if(this.useNormalOffset=!!f,this.useNormalOffset){let L=o.b5(r.canonical),F=2/y.tileSize*o.a3/Rr.shadowMapResolution,N=F*this._cascades[0].boundingSphereRadius,j=F*this._cascades[this._cascades.length-1].boundingSphereRadius,U=(f==="vector-tile"?1:3)/Math.pow(2,g-r.canonical.z-(1-y.zoom+Math.floor(y.zoom)));M.u_shadow_normal_offset=[L,N*U,j*U],M.u_shadow_bias=[6e-5,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(b,M)}setupShadowsFromMatrix(r,a,f=!1){if(!this.enabled)return;let g=this.painter.context,y=g.gl,b=this._uniformValues,T=new Float64Array(16);for(let M=0;M<Rr.cascadeCount;M++)o.ad.multiply(T,this._cascades[M].matrix,r),b[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(T),g.activeTexture.set(y.TEXTURE0+rr.ShadowMap0+M),this._cascades[M].texture.bind(y.NEAREST,y.CLAMP_TO_EDGE);this.useNormalOffset=f,f?(b.u_shadow_normal_offset=[1,5,5],b.u_shadow_bias=[6e-5,.0012,.012]):b.u_shadow_bias=[36e-5,.0012,.012],a.setShadowUniformValues(g,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,a,f,g){if(g[2]>=0)return{};let y=function(M,C,P){let L=P/(1<<M.canonical.z);return new o.b6([M.canonical.x*L+M.wrap*P,M.canonical.y*L+M.wrap*P,0],[(M.canonical.x+1)*L+M.wrap*P,(M.canonical.y+1)*L+M.wrap*P,C])}(r,a,f).getCorners(),b=a/-g[2];g[0]<0?(o._.add(y[0],y[0],[g[0]*b,0,0]),o._.add(y[3],y[3],[g[0]*b,0,0])):g[0]>0&&(o._.add(y[1],y[1],[g[0]*b,0,0]),o._.add(y[2],y[2],[g[0]*b,0,0])),g[1]<0?(o._.add(y[0],y[0],[0,g[1]*b,0]),o._.add(y[1],y[1],[0,g[1]*b,0])):g[1]>0&&(o._.add(y[2],y[2],[0,g[1]*b,0]),o._.add(y[3],y[3],[0,g[1]*b,0]));let T={};return T.vertices=y,T.planes=[ms(y[1],y[0],y[4]),ms(y[2],y[1],y[5]),ms(y[3],y[2],y[6]),ms(y[0],y[3],y[7])],T}addShadowReceiver(r,a,f){this._receivers.add(r,o.b6.fromTileIdAndHeight(r,a,f))}getMaxCascadeForTile(r){let a=this._receivers.get(r);return a&&a.lastCascade?a.lastCascade:0}}function ms(u,r,a){let f=o._.sub([],a,r),g=o._.sub([],u,r),y=o._.cross([],f,g),b=o._.length(y);return b===0?[0,0,1,0]:(o._.scale(y,y,1/b),[y[0],y[1],y[2],-o._.dot(y,r)])}function hu(u){let r=u.properties.get("direction"),a=o.ac(r.x,r.y,r.z);a[2]=o.at(a[2],0,75);let f=o.b7([a[0],a[1],a[2]]);return o._.fromValues(f.x,f.y,f.z)}function fa(u,r,a){let f=r.properties.get("color"),g=r.properties.get("intensity"),y=r.properties.get("direction"),b=[y.x,y.y,y.z],T=a.properties.get("color"),M=a.properties.get("intensity"),C=Math.max(o._.dot([0,0,1],b),0),P=[0,0,0];o._.scale(P,T.toRenderColor(u.getLut(r.scope)).toArray01Linear().slice(0,3),M);let L=[0,0,0];return o._.scale(L,f.toRenderColor(u.getLut(a.scope)).toArray01Linear().slice(0,3),C*g),o.b8([P[0]>0?P[0]/(P[0]+L[0]):0,P[1]>0?P[1]/(P[1]+L[1]):0,P[2]>0?P[2]/(P[2]+L[2]):0])}function gs(u,r,a,f,g,y){let b=u.zoom,T=u.scale,M=u.worldSize,C=1/M,P=u.aspect,L=Math.sqrt(1+P*P)*Math.tan(.5*u.fovX),F=L*L,N=f-a,j=f+a,U,G;F>N/j?(U=f,G=f*L):(U=.5*j*(1+F),G=.5*Math.sqrt(N*N+2*(f*f+a*a)*F+j*j*F*F));let $=u.projection.pixelsPerMeter(u.center.lat,M),Q=u._camera.getCameraToWorldMercator(),K=[0,0,-U*C];o._.transformMat4(K,K,Q);let J=G*C,oe=u._edgeInsets;if(!(oe.left===0&&oe.top===0&&oe.right===0&&oe.bottom===0||oe.left===oe.right&&oe.top===oe.bottom)){let Qe=u._camera.getWorldToCamera(u.worldSize,u.projection.zAxisUnit==="meters"?$:1),Ke=u._camera.getCameraToClipPerspective(u._fov,u.width/u.height,a,f);Ke[8]=2*-u.centerOffset.x/u.width,Ke[9]=2*u.centerOffset.y/u.height;let nt=new Float64Array(16);o.ad.mul(nt,Ke,Qe);let Je=new Float64Array(16);o.ad.invert(Je,nt);let Ze=o.aM.fromInvProjectionMatrix(Je,M,b,!0);for(let Ae of Ze.points){let at=((ie=Ae)[0]/=T,ie[1]/=T,ie[2]=o.ax(ie[2],u._center.lat),ie);J=Math.max(J,o._.len(o._.subtract([],K,at)))}}var ie;J*=g/(g-1);let ce=Math.acos(r[2]),q=Math.atan2(-r[0],-r[1]),ee=new Pl;ee.position=K,ee.setPitchBearing(ce,q);let he=ee.getWorldToCamera(M,$),we=J*M,pe=Math.min(u._mercatorZfromZoom(17)*M*-2,-2*we),ae=ee.getCameraToClipOrthographic(-we,we,-we,we,pe,(we+y*$)/r[2]),Ee=new Float64Array(16);o.ad.multiply(Ee,ae,he);let Fe=o._.fromValues(Math.floor(1e6*K[0])/1e6*M,Math.floor(1e6*K[1])/1e6*M,0),ze=.5*g,ke=[0,0,0];o._.transformMat4(ke,Fe,Ee),o._.scale(ke,ke,ze);let _e=[Math.floor(ke[0]),Math.floor(ke[1]),Math.floor(ke[2])],De=[0,0,0];o._.sub(De,ke,_e),o._.scale(De,De,-1/ze);let Re=new Float64Array(16);return o.ad.identity(Re),o.ad.translate(Re,Re,De),o.ad.multiply(Ee,Re,Ee),[Ee,we]}function pa(u,r){return u!=null&&r!=null&&!(!u.hasData()||!r.hasData())&&u.demTexture!=null&&r.demTexture!=null&&u.tileID.key!==r.tileID.key}let No=new class{constructor(){this.operations={}}newMorphing(u,r,a,f,g){if(u in this.operations){let y=this.operations[u];y.to.tileID.key!==a.tileID.key&&(y.queued=a)}else this.operations[u]={startTime:f,phase:0,duration:g,from:r,to:a,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;let r=this.operations[u];return{from:r.from,to:r.to,phase:r.phase}}update(u){for(let r in this.operations){let a=this.operations[r];for(a.phase=(u-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,u)){delete this.operations[r];break}}}_nextOp(u,r){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=r,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},ld={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ol(u,r,a){if(r===0)return 0;let f=r<1&&a===514?.25/r:1;return 6*Math.pow(1.5,22-u)*Math.max(r,1)*f}function Tp(u,r){let a=1<<u.z;return!r&&(u.x===0||u.x===a-1)||u.y===0||u.y===a-1}let du=u=>({u_matrix:u});function fu(u,r,a,f,g){if(g>0){let y=o.e.now(),b=(y-u.timeAdded)/g,T=r?(y-r.timeAdded)/g:-1,M=a.getSource(),C=f.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),P=!r||Math.abs(r.tileID.overscaledZ-C)>Math.abs(u.tileID.overscaledZ-C),L=P&&u.refreshedUponExpiration?1:o.at(P?b:1-T,0,1);return u.refreshedUponExpiration&&b>=1&&(u.refreshedUponExpiration=!1),r?{opacity:1,mix:1-L}:{opacity:L,mix:0}}return{opacity:1,mix:0}}class ma extends Al{constructor(r,a,f,g){super(r,a,f,g),this.type="raster-array",this.maxzoom=22,this._options=o.W({type:"raster-array"},a)}triggerRepaint(r){let a=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);a&&a.enabled&&f&&a._clearRenderCacheForTile(f.id,r.tileID),this.map.triggerRepaint()}loadTile(r,a){let f=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(f,o.R.Tile);r.requestParams=g,r.actor||(r.actor=this.dispatcher.getActor()),r.request=r.fetchHeader(void 0,(y,b,T,M)=>{if(delete r.request,r.aborted)return r.state="unloaded",a(null);if(y)return y.code===20?void 0:(r.state="errored",a(y));this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:T,expires:M}),r.state="empty",a(null)})}unloadTile(r,a){let f=r.texture;f&&f instanceof o.T?(r.destroy(!0),this.map.painter.saveTileTexture(f)):(r.destroy(),r.flushQueues(),r._isHeaderLoaded=!1,delete r._mrt,delete r.textureDescriptor),r.fbo&&(r.fbo.destroy(),delete r.fbo),delete r.request,delete r.requestParams,delete r.neighboringTiles,r.state="unloaded"}prepareTile(r,a,f){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBand(a,f,(g,y)=>{if(g)return r.state="errored",this.fire(new o.d(g)),void this.triggerRepaint(r);y&&(r.setTexture(y,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;let a=this.rasterLayers.find(({id:y})=>y===r),f=a&&a.fields,g=f&&f.bands&&f.bands;return g?g[0]:0}getTextureDescriptor(r,a,f){if(!r)return;let g=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let y=null;a instanceof o.bk?y=a.paint.get("raster-array-band"):a instanceof o.bl&&(y=a.paint.get("raster-particle-array-band"));let b=y||this.getInitialBand(g);if(b!=null)if(r.textureDescriptor){if(!r.updateNeeded(g,b)||f)return Object.assign({},r.textureDescriptor,{texture:r.texture})}else this.prepareTile(r,g,b)}}let pu={vector:su,raster:Al,"raster-dem":class extends Al{constructor(u,r,a,f){super(u,r,a,f),this.type="raster-dem",this.maxzoom=22,this._options=o.W({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(u,r){let a=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(g,y){g&&(u.state="errored",r(g)),y&&(u.dem=y,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",r(null))}u.request=o.h(this.map._requestManager.transformRequest(a,o.R.Tile),(function(g,y,b,T){if(delete u.request,u.aborted)u.state="unloaded",r(null);else if(g)u.state="errored",r(g);else if(y){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:b,expires:T});let M=ImageBitmap&&y instanceof ImageBitmap&&o.bi(),C=1-(y.width-o.bj(y.width))/2;C<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));let P=M?y:o.e.getImageData(y,C),L={uid:u.uid,coord:u.tileID,source:this.id,scope:this.scope,rawImageData:P,encoding:this.encoding,padding:C};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",L,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){let r=u.canonical,a=Math.pow(2,r.z),f=(r.x-1+a)%a,g=r.x===0?u.wrap-1:u.wrap,y=(r.x+1+a)%a,b=r.x+1===a?u.wrap+1:u.wrap,T={};return T[new o.aL(u.overscaledZ,g,r.z,f,r.y).key]={backfilled:!1},T[new o.aL(u.overscaledZ,b,r.z,y,r.y).key]={backfilled:!1},r.y>0&&(T[new o.aL(u.overscaledZ,g,r.z,f,r.y-1).key]={backfilled:!1},T[new o.aL(u.overscaledZ,u.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},T[new o.aL(u.overscaledZ,b,r.z,y,r.y-1).key]={backfilled:!1}),r.y+1<a&&(T[new o.aL(u.overscaledZ,g,r.z,f,r.y+1).key]={backfilled:!1},T[new o.aL(u.overscaledZ,u.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},T[new o.aL(u.overscaledZ,b,r.z,y,r.y+1).key]={backfilled:!1}),T}},"raster-array":ma,geojson:class extends o.E{constructor(u,r,a,f){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(f),this._data=r.data,this._options=o.W({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.minzoom!==void 0&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;let g=o.a3/this.tileSize;this.workerOptions=o.W({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*g,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*g,extent:o.a3,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.a3,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*g,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}updateData(u){return this._options.dynamic?typeof u!="string"&&(u.type==="Feature"&&(u={type:"FeatureCollection",features:[u]}),u.type!=="FeatureCollection")?this.fire(new o.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&typeof u!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"?this._data.features.push(...u.features):this._data=u,this._updateWorkerData(!0),this):this.fire(new o.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(u,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id,scope:this.scope},r),this}getClusterChildren(u,r){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id,scope:this.scope},r),this}getClusterLeaves(u,r,a,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:u,limit:r,offset:a},f),this}_updateWorkerData(u=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.f("dataloading",{dataType:"source"})),this._loaded=!1;let r=o.W({append:u},this.workerOptions);r.scope=this.scope;let a=this._data;typeof a=="string"?(r.request=this.map._requestManager.transformRequest(o.e.resolveURL(a),o.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(f,g)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new o.d(f));else{let y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(y.resourceTiming=g.resourceTiming[this.id]),u&&(this._partialReload=!0),this.fire(new o.f("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(u),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(u,r){let a=u.actor?"reloadTile":"loadTile";u.actor=this.actor;let f=this.map.style?this.map.style.getLut(this.scope):null,g=this._partialReload,y={type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:f?{image:f.image.clone()}:null,scope:this.scope,pixelRatio:o.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:g};u.request=this.actor.send(a,y,(b,T)=>g&&!T?(u.state="loaded",r(null)):(delete u.request,u.destroy(),u.aborted?r(null):b?r(b):(u.loadVectorData(T,this.map.painter,a==="reloadTile"),r(null))),void 0,a==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u,r){this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}onRemove(u){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.bm{constructor(u,r,a,f){super(u,r,a,f),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;let u=this.options;this.urls=[];for(let r of u.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.R.Source).url);o.bn(this.urls,(r,a)=>{this._loaded=!0,r?this.fire(new o.d(r)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){let r=this.video.seekable;u<r.start(0)||u>r.end(0)?this.fire(new o.d(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let u=this.map.painter.context,r=u.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(u,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.bm,model:class extends o.E{constructor(u,r,a,f){super(),this.id=u,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){let u=[];for(let r in this._options.models){let a=this._options.models[r],f=o.l(this.map._requestManager.transformRequest(a.uri,o.R.Model).url).then(g=>{if(!g)return;let y=o.c(g),b=new o.M(r,a.position,a.orientation,y);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(g=>{this.fire(new o.d(new Error(`Could not load model ${r} from ${a.uri}: ${g.message}`)))});u.push(f)}return Promise.allSettled(u).then(()=>{this._loaded=!0,this.fire(new o.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this.fire(new o.d(new Error(`Could not load models: ${r.message}`)))})}onAdd(u){this.map=u,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(u,r){}serialize(){return{type:"model"}}},"batched-model":class extends o.E{constructor(u,r,a,f){super(),this.type="batched-model",this.id=u,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(u){this.map=u,this.load()}load(u){this._loaded=!1,this.fire(new o.f("dataloading",{dataType:"source"}));let r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map._worldview;this._tileJSONRequest=Jh(this._options,this.map._requestManager,r,a,(f,g)=>{this._tileJSONRequest=null,this._loaded=!0,f?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new o.d(f))):g&&(o.W(this,g),g.bounds&&(this.tileBounds=new Sl(g.bounds,this.minzoom,this.maxzoom)),o.an(g.tiles,this.map._requestManager._customAccessToken),this.fire(new o.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.f("data",{dataType:"source",sourceDataType:"content"}))),u&&u(f)})}hasTransition(){return!1}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loaded(){return this._loaded}loadTile(u,r){let a=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(a,o.R.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(u.actor&&u.state!=="expired")if(u.state==="loading")u.reloadCallback=r;else{if(u.buckets){let y=Object.values(u.buckets);for(let b of y)b.dirty=!0;return void(u.state="loaded")}u.request=u.actor.send("reloadTile",f,g.bind(this))}else u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",f,g.bind(this),void 0,!0);function g(y,b){return u.aborted?r(null):y&&y.status!==404?r(y):(b&&(b.resourceTiming&&(u.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&u.setExpiryData(b),u.buckets=Br(Br({},u.buckets),b.buckets),b.featureIndex&&(u.latestFeatureIndex=b.featureIndex)),u.state="loaded",void r(null))}}serialize(){return o.W({},this._options)}},canvas:class extends o.bm{constructor(u,r,a,f){super(u,r,a,f),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(y=>typeof y!="number"))||this.fire(new o.d(new o.V(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.d(new o.V(`sources.${u}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.d(new o.V(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.d(new o.V(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.d(new o.V(`sources.${u}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(u){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let r=this.map.painter.context;this.texture?!u&&!this._playing||this.texture instanceof o.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends o.E{constructor(u,r,a,f){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=r,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Sl(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),o.W(this,o.ah(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this.map=u,this._loaded=!1,this.fire(new o.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){let{x:r,y:a,z:f}=u.canonical;return this._implementation.hasTile({x:r,y:a,z:f})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,r){let{x:a,y:f,z:g}=u.tileID.canonical,y=new AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:a,y:f,z:g},{signal:y.signal})).then((function(b){return delete u.request,u.aborted?(u.state="unloaded",r(null)):b===void 0?(u.state="errored",r(null)):b===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",r(null)):function(T){return T instanceof ImageData||T instanceof HTMLCanvasElement||T instanceof ImageBitmap||T instanceof HTMLImageElement}(b)?(this.loadTileData(u,b),u.state="loaded",void r(null)):(u.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(b=>{b.code!==20&&(u.state="errored",r(b))}),u.request.cancel=()=>y.abort()}loadTileData(u,r){u.setTexture(r,this.map.painter)}unloadTile(u,r){if(u.texture&&u.texture instanceof o.T?(u.destroy(!0),u.texture&&u.texture instanceof o.T&&this.map.painter.saveTileTexture(u.texture)):u.destroy(),this._implementation.unloadTile){let{x:a,y:f,z:g}=u.tileID.canonical;this._implementation.unloadTile({x:a,y:f,z:g})}r&&r()}abortTile(u,r){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){let u=o.al(this.id,this.scope);this.map.style.clearSource(u)}_update(){this.fire(new o.f("data",{dataType:"source",sourceDataType:"content"}))}}},_r=function(u,r,a,f){let g=new pu[r.type](u,r,a,f);if(g.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${g.id}`);return o.bp(["load","abort","unload","serialize","prepare"],g),g};class Ep extends o.bv{constructor(r){let a={type:"raster-dem",maxzoom:r.transform.maxZoom},f=new o.bw(o.bx(),null),g=_r("mock-dem",a,f,r.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,a){r.state="loaded",a(null)}}class cd extends o.bv{constructor(r){let a=_r("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new o.bw(o.bx(),null),r.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,a,f){if(r.freezeTileCoverage)return;this.transform=r;let g=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,b)=>{if(y[b.key]="",!this._tiles[b.key]){let T=new o.by(b,this._source.tileSize*b.overscaleFactor(),r.tileZoom);T.state="loaded",this._tiles[b.key]=T}return y},{});for(let y in this._tiles)y in g||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(r){let a=this.proxyCachedFBO[r];if(a!==void 0){let f=Object.values(a);this.renderCachePool.push(...f),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ud extends o.aL{constructor(r,a,f){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=a,this.projMatrix=f}}class hd extends o.bq{constructor(r,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[f,g,y]=function(M){let C=new o.bt,P=new o.bu,L=131;C.reserve(17161),P.reserve(33800);let F=o.a3/128,N=o.a3+F/2,j=N+F;for(let G=-F;G<j;G+=F)for(let $=-F;$<j;$+=F){let Q=$<0||$>N||G<0||G>N?24575:0,K=o.at(Math.round($),0,o.a3),J=o.at(Math.round(G),0,o.a3);C.emplaceBack(K+Q,J)}let U=(G,$)=>{let Q=$*L+G;P.emplaceBack(Q+1,Q,Q+L),P.emplaceBack(Q+L,Q+L+1,Q+1)};for(let G=1;G<129;G++)for(let $=1;$<129;$++)U($,G);return[0,129].forEach(G=>{for(let $=0;$<130;$++)U($,G),U(G,$)}),[C,P,32768]}(),b=r.context;this.gridBuffer=b.createVertexBuffer(f,o.br.members),this.gridIndexBuffer=b.createIndexBuffer(g),this.gridSegments=o.b.simpleSegment(0,0,f.length,g.length),this.gridNoSkirtSegments=o.b.simpleSegment(0,0,f.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new cd(a.map),this.orthoMatrix=o.ad.create(),o.ad.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.a3,0,o.a3,0,1);let T=b.gl;this._overlapStencilMode=new o.ag({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ep(a.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,a,f){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);let g=r.terrain.properties,y=r.terrain.drapeRenderMode===0,b=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.e.now();let T=r.terrain&&r.terrain.scope,M=g.get("source"),C=y?this._mockSourceCache:r.getSourceCache(M,T);if(!C)return void o.w(`Couldn't find terrain source "${M}".`);if(this.sourceCache=C,this._exaggeration=b?this.calculateExaggeration(a):g.get("exaggeration"),!a.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;let P=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let L=this.getScaledDemTileSize();this.sourceCache.update(a,L,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,P(),this._initializing=!0),P(),a.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(r){let a=this._previousCameraAltitude,f=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=f;let g=a!=null?f-a:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;let y=r.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(y);let T=y-this._previousZoom,M=this._previousUpdateTimestamp,C=y;this._evaluationZoom!=null&&(C=this._evaluationZoom,Math.abs(y-C)>.5&&(T=.5*(y-C+T)),T*g<0&&(C+=T)),this._evaluationZoom=C;let P=b.getExaggeration(C),L=P===b.getExaggeration(Math.max(0,C-.1));if(L&&Math.abs(P-this._exaggeration)<.01)return P;let F=Math.min(.1,.00375*(this._updateTimestamp-M));return(L||P<.1||Math.abs(T)<1e-4)&&(F=Math.min(.2,4*F)),o.a2(this._exaggeration,P,F)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let a=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(o.Y.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let g=this.proxyCoords=a.getIds().map(M=>{let C=a.getTileByID(M).tileID;return C.projMatrix=f.calculateProjMatrix(C.toUnwrapped()),C});(function(M,C){let P=C.transform.pointCoordinate(C.transform.getCameraPoint()),L=new o.P(P.x,P.y);M.sort((F,N)=>{if(N.overscaledZ-F.overscaledZ)return N.overscaledZ-F.overscaledZ;let j=new o.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),U=new o.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),G=L.mult(1<<F.canonical.z);return G.x-=.5,G.y-=.5,G.distSqr(j)-G.distSqr(U)})})(g,this.painter);let y=this.proxyToSource||{};this.proxyToSource={},g.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};let b=this._style._mergedSourceCaches;for(let M in b){let C=b[M];if(!C.used||(C!==this.sourceCache&&this.resetTileLookupCache(C.id),this._setupProxiedCoordsForOrtho(C,r[M],y),C.usedForTerrain))continue;let P=r[M];C.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[a.id]=g.map(M=>new ud(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;let T={};this._visibleDemTiles=[];for(let M of this.proxyCoords){let C=this.terrainTileForTile[M.key];if(!C)continue;let P=C.tileID.key;P in T||(this._visibleDemTiles.push(C),T[P]=P)}}_assignTerrainTiles(r){this._initializing||r.forEach(a=>{if(this.terrainTileForTile[a.key])return;let f=this._findTileCoveringTileID(a,this.sourceCache);f&&(this.terrainTileForTile[a.key]=f)})}_prepareDEMTextures(){let r=this.painter.context,a=r.gl;for(let f in this.terrainTileForTile){let g=this.terrainTileForTile[f],y=g.dem;!y||g.demTexture&&!g.needsDEMTextureUpload||(r.activeTexture.set(a.TEXTURE1),Kh(this.painter,g,y))}}_prepareDemTileUniforms(r,a,f,g){if(!a||a.demTexture==null)return!1;let y=r.tileID.canonical,b=Math.pow(2,a.tileID.canonical.z-y.z),T=g||"";return f[`u_dem_tl${T}`]=[y.x*b%1,y.y*b%1],f[`u_dem_scale${T}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let r=this.painter.context,a=r.gl;if(!this._emptyDepthBufferTexture){let f=new o.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.T(r,f,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0,a=this._visibleDemTiles.reduce((f,g)=>{if(!g.dem)return f;let y=g.dem.tree.minimums[0];return y>0&&r++,f+y},0);return r?a/r:0}_updateEmptyDEMTexture(){let r=this.painter.context,a=r.gl;r.activeTexture.set(a.TEXTURE2);let f=this._getLoadedAreaMinimum(),[g,y]=(()=>{let T=new o.bz({width:1,height:1},new Float32Array([f]));return[a.R32F,T]})();this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new o.T(r,y,g,{premultiply:!1}),b}setupElevationDraw(r,a,f){let g=this.painter.context,y=g.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[2,0],u_exaggeration:0};b.u_exaggeration=this.exaggeration();let T=null,M=null,C=1;if(f&&f.morphing&&this._useVertexMorphing){let j=f.morphing.srcDemTile,U=f.morphing.dstDemTile;C=f.morphing.phase,j&&U&&(this._prepareDemTileUniforms(r,j,b,"_prev")&&(M=j),this._prepareDemTileUniforms(r,U,b)&&(T=U))}let P=j=>j&&j.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST,L=null;var F,N;if(this.enabled?M&&T?(L=T.demTexture,g.activeTexture.set(y.TEXTURE4),M.demTexture.bind(P(M),y.CLAMP_TO_EDGE),b.u_dem_lerp=C):(T=this.terrainTileForTile[r.tileID.key],L=this._prepareDemTileUniforms(r,T,b)?T.demTexture:this.emptyDEMTexture):L=this.emptyDEMTexture,g.activeTexture.set(y.TEXTURE2),L&&(b.u_dem_size=(F=L).size[0]===1?1:F.size[0]-2,L.bind(P(T),y.CLAMP_TO_EDGE)),g.activeTexture.set(y.TEXTURE3),f&&f.useDepthForOcclusion&&this.painter.terrainDepthTexture&&this.painter.terrainDepthFBO?(this.painter.terrainDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),b.u_depth_size_inv=[1/this.painter.terrainDepthFBO.width,1/this.painter.terrainDepthFBO.height],b.u_depth_range_unpack=[2/((N=this.painter.depthRangeFor3D)[1]-N[0]),-1-2*N[0]/(N[1]-N[0])]):(this.emptyDepthBufferTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),b.u_depth_range_unpack=[2,0]),g.activeTexture.set(y.TEXTURE0),f&&f.useMeterToDem&&T){let j=(1<<T.tileID.canonical.z)*o.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=j}if(f&&f.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),a.setTerrainUniformValues(g,b),this.painter.transform.projection.name==="globe"){let j=this.globeUniformValues(this.painter.transform,r.tileID.canonical,f&&f.useDenormalizedUpVectorScale);a.setGlobeUniformValues(g,j)}}globeUniformValues(r,a,f){let g=r.projection;return{u_tile_tl_up:g.upVector(a,0,0),u_tile_tr_up:g.upVector(a,o.a3,0),u_tile_br_up:g.upVector(a,o.a3,o.a3),u_tile_bl_up:g.upVector(a,0,o.a3),u_tile_up_scale:f?o.bs(1):g.upVectorScale(a,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){let a=this.painter,f=this.painter.context;r.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,y,b,T,M){if(g.transform.projection.name==="globe")(function(C,P,L,F,N){let j=C.context,U=j.gl,G,$,Q=C.transform,K=o.ba(C,j,Q),J=(ae,Ee)=>{if($===Ee)return;let Fe=[ld[Ee],"PROJECTION_GLOBE_VIEW"];K&&Fe.push("CUSTOM_ANTIALIASING");let ze=C.isTileAffectedByFog(ae);G=C.getOrCreateProgram("globeRaster",{defines:Fe,overrideFog:ze}),$=Ee},oe=C.colorModeForRenderPass(),ie=new o.ae(U.LEQUAL,o.ae.ReadWrite,C.depthRangeFor3D);No.update(N);let ce=o.bb(Q),q=[o.aj(Q.center.lng),o.ak(Q.center.lat)],ee=C.globeSharedBuffers,he=[Q.width*o.e.devicePixelRatio,Q.height*o.e.devicePixelRatio],we=Float32Array.from(Q.globeMatrix),pe={useDenormalizedUpVectorScale:!0};{let ae=C.transform,Ee=Ol(ae.zoom,P.exaggeration(),P.sourceCache._source.tileSize);$=-1;let Fe=U.TRIANGLES;for(let ze of F){let ke=L.getTile(ze),_e=o.ag.disabled,De=P.prevTerrainTileForTile[ze.key],Re=P.terrainTileForTile[ze.key];pa(De,Re)&&No.newMorphing(ze.key,De,Re,N,250),j.activeTexture.set(U.TEXTURE0),ke.texture&&ke.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let Qe=No.getMorphValuesForProxy(ze.key),Ke=Qe?1:0;Qe&&o.o(pe,{morphing:{srcDemTile:Qe.from,dstDemTile:Qe.to,phase:o.b9(Qe.phase)}});let nt=o.bc(ze.canonical),Je=o.bd(nt.getCenter().lat),Ze=o.be(ze.canonical,nt,Je,ae.worldSize/ae._pixelsPerMercatorPixel),Ae=o.bf(o.bg(ze.canonical)),at=tt(ae.expandedFarZProjMatrix,we,ce,Ae,o.a1(ae.zoom),q,ae.frustumCorners.TL,ae.frustumCorners.TR,ae.frustumCorners.BR,ae.frustumCorners.BL,ae.globeCenterInViewSpace,ae.globeRadius,he,Ee,ae._farZ,Ze);if(J(ze,Ke),G&&(P.setupElevationDraw(ke,G,pe),C.uploadCommonUniforms(j,G,ze.toUnwrapped()),ee)){let[Lt,gt,It]=ee.getGridBuffers(Je,Ee!==0);G.draw(C,Fe,ie,_e,oe,o.af.backCCW,at,"globe_raster",Lt,gt,It)}}}if(ee&&(C.renderDefaultNorthPole||C.renderDefaultSouthPole)){let ae=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];K&&ae.push("CUSTOM_ANTIALIASING"),G=C.getOrCreateProgram("globeRaster",{defines:ae});for(let Ee of F){let{x:Fe,y:ze,z:ke}=Ee.canonical,_e=ze===0,De=ze===(1<<ke)-1,[Re,Qe,Ke,nt]=ee.getPoleBuffers(ke,!1);if(nt&&(_e||De)){let Je=L.getTile(Ee);j.activeTexture.set(U.TEXTURE0),Je.texture&&Je.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let Ze=o.bh(ke,Fe,Q),Ae=o.bf(o.bg(Ee.canonical)),at=(Lt,gt)=>Lt.draw(C,U.TRIANGLES,ie,o.ag.disabled,oe,o.af.disabled,tt(Q.expandedFarZProjMatrix,Ze,Ze,Ae,0,q,Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.globeCenterInViewSpace,Q.globeRadius,he,0,Q._farZ),"globe_pole_raster",gt,Ke,nt);P.setupElevationDraw(Je,G,pe),C.uploadCommonUniforms(j,G,Ee.toUnwrapped()),_e&&C.renderDefaultNorthPole&&at(G,Re),De&&C.renderDefaultSouthPole&&(Ze=o.ad.scale(o.ad.create(),Ze,[1,-1,1]),at(G,Qe))}}}})(g,y,b,T,M);else{let C=g.context,P=C.gl,L,F,N=g.shadowRenderer,j=ps(g,g.longestCutoffRange),U=oe=>{if(F===oe)return;let ie=[];ie.push(ld[oe]),j.shouldRenderCutoff&&ie.push("RENDER_CUTOFF"),L=g.getOrCreateProgram("terrainRaster",{defines:ie}),F=oe},G=g.colorModeForRenderPass(),$=new o.ae(P.LEQUAL,o.ae.ReadWrite,g.depthRangeFor3D);No.update(M);let Q=g.transform,K=Ol(Q.zoom,y.exaggeration(),y.sourceCache._source.tileSize),J=[0,0,0];if(N){let oe=g.style.directionalLight,ie=g.style.ambientLight;oe&&ie&&(J=fa(g.style,oe,ie))}{F=-1;let oe=P.TRIANGLES,[ie,ce]=[y.gridIndexBuffer,y.gridSegments];for(let q of T){let ee=b.getTile(q),he=o.ag.disabled,we=y.prevTerrainTileForTile[q.key],pe=y.terrainTileForTile[q.key];pa(we,pe)&&No.newMorphing(q.key,we,pe,M,250),C.activeTexture.set(P.TEXTURE0),ee.texture&&ee.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE);let ae=No.getMorphValuesForProxy(q.key),Ee=ae?1:0,Fe;ae&&(Fe={morphing:{srcDemTile:ae.from,dstDemTile:ae.to,phase:o.b9(ae.phase)}});let ze=da(q.projMatrix,Tp(q.canonical,Q.renderWorldCopies)?K/10:K,J);if(U(Ee),!L)continue;y.setupElevationDraw(ee,L,Fe);let ke=q.toUnwrapped();N&&N.setupShadows(ke,L),g.uploadCommonUniforms(C,L,ke,null,j),L.draw(g,oe,$,he,G,o.af.backCCW,ze,"terrain_raster",y.gridBuffer,ie,ce)}}}}(a,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;let a=this.painter,f=this.painter.context,g=this.proxySourceCache,y=this.proxiedCoords[g.id],b=this._drapedRenderBatches.shift(),T=a.style.order,M=[],C=0;for(let P of y){let L=g.getTileByID(P.proxyTileKey),F=g.proxyCachedFBO[P.key]?g.proxyCachedFBO[P.key][r]:void 0,N=F!==void 0?g.renderCache[F]:this.pool[C++],j=F!==void 0;if(L.texture=N.tex,j&&!N.dirty){M.push(L.tileID);continue}let U;f.bindFramebuffer.set(N.fb.framebuffer),this.renderedToTile=!1,N.dirty&&(f.clear({color:o.C.transparent,stencil:0}),N.dirty=!1);for(let G=b.start;G<=b.end;++G){let $=a.style._mergedLayers[T[G]];if($.isHidden(a.transform.zoom))continue;let Q=a.style.getLayerSourceCache($),K=Q?this.proxyToSource[P.key][Q.id]:[P];if(!K)continue;let J=K;f.viewport.set([0,0,N.fb.width,N.fb.height]),U!==(Q?Q.id:null)&&(this._setupStencil(N,K,$,Q),U=Q?Q.id:null),a.renderLayer(a,Q,$,J)}if(this._drapedRenderBatches.length===0)for(let G of this._pendingGroundEffectLayers){let $=a.style._mergedLayers[T[G]];if($.isHidden(a.transform.zoom))continue;let Q=a.style.getLayerSourceCache($),K=Q?this.proxyToSource[P.key][Q.id]:[P];if(!K)continue;let J=K;f.viewport.set([0,0,N.fb.width,N.fb.height]),U!==(Q?Q.id:null)&&(this._setupStencil(N,K,$,Q),U=Q?Q.id:null),a.renderLayer(a,Q,$,J)}this.renderedToTile?(N.dirty=!0,M.push(L.tileID)):j||--C,C===5&&(C=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),b.end+1}postRender(){}isLayerOrderingCorrect(r){let a=r.order.length,f=-1,g=a;for(let y=0;y<a;++y)this._style.isLayerDraped(r._mergedLayers[r.order[y]])?f=Math.max(f,y):g=Math.min(g,y);return g>f}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{r=Math.min(r,a.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,a,f){if(!this._visibleDemTiles)return null;let g=this._visibleDemTiles.filter(y=>y.dem).map(y=>{let b=y.tileID,T=1<<b.overscaledZ,{x:M,y:C}=b.canonical,P=M/T,L=(M+1)/T,F=C/T,N=(C+1)/T;return{minx:P,miny:F,maxx:L,maxy:N,t:y.dem.tree.raycastRoot(P,F,L,N,r,a,f),tile:y}});g.sort((y,b)=>(y.t!==null?y.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(let y of g){if(y.t==null)return null;let b=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,r,a,f);if(b!=null)return b}return null}_createFBO(){let r=this.painter.context,a=r.gl,f=this.drapeBufferSize;r.activeTexture.set(a.TEXTURE0);let g=new o.T(r,{width:f[0],height:f[1],data:null},a.RGBA);g.bind(a.LINEAR,a.CLAMP_TO_EDGE);let y=r.createFramebuffer(f[0],f[1],!0,null);return y.colorAttachment.set(g.texture),y.depthAttachment=new ss(r,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:y,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{let a=this._style._mergedLayers[r],f=a.isHidden(this.painter.transform.zoom);return a.type==="custom"?!f&&a.shouldRedrape():!f&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(let f of this._style.getSources())if(f instanceof su){r=!0;break}if(!r)return;let a={};for(let f=0;f<this._style.order.length;++f){let g=this._style._mergedLayers[this._style.order[f]],y=this._style.getLayerSourceCache(g);if(y&&!a[y.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof o.Z){a[y.id]=!0;for(let b of this.proxyCoords){let T=this.proxyToSource[b.key][y.id];if(T)for(let M of T)this._clearRenderCacheForTile(y.id,M)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(let f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof Al){r=!0;break}if(!r)return;let a={};for(let f=0;f<this._style.order.length;++f){let g=this._style._mergedLayers[this._style.order[f]],y=this._style.getLayerSourceCache(g);if(!y||a[y.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;let b=g.paint.get("raster-fade-duration");for(let T of this.proxyCoords){let M=this.proxyToSource[T.key][y.id];if(M)for(let C of M){let P=fu(y.getTile(C),y.findLoadedParent(C,0),y,this.painter.transform,b);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(y.id,C)}}}}_setupDrapedRenderBatches(){let r=this._style.order,a=r.length;if(a===0)return;let f=[];this._pendingGroundEffectLayers=[];let g,y=0,b=this._style._mergedLayers[r[y]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++y<a;)b=this._style._mergedLayers[r[y]];for(;y<a;++y){let T=this._style._mergedLayers[r[y]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?g===void 0&&(g=y):(T.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),g!==void 0&&(f.push({start:g,end:y-1}),g=void 0)))}if(g!==void 0&&f.push({start:g,end:y-1}),f.length!==0){let T=f[f.length-1];this._pendingGroundEffectLayers.every(M=>M>T.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(r){let a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){let b=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let T=0;T<b.length;++T){let M=Object.values(b[T]);a.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();let f=this.proxyCoords,g=this._tilesDirty;for(let b=f.length-1;b>=0;b--){let T=f[b];if(a.getTileByID(T.key),a.proxyCachedFBO[T.key]!==void 0){let M=r[T.key],C=this.proxyToSource[T.key],P=0;for(let L in C){let F=C[L],N=M[L];if(!N||N.length!==F.length||F.some((j,U)=>j!==N[U]||g[L]&&g[L].hasOwnProperty(j.key))){P=-1;break}++P}for(let L in a.proxyCachedFBO[T.key])a.renderCache[a.proxyCachedFBO[T.key][L]].dirty=P<0||P!==Object.values(M).length}}let y=[...this._drapedRenderBatches];y.sort((b,T)=>T.end-T.start-(b.end-b.start));for(let b of y)for(let T of f){if(a.proxyCachedFBO[T.key])continue;let M=a.renderCachePool.pop();M===void 0&&a.renderCache.length<50&&(M=a.renderCache.length,a.renderCache.push(this._createFBO())),M!==void 0&&(a.proxyCachedFBO[T.key]={},a.proxyCachedFBO[T.key][b.start]=M,a.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(r,a,f,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let y=this.painter.context,b=y.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let T;if(f.isTileClipped())T=a.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):o.ag.disabled}_renderTileClippingMasks(r,a){let f=this.painter,g=this.painter.context,y=g.gl;f._tileClippingMaskIDs={},g.setColorMode(o.a.disabled),g.setDepthMode(o.ae.disabled);let b=f.getOrCreateProgram("clippingMask");for(let T of r){let M=f._tileClippingMaskIDs[T.key]=--a;b.draw(f,y.TRIANGLES,o.ae.disabled,new o.ag({func:y.ALWAYS,mask:0},M,255,y.KEEP,y.KEEP,y.REPLACE),o.a.disabled,o.af.disabled,du(T.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(r){let a=this.painter.transform;if(r.x<0||r.x>a.width||r.y<0||r.y>a.height)return null;let f=[r.x,r.y,1,1];o.aA.transformMat4(f,f,a.pixelMatrixInverse),o.aA.scale(f,f,1/f[3]),f[0]/=a.worldSize,f[1]/=a.worldSize;let g=a._camera.position,y=o.ax(1,a.center.lat),b=[g[0],g[1],g[2]/y,0],T=o._.subtract([],f.slice(0,3),b);o._.normalize(T,T);let M=this.raycast(b,T,this._exaggeration);return M!==null&&M?(o._.scaleAndAdd(b,b,T,M),b[3]=b[2],b[2]*=y,b):null}_setupProxiedCoordsForOrtho(r,a,f){if(r.getSource()instanceof o.bm)return this._setupProxiedCoordsForImageSource(r,a,f);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};let g=this.proxiedCoords[r.id]=[],y=this.proxyCoords;for(let M=0;M<y.length;M++){let C=y[M],P=this._findTileCoveringTileID(C,r);if(P){let L=this._createProxiedId(C,P,f[C.key]&&f[C.key][r.id]);g.push(L),this.proxyToSource[C.key][r.id]=[L]}}let b=!1,T=new Set;for(let M=0;M<a.length;M++){let C=r.getTile(a[M]);if(!C||!C.hasData())continue;let P=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==C.tileID.canonical.z){let L=this.proxyToSource[P.tileID.key][r.id],F=this._createProxiedId(P.tileID,C,f[P.tileID.key]&&f[P.tileID.key][r.id]);L?L.splice(L.length-1,0,F):this.proxyToSource[P.tileID.key][r.id]=[F];let N=this.proxyToSource[P.tileID.key][r.id];T.has(N)||T.add(N),g.push(F),b=!0}}if(this._sourceTilesOverlap[r.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(let M of T)M.sort((C,P)=>P.overscaledZ-C.overscaledZ)}_setupProxiedCoordsForImageSource(r,a,f){if(!r.getSource().loaded())return;let g=this.proxiedCoords[r.id]=[],y=this.proxyCoords,b=r.getSource(),T=b.tileID;if(!T)return;let M=new o.P(T.x,T.y)._div(1<<T.z),C=b.coordinates.map(o.Y.fromLngLat).reduce((L,F)=>(L.min.x=Math.min(L.min.x,F.x-M.x),L.min.y=Math.min(L.min.y,F.y-M.y),L.max.x=Math.max(L.max.x,F.x-M.x),L.max.y=Math.max(L.max.y,F.y-M.y),L),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(L,F)=>{let N=L.wrap+L.canonical.x/(1<<L.canonical.z),j=L.canonical.y/(1<<L.canonical.z),U=o.a3/(1<<L.canonical.z),G=F.wrap+F.canonical.x/(1<<F.canonical.z),$=F.canonical.y/(1<<F.canonical.z);return N+U<G+C.min.x||N>G+C.max.x||j+U<$+C.min.y||j>$+C.max.y};for(let L=0;L<y.length;L++){let F=y[L];for(let N=0;N<a.length;N++){let j=r.getTile(a[N]);if(!j||!j.hasData()||P(F,j.tileID))continue;let U=this._createProxiedId(F,j,f[F.key]&&f[F.key][r.id]),G=this.proxyToSource[F.key][r.id];G?G.push(U):this.proxyToSource[F.key][r.id]=[U],g.push(U)}}}_createProxiedId(r,a,f){let g=this.orthoMatrix;if(f){let y=f.find(b=>b.key===a.tileID.key);if(y)return y}if(a.tileID.key!==r.key){let y=r.canonical.z-a.tileID.canonical.z,b,T,M;g=o.ad.create();let C=a.tileID.wrap-r.wrap<<r.overscaledZ;y>0?(b=o.a3>>y,T=b*((a.tileID.canonical.x<<y)-r.canonical.x+C),M=b*((a.tileID.canonical.y<<y)-r.canonical.y)):(b=o.a3<<-y,T=o.a3*(a.tileID.canonical.x-(r.canonical.x+C<<-y)),M=o.a3*(a.tileID.canonical.y-(r.canonical.y<<-y))),o.ad.ortho(g,0,b,0,b,0,1),o.ad.translate(g,g,[T,M,0])}return new ud(a.tileID,r.key,g)}_findTileCoveringTileID(r,a){let f=a.getTile(r);if(f&&f.hasData())return f;let g=this._findCoveringTileCache[a.id],y=g[r.key];if(f=y?a.getTileByID(y):null,f&&f.hasData()||y===null)return f;let b=f?f.tileID:r,T=b.overscaledZ,M=a.getSource().minzoom,C=[];if(!y){let L=a.getSource().maxzoom;if(r.canonical.z>=L){let F=r.canonical.z-L;a.getSource().reparseOverscaled?(T=Math.max(r.canonical.z+2,a.transform.tileZoom),b=new o.aL(T,r.wrap,L,r.canonical.x>>F,r.canonical.y>>F)):F!==0&&(T=L,b=new o.aL(T,r.wrap,L,r.canonical.x>>F,r.canonical.y>>F))}b.key!==r.key&&(C.push(b.key),f=a.getTile(b))}let P=L=>{C.forEach(F=>{g[F]=L}),C.length=0};for(T-=1;T>=M&&(!f||!f.hasData());T--){f&&P(f.tileID.key);let L=b.calculateScaledKey(T);if(f=a.getTileByID(L),f&&f.hasData())break;let F=g[L];if(F===null)break;F===void 0?C.push(L):f=a.getTileByID(F)}return P(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,a){let f=this._tilesDirty[r];f||(f=this._tilesDirty[r]={}),f[a.key]=!0}}function Ip(u,r,a){let f=function(T,M,C){let P=o._.dot(M,T),L=o._.dot(C,[.2126,.7152,.0722]),F=(j,U,G)=>(1-G)*j+G*U,N=F(1-.3*Math.min(L,1),1,Math.min(P+1,1));return F(.92,1,Math.asin(o.at(M[2],-1,1))/Math.PI+.5)*N}(u,[0,0,1],r),g=[0,0,0];o._.scale(g,a.slice(0,3),f);let y=[0,0,0];o._.scale(y,r.slice(0,3),u[2]);let b=[0,0,0];return o._.add(b,g,y),o.b8(b)}let no=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],mu=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class dd{static cacheKey(r,a,f,g){let y=`${a}${g?g.cacheKey:""}`;for(let b of f)r.usedDefines.includes(b)&&(y+=`/${b}`);return y}constructor(r,a,f,g,y,b){let T=r.gl;this.program=T.createProgram(),this.configuration=g,this.name=a,this.fixedDefines=[...b];let M=g?g.getBinderAttributes():[],C=(f.staticAttributes||[]).concat(M),P=g?g.defines():[];P=P.concat(b.map(G=>`#define ${G}`));let L=`#version 300 es
`,F=L+P.concat("precision mediump float;",xp,yp.fragmentSource).join(`
`);for(let G of f.fragmentIncludes)F+=`
${iu[G]}`;F+=`
${f.fragmentSource}`;let N=L+P.concat("precision highp float;",xp,yp.vertexSource).join(`
`);for(let G of f.vertexIncludes)N+=`
${iu[G]}`;N+=`
${f.vertexSource}`;let j=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(j,F),T.compileShader(j),T.attachShader(this.program,j);let U=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(U,N),T.compileShader(U),T.attachShader(this.program,U),this.attributes={},this.numAttributes=C.length;for(let G=0;G<this.numAttributes;G++)if(C[G]){let $=C[G].startsWith("a_")?C[G]:`a_${C[G]}`;T.bindAttribLocation(this.program,G,$),this.attributes[$]=G}T.linkProgram(this.program),T.deleteShader(U),T.deleteShader(j),this.fixedUniforms=y(r),this.binderUniforms=g?g.getUniforms(r):[],b.includes("TERRAIN")&&(this.terrainUniforms=(G=>({u_dem:new o.a7(G),u_dem_prev:new o.a7(G),u_dem_tl:new o.a8(G),u_dem_scale:new o.aa(G),u_dem_tl_prev:new o.a8(G),u_dem_scale_prev:new o.aa(G),u_dem_size:new o.aa(G),u_dem_lerp:new o.aa(G),u_exaggeration:new o.aa(G),u_depth:new o.a7(G),u_depth_size_inv:new o.a8(G),u_depth_range_unpack:new o.a8(G),u_meter_to_dem:new o.aa(G),u_label_plane_matrix_inv:new o.a6(G)}))(r)),b.includes("GLOBE")&&(this.globeUniforms=(G=>({u_tile_tl_up:new o.aq(G),u_tile_tr_up:new o.aq(G),u_tile_br_up:new o.aq(G),u_tile_bl_up:new o.aq(G),u_tile_up_scale:new o.aa(G)}))(r)),b.includes("FOG")&&(this.fogUniforms=(G=>({u_fog_matrix:new o.a6(G),u_fog_range:new o.a8(G),u_fog_color:new o.as(G),u_fog_horizon_blend:new o.aa(G),u_fog_vertical_limit:new o.a8(G),u_fog_temporal_offset:new o.aa(G),u_frustum_tl:new o.aq(G),u_frustum_tr:new o.aq(G),u_frustum_br:new o.aq(G),u_frustum_bl:new o.aq(G),u_globe_pos:new o.aq(G),u_globe_radius:new o.aa(G),u_globe_transition:new o.aa(G),u_is_globe:new o.a7(G),u_viewport:new o.a8(G)}))(r)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(G=>({u_cutoff_params:new o.as(G)}))(r)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(G=>({u_lighting_ambient_color:new o.aq(G),u_lighting_directional_dir:new o.aq(G),u_lighting_directional_color:new o.aq(G),u_ground_radiance:new o.aq(G)}))(r)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(G=>({u_light_matrix_0:new o.a6(G),u_light_matrix_1:new o.a6(G),u_fade_range:new o.a8(G),u_shadow_normal_offset:new o.aq(G),u_shadow_intensity:new o.aa(G),u_shadow_texel_size:new o.aa(G),u_shadow_map_resolution:new o.aa(G),u_shadow_direction:new o.aq(G),u_shadow_bias:new o.aq(G),u_shadowmap_0:new o.a7(G),u_shadowmap_1:new o.a7(G)}))(r))}}setTerrainUniformValues(r,a){if(!this.terrainUniforms)return;let f=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let g in a)f[g]&&f[g].set(this.program,g,a[g])}}setGlobeUniformValues(r,a){if(!this.globeUniforms)return;let f=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let g in a)f[g]&&f[g].set(this.program,g,a[g])}}setFogUniformValues(r,a){if(!this.fogUniforms)return;let f=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let g in a)f[g].set(this.program,g,a[g])}}setCutoffUniformValues(r,a){if(!this.cutoffUniforms)return;let f=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let g in a)f[g].set(this.program,g,a[g])}}setLightsUniformValues(r,a){if(!this.lightsUniforms)return;let f=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let g in a)f[g].set(this.program,g,a[g])}}setShadowUniformValues(r,a){if(this.failedToCreate||!this.shadowUniforms)return;let f=this.shadowUniforms;r.program.set(this.program);for(let g in a)f[g].set(this.program,g,a[g])}_drawDebugWireframe(r,a,f,g,y,b,T,M,C,P){let L=r.options.wireframe;if(L.terrain===!1&&L.layers2D===!1&&L.layers3D===!1)return;let F=r.context;if(!(!(!L.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!L.layers2D||r._terrain&&r._terrain.renderingToTexture||!no.includes(this.name))||!(!L.layers3D||!mu.includes(this.name))))return;let N=F.gl,j=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,y,F);if(!j)return;let U=[...this.fixedDefines];U.push("DEBUG_WIREFRAME");let G=r.getOrCreateProgram(this.name,{config:this.configuration,defines:U});F.program.set(G.program);let $=(J,oe,ie)=>{if(oe[J]&&ie[J])for(let ce in oe[J])ie[J][ce]&&ie[J][ce].set(ie.program,ce,oe[J][ce].current)};C&&C.setUniforms(G.program,F,G.binderUniforms,T,{zoom:M}),$("fixedUniforms",this,G),$("terrainUniforms",this,G),$("globeUniforms",this,G),$("fogUniforms",this,G),$("lightsUniforms",this,G),$("shadowUniforms",this,G),j.bind(),F.setColorMode(new o.a([N.ONE,N.ONE_MINUS_SRC_ALPHA,N.ZERO,N.ONE],o.C.transparent,[!0,!0,!0,!1])),F.setDepthMode(new o.ae(a.func===N.LESS?N.LEQUAL:a.func,o.ae.ReadOnly,a.range)),F.setStencilMode(o.ag.disabled);let Q=3*b.primitiveLength*2,K=3*b.primitiveOffset*2*2;P&&P>1?N.drawElementsInstanced(N.LINES,Q,N.UNSIGNED_SHORT,K,P):N.drawElements(N.LINES,Q,N.UNSIGNED_SHORT,K),y.bind(),F.program.set(this.program),F.setDepthMode(a),F.setStencilMode(f),F.setColorMode(g)}draw(r,a,f,g,y,b,T,M,C,P,L,F,N,j,U,G){let $=r.context,Q=$.gl;if(this.failedToCreate)return;$.program.set(this.program),$.setDepthMode(f),$.setStencilMode(g),$.setColorMode(y),$.setCullFace(b);for(let oe of Object.keys(this.fixedUniforms))this.fixedUniforms[oe].set(this.program,oe,T[oe]);j&&j.setUniforms(this.program,$,this.binderUniforms,F,{zoom:N});let K={[Q.POINTS]:1,[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[a],J=G&&G>0?1:void 0;for(let oe of L.get()){let ie=oe.vaos||(oe.vaos={});(ie[M]||(ie[M]=new H_)).bind($,this,C,j?j.getPaintVertexBuffers():[],P,oe.vertexOffset,U||[],J),G&&G>1?Q.drawElementsInstanced(a,oe.primitiveLength*K,Q.UNSIGNED_SHORT,oe.primitiveOffset*K*2,G):P?Q.drawElements(a,oe.primitiveLength*K,Q.UNSIGNED_SHORT,oe.primitiveOffset*K*2):Q.drawArrays(a,oe.vertexOffset,oe.vertexLength),a===Q.TRIANGLES&&P&&this._drawDebugWireframe(r,f,g,y,P,oe,F,N,j,G)}}}function kl(u,r){let a=Math.pow(2,r.tileID.overscaledZ),f=r.tileSize*Math.pow(2,u.transform.tileZoom)/a,g=f*(r.tileID.canonical.x+r.tileID.wrap*a),y=f*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.bB(r,1,u.transform.tileZoom),u_pixel_coord_upper:[g>>16,y>>16],u_pixel_coord_lower:[65535&g,65535&y]}}let fd=o.ad.create(),Fl=(u,r,a,f,g,y,b,T,M,C,P,L,F,N,j,U)=>{let G=r.style.light,$=G.properties.get("position"),Q=[$.x,$.y,$.z],K=o.bC.create();G.properties.get("anchor")==="viewport"&&(o.bC.fromRotation(K,-r.transform.angle),o._.transformMat3(Q,Q,K));let J=G.properties.get("color"),oe=r.transform,ie={u_matrix:u,u_lightpos:Q,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_vertical_gradient:+a,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:g,u_edge_radius:y,u_flood_light_color:L,u_vertical_scale:F,u_flood_light_intensity:N,u_ground_shadow_factor:j,u_emissive_strength:U};return oe.projection.name==="globe"&&(ie.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],ie.u_zoom_transition=M,ie.u_inv_rot_matrix=P,ie.u_merc_center=C,ie.u_up_dir=oe.projection.upVector(new o.aO(0,0,0),C[0]*o.a3,C[1]*o.a3),ie.u_height_lift=T),ie},Nl=(u,r,a)=>({u_matrix:u,u_edge_radius:r,u_vertical_scale:a}),ga=(u,r,a,f,g,y,b,T,M,C,P,L,F,N)=>{let j=Fl(u,r,a,f,g,y,b,M,C,P,L,F,N,1,[0,0,0],0),U={u_height_factor:-Math.pow(2,b.overscaledZ)/T.tileSize/8};return o.W(j,kl(r,T),U)},gu=(u,r)=>({u_matrix:u,u_emissive_strength:r}),pd=(u,r,a,f)=>o.W(gu(u,r),kl(a,f)),Dp=(u,r,a)=>({u_matrix:u,u_world:a,u_emissive_strength:r}),Mp=(u,r,a,f,g)=>o.W(pd(u,r,a,f),{u_world:g}),_u=(u,r,a,f)=>{let g=o.a3/a.tileSize;return{u_matrix:u,u_camera_to_center_distance:r.getCameraToCenterDistance(f),u_extrude_scale:[r.pixelsToGLUnits[0]/g,r.pixelsToGLUnits[1]/g]}},yu=(u,r,a=1)=>({u_matrix:u,u_color:r.toRenderColor(null),u_overlay:0,u_overlay_scale:a}),md=o.ad.create(),zl=(u,r,a,f,g,y,b)=>{let T=u.transform,M=T.projection.name==="globe",C=M?o.bD(T.zoom,r.canonical)*T._pixelsPerMercatorPixel:o.bB(a,1,y),P={u_matrix:r.projMatrix,u_extrude_scale:C,u_intensity:b,u_inv_rot_matrix:md,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){P.u_inv_rot_matrix=f,P.u_merc_center=g,P.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],P.u_zoom_transition=o.a1(T.zoom);let L=g[0]*o.a3,F=g[1]*o.a3;P.u_up_dir=T.projection.upVector(new o.aO(0,0,0),L,F)}return P};function zo(u,[r,a,f,g],[y,b]){if(y===b)return[0,0,0,0];let T=255*(u-1)/(u*(b-y));return[r*T,a*T,f*T,g*T]}function Cp(u,r,[a,f]){return a===f?0:.5/u+(r-a)*(u-1)/(u*(f-a))}let gd=(u,r,a,f,g,y,b,T,M,C,P,L,F,N,j,U,G,$,Q,K,J)=>({u_matrix:u,u_normalize_matrix:r,u_globe_matrix:a,u_merc_matrix:f,u_grid_matrix:g,u_tl_parent:y,u_scale_parent:C,u_fade_t:P.mix,u_opacity:P.opacity*L.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:L.paint.get("raster-brightness-min"),u_brightness_high:L.paint.get("raster-brightness-max"),u_saturation_factor:o.bE(L.paint.get("raster-saturation")),u_contrast_factor:o.bF(L.paint.get("raster-contrast")),u_spin_weights:xu(L.paint.get("raster-hue-rotate")),u_perspective_transform:F,u_raster_elevation:N,u_zoom_transition:b,u_merc_center:T,u_cutoff_params:M,u_colorization_mix:zo(o.bG,U,$),u_colorization_offset:Cp(o.bG,G,$),u_color_ramp:j,u_texture_offset:[K/(Q+2*K),Q/(Q+2*K)],u_texture_res:[Q+2*K,Q+2*K],u_emissive_strength:J});function xu(u){u*=Math.PI/180;let r=Math.sin(u),a=Math.cos(u);return[(2*a+1)/3,(-Math.sqrt(3)*r-a+1)/3,(Math.sqrt(3)*r-a+1)/3]}let ji=.05,_d=(u,r,a,f,g,y,b,T,M,C,P,L)=>({u_matrix:u,u_normalize_matrix:r,u_globe_matrix:a,u_merc_matrix:f,u_grid_matrix:g,u_tl_parent:y,u_scale_parent:C,u_fade_t:P.mix,u_opacity:P.opacity,u_image0:0,u_image1:1,u_raster_elevation:L,u_zoom_transition:b,u_merc_center:T,u_cutoff_params:M}),yd=(u,r,a,f,g,y,b,T,M,C)=>({u_particle_texture:u,u_particle_texture_side_len:r,u_tile_offset:a,u_velocity:f,u_color_ramp:y,u_velocity_res:g,u_max_speed:b,u_uv_offset:T,u_data_scale:[255*M[0],255*M[1]],u_data_offset:C,u_particle_pos_scale:1.1,u_particle_pos_offset:[ji,ji]}),xd=(u,r,a,f,g,y,b,T,M,C)=>({u_particle_texture:u,u_particle_texture_side_len:r,u_velocity:a,u_velocity_res:f,u_max_speed:g,u_speed_factor:y,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:T,u_data_scale:[255*M[0],255*M[1]],u_data_offset:C,u_particle_pos_scale:1.1,u_particle_pos_offset:[ji,ji]}),Sp=o.ad.create(),Ti=(u,r,a,f,g,y,b,T,M,C,P,L,F,N,j,U,G,$)=>{let Q=g.transform,K={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:Q.getCameraToCenterDistance(U),u_rotate_symbol:+a,u_aspect_ratio:Q.width/Q.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:b,u_coord_matrix:T,u_is_text:+M,u_pitch_with_map:+f,u_texsize:C,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Sp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Sp,u_up_vector:[0,-1,0],u_color_adj_mat:G,u_icon_transition:$||0};return U.name==="globe"&&(K.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],K.u_zoom_transition=L,K.u_inv_rot_matrix=N,K.u_merc_center=F,K.u_camera_forward=Q._camera.forward(),K.u_ecef_origin=o.bH(Q.globeMatrix,P.toUnwrapped()),K.u_tile_matrix=Float32Array.from(Q.globeMatrix),K.u_up_vector=j),K},_s=(u,r,a,f,g,y,b,T,M,C,P,L,F,N,j,U,G)=>o.W(Ti(u,r,a,f,g,y,b,T,M,C,L,F,N,j,U,G),{u_gamma_scale:f?g.transform.getCameraToCenterDistance(G)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:o.e.devicePixelRatio,u_is_halo:+P,undefined:void 0}),Ap=(u,r,a,f,g,y,b,T,M,C,P,L,F,N,j,U)=>o.W(_s(u,r,a,f,g,y,b,T,!0,M,!0,P,L,F,N,j,U),{u_texsize_icon:C,u_texture_icon:1}),Pp=(u,r,a,f)=>({u_matrix:u,u_emissive_strength:r,u_opacity:a,u_color:f}),Bl=(u,r,a,f,g,y,b,T)=>o.W(function(M,C,P,L,F){let{width:N,height:j}=L.imageManager.getPixelSize(C),U=Math.pow(2,F.tileID.overscaledZ),G=F.tileSize*Math.pow(2,L.transform.tileZoom)/U,$=G*(F.tileID.canonical.x+F.tileID.wrap*U),Q=G*F.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[N,j],u_pattern_size:P.displaySize,u_tile_units_to_pixels:1/o.bB(F,1,L.transform.tileZoom),u_pixel_coord_upper:[$>>16,Q>>16],u_pixel_coord_lower:[65535&$,65535&Q]}}(0,y,b,f,T),{u_matrix:u,u_emissive_strength:r,u_opacity:a}),vu=new Float32Array(o.ad.identity([])),vd=(u,r,a,f,g,y,b,T,M,C,P,L,F,N=[0,0,0],j)=>{let U=g.style.light,G=U.properties.get("position"),$=[-G.x,-G.y,G.z],Q=o.bC.create();U.properties.get("anchor")==="viewport"&&(o.bC.fromRotation(Q,-g.transform.angle),o._.transformMat3($,$,Q));let K=P.alphaMode==="MASK",J=U.properties.get("color").toRenderColor(null),oe=F.paint.get("model-ambient-occlusion-intensity"),ie=F.paint.get("model-color").constantOr(o.C.white).toRenderColor(null),ce=F.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:u,u_lighting_matrix:r,u_normal_matrix:a,u_node_matrix:f||vu,u_lightpos:$,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_camera_pos:N,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+K,u_alphaCutoff:P.alphaCutoff,u_baseColorFactor:[b.r,b.g,b.b,b.a],u_emissiveFactor:[T[0],T[1],T[2],1],u_metallicFactor:M,u_roughnessFactor:C,u_baseColorTexture:rr.BaseColor,u_metallicRoughnessTexture:rr.MetallicRoughness,u_normalTexture:rr.Normal,u_occlusionTexture:rr.Occlusion,u_emissionTexture:rr.Emission,u_lutTexture:rr.LUT,u_color_mix:[ie.r,ie.g,ie.b,ce],u_aoIntensity:oe,u_emissive_strength:L,u_occlusionTextureTransform:j||[0,0,0,0]}},bu=(u,r=vu,a=vu)=>({u_matrix:u,u_instance:r,u_node_matrix:a}),X_=(u,r,a,f,g)=>({u_matrix:Float32Array.from(u),u_anchorPos:r,u_screenSizePx:a,u_occluderSizePx:f,u_color:g}),Rp={fillExtrusion:u=>({u_matrix:new o.a6(u),u_lightpos:new o.aq(u),u_lightintensity:new o.aa(u),u_lightcolor:new o.aq(u),u_vertical_gradient:new o.aa(u),u_opacity:new o.aa(u),u_edge_radius:new o.aa(u),u_ao:new o.a8(u),u_tile_id:new o.aq(u),u_zoom_transition:new o.aa(u),u_inv_rot_matrix:new o.a6(u),u_merc_center:new o.a8(u),u_up_dir:new o.aq(u),u_height_lift:new o.aa(u),u_flood_light_color:new o.aq(u),u_vertical_scale:new o.aa(u),u_flood_light_intensity:new o.aa(u),u_ground_shadow_factor:new o.aq(u),u_emissive_strength:new o.aa(u)}),fillExtrusionDepth:u=>({u_matrix:new o.a6(u),u_edge_radius:new o.aa(u),u_vertical_scale:new o.aa(u)}),fillExtrusionPattern:u=>({u_matrix:new o.a6(u),u_lightpos:new o.aq(u),u_lightintensity:new o.aa(u),u_lightcolor:new o.aq(u),u_vertical_gradient:new o.aa(u),u_height_factor:new o.aa(u),u_edge_radius:new o.aa(u),u_ao:new o.a8(u),u_tile_id:new o.aq(u),u_zoom_transition:new o.aa(u),u_inv_rot_matrix:new o.a6(u),u_merc_center:new o.a8(u),u_up_dir:new o.aq(u),u_height_lift:new o.aa(u),u_image:new o.a7(u),u_texsize:new o.a8(u),u_pixel_coord_upper:new o.a8(u),u_pixel_coord_lower:new o.a8(u),u_tile_units_to_pixels:new o.aa(u),u_opacity:new o.aa(u)}),fillExtrusionGroundEffect:u=>({u_matrix:new o.a6(u),u_opacity:new o.aa(u),u_ao_pass:new o.aa(u),u_meter_to_tile:new o.aa(u),u_ao:new o.a8(u),u_flood_light_intensity:new o.aa(u),u_flood_light_color:new o.aq(u),u_attenuation:new o.aa(u),u_edge_radius:new o.aa(u),u_fb:new o.a7(u),u_fb_size:new o.aa(u)}),fill:u=>({u_matrix:new o.a6(u),u_emissive_strength:new o.aa(u)}),fillPattern:u=>({u_matrix:new o.a6(u),u_emissive_strength:new o.aa(u),u_image:new o.a7(u),u_texsize:new o.a8(u),u_pixel_coord_upper:new o.a8(u),u_pixel_coord_lower:new o.a8(u),u_tile_units_to_pixels:new o.aa(u)}),fillOutline:u=>({u_matrix:new o.a6(u),u_emissive_strength:new o.aa(u),u_world:new o.a8(u)}),fillOutlinePattern:u=>({u_matrix:new o.a6(u),u_emissive_strength:new o.aa(u),u_world:new o.a8(u),u_image:new o.a7(u),u_texsize:new o.a8(u),u_pixel_coord_upper:new o.a8(u),u_pixel_coord_lower:new o.a8(u),u_tile_units_to_pixels:new o.aa(u)}),circle:o.bI,collisionBox:u=>({u_matrix:new o.a6(u),u_camera_to_center_distance:new o.aa(u),u_extrude_scale:new o.a8(u)}),collisionCircle:u=>({u_matrix:new o.a6(u),u_inv_matrix:new o.a6(u),u_camera_to_center_distance:new o.aa(u),u_viewport_size:new o.a8(u)}),debug:u=>({u_color:new o.a9(u),u_matrix:new o.a6(u),u_overlay:new o.a7(u),u_overlay_scale:new o.aa(u)}),clippingMask:u=>({u_matrix:new o.a6(u)}),heatmap:u=>({u_extrude_scale:new o.aa(u),u_intensity:new o.aa(u),u_matrix:new o.a6(u),u_inv_rot_matrix:new o.a6(u),u_merc_center:new o.a8(u),u_tile_id:new o.aq(u),u_zoom_transition:new o.aa(u),u_up_dir:new o.aq(u)}),heatmapTexture:u=>({u_image:new o.a7(u),u_color_ramp:new o.a7(u),u_opacity:new o.aa(u)}),hillshade:u=>({u_matrix:new o.a6(u),u_image:new o.a7(u),u_latrange:new o.a8(u),u_light:new o.a8(u),u_shadow:new o.a9(u),u_highlight:new o.a9(u),u_emissive_strength:new o.aa(u),u_accent:new o.a9(u)}),hillshadePrepare:u=>({u_matrix:new o.a6(u),u_image:new o.a7(u),u_dimension:new o.a8(u),u_zoom:new o.aa(u)}),line:o.bJ,linePattern:o.bK,raster:u=>({u_matrix:new o.a6(u),u_normalize_matrix:new o.a6(u),u_globe_matrix:new o.a6(u),u_merc_matrix:new o.a6(u),u_grid_matrix:new o.ar(u),u_tl_parent:new o.a8(u),u_scale_parent:new o.aa(u),u_fade_t:new o.aa(u),u_opacity:new o.aa(u),u_image0:new o.a7(u),u_image1:new o.a7(u),u_brightness_low:new o.aa(u),u_brightness_high:new o.aa(u),u_saturation_factor:new o.aa(u),u_contrast_factor:new o.aa(u),u_spin_weights:new o.aq(u),u_perspective_transform:new o.a8(u),u_raster_elevation:new o.aa(u),u_zoom_transition:new o.aa(u),u_merc_center:new o.a8(u),u_cutoff_params:new o.as(u),u_colorization_mix:new o.as(u),u_colorization_offset:new o.aa(u),u_color_ramp:new o.a7(u),u_texture_offset:new o.a8(u),u_texture_res:new o.a8(u),u_emissive_strength:new o.aa(u)}),rasterParticle:u=>({u_matrix:new o.a6(u),u_normalize_matrix:new o.a6(u),u_globe_matrix:new o.a6(u),u_merc_matrix:new o.a6(u),u_grid_matrix:new o.ar(u),u_tl_parent:new o.a8(u),u_scale_parent:new o.aa(u),u_fade_t:new o.aa(u),u_opacity:new o.aa(u),u_image0:new o.a7(u),u_image1:new o.a7(u),u_raster_elevation:new o.aa(u),u_zoom_transition:new o.aa(u),u_merc_center:new o.a8(u),u_cutoff_params:new o.as(u)}),rasterParticleTexture:u=>({u_texture:new o.a7(u),u_opacity:new o.aa(u)}),rasterParticleDraw:u=>({u_particle_texture:new o.a7(u),u_particle_texture_side_len:new o.aa(u),u_tile_offset:new o.a8(u),u_velocity:new o.a7(u),u_color_ramp:new o.a7(u),u_velocity_res:new o.a8(u),u_max_speed:new o.aa(u),u_uv_offset:new o.a8(u),u_data_scale:new o.a8(u),u_data_offset:new o.aa(u),u_particle_pos_scale:new o.aa(u),u_particle_pos_offset:new o.a8(u)}),rasterParticleUpdate:u=>({u_particle_texture:new o.a7(u),u_particle_texture_side_len:new o.aa(u),u_velocity:new o.a7(u),u_velocity_res:new o.a8(u),u_max_speed:new o.aa(u),u_speed_factor:new o.aa(u),u_reset_rate:new o.aa(u),u_rand_seed:new o.aa(u),u_uv_offset:new o.a8(u),u_data_scale:new o.a8(u),u_data_offset:new o.aa(u),u_particle_pos_scale:new o.aa(u),u_particle_pos_offset:new o.a8(u)}),symbolIcon:u=>({u_is_size_zoom_constant:new o.a7(u),u_is_size_feature_constant:new o.a7(u),u_size_t:new o.aa(u),u_size:new o.aa(u),u_camera_to_center_distance:new o.aa(u),u_rotate_symbol:new o.a7(u),u_aspect_ratio:new o.aa(u),u_fade_change:new o.aa(u),u_matrix:new o.a6(u),u_label_plane_matrix:new o.a6(u),u_coord_matrix:new o.a6(u),u_is_text:new o.a7(u),u_pitch_with_map:new o.a7(u),u_texsize:new o.a8(u),u_tile_id:new o.aq(u),u_zoom_transition:new o.aa(u),u_inv_rot_matrix:new o.a6(u),u_merc_center:new o.a8(u),u_camera_forward:new o.aq(u),u_tile_matrix:new o.a6(u),u_up_vector:new o.aq(u),u_ecef_origin:new o.aq(u),u_texture:new o.a7(u),u_icon_transition:new o.aa(u),u_color_adj_mat:new o.a6(u)}),symbolSDF:u=>({u_is_size_zoom_constant:new o.a7(u),u_is_size_feature_constant:new o.a7(u),u_size_t:new o.aa(u),u_size:new o.aa(u),u_camera_to_center_distance:new o.aa(u),u_rotate_symbol:new o.a7(u),u_aspect_ratio:new o.aa(u),u_fade_change:new o.aa(u),u_matrix:new o.a6(u),u_label_plane_matrix:new o.a6(u),u_coord_matrix:new o.a6(u),u_is_text:new o.a7(u),u_pitch_with_map:new o.a7(u),u_texsize:new o.a8(u),u_texture:new o.a7(u),u_gamma_scale:new o.aa(u),u_device_pixel_ratio:new o.aa(u),u_tile_id:new o.aq(u),u_zoom_transition:new o.aa(u),u_inv_rot_matrix:new o.a6(u),u_merc_center:new o.a8(u),u_camera_forward:new o.aq(u),u_tile_matrix:new o.a6(u),u_up_vector:new o.aq(u),u_ecef_origin:new o.aq(u),u_is_halo:new o.a7(u)}),symbolTextAndIcon:u=>({u_is_size_zoom_constant:new o.a7(u),u_is_size_feature_constant:new o.a7(u),u_size_t:new o.aa(u),u_size:new o.aa(u),u_camera_to_center_distance:new o.aa(u),u_rotate_symbol:new o.a7(u),u_aspect_ratio:new o.aa(u),u_fade_change:new o.aa(u),u_matrix:new o.a6(u),u_label_plane_matrix:new o.a6(u),u_coord_matrix:new o.a6(u),u_is_text:new o.a7(u),u_pitch_with_map:new o.a7(u),u_texsize:new o.a8(u),u_texsize_icon:new o.a8(u),u_texture:new o.a7(u),u_texture_icon:new o.a7(u),u_gamma_scale:new o.aa(u),u_device_pixel_ratio:new o.aa(u),u_is_halo:new o.a7(u)}),background:u=>({u_matrix:new o.a6(u),u_emissive_strength:new o.aa(u),u_opacity:new o.aa(u),u_color:new o.a9(u)}),backgroundPattern:u=>({u_matrix:new o.a6(u),u_emissive_strength:new o.aa(u),u_opacity:new o.aa(u),u_image:new o.a7(u),u_pattern_tl:new o.a8(u),u_pattern_br:new o.a8(u),u_texsize:new o.a8(u),u_pattern_size:new o.a8(u),u_pixel_coord_upper:new o.a8(u),u_pixel_coord_lower:new o.a8(u),u_tile_units_to_pixels:new o.aa(u)}),terrainRaster:u=>({u_matrix:new o.a6(u),u_image0:new o.a7(u),u_skirt_height:new o.aa(u),u_ground_shadow_factor:new o.aq(u)}),skybox:u=>({u_matrix:new o.a6(u),u_sun_direction:new o.aq(u),u_cubemap:new o.a7(u),u_opacity:new o.aa(u),u_temporal_offset:new o.aa(u)}),skyboxGradient:u=>({u_matrix:new o.a6(u),u_color_ramp:new o.a7(u),u_center_direction:new o.aq(u),u_radius:new o.aa(u),u_opacity:new o.aa(u),u_temporal_offset:new o.aa(u)}),skyboxCapture:u=>({u_matrix_3f:new o.ar(u),u_sun_direction:new o.aq(u),u_sun_intensity:new o.aa(u),u_color_tint_r:new o.as(u),u_color_tint_m:new o.as(u),u_luminance:new o.aa(u)}),globeRaster:u=>({u_proj_matrix:new o.a6(u),u_globe_matrix:new o.a6(u),u_normalize_matrix:new o.a6(u),u_merc_matrix:new o.a6(u),u_zoom_transition:new o.aa(u),u_merc_center:new o.a8(u),u_image0:new o.a7(u),u_grid_matrix:new o.ar(u),u_skirt_height:new o.aa(u),u_far_z_cutoff:new o.aa(u),u_frustum_tl:new o.aq(u),u_frustum_tr:new o.aq(u),u_frustum_br:new o.aq(u),u_frustum_bl:new o.aq(u),u_globe_pos:new o.aq(u),u_globe_radius:new o.aa(u),u_viewport:new o.a8(u)}),globeAtmosphere:u=>({u_frustum_tl:new o.aq(u),u_frustum_tr:new o.aq(u),u_frustum_br:new o.aq(u),u_frustum_bl:new o.aq(u),u_horizon:new o.aa(u),u_transition:new o.aa(u),u_fadeout_range:new o.aa(u),u_color:new o.as(u),u_high_color:new o.as(u),u_space_color:new o.as(u),u_temporal_offset:new o.aa(u),u_horizon_angle:new o.aa(u)}),model:u=>({u_matrix:new o.a6(u),u_lighting_matrix:new o.a6(u),u_normal_matrix:new o.a6(u),u_node_matrix:new o.a6(u),u_lightpos:new o.aq(u),u_lightintensity:new o.aa(u),u_lightcolor:new o.aq(u),u_camera_pos:new o.aq(u),u_opacity:new o.aa(u),u_baseColorFactor:new o.as(u),u_emissiveFactor:new o.as(u),u_metallicFactor:new o.aa(u),u_roughnessFactor:new o.aa(u),u_baseTextureIsAlpha:new o.a7(u),u_alphaMask:new o.a7(u),u_alphaCutoff:new o.aa(u),u_baseColorTexture:new o.a7(u),u_metallicRoughnessTexture:new o.a7(u),u_normalTexture:new o.a7(u),u_occlusionTexture:new o.a7(u),u_emissionTexture:new o.a7(u),u_lutTexture:new o.a7(u),u_color_mix:new o.as(u),u_aoIntensity:new o.aa(u),u_emissive_strength:new o.aa(u),u_occlusionTextureTransform:new o.as(u)}),modelDepth:u=>({u_matrix:new o.a6(u),u_instance:new o.a6(u),u_node_matrix:new o.a6(u)}),groundShadow:u=>({u_matrix:new o.a6(u),u_ground_shadow_factor:new o.aq(u)}),stars:u=>({u_matrix:new o.a6(u),u_up:new o.aq(u),u_right:new o.aq(u),u_intensity_multiplier:new o.aa(u)}),occlusion:u=>({u_matrix:new o.a6(u),u_anchorPos:new o.aq(u),u_screenSizePx:new o.a8(u),u_occluderSizePx:new o.a8(u),u_color:new o.as(u)})};function bd(u,r,a){let f=r.createTileMatrix(u,u.worldSize,a.toUnwrapped());return o.ad.multiply(new Float32Array(16),u.projMatrix,f)}function Lp(u,r,a){if(r.projection.name===a.projection.name)return u.projMatrix;let f=a.clone();return f.setProjection(r.projection),bd(f,r.getProjection(),u)}function wu(u,r,a){return r.name===a.projection.name?u.projMatrix:bd(a,r,u)}let _a;function Op(u,r,a,f,g,y,b){let T=u.context,M=T.gl,C=u.transform,P=u.getOrCreateProgram("collisionBox"),L=[],F=0,N=0;for(let J=0;J<f.length;J++){let oe=f[J],ie=r.getTile(oe),ce=ie.getBucket(a);if(!ce)continue;let q=Lp(oe,ce,C),ee=q;g[0]===0&&g[1]===0||(ee=u.translatePosMatrix(q,ie,g,y));let he=b?ce.textCollisionBox:ce.iconCollisionBox,we=ce.collisionCircleArray;if(we.length>0){let pe=o.ad.create(),ae=ee;o.ad.mul(pe,ce.placementInvProjMatrix,C.glCoordMatrix),o.ad.mul(pe,pe,ce.placementViewportMatrix),L.push({circleArray:we,circleOffset:N,transform:ae,invTransform:pe,projection:ce.getProjection()}),F+=we.length/4,N=F}he&&(u.terrain&&u.terrain.setupElevationDraw(ie,P),P.draw(u,M.LINES,o.ae.disabled,o.ag.disabled,u.colorModeForRenderPass(),o.af.disabled,_u(ee,C,ie,ce.getProjection()),a.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,null,C.zoom,null,[he.collisionVertexBuffer,he.collisionVertexBufferExt]))}if(!b||!L.length)return;let j=u.getOrCreateProgram("collisionCircle"),U=new o.bL;U.resize(4*F),U._trim();let G=0;for(let J of L)for(let oe=0;oe<J.circleArray.length/4;oe++){let ie=4*oe,ce=J.circleArray[ie+0],q=J.circleArray[ie+1],ee=J.circleArray[ie+2],he=J.circleArray[ie+3];U.emplace(G++,ce,q,ee,he,0),U.emplace(G++,ce,q,ee,he,1),U.emplace(G++,ce,q,ee,he,2),U.emplace(G++,ce,q,ee,he,3)}(!_a||_a.length<2*F)&&(_a=function(J){let oe=2*J,ie=new o.bu;ie.resize(oe),ie._trim();for(let ce=0;ce<oe;ce++){let q=6*ce;ie.uint16[q+0]=4*ce+0,ie.uint16[q+1]=4*ce+1,ie.uint16[q+2]=4*ce+2,ie.uint16[q+3]=4*ce+2,ie.uint16[q+4]=4*ce+3,ie.uint16[q+5]=4*ce+0}return ie}(F));let $=T.createIndexBuffer(_a,!0),Q=T.createVertexBuffer(U,o.bM.members,!0);for(let J of L){let oe={u_matrix:J.transform,u_inv_matrix:J.invTransform,u_camera_to_center_distance:(K=C).getCameraToCenterDistance(J.projection),u_viewport_size:[K.width,K.height]};j.draw(u,M.TRIANGLES,o.ae.disabled,o.ag.disabled,u.colorModeForRenderPass(),o.af.disabled,oe,a.id,Q,$,o.b.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,C.zoom)}var K;Q.destroy(),$.destroy()}let ys=o.ad.create();function Vl(u){let r=u._camera.getWorldToCamera(u.worldSize,1),a=o.ad.multiply([],r,u.globeMatrix);o.ad.invert(a,a);let f=[0,0,0],g=[0,1,0,0];return o.aA.transformMat4(g,g,a),f[0]=g[0],f[1]=g[1],f[2]=g[2],o._.normalize(f,f),f}function Y_({width:u,height:r,anchor:a,textOffset:f,textScale:g},y){let{horizontalAlign:b,verticalAlign:T}=o.bQ(a),M=-(b-.5)*u,C=-(T-.5)*r,P=o.bP(a,f);return new o.P((M/g+P[0])*y,(C/g+P[1])*y)}function Q_(u,r,a,f,g,y,b,T,M,C,P){let L=u.text.placedSymbolArray,F=u.text.dynamicLayoutVertexArray,N=u.icon.dynamicLayoutVertexArray,j={},U=u.getProjection(),G=wu(T,U,y),$=y.elevation,Q=U.upVectorScale(T.canonical,y.center.lat,y.worldSize).metersToTile;F.clear();for(let K=0;K<L.length;K++){let J=L.get(K),{tileAnchorX:oe,tileAnchorY:ie,numGlyphs:ce}=J,q=J.hidden||!J.crossTileID||u.allowVerticalPlacement&&!J.placedOrientation?null:f[J.crossTileID];if(q){let ee=0,he=0,we=0;if($){let Re=$?$.getAtTileOffset(T,oe,ie):0,[Qe,Ke,nt]=U.upVector(T.canonical,oe,ie);ee=Re*Qe*Q,he=Re*Ke*Q,we=Re*nt*Q}let[pe,ae,Ee,Fe]=$r(J.projectedAnchorX+ee,J.projectedAnchorY+he,J.projectedAnchorZ+we,a?G:b),ze=td(y.getCameraToCenterDistance(U),Fe),ke=g.evaluateSizeForFeature(u.textSizeData,C,J)*ze/o.bN;a&&(ke*=u.tilePixelRatio/M);let _e=Y_(q,ke);a?({x:pe,y:ae,z:Ee}=U.projectTilePoint(oe+_e.x,ie+_e.y,T.canonical),[pe,ae,Ee]=$r(pe+ee,ae+he,Ee+we,b)):(r&&_e._rotate(-y.angle),pe+=_e.x,ae+=_e.y,Ee=0);let De=u.allowVerticalPlacement&&J.placedOrientation===o.aE.vertical?Math.PI/2:0;for(let Re=0;Re<ce;Re++)o.aH(F,pe,ae,Ee,De);P&&J.associatedIconIndex>=0&&(j[J.associatedIconIndex]={x:pe,y:ae,z:Ee,angle:De})}else Fo(ce,F)}if(P){N.clear();let K=u.icon.placedSymbolArray;for(let J=0;J<K.length;J++){let oe=K.get(J),{numGlyphs:ie}=oe,ce=j[J];if(oe.hidden||!ce)Fo(ie,N);else{let{x:q,y:ee,z:he,angle:we}=ce;for(let pe=0;pe<ie;pe++)o.aH(N,q,ee,he,we)}}u.icon.dynamicLayoutVertexBuffer.updateData(N)}u.text.dynamicLayoutVertexBuffer.updateData(F)}function Tu(u,r,a,f,g,y,b={}){let T=a.paint.get("icon-translate"),M=a.paint.get("text-translate"),C=a.paint.get("icon-translate-anchor"),P=a.paint.get("text-translate-anchor"),L=a.layout.get("icon-rotation-alignment"),F=a.layout.get("text-rotation-alignment"),N=a.layout.get("icon-pitch-alignment"),j=a.layout.get("text-pitch-alignment"),U=a.layout.get("icon-keep-upright"),G=a.layout.get("text-keep-upright"),$=a.paint.get("icon-color-saturation"),Q=a.paint.get("icon-color-contrast"),K=a.paint.get("icon-color-brightness-min"),J=a.paint.get("icon-color-brightness-max"),oe=a.paint.get("icon-occlusion-opacity").constantOr(0),ie=a.paint.get("text-occlusion-opacity").constantOr(0),ce=u.context,q=ce.gl,ee=u.transform,he=L==="map",we=F==="map",pe=N==="map",ae=j==="map",Ee=oe!==1,Fe=ie!==1,ze=a.layout.get("symbol-sort-key").constantOr(1)!==void 0,ke=!1,_e=u.depthModeForSublayer(0,o.ae.ReadOnly),De=[o.aj(ee.center.lng),o.ak(ee.center.lat)],Re=a.layout.get("text-variable-anchor"),Qe=ee.projection.name==="globe",Ke=[],nt=[0,-1,0];for(let Je of f){let Ze=r.getTile(Je),Ae=Ze.getBucket(a);if(!Ae||Ae.projection.name==="mercator"&&Qe||Ae.fullyClipped)continue;let at=Ae.projection.name==="globe",Lt=at?o.a1(ee.zoom):0,gt=wu(Je,Ae.getProjection(),ee),It=ee.calculatePixelsToTileUnitsMatrix(Ze),Gt=Re&&Ae.hasTextData(),Ln=Ae.hasIconTextFit()&&Gt&&Ae.hasIconData(),Bt=Ae.getProjection().createInversionMatrix(ee,Je.canonical),vt=()=>{let Mn=he&&a.layout.get("symbol-placement")!=="point",Oe=[];a.hasInitialOcclusionOpacityProperties&&Ee&&u.symbolParams.useOcclusionQueries&&!at&&!Qe&&Oe.push("OCCLUSION_QUERIES"),a.hasInitialOcclusionOpacityProperties||Oe.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH");let it=Mn||Ln,dr=a.paint.get("icon-image-cross-fade").constantOr(0);u.terrainRenderModeElevated()&&pe&&Oe.push("PITCH_WITH_MAP_TERRAIN"),at&&(Oe.push("PROJECTION_GLOBE_VIEW"),it&&Oe.push("PROJECTED_POS_ON_VIEWPORT")),dr>0&&Oe.push("ICON_TRANSITION"),Ae.icon.zOffsetVertexBuffer&&Oe.push("Z_OFFSET"),Oe.push("TERRAIN_DEPTH_D24"),$===0&&Q===0&&K===0&&J===1||Oe.push("COLOR_ADJUSTMENT");let ln=Ae.icon.programConfigurations.get(a.id),be=u.getOrCreateProgram(Ae.sdfIcons?"symbolSDF":"symbolIcon",{config:ln,defines:Oe}),Or,Ir=Ze.imageAtlasTexture?Ze.imageAtlasTexture.size:[0,0],fr=Ae.iconSizeData,Dr=o.aD(fr,ee.zoom),Ai=pe||ee.pitch!==0,ao=St(gt,Ze.tileID.canonical,pe,he,ee,Ae.getProjection(),It),ri=ds(gt,Ze.tileID.canonical,pe,he,ee,Ae.getProjection(),It),jo=u.translatePosMatrix(ri,Ze,T,C,!0),Uo=u.translatePosMatrix(gt,Ze,T,C),Go=it?ys:ao,qi=he&&!pe&&!Mn,As=nt;!Qe&&!ee.mercatorFromTransition||he||(As=Vl(ee));let La=at?As:nt;if(Ae.sdfIcons&&!Ae.iconsInText)Or=_s(fr.kind,Dr,qi,pe,u,Uo,Go,jo,!1,Ir,!0,Je,Lt,De,Bt,La,Ae.getProjection());else{let Ps=a.getColorAdjustmentMatrix($,Q,K,J);Or=Ti(fr.kind,Dr,qi,pe,u,Uo,Go,jo,!1,Ir,Je,Lt,De,Bt,La,Ae.getProjection(),Ps,dr)}let sc=Ze.imageAtlasTexture?Ze.imageAtlasTexture:null,Oa=a.layout.get("icon-size").constantOr(0)!==1||Ae.iconsNeedLinear,ka=Ae.sdfIcons||u.options.rotating||u.options.zooming||Oa||Ai?q.LINEAR:q.NEAREST,Uu=Ae.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,Gu=u.terrain&&pe&&Mn?o.ad.invert(o.ad.create(),ao):ys;if(Mn&&Ae.icon){let Ps=ee.elevation,Mr=Ps?Ps.getAtTileOffsetFunc(Je,ee.center.lat,ee.worldSize,Ae.getProjection()):null,sf=Rl(gt,Ze.tileID.canonical,pe,he,ee,Ae.getProjection(),It);wp(Ae,gt,u,!1,sf,ri,pe,U,Mr,Je)}return{program:be,buffers:Ae.icon,uniformValues:Or,atlasTexture:sc,atlasTextureIcon:null,atlasInterpolation:ka,atlasInterpolationIcon:null,isSDF:Ae.sdfIcons,hasHalo:Uu,tile:Ze,labelPlaneMatrixInv:Gu}},wn=()=>{let Mn=we&&a.layout.get("symbol-placement")!=="point",Oe=[],it=Mn||Re||Ln;a.hasInitialOcclusionOpacityProperties&&Fe&&u.symbolParams.useOcclusionQueries&&!at&&!Qe&&Oe.push("OCCLUSION_QUERIES"),a.hasInitialOcclusionOpacityProperties||Oe.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH"),u.terrainRenderModeElevated()&&ae&&Oe.push("PITCH_WITH_MAP_TERRAIN"),at&&(Oe.push("PROJECTION_GLOBE_VIEW"),it&&Oe.push("PROJECTED_POS_ON_VIEWPORT")),Ae.text.zOffsetVertexBuffer&&Oe.push("Z_OFFSET"),Oe.push("TERRAIN_DEPTH_D24");let dr=Ae.text.programConfigurations.get(a.id),ln=u.getOrCreateProgram(Ae.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:dr,defines:Oe}),be,Or=[0,0],Ir=null,fr=Ae.textSizeData;Ae.iconsInText&&(Or=Ze.imageAtlasTexture?Ze.imageAtlasTexture.size:[0,0],Ir=Ze.imageAtlasTexture?Ze.imageAtlasTexture:null,be=ae||ee.pitch!==0||u.options.rotating||u.options.zooming||fr.kind==="composite"||fr.kind==="camera"?q.LINEAR:q.NEAREST);let Dr=Ze.glyphAtlasTexture?Ze.glyphAtlasTexture.size:[0,0],Ai=o.aD(fr,ee.zoom),ao=St(gt,Ze.tileID.canonical,ae,we,ee,Ae.getProjection(),It),ri=ds(gt,Ze.tileID.canonical,ae,we,ee,Ae.getProjection(),It),jo=u.translatePosMatrix(ri,Ze,M,P,!0),Uo=u.translatePosMatrix(gt,Ze,M,P),Go=it?ys:ao,qi=we&&!ae&&!Mn,As=nt;!Qe&&!ee.mercatorFromTransition||we||(As=Vl(ee));let La=at?As:nt,sc;sc=Ae.iconsInText?Ap(fr.kind,Ai,qi,ae,u,Uo,Go,jo,Dr,Or,Je,Lt,De,Bt,La,Ae.getProjection()):_s(fr.kind,Ai,qi,ae,u,Uo,Go,jo,!0,Dr,!0,Je,Lt,De,Bt,La,Ae.getProjection());let Oa=Ze.glyphAtlasTexture?Ze.glyphAtlasTexture:null,ka=q.LINEAR,Uu=a.paint.get("text-halo-width").constantOr(1)!==0,Gu=u.terrain&&ae&&Mn?o.ad.invert(o.ad.create(),ao):ys;if(Mn&&Ae.text){let Ps=ee.elevation,Mr=Ps?Ps.getAtTileOffsetFunc(Je,ee.center.lat,ee.worldSize,Ae.getProjection()):null,sf=Rl(gt,Ze.tileID.canonical,ae,we,ee,Ae.getProjection(),It);wp(Ae,gt,u,!0,sf,ri,ae,G,Mr,Je)}return{program:ln,buffers:Ae.text,uniformValues:sc,atlasTexture:Oa,atlasTextureIcon:Ir,atlasInterpolation:ka,atlasInterpolationIcon:be,isSDF:!0,hasHalo:Uu,tile:Ze,labelPlaneMatrixInv:Gu}},dn=Ae.icon.segments.get().length,$t=Ae.text.segments.get().length,Dt=dn&&!b.onlyText?vt():null,Dn=$t&&!b.onlyIcons?wn():null,Xn=a.paint.get("icon-opacity").constantOr(1),gn=a.paint.get("text-opacity").constantOr(1);if(ze&&Ae.canOverlap){ke=!0;let Mn=Xn&&!b.onlyText?Ae.icon.segments.get():[],Oe=gn&&!b.onlyIcons?Ae.text.segments.get():[];for(let it of Mn)Ke.push({segments:new o.b([it]),sortKey:it.sortKey,state:Dt});for(let it of Oe)Ke.push({segments:new o.b([it]),sortKey:it.sortKey,state:Dn})}else b.onlyText||Ke.push({segments:Xn?Ae.icon.segments:new o.b([]),sortKey:0,state:Dt}),b.onlyIcons||Ke.push({segments:gn?Ae.text.segments:new o.b([]),sortKey:0,state:Dn})}ke&&Ke.sort((Je,Ze)=>Je.sortKey-Ze.sortKey);for(let Je of Ke){let Ze=Je.state;if(Ze)if(u.terrain&&u.terrain.setupElevationDraw(Ze.tile,Ze.program,{useDepthForOcclusion:!a.hasInitialOcclusionOpacityProperties&&ee.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ze.labelPlaneMatrixInv}),ce.activeTexture.set(q.TEXTURE0),Ze.atlasTexture&&Ze.atlasTexture.bind(Ze.atlasInterpolation,q.CLAMP_TO_EDGE,!0),Ze.atlasTextureIcon&&(ce.activeTexture.set(q.TEXTURE1),Ze.atlasTextureIcon&&Ze.atlasTextureIcon.bind(Ze.atlasInterpolationIcon,q.CLAMP_TO_EDGE,!0)),u.uploadCommonLightUniforms(u.context,Ze.program),Ze.hasHalo){let Ae=Ze.uniformValues;Ae.u_is_halo=1,wd(Ze.buffers,Je.segments,a,u,Ze.program,_e,g,y,Ae,2),Ae.u_is_halo=0}else{if(Ze.isSDF){let Ae=Ze.uniformValues;Ze.hasHalo&&(Ae.u_is_halo=1,wd(Ze.buffers,Je.segments,a,u,Ze.program,_e,g,y,Ae,1)),Ae.u_is_halo=0}wd(Ze.buffers,Je.segments,a,u,Ze.program,_e,g,y,Ze.uniformValues,1)}}}function wd(u,r,a,f,g,y,b,T,M,C){let P=f.context.gl,L=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.iconTransitioningVertexBuffer,u.globeExtVertexBuffer,u.zOffsetVertexBuffer];u.occlusionQueryOpacityVertexBuffer.length>0&&L.push(u.occlusionQueryOpacityVertexBuffer),g.draw(f,P.TRIANGLES,y,b,T,o.af.disabled,M,a.id,u.layoutVertexBuffer,u.indexBuffer,r,a.paint,f.transform.zoom,u.programConfigurations.get(a.id),L,C)}function jl(u,r,a,f,g,y,b){let T=u.context.gl,M=a.paint.get("fill-pattern"),C=M&&M.constantOr(1),P,L,F,N,j;b?(L=C&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",P=T.LINES):(L=C?"fillPattern":"fill",P=T.TRIANGLES);for(let U of f){let G=r.getTile(U);if(C&&!G.patternsLoaded())continue;let $=G.getBucket(a);if(!$)continue;u.prepareDrawTile();let Q=$.programConfigurations.get(a.id),K=u.isTileAffectedByFog(U),J=u.getOrCreateProgram(L,{config:Q,overrideFog:K});C&&(u.context.activeTexture.set(T.TEXTURE0),G.imageAtlasTexture&&G.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Q.updatePaintBuffers());let oe=M.constantOr(null);if(oe&&G.imageAtlas){let q=G.imageAtlas.patternPositions[oe.toString()];q&&Q.setConstantPatternPositions(q)}let ie=u.translatePosMatrix(U.projMatrix,G,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),ce=a.paint.get("fill-emissive-strength");if(b){N=$.indexBuffer2,j=$.segments2;let q=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];F=L==="fillOutlinePattern"&&C?Mp(ie,ce,u,G,q):Dp(ie,ce,q)}else N=$.indexBuffer,j=$.segments,F=C?pd(ie,ce,u,G):gu(ie,ce);u.uploadCommonUniforms(u.context,J,U.toUnwrapped()),J.draw(u,P,g,u.stencilModeForClipping(U),y,o.af.disabled,F,a.id,$.layoutVertexBuffer,N,j,a.paint,u.transform.zoom,Q,void 0)}}function ei(u,r,a,f,g,y,b,T){a.resetLayerRenderingStats(u);let M=u.context,C=M.gl,P=u.transform,L=a.paint.get("fill-extrusion-pattern"),F=L.constantOr(1),N=a.paint.get("fill-extrusion-opacity"),j=u.style.enable3dLights(),U=a.paint.get(j&&!F?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),G=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),U],$=a.layout.get("fill-extrusion-edge-radius"),Q=$>0&&!a.paint.get("fill-extrusion-rounded-roof"),K=Q?0:$,J=P.projection.name==="globe"?o.bY():0,oe=P.projection.name==="globe",ie=oe?o.a1(P.zoom):0,ce=[o.aj(P.center.lng),o.ak(P.center.lat)],q=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(a.lut).toArray01().slice(0,3),ee=a.paint.get("fill-extrusion-flood-light-intensity"),he=a.paint.get("fill-extrusion-vertical-scale"),we=ps(u,a.paint.get("fill-extrusion-cutoff-fade-range")),pe=a.paint.get("fill-extrusion-emissive-strength"),ae=[],Ee;oe&&ae.push("PROJECTION_GLOBE_VIEW"),G[0]>0&&ae.push("FAUX_AO"),Q&&ae.push("ZERO_ROOF_RADIUS"),T&&ae.push("HAS_CENTROID"),ee>0&&ae.push("FLOOD_LIGHT"),we.shouldRenderCutoff&&ae.push("RENDER_CUTOFF");let Fe=u.renderPass==="shadow",ze=u.shadowRenderer,ke=Fe&&!!ze;u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0);let _e=[0,0,0];if(ze){let Qe=u.style.directionalLight,Ke=u.style.ambientLight;Qe&&Ke&&(_e=fa(u.style,Qe,Ke)),Ee=ae.concat(["SHADOWS_SINGLE_CASCADE"])}let De=ke?"fillExtrusionDepth":F?"fillExtrusionPattern":"fillExtrusion",Re=a.getLayerRenderingStats();for(let Qe of f){let Ke=r.getTile(Qe),nt=Ke.getBucket(a);if(!nt||nt.projection.name!==P.projection.name)continue;let Je=!1;ze&&(Je=ze.getMaxCascadeForTile(Qe.toUnwrapped())===0);let Ze=u.isTileAffectedByFog(Qe),Ae=nt.programConfigurations.get(a.id),at=u.getOrCreateProgram(De,{config:Ae,defines:Je?Ee:ae,overrideFog:Ze});if(u.terrain&&u.terrain.setupElevationDraw(Ke,at,{useMeterToDem:!0}),!nt.centroidVertexBuffer){let Bt=at.attributes.a_centroid_pos;Bt!==void 0&&C.vertexAttrib2f(Bt,0,0)}!Fe&&ze&&ze.setupShadows(Ke.tileID.toUnwrapped(),at,"vector-tile",Ke.tileID.overscaledZ),F&&(u.context.activeTexture.set(C.TEXTURE0),Ke.imageAtlasTexture&&Ke.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),Ae.updatePaintBuffers());let Lt=L.constantOr(null);if(Lt&&Ke.imageAtlas){let Bt=Ke.imageAtlas.patternPositions[Lt.toString()];Bt&&Ae.setConstantPatternPositions(Bt)}let gt=a.paint.get("fill-extrusion-vertical-gradient"),It;if(Fe&&ze){if(Eu(Ke.tileID,nt,u))continue;let Bt=ze.calculateShadowPassMatrixFromTile(Ke.tileID.toUnwrapped());It=Nl(Bt,K,he)}else{let Bt=u.translatePosMatrix(Qe.expandedProjMatrix,Ke,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),vt=P.projection.createInversionMatrix(P,Qe.canonical);It=F?ga(Bt,u,gt,N,G,K,Qe,Ke,J,ie,ce,vt,q,he):Fl(Bt,u,gt,N,G,K,Qe,J,ie,ce,vt,q,he,ee,_e,pe)}u.uploadCommonUniforms(M,at,Qe.toUnwrapped(),null,we);let Gt=nt.segments;if(P.projection.name==="mercator"&&!Fe&&(Gt=nt.getVisibleSegments(Ke.tileID,u.terrain,u.transform.getFrustum(0)),!Gt.get().length))continue;if(Re)if(Fe)for(let Bt of Gt.get())Re.numRenderedVerticesInShadowPass+=Bt.primitiveLength;else for(let Bt of Gt.get())Re.numRenderedVerticesInTransparentPass+=Bt.primitiveLength;let Ln=[];(u.terrain||T)&&Ln.push(nt.centroidVertexBuffer),oe&&Ln.push(nt.layoutVertexExtBuffer),at.draw(u,M.gl.TRIANGLES,g,y,b,o.af.backCCW,It,a.id,nt.layoutVertexBuffer,nt.indexBuffer,Gt,a.paint,u.transform.zoom,Ae,Ln)}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1)}function ro(u,r,a,f,g,y,b,T,M,C,P,L,F,N,j,U,G,$,Q){let K=u.context,J=K.gl,oe=u.transform,ie=u.transform.zoom,ce=[],q=ps(u,a.paint.get("fill-extrusion-cutoff-fade-range"));C==="clear"?(ce.push("CLEAR_SUBPASS"),Q&&(ce.push("CLEAR_FROM_TEXTURE"),K.activeTexture.set(J.TEXTURE0),Q.bind(J.LINEAR,J.CLAMP_TO_EDGE))):C==="sdf"&&ce.push("SDF_SUBPASS"),G&&ce.push("HAS_CENTROID"),q.shouldRenderCutoff&&ce.push("RENDER_CUTOFF");let ee=a.layout.get("fill-extrusion-edge-radius"),he=(we,pe,ae,Ee,Fe)=>{let ze=pe.programConfigurations.get(a.id),ke=u.isTileAffectedByFog(we),_e=u.getOrCreateProgram("fillExtrusionGroundEffect",{config:ze,defines:ce,overrideFog:ke}),De=((Qe,Ke,nt,Je,Ze,Ae,at,Lt,gt,It,Gt)=>({u_matrix:Ke,u_opacity:nt,u_ao_pass:Je?1:0,u_meter_to_tile:Ze,u_ao:Ae,u_flood_light_intensity:at,u_flood_light_color:Lt,u_attenuation:gt,u_edge_radius:It,u_fb:0,u_fb_size:Gt}))(0,Ee,P,M,Fe,[L,F*Fe],N,j,U,ie>=17?0:ee*Fe,Q?Q.size[0]:0),Re=[];G&&Re.push(pe.hiddenByLandmarkVertexBuffer),u.uploadCommonUniforms(K,_e,we.toUnwrapped(),null,q),_e.draw(u,K.gl.TRIANGLES,g,y,b,T,De,a.id,pe.vertexBuffer,pe.indexBuffer,ae,a.paint,ie,ze,Re)};for(let we of f){let pe=r.getTile(we),ae=pe.getBucket(a);if(!ae||ae.projection.name!==oe.projection.name||!ae.groundEffect||ae.groundEffect&&!ae.groundEffect.hasData())continue;let Ee=ae.groundEffect,Fe=1/ae.tileToMeter;{let ze=u.translatePosMatrix(we.projMatrix,pe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ke=Ee.getDefaultSegment();he(we,Ee,ke,ze,Fe)}if($)for(let ze=0;ze<4;ze++){let ke=o.bZ[ze](we),_e=r.getTile(ke);if(!_e)continue;let De=_e.getBucket(a);if(!De||De.projection.name!==oe.projection.name||!De.groundEffect||De.groundEffect&&!De.groundEffect.hasData())continue;let Re=De.groundEffect,Qe,Ke;ze===0?(Qe=[-o.a3,0,0],Ke=1):ze===1?(Qe=[o.a3,0,0],Ke=0):ze===2?(Qe=[0,-o.a3,0],Ke=3):(Qe=[0,o.a3,0],Ke=2);let nt=Re.regionSegments[Ke];if(!nt)continue;let Je=new Float32Array(16);o.ad.translate(Je,we.projMatrix,Qe),he(we,Re,nt,u.translatePosMatrix(Je,pe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Fe)}}}function kp(u,r,a,f,g,y,b){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();let T=y?y.findDEMTileFor(a):null;if(!(T&&T.dem||b))return;let M=$=>new o.P(Math.ceil(($+o.c0)*o.c1),0),C=$=>{let Q=r.getSource().minzoom,K=oe=>{let ie=r.getTileByID(oe);if(ie&&ie.hasData())return ie.getBucket(g)},J=[0,-1,1];for(let oe of J){if($.overscaledZ+oe<Q)continue;let ie=K($.calculateScaledKey($.overscaledZ+oe));if(ie)return ie}},P=[0,0,0],L=($,Q)=>(P[0]=Math.min($.min.y,Q.min.y),P[1]=Math.max($.max.y,Q.max.y),P[2]=o.a3-Q.min.x>$.max.x?Q.min.x-o.a3:$.max.x,P),F=($,Q)=>(P[0]=Math.min($.min.x,Q.min.x),P[1]=Math.max($.max.x,Q.max.x),P[2]=o.a3-Q.min.y>$.max.y?Q.min.y-o.a3:$.max.y,P),N=[($,Q)=>L($,Q),($,Q)=>L(Q,$),($,Q)=>F($,Q),($,Q)=>F(Q,$)],j=($,Q,K,J,oe,ie,ce)=>{if(!y)return 0;let q=[[ie?K:$,ie?$:K,0],[ie?K:Q,ie?Q:K,0]],ee=ce<0?o.a3+ce:ce,he=[ie?ee:($+Q)/2,ie?($+Q)/2:ee,0];return K===0&&ce<0||K!==0&&ce>0?y.getForTilePoints(oe,[he],!0,J):q.push(he),y.getForTilePoints(a,q,!0,T),Math.max(q[0][2],q[1][2],he[2])/y.exaggeration()};for(let $=0;$<4;$++){let Q=f.borderFeatureIndices[$];if(Q.length===0)continue;let K=o.bZ[$](a),J=C(K);if(!(J&&J instanceof o.b_)||f.borderDoneWithNeighborZ[$]===J.canonical.z)continue;J.centroidVertexArray.length===0&&J.createCentroidsBuffer();let oe=y?y.findDEMTileFor(K):null;if(!(oe&&oe.dem||b))continue;let ie=($<2?1:5)-$,ce=J.borderDoneWithNeighborZ[ie]!==f.canonical.z,q=J.borderFeatureIndices[ie],ee=0;if(f.canonical.z!==J.canonical.z){for(let he of Q)f.showCentroid(f.featuresOnBorder[he]);if(ce)for(let he of q)J.showCentroid(J.featuresOnBorder[he]);f.borderDoneWithNeighborZ[$]=J.canonical.z,J.borderDoneWithNeighborZ[ie]=f.canonical.z}for(let he of Q){let we=f.featuresOnBorder[he],pe=f.centroidData[we.centroidDataIndex],ae=we.borders[$],Ee;for(;ee<q.length;){Ee=J.featuresOnBorder[q[ee]];let Fe=Ee.borders[ie];if(Fe[1]>ae[0]+3||Fe[0]>ae[0]-3)break;J.showCentroid(Ee),ee++}if(Ee&&ee<q.length){let Fe=ee,ze=0;for(;!(Ee.borders[ie][0]>ae[1]-3)&&(ze++,++ee!==q.length);)Ee=J.featuresOnBorder[q[ee]];if(Ee=J.featuresOnBorder[q[Fe]],ze>1){let De=Ee.borders[ie];Math.abs(ae[0]-De[0])<3&&Math.abs(ae[1]-De[1])<3&&(ze=1,ee=Fe+1)}else if(ze===0){f.showCentroid(we);continue}let ke=J.centroidData[Ee.centroidDataIndex];b&&ze===1&&(((U=pe).flags|(G=ke).flags)&o.b$?(U.flags|=o.b$,G.flags|=o.b$):(U.flags&=~o.b$,G.flags&=~o.b$));let _e=we.intersectsCount()>1||Ee.intersectsCount()>1;if(ze>1)ee=Fe,pe.centroidXY=ke.centroidXY=new o.P(0,0);else if(oe&&oe.dem&&!_e){let De=N[$](pe,ke),Re=$%2?o.a3-1:0,Qe=j(De[0],Math.min(o.a3-1,De[1]),Re,oe,K,$<2,De[2]);pe.centroidXY=ke.centroidXY=M(Qe)}else _e?pe.centroidXY=ke.centroidXY=new o.P(0,0):(pe.centroidXY=f.encodeBorderCentroid(we),ke.centroidXY=J.encodeBorderCentroid(Ee));f.writeCentroidToBuffer(pe),J.writeCentroidToBuffer(ke)}else f.showCentroid(we)}f.borderDoneWithNeighborZ[$]=J.canonical.z,J.borderDoneWithNeighborZ[ie]=f.canonical.z}var U,G;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(u)}let Td=[1,0,0],xs=[0,1,0],Fp=[0,0,1];function Eu(u,r,a){let f=a.transform,g=a.shadowRenderer;if(!g)return!0;let y=u.toUnwrapped(),b=f.tileSize*g._cascades[a.currentShadowCascade].scale,T=r.maxHeight;if(f.elevation){let U=f.elevation.getMinMaxForTile(u);U&&(T+=U.max)}let M=[...g.shadowDirection];M[2]=-M[2];let C=g.computeSimplifiedTileShadowVolume(y,T,b,M);if(!C)return!1;let P=[Td,xs,Fp,M,[M[0],0,M[2]],[0,M[1],M[2]]],L=f.projection.name==="globe",F=f.scaleZoom(b),N=o.aM.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,F,!L),j=g.getCurrentCascadeFrustum();return N.intersectsPrecise(C.vertices,C.planes,P)===0||j.intersectsPrecise(C.vertices,C.planes,P)===0}function Iu(u){return[u[0]*o.c2,u[1]*o.c2,u[2]*o.c2,0]}function ya(u,r,a,f,g,y,b,T,M){let C=f.getSource(),P=a.globeSharedBuffers;if(!P)return;let L,F,N;if(r&&(L=f.getTile(r)),C instanceof o.bm?(F=C.texture,N=o.bh(0,0,a.transform)):L&&r&&(F=L.texture,N=o.bh(r.canonical.z,r.canonical.x,a.transform)),!F||!N)return;u||(N=o.ad.scale(o.ad.create(),N,[1,-1,1]));let j=a.context,U=j.gl,G=g.paint.get("raster-resampling")==="nearest"?U.NEAREST:U.LINEAR,$=a.colorModeForDrapableLayerRenderPass(y),Q=b.defines;Q.push("GLOBE_POLES");let K=new o.ae(U.LEQUAL,o.ae.ReadWrite,a.depthRangeFor3D),J=Float32Array.from(a.transform.expandedFarZProjMatrix),oe=Float32Array.from(o.bf(o.bg(new o.aO(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),j.activeTexture.set(U.TEXTURE0),F.bind(G,U.CLAMP_TO_EDGE),j.activeTexture.set(U.TEXTURE1),F.bind(G,U.CLAMP_TO_EDGE),F.useMipmap&&j.extTextureFilterAnisotropic&&a.transform.pitch>20&&U.texParameterf(U.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);let[ie,ce,q,ee]=r?P.getPoleBuffers(r.canonical.z,!1):P.getPoleBuffers(0,!0),he=g.paint.get("raster-elevation"),we;u?(we=ie,a.renderDefaultNorthPole=he!==0):(we=ce,a.renderDefaultSouthPole=he!==0);let pe=Iu(b.mix),ae=((Fe,ze,ke,_e,De,Re,Qe,Ke,nt,Je,Ze,Ae,at)=>gd(Fe,ze,ke,new Float32Array(16),new Float32Array(9),[0,0],_e,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Re,[0,0],Ke,2,Je,Ze,Ae,1,0,at))(J,oe,N,o.a1(a.transform.zoom),0,g,0,he,0,pe,b.offset,b.range,y),Ee=a.getOrCreateProgram("raster",{defines:Q});a.uploadCommonUniforms(j,Ee,null),Ee.draw(a,U.TRIANGLES,K,M,$,T,ae,g.id,we,q,ee)}function Ed(u){let r=u._nearZ,a=u.projection.farthestPixelDistance(u),f=a-r,g=.2*u.height,y=r+g;return[r,a,(y-g-r)/f,(y-r)/f]}function nn(u,r,a,f){if(u)return r instanceof ma&&u instanceof o.c3?r.getTextureDescriptor(u,a,!0):{texture:u.texture,mix:Iu(f.mix),offset:f.offset,buffer:0,tileSize:1}}function K_(u,r,a){if(!u)return null;let f=r.getTextureDescriptor(u,a,!0);if(!f)return null;let{texture:g,mix:y,offset:b,tileSize:T,buffer:M,format:C}=f;if(!g||!C)return null;let P=!1;return C==="uint32"&&(P=!0,y[3]=0,y=zo(o.c4,y,[0,a.paint.get("raster-particle-max-speed")]),b=Cp(o.c4,b,[0,a.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[M/(T+2*M),T/(T+2*M)],tileSize:T,scalarData:P,scale:y,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[C]]}}function pt(u){let r=u._nearZ,a=u.projection.farthestPixelDistance(u),f=a-r,g=.2*u.height,y=r+g;return[r,a,(y-g-r)/f,(y-r)/f]}let Np=new o.C(1,0,0,1),Du=new o.C(0,1,0,1),Id=new o.C(0,0,1,1),Ui=new o.C(1,0,1,1),Dd=new o.C(0,1,1,1);function Ei(u,r,a,f,g,y,b){let T=u.context,M=u.transform,C=T.gl,P=M.projection.name==="globe",L=P?["PROJECTION_GLOBE_VIEW"]:[],F=o.ad.clone(a.projMatrix);if(P&&o.a1(M.zoom)>0){let pe=o.c5(a.canonical,M),ae=o.c6(pe);F=o.ad.multiply(new Float32Array(16),M.globeMatrix,ae),o.ad.multiply(F,M.projMatrix,F)}let N=o.ad.create();N[12]+=2*g/(o.e.devicePixelRatio*M.width),N[13]+=2*y/(o.e.devicePixelRatio*M.height),o.ad.multiply(F,N,F);let j=u.getOrCreateProgram("debug",{defines:L}),U=r.getTileByID(a.key);u.terrain&&u.terrain.setupElevationDraw(U,j);let G=o.ae.disabled,$=o.ag.disabled,Q=u.colorModeForRenderPass(),K="$debug";T.activeTexture.set(C.TEXTURE0),u.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),P?U._makeGlobeTileDebugBuffers(u.context,M):U._makeDebugTileBoundsBuffers(u.context,M.projection);let J=U._tileDebugBuffer||u.debugBuffer,oe=U._tileDebugIndexBuffer||u.debugIndexBuffer,ie=U._tileDebugSegments||u.debugSegments;if(j.draw(u,C.LINE_STRIP,G,$,Q,o.af.disabled,yu(F,f),K,J,oe,ie,null,null,null,[U._globeTileDebugBorderBuffer]),b){let pe=U.latestRawTileData,ae=Math.floor((pe&&pe.byteLength||0)/1024),Ee=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Ee+=` => ${a.overscaledZ}`),Ee+=` ${U.state}`,Ee+=` ${ae}kb`,function(Fe,ze){Fe.initDebugOverlayCanvas();let ke=Fe.debugOverlayCanvas,_e=Fe.context.gl,De=Fe.debugOverlayCanvas.getContext("2d");De.clearRect(0,0,ke.width,ke.height),De.shadowColor="white",De.shadowBlur=2,De.lineWidth=1.5,De.strokeStyle="white",De.textBaseline="top",De.font="bold 36px Open Sans, sans-serif",De.fillText(ze,5,5),De.strokeText(ze,5,5),Fe.debugOverlayTexture.update(ke),Fe.debugOverlayTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}(u,Ee)}let ce=r.getTile(a).tileSize,q=512/Math.min(ce,512)*(a.overscaledZ/M.zoom)*.5,ee=U._tileDebugTextBuffer||u.debugBuffer,he=U._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,we=U._tileDebugTextSegments||u.debugSegments;j.draw(u,C.TRIANGLES,G,$,o.a.alphaBlended,o.af.disabled,yu(F,o.C.transparent,q),K,ee,he,we,null,null,null,[U._globeTileDebugTextBuffer])}function st(u,r,a,f){Jt(u,0,r+a/2,u.transform.width,a,f)}function rn(u,r,a,f){Jt(u,r-a/2,0,a,u.transform.height,f)}function Jt(u,r,a,f,g,y){let b=u.context,T=b.gl;T.enable(T.SCISSOR_TEST),T.scissor(r*o.e.devicePixelRatio,a*o.e.devicePixelRatio,f*o.e.devicePixelRatio,g*o.e.devicePixelRatio),b.clear({color:y}),T.disable(T.SCISSOR_TEST)}let ui=o.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:xa}=ui;function zt(u,r,a,f){u.emplaceBack(r,a,f)}class Ul{constructor(r){this.vertexArray=new o.c8,this.indices=new o.bu,zt(this.vertexArray,-1,-1,1),zt(this.vertexArray,1,-1,1),zt(this.vertexArray,-1,1,1),zt(this.vertexArray,1,1,1),zt(this.vertexArray,-1,-1,-1),zt(this.vertexArray,1,-1,-1),zt(this.vertexArray,-1,1,-1),zt(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,xa),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.b.simpleSegment(0,0,36,12)}}function Gi(u,r,a,f,g,y){let b=u.context.gl,T=r.paint.get("sky-atmosphere-color"),M=r.paint.get("sky-atmosphere-halo-color"),C=r.paint.get("sky-atmosphere-sun-intensity"),P=((L,F,N,j,U)=>({u_matrix_3f:L,u_sun_direction:F,u_sun_intensity:N,u_color_tint_r:[j.r,j.g,j.b,j.a],u_color_tint_m:[U.r,U.g,U.b,U.a],u_luminance:5e-5}))(o.bC.fromMat4(o.bC.create(),f),g,C,T,M);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+y,r.skyboxTexture,0),a.draw(u,b.TRIANGLES,o.ae.disabled,o.ag.disabled,o.a.unblended,o.af.frontCW,P,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}let Gl=o.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Hr{constructor(r){let a=new o.c9;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);let f=new o.bu;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(a,Gl.members),this.indexBuffer=r.createIndexBuffer(f),this.segments=o.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let tr=o.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class J_{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class $l{constructor(r){this.colorModeAlphaBlendedWriteRGB=new o.a([o.ca,o.cb,o.ca,o.cb],o.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new o.a([o.ca,o.cc,o.ca,o.cc],o.C.transparent,[!1,!1,!1,!0]),this.params=new J_,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){let a=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Hr(a);let f=this.params.sizeRange,g=this.params.intensityRange,y=function(P){let L=o.cf(30),F=[];for(let N=0;N<P;++N){let j=2*Math.PI*L(),U=Math.acos(1-2*L())-.5*Math.PI;F.push(o._.fromValues(Math.cos(U)*Math.cos(j),Math.cos(U)*Math.sin(j),Math.sin(U)))}return F}(this.params.starsCount),b=o.cf(300),T=new o.cd,M=new o.bu,C=0;for(let P=0;P<y.length;++P){let L=o._.scale([],y[P],200),F=Math.max(0,1+.01*f*(1*b()-.5)),N=Math.max(0,1+.01*g*(1*b()-.5));T.emplaceBack(L[0],L[1],L[2],-1,-1,F,N),T.emplaceBack(L[0],L[1],L[2],1,-1,F,N),T.emplaceBack(L[0],L[1],L[2],1,1,F,N),T.emplaceBack(L[0],L[1],L[2],-1,1,F,N),M.emplaceBack(C+0,C+1,C+2),M.emplaceBack(C+0,C+2,C+3),C+=4}this.starsVx=a.createVertexBuffer(T,tr.members),this.starsIdx=a.createIndexBuffer(M),this.starsSegments=o.b.simpleSegment(0,0,T.length,M.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,a){let f=r.context,g=f.gl,y=r.transform,b=new o.ae(g.LEQUAL,o.ae.ReadOnly,[0,1]),T=o.a1(y.zoom),M=r.style.getLut(a.scope),C=a.properties.get("color").toRenderColor(M).toArray01(),P=a.properties.get("high-color").toRenderColor(M).toArray01(),L=a.properties.get("space-color").toRenderColor(M).toArray01PremultipliedAlpha(),F=5e-4,N=o.ce(a.properties.get("horizon-blend"),0,1,F,.25),j=o.ba(r,f,y)&&N===F?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,U=r.frameCounter/1e3%1,G=o._.length(y.globeCenterInViewSpace),$=Math.sqrt(Math.pow(G,2)-Math.pow(j,2)),Q=Math.acos($/G),K=J=>{let oe=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];J&&oe.push("ALPHA_PASS");let ie=r.getOrCreateProgram("globeAtmosphere",{defines:oe}),ce=((ee,he,we,pe,ae,Ee,Fe,ze,ke,_e,De,Re)=>({u_frustum_tl:ee,u_frustum_tr:he,u_frustum_br:we,u_frustum_bl:pe,u_horizon:ae,u_transition:Ee,u_fadeout_range:Fe,u_color:ze,u_high_color:ke,u_space_color:_e,u_temporal_offset:De,u_horizon_angle:Re}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,T,N,C,P,L,U,Q);r.uploadCommonUniforms(f,ie);let q=this.atmosphereBuffer;q&&ie.draw(r,g.TRIANGLES,b,o.ag.disabled,J?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,o.af.backCW,ce,J?"atmosphere_glow_alpha":"atmosphere_glow",q.vertexBuffer,q.indexBuffer,q.segments)};K(!1),K(!0)}drawStars(r,a){let f=o.at(a.properties.get("star-intensity"),0,1);if(f===0)return;let g=r.context,y=g.gl,b=r.transform,T=r.getOrCreateProgram("stars"),M=o.av.identity([]);o.av.rotateX(M,M,-b._pitch),o.av.rotateZ(M,M,-b.angle),o.av.rotateX(M,M,o.ab(b._center.lat)),o.av.rotateY(M,M,-o.ab(b._center.lng));let C=o.ad.fromQuat(new Float32Array(16),M),P=o.ad.multiply([],b.starsProjMatrix,C),L=o.bC.fromMat4([],C),F=o.bC.invert([],L),N=[0,1,0];o._.transformMat3(N,N,F),o._.scale(N,N,this.params.sizeMultiplier);let j=[1,0,0];o._.transformMat3(j,j,F),o._.scale(j,j,this.params.sizeMultiplier);let U=(G=N,$=j,Q=f,{u_matrix:Float32Array.from(P),u_up:G,u_right:$,u_intensity_multiplier:Q});var G,$,Q;r.uploadCommonUniforms(g,T),this.starsVx&&this.starsIdx&&T.draw(r,y.TRIANGLES,o.ae.disabled,o.ag.disabled,this.colorModeAlphaBlendedWriteRGB,o.af.disabled,U,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Mu(u,r){let a=[...u],f=r.cameraWorldSizeForFog/r.worldSize,g=o.ad.identity([]);return o.ad.scale(g,g,[f,f,1]),o.ad.multiply(a,g,a),o.ad.multiply(a,r.worldToFogMatrix,a),a}function vs(u,r,a,f,g){let y=a.material,b=f.context,{baseColorTexture:T,metallicRoughnessTexture:M}=y.pbrMetallicRoughness,{normalTexture:C,occlusionTexture:P,emissionTexture:L}=y;function F(N,j,U){if(N&&(u.push(j),b.activeTexture.set(b.gl.TEXTURE0+U),N.gfxTexture)){let{minFilter:G,magFilter:$,wrapS:Q,wrapT:K}=N.sampler;N.gfxTexture.bindExtraParam(G,$,Q,K)}}F(T,"HAS_TEXTURE_u_baseColorTexture",rr.BaseColor),F(M,"HAS_TEXTURE_u_metallicRoughnessTexture",rr.MetallicRoughness),F(C,"HAS_TEXTURE_u_normalTexture",rr.Normal),F(P,"HAS_TEXTURE_u_occlusionTexture",rr.Occlusion),F(L,"HAS_TEXTURE_u_emissionTexture",rr.Emission),g&&(g.texture||(g.texture=new o.ch(f.context,g.image,[g.image.height,g.image.height,g.image.height],b.gl.RGBA)),b.activeTexture.set(b.gl.TEXTURE0+rr.LUT),g.texture&&g.texture.bind(b.gl.LINEAR,b.gl.CLAMP_TO_EDGE),u.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(u.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(a.texcoordBuffer)),a.colorBuffer&&(u.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(a.colorBuffer)),a.normalBuffer&&(u.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(a.normalBuffer)),a.pbrBuffer&&(u.push("HAS_ATTRIBUTE_a_pbr"),u.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(a.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||u.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||u.push("DIFFUSE_SHADED"),u.push("USE_STANDARD_DERIVATIVES")}function va(u,r,a,f,g,y){let b=a.paint.get("model-opacity"),T=r.context,M=new o.ae(r.context.gl.LEQUAL,o.ae.ReadWrite,r.depthRangeFor3D),C=r.transform,P=u.mesh,L=P.material,F=L.pbrMetallicRoughness,N=r.style.fog,j;j=r.transform.projection.zAxisUnit==="pixels"?[...u.nodeModelMatrix]:o.ad.multiply([],f.zScaleMatrix,u.nodeModelMatrix),o.ad.multiply(j,f.negCameraPosMatrix,j);let U=o.ad.invert([],j);o.ad.transpose(U,U);let G=a.paint.get("model-emissive-strength").constantOr(0),$=vd(new Float32Array(u.worldViewProjection),new Float32Array(j),new Float32Array(U),null,r,b,F.baseColorFactor.toRenderColor(null),L.emissiveFactor,F.metallicFactor,F.roughnessFactor,L,G,a),Q={defines:[]},K=[];vs(Q.defines,K,P,r,a.lut);let J=r.shadowRenderer;J&&(J.useNormalOffset=!1);let oe=null;if(N){let q=Mu(u.nodeModelMatrix,r.transform);if(oe=new Float32Array(q),C.projection.name!=="globe"){let ee=P.aabb.min,he=P.aabb.max,[we,pe]=N.getOpacityForBounds(q,ee[0],ee[1],he[0],he[1]);Q.overrideFog=we>=zn||pe>=zn}}let ie=ps(r,a.paint.get("model-cutoff-fade-range"));ie.shouldRenderCutoff&&Q.defines.push("RENDER_CUTOFF");let ce=r.getOrCreateProgram("model",Q);r.uploadCommonUniforms(T,ce,null,oe,ie),r.renderPass!=="shadow"&&J&&J.setupShadowsFromMatrix(u.nodeModelMatrix,ce),ce.draw(r,T.gl.TRIANGLES,M,g,y,P.material.doubleSided?o.af.disabled:o.af.backCCW,$,a.id,P.vertexBuffer,P.indexBuffer,P.segments,a.paint,r.transform.zoom,void 0,K)}function Hl(u,r,a,f,g,y,b){let T;T=u.projection.name==="globe"?o.ci(a,u):[...a],o.ad.multiply(T,T,r.matrix);let M=o.ad.multiply([],f,T);if(r.meshes)for(let C of r.meshes){if(C.material.alphaMode!=="BLEND"){b.push({mesh:C,depth:0,modelIndex:g,worldViewProjection:M,nodeModelMatrix:T});continue}let P=o._.transformMat4([],C.centroid,M);P[2]>0&&y.push({mesh:C,depth:P[2],modelIndex:g,worldViewProjection:M,nodeModelMatrix:T})}if(r.children)for(let C of r.children)Hl(u,C,a,f,g,y,b)}function yr(u,r,a,f){let g=a.shadowRenderer;if(!g)return;let y=g.getShadowPassDepthMode(),b=g.getShadowPassColorMode(),T=g.calculateShadowPassMatrixFromMatrix(r),M=bu(T);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,y,o.ag.disabled,b,o.af.backCCW,M,f.id,u.vertexBuffer,u.indexBuffer,u.segments,f.paint,a.transform.zoom,void 0,void 0)}function ti(u,r,a){let f=r.updateZoomBasedPaintProperties(),g=function(y,b,T){let M,C,P,L=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&L>0){let F=y.terrain,N=F.findDEMTileFor(T);N&&N.dem?M=o.ck.create(F,T,N):L=0}if(L===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),L===b.validForExaggeration&&(L===0||M&&M._demTile&&M._demTile.tileID===b.validForDEMTile.id&&M._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(let F in b.instancesPerModel){let N=b.instancesPerModel[F];for(let j=0;j<N.instancedDataArray.length;++j){let U=(M?L*M.getElevationAt(0|N.instancedDataArray.float32[16*j],0|N.instancedDataArray.float32[16*j+1],!0,!0):0)+N.instancesEvaluatedElevation[j];N.instancedDataArray.float32[16*j+6]=U,C=C?Math.min(b.terrainElevationMin,U):U,P=P?Math.max(b.terrainElevationMax,U):U}}return b.terrainElevationMin=C||0,b.terrainElevationMax=P||0,b.validForExaggeration=L,b.validForDEMTile=M&&M._demTile?{id:M._demTile.tileID,timestamp:M._dem._timestamp}:{id:void 0,timestamp:0},!0}(u,r,a);(f||g)&&(r.uploaded=!1,r.upload(u.context))}let Ii={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.b6([0,0,0],[o.a3,o.a3,0])};function ba(u,r){let a=1<<u.canonical.z,f=r.getFreeCameraOptions().position,g=r.elevation,y=u.canonical.x/a,b=(u.canonical.x+1)/a,T=u.canonical.y/a,M=(u.canonical.y+1)/a,C=r._centerAltitude;if(g){let N=g.getMinMaxForTile(u);N&&N.max>C&&(C=N.max)}let P=o.at(f.x,y,b)-f.x,L=o.at(f.y,T,M)-f.y,F=o.ax(C,r.center.lat)-f.z;return r._zoomFromMercatorZ(Math.sqrt(P*P+L*L+F*F))}function ir(u,r,a,f,g,y,b){let T=u.context,M=u.renderPass==="shadow",C=u.shadowRenderer,P=M&&C?C.getShadowPassDepthMode():new o.ae(T.gl.LEQUAL,o.ae.ReadWrite,u.depthRangeFor3D),L=u.isTileAffectedByFog(y);if(a.meshes)for(let F of a.meshes){let N=["MODEL_POSITION_ON_GPU"],j=[],U,G,$;f.instancedDataArray.length>20&&N.push("INSTANCED_ARRAYS");let Q=ps(u,r.paint.get("model-cutoff-fade-range"));if(Q.shouldRenderCutoff&&N.push("RENDER_CUTOFF"),M&&C)U=u.getOrCreateProgram("modelDepth",{defines:N}),G=bu(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(a.matrix)),$=C.getShadowPassColorMode();else{vs(N,j,F,u,r.lut),U=u.getOrCreateProgram("model",{defines:N,overrideFog:L});let J=F.material,oe=J.pbrMetallicRoughness,ie=r.paint.get("model-opacity"),ce=r.paint.get("model-emissive-strength").constantOr(0);G=vd(y.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,u,ie,oe.baseColorFactor.toRenderColor(null),J.emissiveFactor,oe.metallicFactor,oe.roughnessFactor,J,ce,r,g),C&&(b.shadowUniformsInitialized?U.setShadowUniformValues(T,C.getShadowUniformValues()):(C.setupShadows(y.toUnwrapped(),U,"model-tile",y.overscaledZ),b.shadowUniformsInitialized=!0)),$=Q.shouldRenderCutoff||ie<1||J.alphaMode!=="OPAQUE"?o.a.alphaBlended:o.a.unblended}u.uploadCommonUniforms(T,U,y.toUnwrapped(),null,Q);let K=F.material.doubleSided?o.af.disabled:o.af.backCCW;if(f.instancedDataArray.length>20)j.push(f.instancedDataBuffer),U.draw(u,T.gl.TRIANGLES,P,o.ag.disabled,$,K,G,r.id,F.vertexBuffer,F.indexBuffer,F.segments,r.paint,u.transform.zoom,void 0,j,f.instancedDataArray.length);else{let J=M?"u_instance":"u_normal_matrix";for(let oe=0;oe<f.instancedDataArray.length;++oe)G[J]=new Float32Array(f.instancedDataArray.arrayBuffer,64*oe,16),U.draw(u,T.gl.TRIANGLES,P,o.ag.disabled,$,K,G,r.id,F.vertexBuffer,F.indexBuffer,F.segments,r.paint,u.transform.zoom,void 0,j)}}if(a.children)for(let F of a.children)ir(u,r,F,f,g,y,b)}let Di=[1,-1,1];function io(u,r,a,f){if(!a.modelManager)return!0;let g=a.modelManager;if(!a.shadowRenderer)return!0;let y=a.shadowRenderer,b=r.aabb,T=!0,M=u.maxHeight;if(M===0){let P=0;for(let L in u.instancesPerModel){let F=g.getModel(L,f);F?P=Math.max(P,Math.max(Math.max(F.aabb.max[0],F.aabb.max[1]),F.aabb.max[2])):T=!1}M=u.maxScale*P*1.41+u.maxVerticalOffset,T&&(u.maxHeight=M)}b.max[2]=M,b.min[2]+=u.terrainElevationMin,b.max[2]+=u.terrainElevationMax,o._.transformMat4(b.min,b.min,r.tileMatrix),o._.transformMat4(b.max,b.max,r.tileMatrix);let C=b.intersects(y.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(u.isInsideFirstShadowMapFrustum=C===2),C===0}function hr(u,r){let a=u.uniformValues.u_cutoff_params[0],f=u.uniformValues.u_cutoff_params[1],g=u.uniformValues.u_cutoff_params[2],y=u.uniformValues.u_cutoff_params[3];return f===a||y===g?1:o.at(((r-a)/(f-a)-g)/(y-g),0,1)}function Md(u,r,a,f){if(r.pitch<20)return 1;let g=r.getWorldToCameraMatrix(),y=o.ad.multiply([],g,u),b=[...a.min,1],T=o.aA.transformMat4([],b,y),M=T,C=T;b[1]=a.max[1],T=o.aA.transformMat4([],b,y),M=T[1]<M[1]?T:M,C=T[1]>C[1]?T:C,b[0]=a.max[0],T=o.aA.transformMat4([],b,y),M=T[1]<M[1]?T:M,C=T[1]>C[1]?T:C,b[1]=a.min[1],T=o.aA.transformMat4([],b,y),M=T[1]<M[1]?T:M,C=T[1]>C[1]?T:C;let P=o.at(f[0],0,1),L=100*r.pixelsPerMeter*o.at(f[1],0,1),F=o.at(f[2],0,1),N=o._.lerp([],M,C,P),j=Math.tan(.5*r.fovX),U=-N[2]*j;if(L===0)return N[1]<-Math.abs(U)?F:1;let G=(-Math.abs(U)-N[1])/L,$=(K,J,oe)=>(1-oe)*K+oe*J,Q=o.at($(1,F,G),F,1);return $(1,Q,o.at((r.pitch-20)/20,0,1))}class Mi{}class ql{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,a,f){{let L=this._storage.get(a.id);if(L)return L.lastUsedFrameIdx=r,L.buf}let g=f.gl,y=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),b=new ArrayBuffer(y),T=new Int16Array(b);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));let M=new o.cm;for(let L=0;L<y/2;L+=3){let F=T[L],N=T[L+1],j=T[L+2];M.emplaceBack(F,N),M.emplaceBack(N,j),M.emplaceBack(j,F)}let C=f.bindVertexArrayOES.current,P=new Mi;return P.buf=new o.I(f,M),P.lastUsedFrameIdx=r,this._storage.set(a.id,P),f.bindVertexArrayOES.set(C),P.buf}update(r){for(let[a,f]of this._storage)r-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(a))}destroy(){for(let[r,a]of this._storage)a.buf.destroy(),this._storage.delete(r)}}let Wl=o.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class bs{constructor(r){let a=new o.cn,f=new o.bu;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1),f.emplaceBack(0,1,2),f.emplaceBack(0,2,3),this.segments=o.b.simpleSegment(0,0,a.length,f.length),this.vx=r.createVertexBuffer(a,Wl.members),this.idx=r.createIndexBuffer(f)}destroy(){this.vx.destroy(),this.idx.destroy()}}let Cd={symbol:function(u,r,a,f,g){if(u.renderPass!=="translucent")return;let y=o.ag.disabled,b=u.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(C,P,L,F,N,j,U){let G=P.transform,$=N==="map",Q=j==="map";for(let K of C){let J=F.getTile(K),oe=J.getBucket(L);if(!oe||!oe.text||!oe.text.segments.get().length)continue;let ie=o.aD(oe.textSizeData,G.zoom),ce=wu(K,oe.getProjection(),G),q=G.calculatePixelsToTileUnitsMatrix(J),ee=St(ce,J.tileID.canonical,Q,$,G,oe.getProjection(),q),he=oe.hasIconTextFit()&&oe.hasIconData();if(ie){let we=Math.pow(2,G.zoom-J.tileID.overscaledZ);Q_(oe,$,Q,U,o.bO,G,ee,K,we,ie,he)}}}(f,u,a,r,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g);let T=a.paint.get("icon-opacity").constantOr(1)!==0,M=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(T||M)?Tu(u,r,a,f,y,b):(T&&Tu(u,r,a,f,y,b,{onlyIcons:!0}),M&&Tu(u,r,a,f,y,b,{onlyText:!0}),function(C,P,L,F){if(!C.symbolParams.useOcclusionQueries)return;let N=C.context.gl,j=C.transform,U=L.paint,G=U.get("icon-occlusion-opacity").constantOr(0),$=U.get("text-occlusion-opacity").constantOr(0);if(!L.hasInitialOcclusionOpacityProperties||G===1&&$===1)return;let Q=j.projection.name==="globe";for(let K of F){let J=P.getTile(K),oe=J.getBucket(L);if(!oe||oe.projection.name==="mercator"&&Q||oe.fullyClipped)continue;if(oe.projection.name==="globe"){o.w(`Occlusion not supported for globe mode. Layer: ${L.type}`);continue}let ie=wu(K,oe.getProjection(),j),ce=o.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,C.symbolParams.depthOffset,1),q=o.ad.multiply([],ce,ie),ee=C.symbolParams.visualizeOcclusions!=="none"?1:C.symbolParams.occlusionQueryFrameWindow;for(let he=0;he<oe.symbolInstances.length;he++){let we=oe.symbolInstances.get(he),pe=C.style.placement.opacities[we.crossTileID];if(pe&&pe.isHidden()||(C.frameCounter+he)%ee!=0)continue;let ae=we.tileAnchorX,Ee=we.tileAnchorY,Fe=we.zOffset,ze;if(C.symbolParams.visualizeOcclusions==="none"){let Qe=oe.queries.get(he);if(Qe){if(!Qe.isFree()){if(!Qe.isResultAvailable())continue;let Ke=Qe.consumeResult();we.occlusionState=Ke===0?0:1;continue}ze=Qe}else ze=new na(C.context),oe.queries.set(he,ze)}let ke=C.getOrCreateProgram("occlusion"),_e=C.symbolParams.occluderSize,De=X_(q,[ae,Ee,Fe],[j.width,j.height],[_e,_e],C.symbolParams.visualizeOcclusions==="zPass"?[1,0,0,.8]:[1,.4,.2,.9]);C.terrain&&C.terrain.setupElevationDraw(J,ke,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),C.symbolParams.visualizeOcclusions==="none"&&ze&&ze.begin();let Re=new o.ae(C.symbolParams.visualizeOcclusions==="zPass"?C.context.gl.ALWAYS:C.context.gl.LEQUAL,o.ae.ReadOnly,C.depthRangeFor3D);ke.draw(C,N.TRIANGLES,Re,o.ag.disabled,C.symbolParams.visualizeOcclusions!=="none"?o.a.alphaBlendedNonPremultiplied:o.a.disabled,o.af.disabled,De,"occlusion",C.occlusionBuffers.vx,C.occlusionBuffers.idx,C.occlusionBuffers.segments),C.symbolParams.visualizeOcclusions==="none"&&ze&&ze.end()}}}(u,r,a,f)),r.map.showCollisionBoxes&&(Op(u,r,a,f,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Op(u,r,a,f,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(u,r,a,f){if(u.renderPass!=="translucent")return;let g=a.paint.get("circle-opacity"),y=a.paint.get("circle-stroke-width"),b=a.paint.get("circle-stroke-opacity"),T=a.layout.get("circle-sort-key").constantOr(1)!==void 0,M=a.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(y.constantOr(1)===0||b.constantOr(1)===0))return;let C=u.context,P=C.gl,L=u.transform,F=u.depthModeForSublayer(0,o.ae.ReadOnly),N=o.ag.disabled,j=u.colorModeForDrapableLayerRenderPass(M),U=L.projection.name==="globe",G=[o.aj(L.center.lng),o.ak(L.center.lat)],$=[];for(let K=0;K<f.length;K++){let J=f[K],oe=r.getTile(J),ie=oe.getBucket(a);if(!ie||ie.projection.name!==L.projection.name)continue;let ce=ie.programConfigurations.get(a.id),q=o.bR(a),ee=u.isTileAffectedByFog(J);U&&q.push("PROJECTION_GLOBE_VIEW"),q.push("TERRAIN_DEPTH_D24");let he=u.getOrCreateProgram("circle",{config:ce,defines:q,overrideFog:ee}),we=ie.layoutVertexBuffer,pe=ie.globeExtVertexBuffer,ae=ie.indexBuffer,Ee=L.projection.createInversionMatrix(L,J.canonical),Fe={programConfiguration:ce,program:he,layoutVertexBuffer:we,globeExtVertexBuffer:pe,indexBuffer:ae,uniformValues:o.bS(u,J,oe,Ee,G,a),tile:oe};if(T){let ze=ie.segments.get();for(let ke of ze)$.push({segments:new o.b([ke]),sortKey:ke.sortKey,state:Fe})}else $.push({segments:ie.segments,sortKey:0,state:Fe})}T&&$.sort((K,J)=>K.sortKey-J.sortKey);let Q={useDepthForOcclusion:L.depthOcclusionForSymbolsAndCircles};for(let K of $){let{programConfiguration:J,program:oe,layoutVertexBuffer:ie,globeExtVertexBuffer:ce,indexBuffer:q,uniformValues:ee,tile:he}=K.state,we=K.segments;u.terrain&&u.terrain.setupElevationDraw(he,oe,Q),u.uploadCommonUniforms(C,oe,he.tileID.toUnwrapped()),oe.draw(u,P.TRIANGLES,F,N,j,o.af.disabled,ee,a.id,ie,q,we,a.paint,L.zoom,J,[ce])}},heatmap:function(u,r,a,f){if(a.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){let g=u.context,y=g.gl,b=o.ag.disabled,T=new o.a([y.ONE,y.ONE,y.ONE,y.ONE],o.C.transparent,[!0,!0,!0,!0]);(function(N,j,U,G){let $=N.gl,Q=j.width*G,K=j.height*G;N.activeTexture.set($.TEXTURE1),N.viewport.set([0,0,Q,K]);let J=U.heatmapFbo;if(!J||J&&(J.width!==Q||J.height!==K)){J&&J.destroy();let oe=$.createTexture();$.bindTexture($.TEXTURE_2D,oe),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),J=U.heatmapFbo=N.createFramebuffer(Q,K,!0,null),function(ie,ce,q,ee,he,we){let pe=ie.gl;pe.texImage2D(pe.TEXTURE_2D,0,ie.extRenderToTextureHalfFloat?pe.RGBA16F:pe.RGBA,he,we,0,pe.RGBA,ie.extRenderToTextureHalfFloat?pe.HALF_FLOAT:pe.UNSIGNED_BYTE,null),ee.colorAttachment.set(q)}(N,0,oe,J,Q,K)}else $.bindTexture($.TEXTURE_2D,J.colorAttachment.get()),N.bindFramebuffer.set(J.framebuffer)})(g,u,a,u.transform.projection.name==="globe"?.5:.25),g.clear({color:o.C.transparent});let M=u.transform,C=M.projection.name==="globe",P=C?["PROJECTION_GLOBE_VIEW"]:[],L=C?o.af.frontCCW:o.af.disabled,F=[o.aj(M.center.lng),o.ak(M.center.lat)];for(let N=0;N<f.length;N++){let j=f[N];if(r.hasRenderableParent(j))continue;let U=r.getTile(j),G=U.getBucket(a);if(!G||G.projection.name!==M.projection.name)continue;let $=u.isTileAffectedByFog(j),Q=G.programConfigurations.get(a.id),K=u.getOrCreateProgram("heatmap",{config:Q,defines:P,overrideFog:$}),{zoom:J}=u.transform;u.terrain&&u.terrain.setupElevationDraw(U,K),u.uploadCommonUniforms(g,K,j.toUnwrapped());let oe=M.projection.createInversionMatrix(M,j.canonical);K.draw(u,y.TRIANGLES,o.ae.disabled,b,T,L,zl(u,j,U,oe,F,J,a.paint.get("heatmap-intensity")),a.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,a.paint,u.transform.zoom,Q,C?[G.globeExtVertexBuffer]:null)}g.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(g,y){let b=g.context,T=b.gl,M=y.heatmapFbo;if(!M)return;b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,M.colorAttachment.get()),b.activeTexture.set(T.TEXTURE1);let C=y.colorRampTexture;C||(C=y.colorRampTexture=new o.T(b,y.colorRamp,T.RGBA)),C.bind(T.LINEAR,T.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,T.TRIANGLES,o.ae.disabled,o.ag.disabled,g.colorModeForRenderPass(),o.af.disabled,((P,L,F,N)=>({u_image:0,u_color_ramp:1,u_opacity:L.paint.get("heatmap-opacity")}))(0,y),y.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,y.paint,g.transform.zoom)}(u,a))},line:function(u,r,a,f){if(u.renderPass!=="translucent")return;let g=a.paint.get("line-opacity"),y=a.paint.get("line-width");if(g.constantOr(1)===0||y.constantOr(1)===0)return;let b=a.paint.get("line-emissive-strength"),T=a.paint.get("line-occlusion-opacity"),M=u.context,C=M.gl,P=a.layout.get("line-z-offset"),L=!P.isConstant()||!!P.constantOr(0),F=L?new o.ae(u.depthOcclusion?C.GREATER:C.LEQUAL,o.ae.ReadOnly,u.depthRangeFor3D):u.depthModeForSublayer(0,o.ae.ReadOnly),N=u.colorModeForDrapableLayerRenderPass(b),j=u.terrain&&u.terrain.renderingToTexture,U=j?1:o.e.devicePixelRatio,G=a.paint.get("line-dasharray"),$=G.constantOr(1),Q=a.layout.get("line-cap"),K=G.constantOr(null),J=Q.constantOr(null),oe=a.paint.get("line-pattern"),ie=oe.constantOr(1),ce=oe.constantOr(null),q=a.paint.get("line-opacity").constantOr(1),ee=!ie&&q!==1||u.depthOcclusion&&T>0&&T<1,he=a.paint.get("line-gradient"),we=ie?"linePattern":"line",pe=o.bT(a),ae;if(j&&u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(ee=!1),T!==0&&u.depthOcclusion){let Fe=a.paint._values["line-opacity"];Fe&&Fe.value&&Fe.value.kind==="constant"?ae=Fe.value:o.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}if(L&&(u.forceTerrainMode=!0),!L&&T!==0&&u.terrain&&!j)return void o.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has non-zero line-z-offset.`);let Ee=ee&&L?u.stencilModeFor3D():o.ag.disabled;for(let Fe of f){let ze=r.getTile(Fe);if(ie&&!ze.patternsLoaded())continue;let ke=ze.getBucket(a);if(!ke)continue;u.prepareDrawTile();let _e=ke.programConfigurations.get(a.id),De=u.isTileAffectedByFog(Fe),Re=u.getOrCreateProgram(we,{config:_e,defines:L?[...pe,"ELEVATED"]:pe,overrideFog:De});if(ce&&ze.imageAtlas){let Ae=ze.imageAtlas.patternPositions[ce.toString()];Ae&&_e.setConstantPatternPositions(Ae)}if(!ie&&K&&J&&ze.lineAtlas){let Ae=ze.lineAtlas.getDash(K,J);Ae&&_e.setConstantPatternPositions(Ae)}let[Qe,Ke]=a.paint.get("line-trim-offset");(J==="round"||J==="square")&&Qe!==Ke&&(Qe===0&&(Qe-=1),Ke===1&&(Ke+=1));let nt=j?Fe.projMatrix:null,Je=ie?o.bU(u,ze,a,nt,U,[Qe,Ke]):o.bV(u,ze,a,nt,ke.lineClipsArray.length,U,[Qe,Ke]);if(he){let Ae=ke.gradients[a.id],at=Ae.texture;if(a.gradientVersion!==Ae.version){let Lt=256;if(a.stepInterpolant){let gt=r.getSource().maxzoom,It=Fe.canonical.z===gt?Math.ceil(1<<u.transform.maxZoom-Fe.canonical.z):1;Lt=o.at(o.bW(ke.maxLineLength/o.a3*1024*It),256,M.maxTextureSize)}Ae.gradient=o.bX({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Lt,image:Ae.gradient||void 0,clips:ke.lineClipsArray}),Ae.texture?Ae.texture.update(Ae.gradient):Ae.texture=new o.T(M,Ae.gradient,C.RGBA),Ae.version=a.gradientVersion,at=Ae.texture}M.activeTexture.set(C.TEXTURE1),at.bind(a.stepInterpolant?C.NEAREST:C.LINEAR,C.CLAMP_TO_EDGE)}$&&(M.activeTexture.set(C.TEXTURE0),ze.lineAtlasTexture&&ze.lineAtlasTexture.bind(C.LINEAR,C.REPEAT),_e.updatePaintBuffers()),ie&&(M.activeTexture.set(C.TEXTURE0),ze.imageAtlasTexture&&ze.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),_e.updatePaintBuffers()),L&&u.terrain.setupElevationDraw(ze,Re),u.uploadCommonUniforms(M,Re,Fe.toUnwrapped());let Ze=Ae=>{ae!=null&&(ae.value=q*T),Re.draw(u,C.TRIANGLES,F,Ae,N,o.af.disabled,Je,a.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,a.paint,u.transform.zoom,_e,[ke.layoutVertexBuffer2,ke.patternVertexBuffer,ke.zOffsetVertexBuffer]),ae!=null&&(ae.value=q)};if(ee&&!L){let Ae=u.stencilModeForClipping(Fe).ref;Ae===0&&j&&M.clear({stencil:0});let at={func:C.EQUAL,mask:255};Je.u_alpha_discard_threshold=.8,Ze(new o.ag(at,Ae,255,C.KEEP,C.KEEP,C.INVERT)),Je.u_alpha_discard_threshold=0,Ze(new o.ag(at,Ae,255,C.KEEP,C.KEEP,C.KEEP))}else ee&&L&&(Je.u_alpha_discard_threshold=.001),Ze(L?Ee:u.stencilModeForClipping(Fe))}ee&&(u.resetStencilClippingMasks(),j&&M.clear({stencil:0})),T===0||u.depthOcclusion||j||u.layersWithOcclusionOpacity.push(u.currentLayer),L&&(u.forceTerrainMode=!1)},fill:function(u,r,a,f){let g=a.paint.get("fill-color"),y=a.paint.get("fill-opacity");if(y.constantOr(1)===0)return;let b=a.paint.get("fill-emissive-strength"),T=u.colorModeForDrapableLayerRenderPass(b),M=a.paint.get("fill-pattern"),C=u.opaquePassEnabledForLayer()&&!M.constantOr(1)&&g.constantOr(o.C.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===C){let P=u.depthModeForSublayer(1,u.renderPass==="opaque"?o.ae.ReadWrite:o.ae.ReadOnly);jl(u,r,a,f,P,T,!1)}if(u.renderPass==="translucent"&&a.paint.get("fill-antialias")){let P=u.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,o.ae.ReadOnly);jl(u,r,a,f,P,T,!0)}},"fill-extrusion":function(u,r,a,f){let g=a.paint.get("fill-extrusion-opacity"),y=u.context,b=y.gl,T=u.terrain,M=T&&T.renderingToTexture;if(g===0)return;let C=u.conflationActive&&u.style.isLayerClipped(a,r.getSource()),P=u.style.order.indexOf(a.fqid);if(C&&function(L,F,N,j,U){for(let G of j){let $=F.getTile(G).getBucket(N);$&&($.updateReplacement(G,L.replacementSource,U),$.uploadCentroid(L.context))}}(u,r,a,f,P),T||C)for(let L of f){let F=r.getTile(L).getBucket(a);F&&kp(u.context,r,L,F,a,T,C)}if(u.renderPass==="shadow"&&u.shadowRenderer){let L=u.shadowRenderer;if(T&&g<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.Z)return;let F=L.getShadowPassDepthMode(),N=L.getShadowPassColorMode();ei(u,r,a,f,F,o.ag.disabled,N,C)}else if(u.renderPass==="translucent"){let L=!a.paint.get("fill-extrusion-pattern").constantOr(1),F=a.paint.get("fill-extrusion-color").constantOr(o.C.white);if(!M&&F.a!==0){let N=new o.ae(u.context.gl.LEQUAL,o.ae.ReadWrite,u.depthRangeFor3D);g===1&&L?ei(u,r,a,f,N,o.ag.disabled,o.a.unblended,C):(ei(u,r,a,f,N,o.ag.disabled,o.a.disabled,C),ei(u,r,a,f,N,u.stencilModeFor3D(),u.colorModeForRenderPass(),C),u.resetStencilClippingMasks())}if(u.style.enable3dLights()&&L&&(!T&&u.transform.projection.name!=="globe"||M)){let N=a.paint.get("fill-extrusion-opacity"),j=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),U=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),G=a.paint.get("fill-extrusion-flood-light-intensity"),$=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(a.lut).toArray01().slice(0,3),Q=j>0&&U>0,K=G>0,J=(ie,ce,q)=>(1-q)*ie+q*ce,oe=ie=>{let ce=u.depthModeForSublayer(1,o.ae.ReadOnly,b.LEQUAL,!0),q=a.paint.get(ie?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ee=J(.1,3,q),he=u._showOverdrawInspector;if(!he){let we=new o.ag({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),pe=new o.a([b.ONE,b.ONE,b.ONE,b.ONE],o.C.transparent,[!1,!1,!1,!0],b.MIN);ro(u,r,a,f,ce,we,pe,o.af.disabled,ie,"sdf",N,j,U,G,$,ee,C,!1)}{let we=he?o.ag.disabled:new o.ag({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),pe=he?u.colorModeForRenderPass():new o.a([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],o.C.transparent,[!0,!0,!0,!0]);ro(u,r,a,f,ce,we,pe,o.af.disabled,ie,"color",N,j,U,G,$,ee,C,!1)}};if(M){let ie=(ce,q,ee)=>{let he=u.depthModeForSublayer(1,o.ae.ReadOnly,b.LEQUAL,!1),we=a.paint.get(ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),pe=J(.1,3,we);{let ae=new o.a([b.ONE,b.ONE,b.ONE,b.ONE],o.C.transparent,[!1,!1,!1,!0]);ro(u,r,a,f,he,o.ag.disabled,ae,o.af.disabled,ce,"clear",N,j,U,G,$,pe,C,q)}{let ae=new o.ag({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Ee=new o.a([b.ONE,b.ONE,b.ONE,b.ONE],o.C.transparent,[!1,!1,!1,!0],b.MIN);ro(u,r,a,f,he,ae,Ee,o.af.disabled,ce,"sdf",N,j,U,G,$,pe,C,q)}{let ae=ce?b.ZERO:b.ONE_MINUS_DST_ALPHA,Ee=new o.ag({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Fe=new o.a([ae,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],o.C.transparent,[!0,!0,!0,!0]);ro(u,r,a,f,he,Ee,Fe,o.af.disabled,ce,"color",N,j,U,G,$,pe,C,q)}{let ae=new o.a([b.ONE,b.ONE,b.ONE,ce?b.ZERO:b.ONE],o.C.transparent,[!1,!1,!1,!0],ce?b.FUNC_ADD:b.MAX);ro(u,r,a,f,he,o.ag.disabled,ae,o.af.disabled,ce,"clear",N,j,U,G,$,pe,C,q,ee)}};if(Q||K){let ce;if(u.prepareDrawTile(),T){let q=T.drapeBufferSize[0],ee=T.drapeBufferSize[1];ce=T.framebufferCopyTexture,ce&&(!ce||ce.size[0]===q&&ce.size[1]===ee)||(ce&&ce.destroy(),ce=T.framebufferCopyTexture=new o.T(y,new o.i({width:q,height:ee}),b.RGBA)),ce.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexImage2D(b.TEXTURE_2D,0,b.RGBA,0,0,q,ee,0)}Q&&ie(!0,!1,ce),K&&ie(!1,!0,ce)}}else Q&&oe(!0),K&&oe(!1)}}},hillshade:function(u,r,a,f){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent"||u.style.disableElevatedTerrain)return;let g=u.context,y=u.terrain&&u.terrain.renderingToTexture,[b,T]=u.renderPass!=="translucent"||y?[{},f]:u.stencilConfigForOverlap(f);for(let M of T){let C=r.getTile(M);if(C.needsHillshadePrepare&&u.renderPass==="offscreen")Bi(u,C,a);else if(u.renderPass==="translucent"){let P=u.depthModeForSublayer(0,o.ae.ReadOnly),L=a.paint.get("hillshade-emissive-strength"),F=u.colorModeForDrapableLayerRenderPass(L),N=y&&u.terrain?u.terrain.stencilModeForRTTOverlap(M):b[M.overscaledZ];W_(u,M,C,a,P,N,F)}}g.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,r,a,f,g,y){if(u.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;let b=u.transform.projection.name==="globe",T=a.paint.get("raster-elevation")!==0,M=T&&b;if(u.renderElevatedRasterBackface&&!M)return;let C=u.context,P=C.gl,L=r.getSource(),F=function(ie,ce,q,ee){let he=ce.paint.get("raster-color"),we=ie.type==="raster-array",pe=[],ae=ce.paint.get("raster-resampling"),Ee=ce.paint.get("raster-color-mix"),Fe=ce.paint.get("raster-color-range"),ze=[Ee[0],Ee[1],Ee[2],0],ke=Ee[3],_e=ae==="nearest"?ee.NEAREST:ee.LINEAR;if(we&&(pe.push("RASTER_ARRAY"),he||pe.push("RASTER_COLOR"),ae==="linear"&&pe.push("RASTER_ARRAY_LINEAR"),_e=ee.NEAREST,!Fe&&ie.rasterLayers)){let De=ie.rasterLayers.find(({id:Re})=>Re===ce.sourceLayer);De&&De.fields&&De.fields.range&&(Fe=De.fields.range)}if(Fe=Fe||[0,1],he){pe.push("RASTER_COLOR"),q.activeTexture.set(ee.TEXTURE2),ce.updateColorRamp(Fe);let De=ce.colorRampTexture;De||(De=ce.colorRampTexture=new o.T(q,ce.colorRamp,ee.RGBA)),De.bind(ee.LINEAR,ee.CLAMP_TO_EDGE)}return{mix:ze,range:Fe,offset:ke,defines:pe,resampling:_e}}(L,a,C,P);if(L instanceof o.bm&&!f.length&&!b)return;let N=a.paint.get("raster-emissive-strength"),j=u.colorModeForDrapableLayerRenderPass(N),U=u.terrain&&u.terrain.renderingToTexture,G=!u.options.moving,$=a.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;if(L instanceof o.bm&&!f.length&&(L.onNorthPole||L.onSouthPole)){let ie=T?u.stencilModeFor3D():o.ag.disabled;return void ya(!!L.onNorthPole,null,u,r,a,N,F,o.af.disabled,ie)}if(!f.length)return;let[Q,K]=L instanceof o.bm||U?[{},f]:u.stencilConfigForOverlap(f),J=K[K.length-1].overscaledZ;M&&F.defines.push("PROJECTION_GLOBE_VIEW"),T&&F.defines.push("RENDER_CUTOFF");let oe=(ie,ce,q)=>{for(let ee of ie){let he=ee.toUnwrapped(),we=r.getTile(ee);if(U&&(!we||!we.hasData()))continue;C.activeTexture.set(P.TEXTURE0);let pe=nn(we,L,a,F);if(!pe||!pe.texture)continue;let{texture:ae,mix:Ee,offset:Fe,tileSize:ze,buffer:ke}=pe,_e,De;U?(_e=o.ae.disabled,De=ee.projMatrix):T?(_e=new o.ae(P.LEQUAL,o.ae.ReadWrite,u.depthRangeFor3D),De=b?Float32Array.from(u.transform.expandedFarZProjMatrix):u.transform.calculateProjMatrix(he,G)):(_e=u.depthModeForSublayer(ee.overscaledZ-J,a.paint.get("raster-opacity")===1?o.ae.ReadWrite:o.ae.ReadOnly,P.LESS),De=u.transform.calculateProjMatrix(he,G));let Re=u.terrain&&U?u.terrain.stencilModeForRTTOverlap(ee):Q[ee.overscaledZ],Qe=y?0:a.paint.get("raster-fade-duration");we.registerFadeDuration(Qe);let Ke=r.findLoadedParent(ee,0),nt=fu(we,Ke,r,u.transform,Qe),Je,Ze;u.terrain&&u.terrain.prepareDrawTile(),C.activeTexture.set(P.TEXTURE0),ae.bind($,P.CLAMP_TO_EDGE),C.activeTexture.set(P.TEXTURE1),Ke?(Ke.texture&&Ke.texture.bind($,P.CLAMP_TO_EDGE),Je=Math.pow(2,Ke.tileID.overscaledZ-we.tileID.overscaledZ),Ze=[we.tileID.canonical.x*Je%1,we.tileID.canonical.y*Je%1]):ae.bind($,P.CLAMP_TO_EDGE),ae.useMipmap&&C.extTextureFilterAnisotropic&&u.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);let Ae=u.transform,at,Lt=T?Ed(Ae):[0,0,0,0],gt,It,Gt,Ln,Bt,vt=0;if(M&&L instanceof o.bm&&L.coordinates.length>3)gt=Float32Array.from(o.bf(o.bg(new o.aO(0,0,0)))),It=Float32Array.from(Ae.globeMatrix),Gt=Float32Array.from(o.bb(Ae)),Ln=[o.aj(Ae.center.lng),o.ak(Ae.center.lat)],at=L.elevatedGlobePerspectiveTransform,Bt=L.elevatedGlobeGridMatrix||new Float32Array(9);else if(M){let Dt=o.bc(ee.canonical);vt=o.bd(Dt.getCenter().lat),gt=Float32Array.from(o.bf(o.bg(ee.canonical))),It=Float32Array.from(Ae.globeMatrix),Gt=Float32Array.from(o.bb(Ae)),Ln=[o.aj(Ae.center.lng),o.ak(Ae.center.lat)],at=[0,0],Bt=Float32Array.from(o.be(ee.canonical,Dt,vt,Ae.worldSize/Ae._pixelsPerMercatorPixel))}else at=L instanceof o.bm?L.perspectiveTransform:[0,0],gt=new Float32Array(16),It=new Float32Array(9),Gt=new Float32Array(16),Ln=[0,0],Bt=new Float32Array(9);let wn=gd(De,gt,It,Gt,Bt,Ze||[0,0],o.a1(u.transform.zoom),Ln,Lt,Je||1,nt,a,at,T?a.paint.get("raster-elevation"):0,2,Ee,Fe,F.range,ze,ke,N),dn=u.isTileAffectedByFog(ee),$t=u.getOrCreateProgram("raster",{defines:F.defines,overrideFog:dn});if(u.uploadCommonUniforms(C,$t,he),L instanceof o.bm){let Dt=L.elevatedGlobeVertexBuffer,Dn=L.elevatedGlobeIndexBuffer;if(U||!b)L.boundsBuffer&&L.boundsSegments&&$t.draw(u,P.TRIANGLES,_e,o.ag.disabled,j,o.af.disabled,wn,a.id,L.boundsBuffer,u.quadTriangleIndexBuffer,L.boundsSegments);else if(Dt&&Dn){let Xn=Ae.zoom<=o.b1?L.elevatedGlobeSegments:L.getSegmentsForLongitude(Ae.center.lng);Xn&&$t.draw(u,P.TRIANGLES,_e,o.ag.disabled,j,ce,wn,a.id,Dt,Dn,Xn)}}else if(M){_e=new o.ae(P.LEQUAL,o.ae.ReadOnly,u.depthRangeFor3D);let Dt=u.globeSharedBuffers;if(Dt){let[Dn,Xn,gn]=Dt.getGridBuffers(vt,!1);$t.draw(u,P.TRIANGLES,_e,q||Re,u.colorModeForRenderPass(),ce,wn,a.id,Dn,Xn,gn)}}else{let{tileBoundsBuffer:Dt,tileBoundsIndexBuffer:Dn,tileBoundsSegments:Xn}=u.getTileBoundsBuffers(we);$t.draw(u,P.TRIANGLES,_e,Re,j,o.af.disabled,wn,a.id,Dt,Dn,Xn)}}if(!(L instanceof o.bm)&&M)for(let ee of ie){let he=ee.canonical.y===(1<<ee.canonical.z)-1;ee.canonical.y===0&&ya(!0,ee,u,r,a,N,F,ce,q||o.ag.disabled),he&&ya(!1,ee,u,r,a,N,F,ce===o.af.frontCW?o.af.backCW:o.af.frontCW,q||o.ag.disabled)}};M?oe(K,u.renderElevatedRasterBackface?o.af.backCW:o.af.frontCW,u.stencilModeFor3D()):oe(K,o.af.disabled,void 0),u.resetStencilClippingMasks()},"raster-particle":function(u,r,a,f,g,y){u.renderPass==="offscreen"&&function(b,T,M,C){if(!C.length)return;let P=b.context,L=P.gl,F=T.getSource();if(!(F instanceof ma))return;let N=Math.ceil(Math.sqrt(M.paint.get("raster-particle-count"))),j=M.particlePositionRGBAImage;if(!j||j.width!==N){let K=function(J){let oe=J*J,ie=new Uint8Array(4*oe),ce=function(ee){return ee|=0,ee=Math.imul(2747636419^ee,2654435769),ee=Math.imul(ee^ee>>>16,2654435769),((ee=Math.imul(ee^ee>>>16,2654435769))>>>0)/4294967296},q=1/1.1;for(let ee=0;ee<oe;ee++){let he=q*(ce(2*ee+0)+ji),we=q*(ce(2*ee+1)+ji),pe=255*he%1,ae=255*we%1,Ee=pe,Fe=we-ae/255,ze=ae;ie[4*ee+0]=255*(he-pe/255),ie[4*ee+1]=255*Ee,ie[4*ee+2]=255*Fe,ie[4*ee+3]=255*ze}return ie}(N);j=M.particlePositionRGBAImage=new o.i({width:N,height:N},K)}let U=M.particleFramebuffer;U?U.width!==N&&(U.destroy(),U=M.particleFramebuffer=P.createFramebuffer(N,N,!0,null)):U=M.particleFramebuffer=P.createFramebuffer(N,N,!0,null);let G=[];for(let K of C){let J=T.getTile(K);if(!(J instanceof o.c3))continue;let oe=K_(J,F,M);if(!oe)continue;let ie=[J.tileSize,J.tileSize],ce=M.tileFramebuffer;ce||(ce=M.tileFramebuffer=P.createFramebuffer(ie[0],ie[1],!0,null));let q=J.rasterParticleState;q||(q=J.rasterParticleState=new ai(P,K,ie,j));let ee=q.update(M.lastInvalidatedAt);q.particleTextureDimension!==N&&q.updateParticleTexture(K,j);let he=q.targetColorTexture;q.targetColorTexture=q.backgroundColorTexture,q.backgroundColorTexture=he;let we=q.particleTexture0;q.particleTexture0=q.particleTexture1,q.particleTexture1=we,G.push([K,oe,q,ee])}if(G.length===0)return;let $=o.e.now(),Q=M.previousDrawTimestamp?.001*($-M.previousDrawTimestamp):.0167;if(M.previousDrawTimestamp=$,M.hasColorMap()){P.activeTexture.set(L.TEXTURE0+2);let K=M.colorRampTexture;K||(K=M.colorRampTexture=new o.T(P,M.colorRamp,L.RGBA)),K.bind(L.LINEAR,L.CLAMP_TO_EDGE)}P.bindFramebuffer.set(M.tileFramebuffer.framebuffer),function(K,J,oe){let ie=K.context,ce=ie.gl,q=J.tileFramebuffer;ie.activeTexture.set(ce.TEXTURE0);let ee={u_texture:0,u_opacity:1.05*(we=J.paint.get("raster-particle-fade-opacity-factor"))/(we+.05)},he=K.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var we;for(let pe of oe){let[,,ae,Ee]=pe;q.colorAttachment.set(ae.targetColorTexture.texture),ie.viewport.set([0,0,q.width,q.height]),ie.clear({color:o.C.transparent}),Ee&&(ae.backgroundColorTexture.bind(ce.NEAREST,ce.CLAMP_TO_EDGE),he.draw(K,ce.TRIANGLES,o.ae.disabled,o.ag.disabled,o.a.alphaBlended,o.af.disabled,ee,J.id,K.viewportBuffer,K.quadTriangleIndexBuffer,K.viewportSegments))}}(b,M,G),function(K,J,oe,ie){let ce=K.context,q=ce.gl,ee=oe.tileFramebuffer,he=K.transform.projection.name==="globe",we=oe.paint.get("raster-particle-max-speed");for(let pe of ie){let[ae,Ee,Fe]=pe;ce.activeTexture.set(q.TEXTURE0+0),Ee.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE),ee.colorAttachment.set(Fe.targetColorTexture.texture);let ze=K.getOrCreateProgram("rasterParticleDraw",{defines:Ee.defines,overrideFog:!1});ce.activeTexture.set(q.TEXTURE0+1);let ke=Ee.scalarData?[]:[0,1,2,3].map(Re=>o.bZ[Re](ae));ke.push(ae);let _e=ae.canonical.x,De=ae.canonical.y;for(let Re of ke){let Qe=J.getTile(he?Re.wrapped():Re);if(!Qe)continue;let Ke=Qe.rasterParticleState;if(!Ke)continue;let nt=Re.canonical.x+(1<<Re.canonical.z)*(Re.wrap-ae.wrap),Je=Re.canonical.y;Ke.particleTexture0.bind(q.NEAREST,q.CLAMP_TO_EDGE);let Ze=yd(1,Ke.particleTexture0.size[0],[nt-_e,Je-De],0,Ee.texture.size,2,we,Ee.textureOffset,Ee.scale,Ee.offset);ze.draw(K,q.POINTS,o.ae.disabled,o.ag.disabled,o.a.alphaBlended,o.af.disabled,Ze,oe.id,Ke.particleIndexBuffer,void 0,Ke.particleSegment)}}}(b,T,M,G),P.bindFramebuffer.set(M.particleFramebuffer.framebuffer),function(K,J,oe,ie){let ce=K.context,q=ce.gl,ee=J.paint.get("raster-particle-max-speed"),he=ie*J.paint.get("raster-particle-speed-factor")*.15,we=function(ae){return Math.pow(ae,6)}(.01+1*J.paint.get("raster-particle-reset-rate-factor")),pe=J.particleFramebuffer;ce.viewport.set([0,0,pe.width,pe.height]);for(let ae of oe){let[,Ee,Fe]=ae;ce.activeTexture.set(q.TEXTURE0+0),Ee.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE),ce.activeTexture.set(q.TEXTURE0+1);let ze=Fe.particleTexture0;ze.bind(q.NEAREST,q.CLAMP_TO_EDGE);let ke=xd(1,ze.size[0],0,Ee.texture.size,ee,he,we,Ee.textureOffset,Ee.scale,Ee.offset);pe.colorAttachment.set(Fe.particleTexture1.texture),ce.clear({color:o.C.transparent}),K.getOrCreateProgram("rasterParticleUpdate",{defines:Ee.defines}).draw(K,q.TRIANGLES,o.ae.disabled,o.ag.disabled,o.a.unblended,o.af.disabled,ke,J.id,K.viewportBuffer,K.quadTriangleIndexBuffer,K.viewportSegments)}}(b,M,G,Q)}(u,r,a,f),u.renderPass==="translucent"&&(function(b,T,M,C,P){let L=b.context,F=L.gl,N=!b.options.moving,j=b.transform.projection.name==="globe";if(!C.length)return;let[U,G]=b.stencilConfigForOverlap(C),$=[];j&&$.push("PROJECTION_GLOBE_VIEW");let Q=b.stencilModeFor3D();for(let K of G){let J=K.toUnwrapped(),oe=T.getTile(K);if(!oe.rasterParticleState)continue;let ie=oe.rasterParticleState,ce=100;oe.registerFadeDuration(ce);let q=T.findLoadedParent(K,0),ee=fu(oe,q,T,b.transform,ce),he,we;b.terrain&&b.terrain.prepareDrawTile(),L.activeTexture.set(F.TEXTURE0),ie.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),L.activeTexture.set(F.TEXTURE1),q&&q.rasterParticleState?(q.rasterParticleState.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),he=Math.pow(2,q.tileID.overscaledZ-oe.tileID.overscaledZ),we=[oe.tileID.canonical.x*he%1,oe.tileID.canonical.y*he%1]):ie.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);let pe=j?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(J,N),ae=b.transform,Ee=pt(ae),Fe=o.bc(K.canonical),ze=o.bd(Fe.getCenter().lat),ke,_e,De,Re,Qe;j?(ke=Float32Array.from(o.bf(o.bg(K.canonical))),_e=Float32Array.from(ae.globeMatrix),De=Float32Array.from(o.bb(ae)),Re=[o.aj(ae.center.lng),o.ak(ae.center.lat)],Qe=Float32Array.from(o.be(K.canonical,Fe,ze,ae.worldSize/ae._pixelsPerMercatorPixel))):(ke=new Float32Array(16),_e=new Float32Array(9),De=new Float32Array(16),Re=[0,0],Qe=new Float32Array(9));let Ke=_d(pe,ke,_e,De,Qe,we||[0,0],o.a1(b.transform.zoom),Re,Ee,he||1,ee,250),nt=b.isTileAffectedByFog(K),Je=b.getOrCreateProgram("rasterParticle",{defines:$,overrideFog:nt});if(b.uploadCommonUniforms(L,Je,J),j){let Ze=new o.ae(F.LEQUAL,o.ae.ReadWrite,b.depthRangeFor3D),Ae=0,at=b.globeSharedBuffers;if(at){let[Lt,gt,It]=at.getGridBuffers(ze,Ae!==0);Je.draw(b,F.TRIANGLES,Ze,Q,o.a.alphaBlended,o.af.backCCW,Ke,M.id,Lt,gt,It)}}else{let Ze=b.depthModeForSublayer(0,o.ae.ReadOnly),Ae=U[K.overscaledZ],{tileBoundsBuffer:at,tileBoundsIndexBuffer:Lt,tileBoundsSegments:gt}=b.getTileBoundsBuffers(oe);Je.draw(b,F.TRIANGLES,Ze,Ae,o.a.alphaBlended,o.af.disabled,Ke,M.id,at,Lt,gt)}}b.resetStencilClippingMasks()}(u,r,a,f),u.style.map.triggerRepaint())},background:function(u,r,a,f){let g=a.paint.get("background-color"),y=a.paint.get("background-opacity"),b=a.paint.get("background-emissive-strength");if(y===0)return;let T=u.context,M=T.gl,C=u.transform,P=C.tileSize,L=a.paint.get("background-pattern"),F;if(L!==void 0&&(L===null||(F=u.imageManager.getPattern(L.toString(),a.scope,u.style.getLut(a.scope)),!F)))return;let N=!L&&g.a===1&&y===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==N)return;let j=o.ag.disabled,U=u.depthModeForSublayer(0,N==="opaque"?o.ae.ReadWrite:o.ae.ReadOnly),G=u.colorModeForDrapableLayerRenderPass(b),$=L?"backgroundPattern":"background",Q,K=f;K||(Q=u.getBackgroundTiles(),K=Object.values(Q).map(J=>J.tileID)),L&&(T.activeTexture.set(M.TEXTURE0),u.imageManager.bind(u.context,a.scope));for(let J of K){let oe=u.isTileAffectedByFog(J),ie=u.getOrCreateProgram($,{overrideFog:oe}),ce=J.toUnwrapped(),q=f?J.projMatrix:u.transform.calculateProjMatrix(ce);u.prepareDrawTile();let ee=r?r.getTile(J):Q?Q[J.key]:new o.by(J,P,C.zoom,u),he=L?Bl(q,b,y,u,0,a.scope,F,{tileID:J,tileSize:P}):Pp(q,b,y,g.toRenderColor(a.lut));u.uploadCommonUniforms(T,ie,ce);let{tileBoundsBuffer:we,tileBoundsIndexBuffer:pe,tileBoundsSegments:ae}=u.getTileBoundsBuffers(ee);ie.draw(u,M.TRIANGLES,U,j,G,o.af.disabled,he,a.id,we,pe,ae)}},sky:function(u,r,a){let f=u._atmosphere?o.a1(u.transform.zoom):1,g=a.paint.get("sky-opacity")*f;if(g===0)return;let y=u.context,b=a.paint.get("sky-type"),T=new o.ae(y.gl.LEQUAL,o.ae.ReadOnly,[0,1]),M=u.frameCounter/1e3%1;b==="atmosphere"?u.renderPass==="offscreen"?a.needsSkyboxCapture(u)&&(function(C,P,L,F){let N=C.context,j=N.gl,U=P.skyboxFbo;if(!U){U=P.skyboxFbo=N.createFramebuffer(32,32,!0,null),P.skyboxGeometry=new Ul(N),P.skyboxTexture=N.gl.createTexture(),j.bindTexture(j.TEXTURE_CUBE_MAP,P.skyboxTexture),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR);for(let K=0;K<6;++K)j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+K,0,j.RGBA,32,32,0,j.RGBA,j.UNSIGNED_BYTE,null)}N.bindFramebuffer.set(U.framebuffer),N.viewport.set([0,0,32,32]);let G=P.getCenter(C,!0),$=C.getOrCreateProgram("skyboxCapture"),Q=new Float64Array(16);o.ad.identity(Q),o.ad.rotateY(Q,Q,.5*-Math.PI),Gi(C,P,$,Q,G,0),o.ad.identity(Q),o.ad.rotateY(Q,Q,.5*Math.PI),Gi(C,P,$,Q,G,1),o.ad.identity(Q),o.ad.rotateX(Q,Q,.5*-Math.PI),Gi(C,P,$,Q,G,2),o.ad.identity(Q),o.ad.rotateX(Q,Q,.5*Math.PI),Gi(C,P,$,Q,G,3),o.ad.identity(Q),Gi(C,P,$,Q,G,4),o.ad.identity(Q),o.ad.rotateY(Q,Q,Math.PI),Gi(C,P,$,Q,G,5),N.viewport.set([0,0,C.width,C.height])}(u,a),a.markSkyboxValid(u)):u.renderPass==="sky"&&function(C,P,L,F,N){let j=C.context,U=j.gl,G=C.transform,$=C.getOrCreateProgram("skybox");j.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_CUBE_MAP,P.skyboxTexture);let Q=((K,J,oe,ie,ce)=>({u_matrix:K,u_sun_direction:J,u_cubemap:0,u_opacity:ie,u_temporal_offset:ce}))(G.skyboxMatrix,P.getCenter(C,!1),0,F,N);C.uploadCommonUniforms(j,$),$.draw(C,U.TRIANGLES,L,o.ag.disabled,C.colorModeForRenderPass(),o.af.backCW,Q,"skybox",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(u,a,T,g,M):b==="gradient"&&u.renderPass==="sky"&&function(C,P,L,F,N){let j=C.context,U=j.gl,G=C.transform,$=C.getOrCreateProgram("skyboxGradient");P.skyboxGeometry||(P.skyboxGeometry=new Ul(j)),j.activeTexture.set(U.TEXTURE0);let Q=P.colorRampTexture;Q||(Q=P.colorRampTexture=new o.T(j,P.colorRamp,U.RGBA)),Q.bind(U.LINEAR,U.CLAMP_TO_EDGE);let K=((J,oe,ie,ce,q)=>({u_matrix:J,u_color_ramp:0,u_center_direction:oe,u_radius:o.ab(ie),u_opacity:ce,u_temporal_offset:q}))(G.skyboxMatrix,P.getCenter(C,!1),P.paint.get("sky-gradient-radius"),F,N);C.uploadCommonUniforms(j,$),$.draw(C,U.TRIANGLES,L,o.ag.disabled,C.colorModeForRenderPass(),o.af.backCW,K,"skyboxGradient",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(u,a,T,g,M)},debug:function(u,r,a,f,g,y){for(let b=0;b<a.length;b++)if(g){let C=new o.C(f.r*.8,f.g*.8,f.b*.8,1);Ei(u,r,a[b],f,-1,-1,y),Ei(u,r,a[b],f,-1,1,y),Ei(u,r,a[b],f,1,1,y),Ei(u,r,a[b],f,1,-1,y),Ei(u,r,a[b],C,0,0,y)}else Ei(u,r,a[b],f,0,0,y)},custom:function(u,r,a,f){let g=u.context,y=a.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&a.isDraped(r)){if(u.renderPass==="offscreen"){let b=y.prerender;if(b){if(u.setCustomLayerDefaults(),g.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){let T=u.transform.pointMerc;b.call(y,g.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),o.a1(u.transform.zoom),[T.x,T.y],u.transform.pixelsPerMeterRatio)}else b.call(y,g.gl,u.transform.customLayerMatrix());g.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){let T=y.renderToTile;if(T){let M=f[0].canonical,C=new o.Y(M.x+f[0].wrap*(1<<M.z),M.y,M.z);g.setDepthMode(o.ae.disabled),g.setStencilMode(o.ag.disabled),g.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),T.call(y,g.gl,C),g.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),g.setColorMode(u.colorModeForRenderPass()),g.setStencilMode(o.ag.disabled);let b=y.renderingMode==="3d"?new o.ae(u.context.gl.LEQUAL,o.ae.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,o.ae.ReadOnly);if(g.setDepthMode(b),u.transform.projection.name==="globe"){let T=u.transform.pointMerc;y.render(g.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),o.a1(u.transform.zoom),[T.x,T.y],u.transform.pixelsPerMeterRatio)}else y.render(g.gl,u.transform.customLayerMatrix());g.setDirty(),u.setBaseState(),g.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(u,r,a,f){if(u.renderPass==="opaque")return;let g=a.paint.get("model-opacity");if(g===0)return;let y=a.paint.get("model-cast-shadows");if(u.renderPass==="shadow"&&(!y||u.terrain&&g<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof o.Z))return;let b=u.shadowRenderer,T=a.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,T||(b.enabled=!1));let M=()=>{b&&(b.useNormalOffset=!0,T||(b.enabled=!0))},C=r.getSource();if(u.renderPass==="light-beam"&&C.type!=="batched-model")return;if(C.type==="vector"||C.type==="geojson")return function($,Q,K,J,oe){let ie=$.transform;if(ie.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${ie.projection.name} projection is not yet implemented`);let ce=ie.getFreeCameraOptions().position;if(!$.modelManager)return;let q=$.modelManager;K.modelManager=q;let ee=$.shadowRenderer;if(!K._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let he=K._unevaluatedLayout._values["model-id"],we=Br({},K.layout.get("model-id").parameters),pe=$.style.order.indexOf(K.fqid);for(let ae of J){let Ee=Q.getTile(ae).getBucket(K);if(!Ee||Ee.projection.name!==ie.projection.name)continue;let Fe=Ee.getModelUris();Fe&&!Ee.modelsRequested&&(q.addModelsFromBucket(Fe,oe),Ee.modelsRequested=!0);let ze=ba(ae,ie);we.zoom=ze;let ke=he.possiblyEvaluate(we);if(ti($,Ee,ae),Ii.shadowUniformsInitialized=!1,Ii.useSingleShadowCascade=!!ee&&ee.getMaxCascadeForTile(ae.toUnwrapped())===0,$.renderPass==="shadow"&&ee){if($.currentShadowCascade===1&&Ee.isInsideFirstShadowMapFrustum)continue;let Re=ie.calculatePosMatrix(ae.toUnwrapped(),ie.worldSize);if(Ii.tileMatrix.set(Re),Ii.shadowTileMatrix=Float32Array.from(ee.calculateShadowPassMatrixFromMatrix(Re)),Ii.aabb.min.fill(0),Ii.aabb.max[0]=Ii.aabb.max[1]=o.a3,Ii.aabb.max[2]=0,io(Ee,Ii,$,K.scope))continue}let _e=1<<ae.canonical.z,De=[((ce.x-ae.wrap)*_e-ae.canonical.x)*o.a3,(ce.y*_e-ae.canonical.y)*o.a3,ce.z*_e*o.a3];$.conflationActive&&Object.keys(Ee.instancesPerModel).length>0&&$.style.isLayerClipped(K,Q.getSource())&&Ee.updateReplacement(ae,$.replacementSource,pe)&&(Ee.uploaded=!1,Ee.upload($.context));for(let Re in Ee.instancesPerModel){let Qe=Ee.instancesPerModel[Re];Qe.features.length>0&&(Re=ke.evaluate(Qe.features[0].feature,{}));let Ke=q.getModel(Re,oe);if(Ke&&Ke.uploaded)for(let nt of Ke.nodes)ir($,K,nt,Qe,De,ae,Ii)}}}(u,r,a,f,C.type==="vector"?a.scope:""),void M();if(!C.loaded())return;if(C.type==="batched-model")return function($,Q,K,J){K.resetLayerRenderingStats($);let oe=$.context,ie=$.transform,ce=$.style.fog,q=$.shadowRenderer;if(ie.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${ie.projection.name} projection is not yet implemented`);let ee=$.transform.getFreeCameraOptions().position,he=o._.scale([],[ee.x,ee.y,ee.z],$.transform.worldSize);o._.negate(he,he);let we=o.ad.identity([]),pe=o.cg(ie.center.lat,ie.zoom),ae=o.ad.fromScaling([],[1,1,1/pe]);o.ad.translate(we,we,he);let Ee=K.paint.get("model-opacity"),Fe=new o.ae(oe.gl.LEQUAL,o.ae.ReadWrite,$.depthRangeFor3D),ze=new o.ae(oe.gl.LEQUAL,o.ae.ReadOnly,$.depthRangeFor3D),ke=new o.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),_e=$.renderPass==="shadow",De=_e&&q?q.getCurrentCascadeFrustum():ie.getFrustum(ie.scaleZoom(ie.worldSize)),Re=K.paint.get("model-front-cutoff"),Qe=Re[2]<1,Ke=ps($,K.paint.get("model-cutoff-fade-range")),nt=K.getLayerRenderingStats();(function(Je,Ze,Ae,at){let Lt=Je.terrain?Je.terrain.exaggeration():0,gt=Je.transform.zoom;for(let It of at){let Gt=Ze.getTile(It).getBucket(Ae);Gt&&(Je.conflationActive&&Gt.updateReplacement(It,Je.replacementSource),Gt.evaluateScale(Je,Ae),Je.terrain&&Lt>0&&Gt.elevationUpdate(Je.terrain,Lt,It,Ae.source),Gt.needsReEvaluation(Je,gt,Ae)&&Gt.evaluate(Ae))}})($,Q,K,J),function(){let Je,Ze,Ae;Qe?(Je=J.length-1,Ze=-1,Ae=-1):(Je=0,Ze=J.length,Ae=1);for(let at=Je;at!==Ze;at+=Ae){let Lt=J[at],gt=Q.getTile(Lt).getBucket(K);if(!gt||!gt.uploaded)continue;let It=!1;q&&(It=q.getMaxCascadeForTile(Lt.toUnwrapped())===0);let Gt=ie.calculatePosMatrix(Lt.toUnwrapped(),ie.worldSize),Ln=gt.modelTraits,Bt=[];for(let vt of gt.getNodesInfo()){if(vt.hiddenByReplacement||!vt.node.meshes)continue;let wn=vt.node,dn=0;$.terrain&&wn.elevation&&(dn=wn.elevation*$.terrain.exaggeration());let $t=vt.evaluatedScale;if($t[0]<=1&&$t[1]<=1&&$t[2]<=1&&(()=>{let ln=vt.aabb;return ke.min=[...ln.min],ke.max=[...ln.max],ke.min[2]+=dn,ke.max[2]+=dn,o._.transformMat4(ke.min,ke.min,Gt),o._.transformMat4(ke.max,ke.max,Gt),ke})().intersects(De)===0)continue;let Dt=[...Gt],Dn=wn.anchor?wn.anchor[0]:0,Xn=wn.anchor?wn.anchor[1]:0;o.ad.translate(Dt,Dt,[Dn*($t[0]-1),Xn*($t[1]-1),dn]),o._.exactEquals($t,o.cj)||o.ad.scale(Dt,Dt,$t);let gn=o.ad.multiply([],Dt,wn.matrix),Mn=o.ad.multiply([],ie.expandedFarZProjMatrix,gn),Oe=o.ad.multiply([],ie.expandedFarZProjMatrix,Dt),it=o.aA.transformMat4([],[Dn,Xn,dn,1],Mn)[2];wn.hidden=!1;let dr=Ee;_e||(Qe&&(dr*=Md(Dt,ie,vt.aabb,Re)),dr*=hr(Ke,it)),dr!==0?Bt.push({nodeInfo:vt,depth:it,opacity:dr,wvpForNode:Mn,wvpForTile:Oe,nodeModelMatrix:gn,tileModelMatrix:Dt}):wn.hidden=!0}_e||Bt.sort((vt,wn)=>!Qe||vt.opacity===1&&wn.opacity===1?vt.depth<wn.depth?-1:1:vt.opacity===1?-1:wn.opacity===1?1:vt.depth>wn.depth?-1:1);for(let vt of Bt){let wn=vt.nodeInfo,dn=wn.node,$t=o.ad.multiply([],ae,vt.tileModelMatrix);o.ad.multiply($t,we,$t);let Dt=o.ad.invert([],$t);o.ad.transpose(Dt,Dt),o.ad.scale(Dt,Dt,Di),$t=o.ad.multiply($t,$t,dn.matrix);let Dn=$.renderPass==="light-beam",Xn=Ln&o.cl.HasMapboxMeshFeatures,gn=Xn?0:wn.evaluatedRMEA[0][2];for(let Mn=0;Mn<dn.meshes.length;++Mn){let Oe=dn.meshes[Mn],it=Mn===dn.lightMeshIndex,dr=vt.wvpForNode;if(it){if(!Dn&&!$.terrain&&$.shadowRenderer){$.currentLayer<$.firstLightBeamLayer&&($.firstLightBeamLayer=$.currentLayer);continue}dr=vt.wvpForTile}else if(Dn)continue;let ln={defines:[]},be=[];if(vs(ln.defines,be,Oe,$,K.lut),Xn||ln.defines.push("DIFFUSE_SHADED"),It&&ln.defines.push("SHADOWS_SINGLE_CASCADE"),nt&&(_e?nt.numRenderedVerticesInShadowPass+=Oe.vertexArray.length:nt.numRenderedVerticesInTransparentPass+=Oe.vertexArray.length),_e){yr(Oe,vt.nodeModelMatrix,$,K);continue}let Or=null;if(ce){let ri=Mu(vt.nodeModelMatrix,$.transform);if(Or=new Float32Array(ri),ie.projection.name!=="globe"){let jo=Oe.aabb.min,Uo=Oe.aabb.max,[Go,qi]=ce.getOpacityForBounds(ri,jo[0],jo[1],Uo[0],Uo[1]);ln.overrideFog=Go>=zn||qi>=zn}}let Ir=Oe.material,fr;Ir.occlusionTexture&&Ir.occlusionTexture.offsetScale&&(fr=Ir.occlusionTexture.offsetScale,ln.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!_e&&q&&(q.useNormalOffset=!!Oe.normalBuffer);let Dr=$.getOrCreateProgram("model",ln);!_e&&q&&q.setupShadowsFromMatrix(vt.tileModelMatrix,Dr,q.useNormalOffset),$.uploadCommonUniforms(oe,Dr,null,Or);let Ai=Ir.pbrMetallicRoughness;Ai.metallicFactor=.9,Ai.roughnessFactor=.5;let ao=vd(new Float32Array(dr),new Float32Array($t),new Float32Array(Dt),new Float32Array(dn.matrix),$,vt.opacity,Ai.baseColorFactor.toRenderColor(null),Ir.emissiveFactor,Ai.metallicFactor,Ai.roughnessFactor,Ir,gn,K,[0,0,0],fr);!it&&(wn.hasTranslucentParts||vt.opacity<1)&&Dr.draw($,oe.gl.TRIANGLES,Fe,o.ag.disabled,o.a.disabled,o.af.backCCW,ao,K.id,Oe.vertexBuffer,Oe.indexBuffer,Oe.segments,K.paint,$.transform.zoom,void 0,be),Dr.draw($,oe.gl.TRIANGLES,it?ze:Fe,o.ag.disabled,it||vt.opacity<1||wn.hasTranslucentParts?o.a.alphaBlended:o.a.unblended,o.af.backCCW,ao,K.id,Oe.vertexBuffer,Oe.indexBuffer,Oe.segments,K.paint,$.transform.zoom,void 0,be)}}}}()}(u,r,a,f),void M();if(C.type!=="model")return;let P=C.getModels(),L=[],F=u.transform.getFreeCameraOptions().position,N=o._.scale([],[F.x,F.y,F.z],u.transform.worldSize);o._.negate(N,N);let j=[],U=[],G=0;for(let $ of P){let Q=a.paint.get("model-rotation").constantOr(null),K=a.paint.get("model-scale").constantOr(null),J=a.paint.get("model-translation").constantOr(null);$.computeModelMatrix(u,Q,K,J,!0,!0,!1);let oe=o.ad.identity([]),ie=o.cg($.position.lat,u.transform.zoom),ce=o.ad.fromScaling([],[1,1,1/ie]);o.ad.translate(oe,oe,N),L.push({zScaleMatrix:ce,negCameraPosMatrix:oe});for(let q of $.nodes)Hl(u.transform,q,$.matrix,u.transform.expandedFarZProjMatrix,G,j,U);G++}if(j.sort(($,Q)=>Q.depth-$.depth),u.renderPass!=="shadow"){if(g===1)for(let $ of U)va($,u,a,L[$.modelIndex],o.ag.disabled,u.colorModeForRenderPass());else{for(let $ of U)va($,u,a,L[$.modelIndex],o.ag.disabled,o.a.disabled);for(let $ of U)va($,u,a,L[$.modelIndex],u.stencilModeFor3D(),u.colorModeForRenderPass());u.resetStencilClippingMasks()}for(let $ of j)va($,u,a,L[$.modelIndex],o.ag.disabled,u.colorModeForRenderPass());M()}else{for(let $ of U)yr($.mesh,$.nodeModelMatrix,u,a);for(let $ of j)yr($.mesh,$.nodeModelMatrix,u,a);M()}}},$i={model:function(u,r,a){let f=r.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,f.type==="vector"?u.scope:""));if(f.type==="batched-model"||f.type!=="model")return;let g=f.getModels();for(let y of g)y.upload(a.context)},raster:function(u,r,a){let f=r.getSource();if(!(f instanceof ma&&f.loaded()))return;let g=u.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!g)return;let y=u.paint.get("raster-array-band")||f.getInitialBand(g);if(y==null)return;let b=r.getIds().map(T=>r.getTileByID(T));for(let T of b)T.updateNeeded(g,y)&&f.prepareTile(T,g,y)},"raster-particle":function(u,r,a){let f=r.getSource();if(!(f instanceof ma&&f.loaded()))return;let g=u.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!g)return;let y=u.paint.get("raster-particle-array-band")||f.getInitialBand(g);if(y==null)return;let b=r.getIds().map(T=>r.getTileByID(T));for(let T of b)T.updateNeeded(g,y)&&f.prepareTile(T,g,y)}};class ey{constructor(r,a,f,g){this.context=new El(r,a),this.occlusionBuffers=new bs(this.context),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=g,this._timeStamp=o.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let y=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let b of y)this._debugParams.enabledLayers[b]=!0;g.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),g.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),g.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let b of y)g.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],b);this.symbolParams=new ra(g),this.setup(),this.numSublayers=o.bv.maxUnderzooming+o.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ad(this),this._wireframeDebugCache=new ql,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(r,a){let f=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new hd(this,r));let g=this._terrain;this.transform.elevation=f?g:null,g.update(r,this.transform,a),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(r){let a=r.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[f,g]=a.getFovAdjustedRange(this.transform._fov);if(f>g)return void(this.transform.fogCullDistSq=null);let y=f+.78*(g-f);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new hd(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,a){if(this.width=r*o.e.devicePixelRatio,this.height=a*o.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let f of this.style.order)this.style._mergedLayers[f].resize()}setup(){let r=this.context,a=new o.bt;a.emplaceBack(0,0),a.emplaceBack(o.a3,0),a.emplaceBack(0,o.a3),a.emplaceBack(o.a3,o.a3),this.tileExtentBuffer=r.createVertexBuffer(a,o.br.members),this.tileExtentSegments=o.b.simpleSegment(0,0,4,2);let f=new o.bt;f.emplaceBack(0,0),f.emplaceBack(o.a3,0),f.emplaceBack(0,o.a3),f.emplaceBack(o.a3,o.a3),this.debugBuffer=r.createVertexBuffer(f,o.br.members),this.debugSegments=o.b.simpleSegment(0,0,4,5);let g=new o.bt;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(g,o.br.members),this.viewportSegments=o.b.simpleSegment(0,0,4,2);let y=new o.cp;y.emplaceBack(0,0,0,0),y.emplaceBack(o.a3,0,o.a3,0),y.emplaceBack(0,o.a3,0,o.a3),y.emplaceBack(o.a3,o.a3,o.a3,o.a3),this.mercatorBoundsBuffer=r.createVertexBuffer(y,o.cq.members),this.mercatorBoundsSegments=o.b.simpleSegment(0,0,4,2);let b=new o.bu;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(b);let T=new o.cr;for(let C of[0,1,3,2,0])T.emplaceBack(C);this.debugIndexBuffer=r.createIndexBuffer(T),this.emptyTexture=new o.T(r,new o.i({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=o.ad.create();let M=this.context.gl;this.stencilClearMode=new o.ag({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,o.ae.disabled,this.stencilClearMode,o.a.disabled,o.af.disabled,du(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,a,f){if(!a||this.currentStencilSource===a.id||!r.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(let M of f)if(this._tileClippingMaskIDs[M.key]===void 0){T=!0;break}if(!T)return}this.currentStencilSource=a.id;let g=this.context,y=g.gl;this.nextStencilID+f.length>256&&this.clearStencil(),g.setColorMode(o.a.disabled),g.setDepthMode(o.ae.disabled);let b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let T of f){let M=a.getTile(T),C=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:L,tileBoundsSegments:F}=this.getTileBoundsBuffers(M);b.draw(this,y.TRIANGLES,o.ae.disabled,new o.ag({func:y.ALWAYS,mask:0},C,255,y.KEEP,y.KEEP,y.REPLACE),o.a.disabled,o.af.disabled,du(T.projMatrix),"$clipping",P,L,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let r=this.nextStencilID++,a=this.context.gl;return new o.ag({func:a.NOTEQUAL,mask:255},r,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);let a=this.context.gl;return new o.ag({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(r){let a=this.context.gl,f=r.sort((b,T)=>T.overscaledZ-b.overscaledZ),g=f[f.length-1].overscaledZ,y=f[0].overscaledZ-g+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();let b={};for(let T=0;T<y;T++)b[T+g]=new o.ag({func:a.GEQUAL,mask:255},T+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=y,[b,f]}return[{[g]:o.ag.disabled},f]}colorModeForRenderPass(){let r=this.context.gl;return this._showOverdrawInspector?new o.a([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new o.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.a.unblended:o.a.alphaBlended}colorModeForDrapableLayerRenderPass(r){let a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new o.a([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new o.C(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,a,f,g=!1){if(this.depthOcclusion)return new o.ae(this.context.gl.GREATER,o.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!g)return o.ae.disabled;let y=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new o.ae(f||this.context.gl.LEQUAL,a,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){let r=this.context.gl,a=Math.ceil(this.width),f=Math.ceil(this.height),g=this.context.bindFramebuffer.get(),y=r.getParameter(r.TEXTURE_BINDING_2D);this.terrainDepthFBO&&this.terrainDepthFBO.width===a&&this.terrainDepthFBO.height===f||(this.terrainDepthFBO&&(this.terrainDepthFBO.destroy(),this.terrainDepthFBO=void 0,this.terrainDepthTexture=void 0),a!==0&&f!==0&&(this.terrainDepthFBO=new as(this.context,a,f,!1,"texture"),this.terrainDepthTexture=new o.T(this.context,{width:a,height:f,data:null},r.DEPTH_STENCIL),this.terrainDepthFBO.depthAttachment.set(this.terrainDepthTexture.texture))),this.context.bindFramebuffer.set(g),r.bindTexture(r.TEXTURE_2D,y),this.terrainDepthFBO&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.terrainDepthFBO.framebuffer),r.blitFramebuffer(0,0,a,f,0,0,a,f,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((r,a)=>r+a/this._fpsHistory.length,0))}render(r,a){let f=o.e.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=a;let g=this.style._mergedLayers,y=this.style.order.filter(q=>{let ee=g[q];return!(ee.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ee.type]}),b=y.map(q=>g[q]),T=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.e.now()),this.imageManager.beginFrame();let M=0,C=!1;for(let q in T){let ee=T[q];ee.used&&(ee.prepare(this.context),ee.getSource().usedInConflation&&++M)}let P=!1;for(let q of b)q.isHidden(this.transform.zoom)||(q.type==="clip"&&(P=!0),this.prepareLayer(q));let L={},F={},N={},j={},U={};for(let q in T){let ee=T[q];L[q]=ee.getVisibleCoordinates(),F[q]=L[q].slice().reverse(),N[q]=ee.getVisibleCoordinates(!0).reverse(),j[q]=ee.getShadowCasterCoordinates(),U[q]=ee.sortCoordinatesByDistance(L[q])}let G=q=>{let ee=this.style.getLayerSourceCache(q);return ee&&ee.used?ee.getSource():null};if(M||P){let q=[],ee=[],he=0;for(let we of b)this.isSourceForClippingOrConflation(we,G(we))&&(q.push(we),ee.push(he)),he++;if(q&&(P||q.length>1)){let we=[];for(let pe=0;pe<q.length;pe++){let ae=q[pe],Ee=ee[pe],Fe=this.style.getLayerSourceCache(ae);if(!Fe||!Fe.used||!Fe.getSource().usedInConflation&&ae.type!=="clip")continue;let ze=1/0,ke=o.cu.None;if(ae.type==="clip"){ze=Ee;for(let _e of ae.layout.get("clip-layer-types"))ke|=_e==="model"?o.cu.Model:_e==="symbol"?o.cu.Symbol:o.cu.FillExtrusion}we.push({layer:ae.fqid,cache:Fe,order:ze,clipMask:ke})}this.replacementSource.setSources(we),C=!0}}C||this.replacementSource.clear(),this.conflationActive=C,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let q=0;q<b.length;q++){let ee=b[q],he=ee.cutoffRange();if(this.longestCutoffRange=Math.max(he,this.longestCutoffRange),he>0){let we=G(ee);we&&(this.minCutoffZoom=Math.max(we.minzoom,this.minCutoffZoom)),ee.minzoom&&(this.minCutoffZoom=Math.max(ee.minzoom,this.minCutoffZoom))}ee.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=q),this._lastOcclusionLayer=q)}let $=this.style&&this.style.fog;$?(this._fogVisible=$.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=$.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(N),this.opaquePassCutoff=0);let Q=this._shadowRenderer;if(Q){Q.updateShadowParameters(this.transform,this.style.directionalLight);for(let q in T)for(let ee of L[q]){let he={min:0,max:0};this.terrain&&(he=this.terrain.getMinMaxForTile(ee)||he),Q.addShadowReceiver(ee.toUnwrapped(),he.min,he.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new $l(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!o.ct(this.context.gl))return;this.renderPass="offscreen";for(let q of b){let ee=r.getLayerSourceCache(q);if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;let he=ee?F[ee.id]:void 0;(q.type==="custom"||q.type==="raster"||q.type==="raster-particle"||q.isSky()||he&&he.length)&&this.renderLayer(this,ee,q,he)}this.depthRangeFor3D=[0,1-(b.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,j)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let K=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),J=(()=>{if(a.showOverdrawInspector)return o.C.black;let q=this.style.fog;if(q&&this.transform.projection.supportsFog){let ee=this.style.getLut(q.scope);if(!K){let he=q.properties.get("color").toRenderColor(ee).toArray01();return new o.C(...he)}if(K){let he=q.properties.get("space-color").toRenderColor(ee).toArray01();return new o.C(...he)}}return o.C.transparent})();if(this.context.clear({color:J,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&K&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){let q=b[this.currentLayer],ee=r.getLayerSourceCache(q);if(q.isSky())continue;let he=ee?(q.is3D()?U:F)[ee.id]:void 0;this._renderTileClippingMasks(q,ee,he),this.renderLayer(this,ee,q,he)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&K&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.a1(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){let q=b[this.currentLayer],ee=r.getLayerSourceCache(q);q.isSky()&&this.renderLayer(this,ee,q,ee?F[ee.id]:void 0)}function oe(q,ee){let he;return ee&&(he=(q.type==="symbol"?N:q.is3D()?U:F)[ee.id]),he}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<y.length;){let q=b[this.currentLayer];if(q.type==="raster"){let ee=r.getLayerSourceCache(q);this.renderLayer(this,ee,q,oe(q,ee))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ie=0;Q&&(ie=Q.getShadowCastingLayerCount());let ce=!1;for(;this.currentLayer<y.length;){let q=b[this.currentLayer],ee=r.getLayerSourceCache(q);if(q.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(q)){if(q.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(ce||!this.terrain||!this.style.hasSymbolLayers()&&!this.style.hasCircleLayers()||this.transform.isOrthographic||(ce=!0,this.blitDepth()),q.is3D()||this.terrain||this._renderTileClippingMasks(q,ee,ee?L[ee.id]:void 0),this.renderLayer(this,ee,q,oe(q,ee)),!this.terrain&&Q&&ie>0&&q.hasShadowPass()&&--ie==0&&(Q.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let he=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=he;this.currentLayer++){let we=b[this.currentLayer];if(!we.hasLightBeamPass())continue;let pe=r.getLayerSourceCache(we);this.renderLayer(this,pe,we,pe?F[pe.id]:void 0)}this.currentLayer=he,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let he=this.currentLayer;this.depthOcclusion=!0;for(let we of this.layersWithOcclusionOpacity){this.currentLayer=we;let pe=b[this.currentLayer],ae=r.getLayerSourceCache(pe),Ee=ae?F[ae.id]:void 0;pe.is3D()||this.terrain||this._renderTileClippingMasks(pe,ae,ae?L[ae.id]:void 0),this.renderLayer(this,ae,pe,Ee)}this.depthOcclusion=!1,this.currentLayer=he,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let q=null;b.forEach(ee=>{let he=r.getLayerSourceCache(ee);he&&!ee.isHidden(this.transform.zoom)&&he.getVisibleCoordinates().length&&(!q||q.getSource().maxzoom<he.getSource().maxzoom)&&(q=he)}),q&&this.options.showTileBoundaries&&Cd.debug(this,q,q.getVisibleCoordinates(),o.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Cd.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(q){let ee=q.transform.padding;st(q,q.transform.height-(ee.top||0),3,Np),st(q,ee.bottom||0,3,Du),rn(q,ee.left||0,3,Id),rn(q,q.transform.width-(ee.right||0),3,Ui);let he=q.transform.centerPoint;(function(we,pe,ae,Ee){Jt(we,pe-1,ae-10,2,20,Ee),Jt(we,pe-10,ae-1,20,2,Ee)})(q,he.x,q.transform.height-he.y,Dd)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),C||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);let{unsupportedLayers:a}=this.transform.projection,f=!a||!a.includes(r.type);if($i[r.type]&&(f||this.terrain&&r.type==="custom")){let g=this.style.getLayerSourceCache(r);$i[r.type](r,g,this)}this.gpuTimingEnd()}renderLayer(r,a,f,g){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||g&&g.length)&&(this.id=f.id,this.gpuTimingStart(f),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(f.type)&&(!r.terrain||f.type!=="custom")||f.type==="clip"||Cd[f.type](r,a,f,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;let a=this.context.extTimerQuery,f=this.context.gl,g=this.gpuTimers[r.id];g||(g=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:f.createQuery()}),g.calls++,f.beginQuery(a.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let r=this.context.extTimerQuery,a=this.context.gl,f=a.createQuery();this.deferredRenderGpuTimeQueries.push(f),a.beginQuery(r.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){let r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){let a={};for(let f in r){let g=r[f],y=this.context.extTimerQuery,b=y.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(g.query),a[f]=b}return a}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;let a=this.context.extTimerQuery,f=this.context.gl,g=0;for(let y of r)g+=a.getQueryParameter(y,f.QUERY_RESULT)/1e6,a.deleteQueryEXT(y);return g}translatePosMatrix(r,a,f,g,y){if(!f[0]&&!f[1])return r;let b=y?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(b){let C=Math.sin(b),P=Math.cos(b);f=[f[0]*P-f[1]*C,f[0]*C+f[1]*P]}let T=[y?f[0]:o.bB(a,f[0],this.transform.zoom),y?f[1]:o.bB(a,f[1],this.transform.zoom),0],M=new Float32Array(16);return o.ad.translate(M,r,T),M}saveTileTexture(r){let a=r.size[0],f=this._tileTextures[a];f?f.push(r):this._tileTextures[a]=[r]}getTileTexture(r){let a=this._tileTextures[r];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,a,f){let g=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,y=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||y.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?y.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):y.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||g||a!==void 0&&!a||y.push("FOG","FOG_DITHERING"),g&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(r,a){this.cache=this.cache||{};let f=a&&a.defines||[],g=a&&a.config,y=this.currentGlobalDefines(r,a&&a.overrideFog,a&&a.overrideRtt).concat(f),b=dd.cacheKey(vp[r],r,y,g);return this.cache[b]||(this.cache[b]=new dd(this.context,r,vp[r],g,Rp[r],y)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.terrainDepthFBO&&(this.terrainDepthFBO.destroy(),this.terrainDepthFBO=void 0,this.terrainDepthTexture=void 0)}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,a){if(this.style.enable3dLights()){let f=this.style.directionalLight,g=this.style.ambientLight;if(f&&g){let y=((b,T,M)=>{let C=b.properties.get("direction"),P=b.properties.get("color").toRenderColor(M.getLut(b.scope)).toArray01(),L=b.properties.get("intensity"),F=T.properties.get("color").toRenderColor(M.getLut(T.scope)).toArray01(),N=T.properties.get("intensity"),j=[C.x,C.y,C.z],U=o.bA(F,N),G=o.bA(P,L);return{u_lighting_ambient_color:U,u_lighting_directional_dir:j,u_lighting_directional_color:G,u_ground_radiance:Ip(j,G,U)}})(f,g,this.style);a.setLightsUniformValues(r,y)}}}uploadCommonUniforms(r,a,f,g,y){if(this.uploadCommonLightUniforms(r,a),this.terrain&&this.terrain.renderingToTexture)return;let b=this.style.fog;if(b){let T=b.getOpacity(this.transform.pitch),M=((C,P,L,F,N,j,U,G,$,Q,K,J)=>{let oe=C.transform,ie=P.properties.get("color").toRenderColor(C.style.getLut(P.scope)).toArray01();ie[3]=F;let ce=C.frameCounter/1e3%1,[q,ee]=P.properties.get("vertical-range");return{u_fog_matrix:L?oe.calculateFogTileMatrix(L):J||C.identityMat,u_fog_range:P.getFovAdjustedRange(oe._fov),u_fog_color:ie,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(q,ee),ee],u_fog_temporal_offset:ce,u_frustum_tl:N,u_frustum_tr:j,u_frustum_br:U,u_frustum_bl:G,u_globe_pos:$,u_globe_radius:Q,u_viewport:K,u_globe_transition:o.a1(oe.zoom),u_is_globe:+(oe.projection.name==="globe")}})(this,b,f,T,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.e.devicePixelRatio,this.transform.height*o.e.devicePixelRatio],g);a.setFogUniformValues(r,M)}y&&a.setCutoffUniformValues(r,y.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){let r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){let r=this.context.gl,a=r.createTexture();return r.bindTexture(r.TEXTURE_2D,a),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let r=this._backgroundTiles,a=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(let g of f)a[g.key]=r[g.key]||new o.by(g,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,a){return!(!r.is3D()||r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||r.sourceLayer!=="building")&&r.type!=="clip"&&(!a||a.type!=="batched-model"))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[r.key];return a||(this._cachedTileFogOpacities[r.key]=a=this.style.fog.getOpacityForTile(r)),a[0]>=zn||a[1]>=zn}}class Cu{constructor(r,a,f,g){this.screenBounds=r,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(r,a){let f,g;if(r instanceof o.P||typeof r[0]=="number"){let y=o.P.convert(r);f=[y],g=a.isPointAboveHorizon(y)}else{let y=o.P.convert(r[0]),b=o.P.convert(r[1]);f=[y,b],g=o.cv(y,b).every(T=>a.isPointAboveHorizon(T))}return new Cu(f,a.getCameraPoint(),g,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.cv(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){let a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],g=o.cv(a,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<f.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?g[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(g[3]=this.cameraPoint)),o.cw(g,r)}bufferedCameraGeometryGlobe(r){let a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],g=o.cv(a,f,r),y=this.cameraPoint.clone();switch(3*((y.y>a.y)+(y.y>f.y))+((y.x>a.x)+(y.x>f.x))){case 0:g[0]=y,g[4]=y.clone();break;case 1:g.splice(1,0,y);break;case 2:g[1]=y;break;case 3:g.splice(4,0,y);break;case 5:g.splice(2,0,y);break;case 6:g[3]=y;break;case 7:g.splice(3,0,y);break;case 8:g[2]=y}return g}containsTile(r,a,f,g=0){let y=r.queryPadding/a._pixelsPerMercatorPixel+1,b=f?this._bufferedCameraMercator(y,a):this._bufferedScreenMercator(y,a),T=r.tileID.wrap+(b.unwrapped?g:0),M=b.polygon.map(G=>o.cx(r.tileTransform,G,T));if(!o.cy(M,0,0,o.a3,o.a3))return;T=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);let C=this.screenGeometryMercator.polygon.map(G=>o.cz(r.tileTransform,G,T)),P=C.map(G=>new o.P(G[0],G[1])),L=a.getFreeCameraOptions().position||new o.Y(0,0,0),F=o.cz(r.tileTransform,L,T),N=C.map(G=>{let $=o._.sub(G,G,F);return o._.normalize($,$),new o.aT(F,$)}),j=o.bB(r,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:N,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(U=o.cA(M),U.min.x=o.at(U.min.x,0,o.a3),U.min.y=o.at(U.min.y,0,o.a3),U.max.x=o.at(U.max.x,0,o.a3),U.max.y=o.at(U.max.y,0,o.a3),U),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:j};var U}_bufferedScreenMercator(r,a){let f=Xl(r);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),a):{polygon:this.bufferedScreenGeometry(r).map(y=>a.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[f]=g,g}}_bufferedCameraMercator(r,a){let f=Xl(r);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),a):{polygon:this.bufferedCameraGeometry(r).map(y=>a.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[f]=g,g}}_projectAndResample(r,a){let f=function(y,b){let T=o.ad.multiply([],b.pixelMatrix,b.globeMatrix),M=[0,-o.cD,0,1],C=[0,o.cD,0,1],P=[0,0,0,1];o.aA.transformMat4(M,M,T),o.aA.transformMat4(C,C,T),o.aA.transformMat4(P,P,T);let L=new o.P(M[0]/M[3],M[1]/M[3]),F=new o.P(C[0]/C[3],C[1]/C[3]),N=o.cB(y,L)&&M[3]<P[3],j=o.cB(y,F)&&C[3]<P[3];if(!N&&!j)return null;let U=function(ce,q,ee){for(let he=1;he<ce.length;he++){let we=Zl(q.pointCoordinate3D(ce[he-1]).x),pe=Zl(q.pointCoordinate3D(ce[he]).x);if(ee<0){if(we<pe)return{idx:he,t:-we/(pe-1-we)}}else if(pe<we)return{idx:he,t:(1-we)/(pe+1-we)}}return null}(y,b,N?-1:1);if(!U)return null;let{idx:G,t:$}=U,Q=G>1?Lr(y.slice(0,G),b):[],K=G<y.length?Lr(y.slice(G),b):[];Q=Q.map(ce=>new o.P(Zl(ce.x),ce.y)),K=K.map(ce=>new o.P(Zl(ce.x),ce.y));let J=[...Q];J.length===0&&J.push(K[K.length-1]);let oe=o.a2(J[J.length-1].y,(K.length===0?Q[0]:K[0]).y,$),ie;return ie=N?[new o.P(0,oe),new o.P(0,0),new o.P(1,0),new o.P(1,oe)]:[new o.P(1,oe),new o.P(1,1),new o.P(0,1),new o.P(0,oe)],J.push(...ie),K.length===0?J.push(Q[0]):J.push(...K),{polygon:J.map(ce=>new o.Y(ce.x,ce.y)),unwrapped:!1}}(r,a);if(f)return f;let g=function(y,b){let T=!1,M=-1/0,C=0;for(let L=0;L<y.length-1;L++)y[L].x>M&&(M=y[L].x,C=L);for(let L=0;L<y.length-1;L++){let F=(C+L)%(y.length-1),N=y[F],j=y[F+1];Math.abs(N.x-j.x)>.5&&(N.x<j.x?(N.x+=1,F===0&&(y[y.length-1].x+=1)):(j.x+=1,F+1===y.length-1&&(y[0].x+=1)),T=!0)}let P=o.aj(b.center.lng);return T&&P<Math.abs(P-1)&&y.forEach(L=>{L.x-=1}),{polygon:y,unwrapped:T}}(Lr(r,a).map(y=>new o.P(Zl(y.x),y.y)),a);return{polygon:g.polygon.map(y=>new o.Y(y.x,y.y)),unwrapped:g.unwrapped}}}function Lr(u,r){return o.cC(u,a=>{let f=r.pointCoordinate3D(a);a.x=f.x,a.y=f.y},1/256)}function Zl(u){return u<0?1+u%1:u%1}function Xl(u){return 100*u|0}function zp(u,r){let a=o.ad.identity([]);return o.ad.scale(a,a,[.5*u.width,.5*-u.height,1]),o.ad.translate(a,a,[1,-1,0]),o.ad.multiply(a,a,u.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(a)}function Yl(u,r,a,f,g,y,b,T=!1){let M=u.tilesIn(f,b,T);M.sort(Bp);let C=[];for(let L of M)C.push({wrappedTileID:L.tile.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(r,a,u._state,L,g,y,zp(u.transform,L.tile.tileID),T)});let P=function(L){let F={},N={};for(let j of L){let U=j.queryResults,G=j.wrappedTileID,$=N[G]=N[G]||{};for(let Q in U){let K=U[Q],J=$[Q]=$[Q]||{},oe=F[Q]=F[Q]||[];for(let ie of K)J[ie.featureIndex]||(J[ie.featureIndex]=!0,oe.push(ie))}}return F}(C);for(let L in P)P[L].forEach(F=>{let N=F.feature,j=N.layer;j&&j.type!=="background"&&j.type!=="sky"&&j.type!=="slot"&&(N.source=j.source,j["source-layer"]&&(N.sourceLayer=j["source-layer"]),N.state=N.id!==void 0?u.getFeatureState(j["source-layer"],N.id):{})});return P}function ty(u,r){let a=u.getRenderableIds().map(y=>u.getTileByID(y)),f=[],g={};for(let y=0;y<a.length;y++){let b=a[y],T=b.tileID.canonical.key;g[T]||(g[T]=!0,b.querySourceFeatures(f,r))}return f}function Bp(u,r){let a=u.tileID,f=r.tileID;return a.overscaledZ-f.overscaledZ||a.canonical.y-f.canonical.y||a.wrap-f.wrap||a.canonical.x-f.canonical.x}class Ql{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let r=!1,a=!1;for(let f in this.style._mergedLayers){let g=this.style._mergedLayers[f];if(g.type==="fill-extrusion")this.layers.push({layer:g,visible:r,visibilityChanged:a});else if(g.type==="model"){let y=this.style.getLayerSource(g);y&&y.type==="batched-model"&&this.layers.push({layer:g,visible:r,visibilityChanged:a})}}}onNewFrame(r){this.layersGotHidden=!1;for(let a of this.layers){let f=a.layer,g=!1;f.type==="fill-extrusion"?g=!f.isHidden(r)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="model"&&(g=!f.isHidden(r)&&f.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!g&&a.visible,a.visible=g}}updateZOffset(r,a){this.currentBuildingBuckets=[];for(let g of this.layers){let y=g.layer,b=this.style.getLayerSourceCache(y),T=1;y.type==="fill-extrusion"&&(T=g.visible?y.paint.get("fill-extrusion-vertical-scale"):0);let M=b?b.getTile(a):null;if(!M&&b&&a.canonical.z>b.getSource().minzoom){let C=a.scaledTo(Math.min(b.getSource().maxzoom,a.overscaledZ-1));for(;C.overscaledZ>=b.getSource().minzoom&&(M=b.getTile(C),!M&&C.overscaledZ!==0);)C=C.scaledTo(C.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:M?M.getBucket(y):null,tileID:M?M.tileID:a,verticalScale:T})}r.hasAnyZOffset=!1;let f=!1;for(let g=0;g<r.symbolInstances.length;g++){let y=r.symbolInstances.get(g),b=y.zOffset,T=this._getHeightAtTileOffset(a,y.tileAnchorX,y.tileAnchorY);y.zOffset=T!==Number.NEGATIVE_INFINITY?T:b,f||b===y.zOffset||(f=!0),r.hasAnyZOffset||y.zOffset===0||(r.hasAnyZOffset=!0)}f&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,a,f,g){let y=a,b=f;if(r.canonical.z!==g.canonical.z){let T=g.canonical,M=1/(1<<r.canonical.z-T.z);y=(a+r.canonical.x*o.a3)*M-T.x*o.a3|0,b=(f+r.canonical.y*o.a3)*M-T.y*o.a3|0}return{tileX:y,tileY:b}}_getHeightAtTileOffset(r,a,f){let g,y;for(let b=0;b<this.layers.length;++b){if(this.layers[b].layer.type!=="fill-extrusion")continue;let{bucket:T,tileID:M,verticalScale:C}=this.currentBuildingBuckets[b];if(!T)continue;let{tileX:P,tileY:L}=this._mapCoordToOverlappingTile(r,a,f,M),F=T.getHeightAtTileCoord(P,L);F&&F.height!==void 0&&(F.hidden?g=F.height:y=Math.max(F.height*C,y||0))}if(y!==void 0)return y;for(let b=0;b<this.layers.length;++b){let T=this.layers[b];if(T.layer.type!=="model"||!T.visible)continue;let{bucket:M,tileID:C}=this.currentBuildingBuckets[b];if(!M)continue;let{tileX:P,tileY:L}=this._mapCoordToOverlappingTile(r,a,f,C),F=M.getHeightAtTileCoord(P,L);if(F&&!F.hidden)return F.height===void 0&&g!==void 0?Math.min(F.maxHeight,g)*F.verticalScale:F.height?F.height*F.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Kl(u,r){let a={};for(let f in u)f!=="ref"&&(a[f]=u[f]);return o.cE.forEach(f=>{f in r&&(a[f]=r[f])}),a}function Vp(u){u=u.slice();let r=Object.create(null);for(let a=0;a<u.length;a++)r[u[a].id]=u[a];for(let a=0;a<u.length;a++)"ref"in u[a]&&(u[a]=Kl(u[a],r[u[a].ref]));return u}let Wt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Sd(u,r,a){a.push({command:Wt.addSource,args:[u,r[u]]})}function Jl(u,r,a){r.push({command:Wt.removeSource,args:[u]}),a[u]=!0}function Bo(u,r,a,f){Jl(u,a,f),Sd(u,r,a)}function ny(u,r,a){let f;for(f in u[a])if(u[a].hasOwnProperty(f)&&f!=="data"&&!k(u[a][f],r[a][f]))return!1;for(f in r[a])if(r[a].hasOwnProperty(f)&&f!=="data"&&!k(u[a][f],r[a][f]))return!1;return!0}function Su(u,r,a,f,g,y){let b;for(b in r=r||{},u=u||{})u.hasOwnProperty(b)&&(k(u[b],r[b])||a.push({command:y,args:[f,b,r[b],g]}));for(b in r)r.hasOwnProperty(b)&&!u.hasOwnProperty(b)&&(k(u[b],r[b])||a.push({command:y,args:[f,b,r[b],g]}))}function Au(u){return u.id}function ec(u,r){return u[r.id]=r,u}class ry{constructor(r,a){this.reset(r,a)}reset(r,a){this.points=r||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.at(r,0,1);let a=1,f=this._distances[a],g=r*this.paddedLength+this.padding;for(;f<g&&a<this._distances.length;)f=this._distances[++a];let y=a-1,b=this._distances[y],T=f-b,M=T>0?(g-b)/T:0;return this.points[y].mult(1-M).add(this.points[a].mult(M))}}class Pu{constructor(r,a,f){let g=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(r/f),this.yCellCount=Math.ceil(a/f);for(let b=0;b<this.xCellCount*this.yCellCount;b++)g.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=a,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,a,f,g,y){this._forEachCell(a,f,g,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(a),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(y)}insertCircle(r,a,f,g){this._forEachCell(a-g,f-g,a+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(a),this.circles.push(f),this.circles.push(g)}_insertBoxCell(r,a,f,g,y,b){this.boxCells[y].push(b)}_insertCircleCell(r,a,f,g,y,b){this.circleCells[y].push(b)}_query(r,a,f,g,y,b){if(f<0||r>this.width||g<0||a>this.height)return!y&&[];let T=[];if(r<=0&&a<=0&&this.width<=f&&this.height<=g){if(y)return!0;for(let M=0;M<this.boxKeys.length;M++)T.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){let C=this.circles[3*M],P=this.circles[3*M+1],L=this.circles[3*M+2];T.push({key:this.circleKeys[M],x1:C-L,y1:P-L,x2:C+L,y2:P+L})}return b?T.filter(b):T}return this._forEachCell(r,a,f,g,this._queryCell,T,{hitTest:y,seenUids:{box:{},circle:{}}},b),y?T.length>0:T}_queryCircle(r,a,f,g,y){let b=r-f,T=r+f,M=a-f,C=a+f;if(T<0||b>this.width||C<0||M>this.height)return!g&&[];let P=[];return this._forEachCell(b,M,T,C,this._queryCellCircle,P,{hitTest:g,circle:{x:r,y:a,radius:f},seenUids:{box:{},circle:{}}},y),g?P.length>0:P}query(r,a,f,g,y){return this._query(r,a,f,g,!1,y)}hitTest(r,a,f,g,y){return this._query(r,a,f,g,!0,y)}hitTestCircle(r,a,f,g){return this._queryCircle(r,a,f,!0,g)}_queryCell(r,a,f,g,y,b,T,M){let C=T.seenUids,P=this.boxCells[y];if(P!==null){let F=this.bboxes;for(let N of P)if(!C.box[N]){C.box[N]=!0;let j=4*N;if(r<=F[j+2]&&a<=F[j+3]&&f>=F[j+0]&&g>=F[j+1]&&(!M||M(this.boxKeys[N]))){if(T.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[N],x1:F[j],y1:F[j+1],x2:F[j+2],y2:F[j+3]})}}}let L=this.circleCells[y];if(L!==null){let F=this.circles;for(let N of L)if(!C.circle[N]){C.circle[N]=!0;let j=3*N;if(this._circleAndRectCollide(F[j],F[j+1],F[j+2],r,a,f,g)&&(!M||M(this.circleKeys[N]))){if(T.hitTest)return b.push(!0),!0;{let U=F[j],G=F[j+1],$=F[j+2];b.push({key:this.circleKeys[N],x1:U-$,y1:G-$,x2:U+$,y2:G+$})}}}}}_queryCellCircle(r,a,f,g,y,b,T,M){let C=T.circle,P=T.seenUids,L=this.boxCells[y];if(L!==null){let N=this.bboxes;for(let j of L)if(!P.box[j]){P.box[j]=!0;let U=4*j;if(this._circleAndRectCollide(C.x,C.y,C.radius,N[U+0],N[U+1],N[U+2],N[U+3])&&(!M||M(this.boxKeys[j])))return b.push(!0),!0}}let F=this.circleCells[y];if(F!==null){let N=this.circles;for(let j of F)if(!P.circle[j]){P.circle[j]=!0;let U=3*j;if(this._circlesCollide(N[U],N[U+1],N[U+2],C.x,C.y,C.radius)&&(!M||M(this.circleKeys[j])))return b.push(!0),!0}}}_forEachCell(r,a,f,g,y,b,T,M){let C=this._convertToXCellCoord(r),P=this._convertToYCellCoord(a),L=this._convertToXCellCoord(f),F=this._convertToYCellCoord(g);for(let N=C;N<=L;N++)for(let j=P;j<=F;j++)if(y.call(this,r,a,f,g,this.xCellCount*j+N,b,T,M))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,a,f,g,y,b){let T=g-r,M=y-a,C=f+b;return C*C>T*T+M*M}_circleAndRectCollide(r,a,f,g,y,b,T){let M=(b-g)/2,C=Math.abs(r-(g+M));if(C>M+f)return!1;let P=(T-y)/2,L=Math.abs(a-(y+P));if(L>P+f)return!1;if(C<=M||L<=P)return!0;let F=C-M,N=L-P;return F*F+N*N<=f*f}}let Ci=100;class jp{constructor(r,a,f=new Pu(r.width+200,r.height+200,25),g=new Pu(r.width+200,r.height+200,25)){this.transform=r,this.grid=f,this.ignoredGrid=g,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Ci,this.screenBottomBoundary=r.height+Ci,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=a}placeCollisionBox(r,a,f,g,y,b,T,M){let C=f.projectedAnchorX,P=f.projectedAnchorY,L=f.projectedAnchorZ,F=f.elevation,N=f.tileID,j=r.getProjection();if(F&&N){let[ie,ce,q]=j.upVector(N.canonical,f.tileAnchorX,f.tileAnchorY),ee=j.upVectorScale(N.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;C+=ie*F*ee,P+=ce*F*ee,L+=q*F*ee}let U=this.projectAndGetPerspectiveRatio(T,C,P,L,f.tileID,j.name==="globe"||!!F||this.transform.pitch>0,j),G=b*U.perspectiveRatio,$=(f.x1*a+g.x-f.padding)*G+U.point.x,Q=(f.y1*a+g.y-f.padding)*G+U.point.y,K=(f.x2*a+g.x+f.padding)*G+U.point.x,J=(f.y2*a+g.y+f.padding)*G+U.point.y,oe=U.perspectiveRatio<=.55||U.occluded;return!this.isInsideGrid($,Q,K,J)||!y&&this.grid.hitTest($,Q,K,J,M)||oe?{box:[],offscreen:!1,occluded:U.occluded}:{box:[$,Q,K,J],offscreen:this.isOffscreen($,Q,K,J),occluded:!1}}placeCollisionCircles(r,a,f,g,y,b,T,M,C,P,L,F,N,j,U){let G=[],$=this.transform.elevation,Q=r.getProjection(),K=$?$.getAtTileOffsetFunc(U,this.transform.center.lat,this.transform.worldSize,Q):null,J=new o.P(f.tileAnchorX,f.tileAnchorY),{x:oe,y:ie,z:ce}=Q.projectTilePoint(J.x,J.y,U.canonical);if(K){let[ke,_e,De]=K(J);oe+=ke,ie+=_e,ce+=De}let q=Q.name==="globe",ee=this.projectAndGetPerspectiveRatio(T,oe,ie,ce,U,q||!!$||this.transform.pitch>0,Q),{perspectiveRatio:he}=ee,we=(L?b/he:b*he)/o.bN,pe=$r(oe,ie,ce,M),ae=ee.signedDistanceFromCamera>0?lu(we,y,f.lineOffsetX*we,f.lineOffsetY*we,!1,pe,J,f,g,M,{},$&&!L?K:null,L&&!!$,Q,U,L):null,Ee=!1,Fe=!1,ze=!0;if(ae&&!ee.occluded){let ke=.5*N*he+j,_e=new o.P(-100,-100),De=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Re=new ry,{first:Qe,last:Ke}=ae,nt=Qe.path.length,Je=[];for(let at=nt-1;at>=1;at--)Je.push(Qe.path[at]);for(let at=1;at<Ke.path.length;at++)Je.push(Ke.path[at]);let Ze=2.5*ke;C&&(Je=Je.map(([at,Lt,gt],It)=>(K&&!q&&(gt=K(It<nt-1?Qe.tilePath[nt-1-It]:Ke.tilePath[It-nt+2])[2]),$r(at,Lt,gt,C))),Je.some(at=>at[3]<=0)&&(Je=[]));let Ae=[];if(Je.length>0){let at=1/0,Lt=-1/0,gt=1/0,It=-1/0;for(let Gt of Je)at=Math.min(at,Gt[0]),gt=Math.min(gt,Gt[1]),Lt=Math.max(Lt,Gt[0]),It=Math.max(It,Gt[1]);Lt>=_e.x&&at<=De.x&&It>=_e.y&&gt<=De.y&&(Ae=[Je.map(Gt=>new o.P(Gt[0],Gt[1]))],(at<_e.x||Lt>De.x||gt<_e.y||It>De.y)&&(Ae=o.cF(Ae,_e.x,_e.y,De.x,De.y)))}for(let at of Ae){Re.reset(at,.25*ke);let Lt=0;Lt=Re.length<=.5*ke?1:Math.ceil(Re.paddedLength/Ze)+1;for(let gt=0;gt<Lt;gt++){let It=gt/Math.max(Lt-1,1),Gt=Re.lerp(It),Ln=Gt.x+Ci,Bt=Gt.y+Ci;G.push(Ln,Bt,ke,0);let vt=Ln-ke,wn=Bt-ke,dn=Ln+ke,$t=Bt+ke;if(ze=ze&&this.isOffscreen(vt,wn,dn,$t),Fe=Fe||this.isInsideGrid(vt,wn,dn,$t),!a&&this.grid.hitTestCircle(Ln,Bt,ke,F)&&(Ee=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Ee,occluded:!1}}}}return{circles:!P&&Ee||!Fe?[]:G,offscreen:ze,collisionDetected:Ee,occluded:ee.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let a=[],f=1/0,g=1/0,y=-1/0,b=-1/0;for(let P of r){let L=new o.P(P.x+Ci,P.y+Ci);f=Math.min(f,L.x),g=Math.min(g,L.y),y=Math.max(y,L.x),b=Math.max(b,L.y),a.push(L)}let T=this.grid.query(f,g,y,b).concat(this.ignoredGrid.query(f,g,y,b)),M={},C={};for(let P of T){let L=P.key;if(M[L.bucketInstanceId]===void 0&&(M[L.bucketInstanceId]={}),M[L.bucketInstanceId][L.featureIndex])continue;let F=[new o.P(P.x1,P.y1),new o.P(P.x2,P.y1),new o.P(P.x2,P.y2),new o.P(P.x1,P.y2)];o.cG(a,F)&&(M[L.bucketInstanceId][L.featureIndex]=!0,C[L.bucketInstanceId]===void 0&&(C[L.bucketInstanceId]=[]),C[L.bucketInstanceId].push(L.featureIndex))}return C}insertCollisionBox(r,a,f,g,y){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:g,collisionGroupID:y},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,a,f,g,y){let b=a?this.ignoredGrid:this.grid,T={bucketInstanceId:f,featureIndex:g,collisionGroupID:y};for(let M=0;M<r.length;M+=4)b.insertCircle(T,r[M],r[M+1],r[M+2])}projectAndGetPerspectiveRatio(r,a,f,g,y,b,T){let M=[a,f,g,1],C=!1;g||this.transform.pitch>0?(o.aA.transformMat4(M,M,r),this.fogState&&y&&T.name!=="globe"&&(C=function(F,N,j,U,G,$){let Q=$.calculateFogTileMatrix(G),K=[N,j,U];return o._.transformMat4(K,K,Q),sr(F,o._.length(K),$.pitch,$._fov)}(this.fogState,a,f,g,y.toUnwrapped(),this.transform)>.9)):id(M,M,r);let P=M[3];return{point:new o.P((M[0]/P+1)/2*this.transform.width+Ci,(-M[1]/P+1)/2*this.transform.height+Ci),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(T)/P*.5,1.5),signedDistanceFromCamera:P,occluded:b&&M[2]>P||C}}isOffscreen(r,a,f,g){return f<Ci||r>=this.screenRightBoundary||g<Ci||a>this.screenBottomBoundary}isInsideGrid(r,a,f,g){return f>=0&&r<this.gridRightBoundary&&g>=0&&a<this.gridBottomBoundary}getViewportMatrix(){let r=o.ad.identity([]);return o.ad.translate(r,r,[-100,-100,0]),r}}class Ad{constructor(r,a,f,g){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?a:-a))):g&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class wa{constructor(r,a,f,g,y,b=!1){this.text=new Ad(r?r.text:null,a,f,y),this.icon=new Ad(r?r.icon:null,a,g,y),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class oo{constructor(r,a,f,g=!1){this.text=r,this.icon=a,this.skipFade=f,this.clipped=g}}class Ru{constructor(){this.invProjMatrix=o.ad.create(),this.viewportMatrix=o.ad.create(),this.circles=[]}}class Up{constructor(r,a,f,g,y){this.bucketInstanceId=r,this.featureIndex=a,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=y}}class Gp{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){let a=++this.maxGroupID;this.collisionGroups[r]={ID:a,predicate:f=>f.collisionGroupID===a}}return this.collisionGroups[r]}}function Ta(u,r,a,f,g){let{horizontalAlign:y,verticalAlign:b}=o.bQ(u),T=-(y-.5)*r,M=-(b-.5)*a,C=o.bP(u,f);return new o.P(T+C[0]*g,M+C[1]*g)}function ws(u,r,a,f,g){let y=new o.P(u,r);return a&&y._rotate(f?g:-g),y}class $p{constructor(r,a,f,g,y,b){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new jp(this.transform,y),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Gp(f),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,a,f,g){let y=f.getBucket(a),b=f.latestFeatureIndex;if(!y||!b||a.fqid!==y.layerIds[0])return;let T=y.layers[0].layout,M=f.collisionBoxArray,C=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),P=f.tileSize/o.a3,L=f.tileID.toUnwrapped();this.transform.setProjection(y.projection);let F=(N=f.tileID,j=y.getProjection(),U=this.transform,j.name===this.projection?U.calculateProjMatrix(N.toUnwrapped()):bd(U,j,N));var N,j,U;let G=T.get("text-pitch-alignment")==="map",$=T.get("text-rotation-alignment")==="map";a.compileFilter();let Q=a.dynamicFilter(),K=a.dynamicFilterNeedsFeature(),J=this.transform.calculatePixelsToTileUnitsMatrix(f),oe=Rl(F,f.tileID.canonical,G,$,this.transform,y.getProjection(),J),ie=null;if(G){let ee=ds(F,f.tileID.canonical,G,$,this.transform,y.getProjection(),J);ie=o.ad.multiply([],this.transform.labelPlaneMatrix,ee)}let ce=null;Q&&f.latestFeatureIndex&&(ce={unwrappedTileID:L,dynamicFilter:Q,dynamicFilterNeedsFeature:K,featureIndex:f.latestFeatureIndex}),this.retainedQueryData[y.bucketInstanceId]=new Up(y.bucketInstanceId,b,y.sourceLayerIndex,y.index,f.tileID);let q={bucket:y,layout:T,posMatrix:F,textLabelPlaneMatrix:oe,labelToScreenMatrix:ie,clippingData:ce,scale:C,textPixelRatio:P,holdingForFade:f.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:o.aD(y.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.aD(y.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(g)for(let ee of y.sortKeyRanges){let{sortKey:he,symbolInstanceStart:we,symbolInstanceEnd:pe}=ee;r.push({sortKey:he,symbolInstanceStart:we,symbolInstanceEnd:pe,parameters:q})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:q})}attemptAnchorPlacement(r,a,f,g,y,b,T,M,C,P,L,F,N,j,U,G,$,Q){let{textOffset0:K,textOffset1:J,crossTileID:oe}=F,ie=[K,J],ce=Ta(r,f,g,ie,y),q=this.collisionIndex.placeCollisionBox(j,y,a,ws(ce.x,ce.y,b,T,this.transform.angle),L,M,C,P.predicate);if(G){let ee=j.getSymbolInstanceIconSize(Q,this.transform.zoom,F.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(j,ee,G,ws(ce.x,ce.y,b,T,this.transform.angle),L,M,C,P.predicate).box.length===0)return}if(q.box.length>0){let ee;return this.prevPlacement&&this.prevPlacement.variableOffsets[oe]&&this.prevPlacement.placements[oe]&&this.prevPlacement.placements[oe].text&&(ee=this.prevPlacement.variableOffsets[oe].anchor),this.variableOffsets[oe]={textOffset:ie,width:f,height:g,anchor:r,textScale:y,prevAnchor:ee},this.markUsedJustification(j,r,F,U),j.allowVerticalPlacement&&(this.markUsedOrientation(j,U,F),this.placedOrientations[oe]=U),{shift:ce,placedGlyphBoxes:q}}}placeLayerBucketPart(r,a,f,g){let{bucket:y,layout:b,posMatrix:T,textLabelPlaneMatrix:M,labelToScreenMatrix:C,clippingData:P,textPixelRatio:L,holdingForFade:F,collisionBoxArray:N,partiallyEvaluatedTextSize:j,partiallyEvaluatedIconSize:U,collisionGroup:G}=r.parameters,$=b.get("text-optional"),Q=b.get("icon-optional"),K=b.get("text-allow-overlap"),J=b.get("icon-allow-overlap"),oe=b.get("text-rotation-alignment")==="map",ie=b.get("text-pitch-alignment")==="map",ce=b.get("symbol-z-order")==="viewport-y",q=b.get("symbol-z-elevate");this.transform.setProjection(y.projection);let ee=K&&(J||!y.hasIconData()||Q),he=J&&(K||!y.hasTextData()||$);!y.collisionArrays&&N&&y.deserializeCollisionBoxes(N),f&&g&&y.updateCollisionDebugBuffers(this.transform.zoom,N);let we=(pe,ae,Ee)=>{let{crossTileID:Fe,numVerticalGlyphVertices:ze}=pe;if(P){let dn={zoom:this.transform.zoom,pitch:this.transform.pitch},$t=null;if(P.dynamicFilterNeedsFeature){let Dt=this.retainedQueryData[y.bucketInstanceId];$t=P.featureIndex.loadFeature({featureIndex:pe.featureIndex,bucketIndex:Dt.bucketIndex,sourceLayerIndex:Dt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,P.dynamicFilter)(dn,$t,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new o.P(pe.tileAnchorX,pe.tileAnchorY),this.transform.calculateDistanceTileData(P.unwrappedTileID)))return this.placements[Fe]=new oo(!1,!1,!1,!0),void a.add(Fe)}if(a.has(Fe))return;if(F)return void(this.placements[Fe]=new oo(!1,!1,!1));let ke=!1,_e=!1,De=!0,Re=!1,Qe=!1,Ke=null,nt={box:null,offscreen:null,occluded:null},Je={box:null,offscreen:null,occluded:null},Ze=null,Ae=null,at=null,Lt=0,gt=0,It=0;Ee.textFeatureIndex?Lt=Ee.textFeatureIndex:pe.useRuntimeCollisionCircles&&(Lt=pe.featureIndex),Ee.verticalTextFeatureIndex&&(gt=Ee.verticalTextFeatureIndex);let Gt=dn=>{dn.tileID=this.retainedQueryData[y.bucketInstanceId].tileID;let $t=this.transform.elevation;dn.elevation=pe.zOffset+($t?$t.getAtTileOffset(dn.tileID,dn.tileAnchorX,dn.tileAnchorY):0)},Ln=Ee.textBox;if(Ln){Gt(Ln);let dn=Dt=>{let Dn=o.aE.horizontal;if(y.allowVerticalPlacement&&!Dt&&this.prevPlacement){let Xn=this.prevPlacement.placedOrientations[Fe];Xn&&(this.placedOrientations[Fe]=Xn,Dn=Xn,this.markUsedOrientation(y,Dn,pe))}return Dn},$t=(Dt,Dn)=>{if(y.allowVerticalPlacement&&ze>0&&Ee.verticalTextBox){for(let Xn of y.writingModes)if(Xn===o.aE.vertical?(nt=Dn(),Je=nt):nt=Dt(),nt&&nt.box&&nt.box.length)break}else nt=Dt()};if(b.get("text-variable-anchor")){let Dt=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Fe]){let gn=this.prevPlacement.variableOffsets[Fe];Dt.indexOf(gn.anchor)>0&&(Dt=Dt.filter(Mn=>Mn!==gn.anchor),Dt.unshift(gn.anchor))}let Dn=(gn,Mn,Oe)=>{let it=y.getSymbolInstanceTextSize(j,pe,this.transform.zoom,ae),dr=(gn.x2-gn.x1)*it+2*gn.padding,ln=(gn.y2-gn.y1)*it+2*gn.padding,be=pe.hasIconTextFit&&!J?Mn:null;be&&Gt(be);let Or={box:[],offscreen:!1,occluded:!1},Ir=K?2*Dt.length:Dt.length;for(let fr=0;fr<Ir;++fr){let Dr=this.attemptAnchorPlacement(Dt[fr%Dt.length],gn,dr,ln,it,oe,ie,L,T,G,fr>=Dt.length,pe,ae,y,Oe,be,j,U);if(Dr&&(Or=Dr.placedGlyphBoxes,Or&&Or.box&&Or.box.length)){ke=!0,Ke=Dr.shift;break}}return Or};$t(()=>Dn(Ln,Ee.iconBox,o.aE.horizontal),()=>{let gn=Ee.verticalTextBox;return gn&&Gt(gn),y.allowVerticalPlacement&&!(nt&&nt.box&&nt.box.length)&&ze>0&&gn?Dn(gn,Ee.verticalIconBox,o.aE.vertical):{box:null,offscreen:null,occluded:null}}),nt&&(ke=nt.box,De=nt.offscreen,Re=nt.occluded);let Xn=dn(!(!nt||!nt.box));if(!ke&&this.prevPlacement){let gn=this.prevPlacement.variableOffsets[Fe];gn&&(this.variableOffsets[Fe]=gn,this.markUsedJustification(y,gn.anchor,pe,Xn))}}else{let Dt=(Dn,Xn)=>{let gn=y.getSymbolInstanceTextSize(j,pe,this.transform.zoom,ae),Mn=this.collisionIndex.placeCollisionBox(y,gn,Dn,new o.P(0,0),K,L,T,G.predicate);return Mn&&Mn.box&&Mn.box.length&&(this.markUsedOrientation(y,Xn,pe),this.placedOrientations[Fe]=Xn),Mn};$t(()=>Dt(Ln,o.aE.horizontal),()=>{let Dn=Ee.verticalTextBox;return y.allowVerticalPlacement&&ze>0&&Dn?(Gt(Dn),Dt(Dn,o.aE.vertical)):{box:null,offscreen:null,occluded:null}}),dn(!!(nt&&nt.box&&nt.box.length))}}if(Ze=nt,ke=Ze&&Ze.box&&Ze.box.length>0,De=Ze&&Ze.offscreen,Re=Ze&&Ze.occluded,pe.useRuntimeCollisionCircles){let dn=y.text.placedSymbolArray.get(pe.centerJustifiedTextSymbolIndex>=0?pe.centerJustifiedTextSymbolIndex:pe.verticalPlacedTextSymbolIndex),$t=o.aF(y.textSizeData,j,dn),Dt=b.get("text-padding");Ae=this.collisionIndex.placeCollisionCircles(y,K,dn,y.lineVertexArray,y.glyphOffsetArray,$t,T,M,C,f,ie,G.predicate,pe.collisionCircleDiameter*$t/o.bN,Dt,this.retainedQueryData[y.bucketInstanceId].tileID),ke=K||Ae.circles.length>0&&!Ae.collisionDetected,De=De&&Ae.offscreen,Re=Ae.occluded}if(Ee.iconFeatureIndex&&(It=Ee.iconFeatureIndex),Ee.iconBox){let dn=$t=>{Gt($t);let Dt=pe.hasIconTextFit&&Ke?ws(Ke.x,Ke.y,oe,ie,this.transform.angle):new o.P(0,0),Dn=y.getSymbolInstanceIconSize(U,this.transform.zoom,pe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(y,Dn,$t,Dt,J,L,T,G.predicate)};Je&&Je.box&&Je.box.length&&Ee.verticalIconBox?(at=dn(Ee.verticalIconBox),_e=at.box.length>0):(at=dn(Ee.iconBox),_e=at.box.length>0),De=De&&at.offscreen,Qe=at.occluded}let Bt=$||pe.numHorizontalGlyphVertices===0&&ze===0,vt=Q||pe.numIconVertices===0;if(Bt||vt?vt?Bt||(_e=_e&&ke):ke=_e&&ke:_e=ke=_e&&ke,ke&&Ze&&Ze.box&&this.collisionIndex.insertCollisionBox(Ze.box,b.get("text-ignore-placement"),y.bucketInstanceId,Je&&Je.box&&gt?gt:Lt,G.ID),_e&&at&&this.collisionIndex.insertCollisionBox(at.box,b.get("icon-ignore-placement"),y.bucketInstanceId,It,G.ID),Ae&&(ke&&this.collisionIndex.insertCollisionCircles(Ae.circles,b.get("text-ignore-placement"),y.bucketInstanceId,Lt,G.ID),f)){let dn=y.bucketInstanceId,$t=this.collisionCircleArrays[dn];$t===void 0&&($t=this.collisionCircleArrays[dn]=new Ru);for(let Dt=0;Dt<Ae.circles.length;Dt+=4)$t.circles.push(Ae.circles[Dt+0]),$t.circles.push(Ae.circles[Dt+1]),$t.circles.push(Ae.circles[Dt+2]),$t.circles.push(Ae.collisionDetected?1:0)}let wn=y.projection.name!=="globe";ee=ee&&(wn||!Re),he=he&&(wn||!Qe),this.placements[Fe]=new oo(ke||ee,_e||he,De||y.justReloaded),a.add(Fe)};if(q&&this.buildingIndex&&(this.buildingIndex.updateZOffset(y,this.retainedQueryData[y.bucketInstanceId].tileID),y.updateZOffset()),ce){let pe=y.getSortedSymbolIndexes(this.transform.angle);for(let ae=pe.length-1;ae>=0;--ae){let Ee=pe[ae];we(y.symbolInstances.get(Ee),Ee,y.collisionArrays[Ee])}y.hasAnyZOffset&&o.w(`${y.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(y.hasAnyZOffset){let pe=y.getSortedIndexesByZOffset();for(let ae=0;ae<pe.length;++ae){let Ee=pe[ae];we(y.symbolInstances.get(Ee),Ee,y.collisionArrays[Ee])}}else for(let pe=r.symbolInstanceStart;pe<r.symbolInstanceEnd;pe++)we(y.symbolInstances.get(pe),pe,y.collisionArrays[pe]);if(f&&y.bucketInstanceId in this.collisionCircleArrays){let pe=this.collisionCircleArrays[y.bucketInstanceId];o.ad.invert(pe.invProjMatrix,T),pe.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(r,a,f,g){let{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:M,crossTileID:C}=f,P=o.cJ(a),L=g===o.aE.vertical?M:P==="left"?y:P==="center"?b:P==="right"?T:-1;y>=0&&(r.text.placedSymbolArray.get(y).crossTileID=L>=0&&y!==L?0:C),b>=0&&(r.text.placedSymbolArray.get(b).crossTileID=L>=0&&b!==L?0:C),T>=0&&(r.text.placedSymbolArray.get(T).crossTileID=L>=0&&T!==L?0:C),M>=0&&(r.text.placedSymbolArray.get(M).crossTileID=L>=0&&M!==L?0:C)}markUsedOrientation(r,a,f){let g=a===o.aE.horizontal||a===o.aE.horizontalOnly?a:0,y=a===o.aE.vertical?a:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:C}=f,P=r.text.placedSymbolArray;b>=0&&(P.get(b).placedOrientation=g),T>=0&&(P.get(T).placedOrientation=g),M>=0&&(P.get(M).placedOrientation=g),C>=0&&(P.get(C).placedOrientation=y)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;let a=this.prevPlacement,f=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;let g=a?a.symbolFadeChange(r):1,y=a?a.opacities:{},b=a?a.variableOffsets:{},T=a?a.placedOrientations:{};for(let M in this.placements){let C=this.placements[M],P=y[M];P?(this.opacities[M]=new wa(P,g,C.text,C.icon,null,C.clipped),f=f||C.text!==P.text.placed||C.icon!==P.icon.placed):(this.opacities[M]=new wa(null,g,C.text,C.icon,C.skipFade,C.clipped),f=f||C.text||C.icon)}for(let M in y){let C=y[M];if(!this.opacities[M]){let P=new wa(C,g,!1,!1);P.isHidden()||(this.opacities[M]=P,f=f||C.text.placed||C.icon.placed)}}for(let M in b)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=b[M]);for(let M in T)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=T[M]);f?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:r)}updateLayerOpacities(r,a,f,g){let y=new Set;for(let b of a){let T=b.getBucket(r);T&&b.latestFeatureIndex&&r.fqid===T.layerIds[0]&&(this.updateBucketOpacities(T,y,b.collisionBoxArray,f,g,b.tileID),T.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(T,b.tileID),T.updateZOffset()))}}updateBucketOpacities(r,a,f,g,y,b){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();let T=r.layers[0].layout,M=!!r.layers[0].dynamicFilter(),C=new wa(null,0,!1,!1,!0),P=T.get("text-allow-overlap"),L=T.get("icon-allow-overlap"),F=T.get("text-variable-anchor"),N=T.get("text-rotation-alignment")==="map",j=T.get("text-pitch-alignment")==="map",U=new wa(null,0,P&&(L||!r.hasIconData()||T.get("icon-optional")),L&&(P||!r.hasTextData()||T.get("text-optional")),!0);!r.collisionArrays&&f&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(f);let G=(Q,K,J)=>{for(let oe=0;oe<K/4;oe++)Q.opacityVertexArray.emplaceBack(J)},$=0;y&&r.updateReplacement(b,y);for(let Q=0;Q<r.symbolInstances.length;Q++){let K=r.symbolInstances.get(Q),{numHorizontalGlyphVertices:J,numVerticalGlyphVertices:oe,crossTileID:ie,numIconVertices:ce,tileAnchorX:q,tileAnchorY:ee}=K,he=a.has(ie),we=this.opacities[ie];he?we=C:we||(we=U,this.opacities[ie]=we),a.add(ie);let pe=J>0||oe>0,ae=ce>0,Ee=this.placedOrientations[ie],Fe=Ee===o.aE.vertical,ze=Ee===o.aE.horizontal||Ee===o.aE.horizontalOnly;!pe&&!ae||we.isHidden()||$++;let ke=!1;if((pe||ae)&&y)for(let _e of r.activeReplacements){if(_e.order<g||_e.order===1/0||!(_e.clipMask&o.cu.Symbol)||_e.min.x>q||q>_e.max.x||_e.min.y>ee||ee>_e.max.y)continue;let De=o.cH(q,ee,b.canonical,_e.footprintTileId.canonical);if(ke=o.cI(De,_e),ke)break}if(pe){let _e=ke?qr:tc(we.text);G(r.text,J,Fe?qr:_e),G(r.text,oe,ze?qr:_e);let De=we.text.isHidden(),{leftJustifiedTextSymbolIndex:Re,centerJustifiedTextSymbolIndex:Qe,rightJustifiedTextSymbolIndex:Ke,verticalPlacedTextSymbolIndex:nt}=K,Je=r.text.placedSymbolArray,Ze=De||Fe?1:0;Re>=0&&(Je.get(Re).hidden=Ze),Qe>=0&&(Je.get(Qe).hidden=Ze),Ke>=0&&(Je.get(Ke).hidden=Ze),nt>=0&&(Je.get(nt).hidden=De||ze?1:0);let Ae=this.variableOffsets[ie];Ae&&this.markUsedJustification(r,Ae.anchor,K,Ee);let at=this.placedOrientations[ie];at&&(this.markUsedJustification(r,"left",K,at),this.markUsedOrientation(r,at,K))}if(ae){let _e=ke?qr:tc(we.icon),{placedIconSymbolIndex:De,verticalPlacedIconSymbolIndex:Re}=K,Qe=r.icon.placedSymbolArray,Ke=we.icon.isHidden()?1:0;De>=0&&(G(r.icon,ce,Fe?qr:_e),Qe.get(De).hidden=Ke),Re>=0&&(G(r.icon,K.numVerticalIconVertices,ze?qr:_e),Qe.get(Re).hidden=Ke)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){let _e=r.collisionArrays[Q];if(_e){let De=new o.P(0,0),Re=!0;if(_e.textBox||_e.verticalTextBox){if(F){let Ke=this.variableOffsets[ie];Ke?(De=Ta(Ke.anchor,Ke.width,Ke.height,Ke.textOffset,Ke.textScale),N&&De._rotate(j?this.transform.angle:-this.transform.angle)):Re=!1}M&&(Re=!we.clipped),_e.textBox&&Ea(r.textCollisionBox.collisionVertexArray,we.text.placed,!Re||Fe,De.x,De.y),_e.verticalTextBox&&Ea(r.textCollisionBox.collisionVertexArray,we.text.placed,!Re||ze,De.x,De.y)}let Qe=Re&&!!(!ze&&_e.verticalIconBox);_e.iconBox&&Ea(r.iconCollisionBox.collisionVertexArray,we.icon.placed,Qe,K.hasIconTextFit?De.x:0,K.hasIconTextFit?De.y:0),_e.verticalIconBox&&Ea(r.iconCollisionBox.collisionVertexArray,we.icon.placed,!Qe,K.hasIconTextFit?De.x:0,K.hasIconTextFit?De.y:0)}}}if(r.fullyClipped=$===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){let Q=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=Q.invProjMatrix,r.placementViewportMatrix=Q.viewportMatrix,r.collisionCircleArray=Q.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,a){let f=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*f>r}setStale(){this.stale=!0}}function Ea(u,r,a,f,g){u.emplaceBack(r?1:0,a?1:0,f||0,g||0),u.emplaceBack(r?1:0,a?1:0,f||0,g||0),u.emplaceBack(r?1:0,a?1:0,f||0,g||0),u.emplaceBack(r?1:0,a?1:0,f||0,g||0)}let hi=Math.pow(2,25),Pd=Math.pow(2,24),Ye=Math.pow(2,17),Hp=Math.pow(2,16),Rd=Math.pow(2,9),Ld=Math.pow(2,8),qp=Math.pow(2,1);function tc(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;let r=u.placed?1:0,a=Math.floor(127*u.opacity);return a*hi+r*Pd+a*Ye+r*Hp+a*Rd+r*Ld+a*qp+r}let qr=0;class Od{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,a,f,g,y){let b=this._bucketParts;for(;this._currentTileIndex<r.length;)if(a.getBucketParts(b,g,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((T,M)=>T.sortKey-M.sortKey));this._currentPartIndex<b.length;){let T=b[this._currentPartIndex];if(a.placeLayerBucketPart(T,this._seenCrossTileIDs,f,T.symbolInstanceStart===0),this._currentPartIndex++,y())return!0}return!1}}class Ts{constructor(r,a,f,g,y,b,T,M,C){this.placement=new $p(r,y,b,T,M,C),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(r,a,f,g){let y=o.e.now(),b=()=>{let T=o.e.now()-y;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){let T=a[r[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=M)&&(!T.maxzoom||T.maxzoom>M)){let C=T,P=C.layout.get("symbol-z-elevate"),L=this._inProgressLayer=this._inProgressLayer||new Od(C),F=o.al(T.source,T.scope);if(L.continuePlacement(P?g[F]:f[F],this.placement,this._showCollisionBoxes,T,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}let Ia=512/o.a3/2;class Da{constructor(r,a,f){this.tileID=r,this.bucketInstanceId=f,this.index=new o.cK(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let g=r.canonical.x*o.a3,y=r.canonical.y*o.a3;for(let b=0;b<a.length;b++){let{key:T,crossTileID:M,tileAnchorX:C,tileAnchorY:P}=a.get(b),L=Math.floor((g+C)*Ia),F=Math.floor((y+P)*Ia);this.index.add(L,F),this.keys.push(T),this.crossTileIDs.push(M)}this.index.finish()}findMatches(r,a,f){let g=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),y=Ia/Math.pow(2,a.canonical.z-this.tileID.canonical.z),b=a.canonical.x*o.a3,T=a.canonical.y*o.a3;for(let M=0;M<r.length;M++){let C=r.get(M);if(C.crossTileID)continue;let{key:P,tileAnchorX:L,tileAnchorY:F}=C,N=Math.floor((b+L)*y),j=Math.floor((T+F)*y),U=this.index.range(N-g,j-g,N+g,j+g);for(let G of U){let $=this.crossTileIDs[G];if(this.keys[G]===P&&!f.has($)){f.add($),C.crossTileID=$;break}}}}}class iy{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class oy{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){let a=Math.round((r-this.lng)/360);if(a!==0)for(let f in this.indexes){let g=this.indexes[f],y={};for(let b in g){let T=g[b];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+a),y[T.tileID.key]=T}this.indexes[f]=y}this.lng=r}addBucket(r,a,f){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let y=0;y<a.symbolInstances.length;y++)a.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);let g=this.usedCrossTileIDs[r.overscaledZ];for(let y in this.indexes){let b=this.indexes[y];if(Number(y)>r.overscaledZ)for(let T in b){let M=b[T];M.tileID.isChildOf(r)&&M.findMatches(a.symbolInstances,r,g)}else{let T=b[r.scaledTo(Number(y)).key];T&&T.findMatches(a.symbolInstances,r,g)}}for(let y=0;y<a.symbolInstances.length;y++){let b=a.symbolInstances.get(y);b.crossTileID||(b.crossTileID=f.generate(),g.add(b.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Da(r,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(r,a){for(let f of a.crossTileIDs)this.usedCrossTileIDs[r].delete(f)}removeStaleBuckets(r){let a=!1;for(let f in this.indexes){let g=this.indexes[f];for(let y in g)r[g[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[y]),delete g[y],a=!0)}return a}}class kd{constructor(){this.layerIndexes={},this.crossTileIDs=new iy,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,a,f,g){let y=this.layerIndexes[r.fqid];y===void 0&&(y=this.layerIndexes[r.fqid]=new oy);let b=!1,T={};g.name!=="globe"&&y.handleWrapJump(f);for(let M of a){let C=M.getBucket(r);C&&r.fqid===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(M.tileID,C,this.crossTileIDs)&&(b=!0),T[C.bucketInstanceId]=!0)}return y.removeStaleBuckets(T)&&(b=!0),b}pruneUnusedLayers(r){let a={};r.forEach(f=>{a[f]=!0});for(let f in this.layerIndexes)a[f]||delete this.layerIndexes[f]}}let sy=new o.N({data:new o.O(o.L.colorTheme.data)}),Vo=(u,r)=>Ct(u,r&&r.filter(a=>a.identifier!=="source.canvas")),Wp=o.ah(Wt,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Fd=o.ah(Wt,["setCenter","setZoom","setBearing","setPitch"]),Zp={version:8,layers:[],sources:{}},Xp={duration:300,delay:0};class Si extends o.E{constructor(r,a={}){super(),this.map=r,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=o.W({},Xp),this._buildingIndex=new Ql(this),this.crossTileSymbolIndex=new kd,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new Sr,this.dispatcher=a.dispatcher?a.dispatcher:new o.bw(o.bx(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new Il,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new o.cM(r._requestManager,a.localFontFamily?o.cN.all:a.localIdeographFontFamily?o.cN.ideographs:o.cN.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new tu(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",o.cO());let f=this;this._rtlTextPluginCallback=Si.registerForPluginStateChange(g=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(y,b)=>{if(o.cP(y),b&&b.every(T=>T))for(let T in f._sourceCaches){let M=f._sourceCaches[T],C=M.getSource().type;C!=="vector"&&C!=="geojson"||M.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;let y=this.getOwnSource(g.sourceId);if(y&&y.vectorLayerIds)for(let b in this._layers){let T=this._layers[b];T.source===y.id&&this._validateLayer(T)}})}load(r){return r?(typeof r=="string"?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if(typeof r=="string"){if(o.cQ(r))return r;let a=o.cR(r);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${o.cS(JSON.stringify(r))}`}_diffStyle(r,a,f){this.globalId=this._getGlobalId(r);let g=(y,b)=>{try{b(null,this.setState(y,f))}catch(T){b(T,!1)}};if(typeof r=="string"){let y=this.map._requestManager.normalizeStyleURL(r),b=this.map._requestManager.transformRequest(y,o.R.Style);o.g(b,(T,M)=>{T?this.fire(new o.d(T)):M&&g(M,a)})}else typeof r=="object"&&g(r,a)}loadURL(r,a={}){this.fire(new o.f("dataloading",{dataType:"style"}));let f=typeof a.validate=="boolean"?a.validate:!o.cQ(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,a.accessToken),this.resolvedImports.add(r);let g=this.importsCache.get(r);if(g)return this._load(g,f);let y=this.map._requestManager.transformRequest(r,o.R.Style);this._request=o.g(y,(b,T)=>{if(this._request=null,b)this.fire(new o.d(b));else if(T)return this.importsCache.set(r,T),this._load(T,f)})}loadJSON(r,a={}){this.fire(new o.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=o.e.frame(()=>{this._request=null,this._load(r,a.validate!==!1)})}loadEmpty(){this.fire(new o.f("dataloading",{dataType:"style"})),this._load(Zp,!1)}_loadImports(r,a,f){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let g=[];for(let y of r){let b=this._createFragmentStyle(y),T=new Promise(P=>{b.once("style.import.load",P),b.once("error",P)}).then(()=>this.mergeAll());if(g.push(T),this.resolvedImports.has(y.url)){b.loadEmpty();continue}let M=y.data||this.importsCache.get(y.url);M?(b.loadJSON(M,{validate:a}),this._isInternalStyle(M)&&(b.globalId=null)):y.url?b.loadURL(y.url,{validate:a}):b.loadEmpty();let C={style:b,id:y.id,config:y.config};if(f){let P=this.fragments.findIndex(({id:L})=>L===f);this.fragments=this.fragments.slice(0,P).concat(C).concat(this.fragments.slice(P))}else this.fragments.push(C)}return Promise.allSettled(g)}getImportGlobalIds(r=this,a=new Set){for(let f of r.fragments)f.style.globalId&&a.add(f.style.globalId),this.getImportGlobalIds(f.style,a);return[...a.values()]}_createFragmentStyle(r){let a=this.scope?o.al(r.id,this.scope):r.id,f,g=this._initialConfig&&this._initialConfig[a];(r.config||g)&&(f=o.W({},r.config,g));let y=new Si(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&r.fragment!==!1)}_load(r,a){let f=r.schema;if(this._isInternalStyle(r)){let b=o.W({},Zp,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(b,a)}if(this.updateConfig(this._config,f),a&&Vo(this,se(r)))return;this._loaded=!0,this.stylesheet=o.cT(r);let g=()=>{for(let C in r.sources)this.addSource(C,r.sources[C],{validate:!1,isInitialLoad:!0});r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(r.glyphs,this.scope);let b=Vp(this.stylesheet.layers);if(this._order=b.map(C=>C.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let C=this.stylesheet.lights[0];this.light=new lt(C.properties,C.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new lt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let C of b){let P=o.cY(C,this.scope,this._styleColorTheme.lut,this.options);P.isConfigDependent&&this._configDependentLayers.add(P.fqid),P.setEventedParent(this,{layer:{id:P.id}}),this._layers[P.id]=P,this._serializedLayers[P.id]=P.serialize();let L=this.getOwnLayerSourceCache(P),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();L&&P.canCastShadows()&&F&&(L.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let T=this.stylesheet.terrain;T&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(T,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.f("data",{dataType:"style"}));let M=this.isRootStyle();r.imports?this._loadImports(r.imports,a).then(()=>{this._reloadImports(),this.fire(new o.f(M?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.f(M?"style.load":"style.import.load")))},y=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=y,y){let b=this._evaluateColorThemeData(y);this._loadColorTheme(b).then(()=>{g()}).catch(T=>{o.w(`Couldn't load color theme from the stylesheet: ${T}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}mergeAll(){let r,a,f,g,y,b,T,M,C={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(P=>{if(P.stylesheet){if(P.light!=null&&(r=P.light),P.stylesheet.lights)for(let L of P.stylesheet.lights)L.type==="ambient"&&P.ambientLight!=null&&(a=P.ambientLight),L.type==="directional"&&P.directionalLight!=null&&(f=P.directionalLight);g=this._prioritizeTerrain(g,P.terrain,P.stylesheet.terrain),P.stylesheet.fog&&P.fog!=null&&(y=P.fog),P.stylesheet.camera!=null&&(M=P.stylesheet.camera),P.stylesheet.projection!=null&&(b=P.stylesheet.projection),P.stylesheet.transition!=null&&(T=P.stylesheet.transition),C[P.scope]=P._styleColorTheme}}),this.light=r,this.ambientLight=a,this.directionalLight=f,this.fog=y,this._styleColorThemeForScope=C,g===null?delete this.terrain:this.terrain=g,this.camera=M||{"camera-projection":"perspective"},this.projection=b||{name:"mercator"},this.transition=o.W({},Xp,T),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){let a=f=>{for(let g of f.fragments)a(g.style);r(f)};a(this)}_prioritizeTerrain(r,a,f){let g=r&&r.drapeRenderMode===0;return f===null?a&&a.drapeRenderMode===0?a:g?r:null:a!=null&&(!r||g||a&&a.drapeRenderMode===1)?a:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{r=this._prioritizeTerrain(r,a.terrain,a.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(r=a.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){let r={},a={},f={};this.forEachFragmentStyle(g=>{for(let y in g._sourceCaches){let b=o.al(y,g.scope);r[b]=g._sourceCaches[y]}for(let y in g._otherSourceCaches){let b=o.al(y,g.scope);a[b]=g._otherSourceCaches[y]}for(let y in g._symbolSourceCaches){let b=o.al(y,g.scope);f[b]=g._symbolSourceCaches[y]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=f}mergeLayers(){let r={},a=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(b=>{for(let T of b._order){let M=b._layers[T];if(M.type==="slot"){let C=o.cU(T);if(r[C])continue;r[C]=[]}M.slot&&r[M.slot]?r[M.slot].push(M):a.push(M)}}),this._mergedOrder=[],this._clipLayerIndices=[];let g=0,y=(b=[])=>{for(let T of b)if(T.type==="slot"){let M=o.cU(T.id);r[M]&&y(r[M]),this._mergedSlots.push(M)}else{let M=o.al(T.id,T.scope);this._mergedOrder.push(M),f[M]=T,T.is3D()&&(this._has3DLayers=!0),T.type==="circle"&&(this._hasCircleLayers=!0),T.type==="symbol"&&(this._hasSymbolLayers=!0),T.type==="clip"&&this._clipLayerIndices.push(g),g++}};y(a),this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=o.W({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?function(a,f,g){let y=o.W({},f);for(let T of Object.keys(o.L.colorTheme))y[T]===void 0&&(y[T]=o.L.colorTheme[T].default);let b=new o.U(sy,a,new Map(g));return b.setTransitionOrValue(y,g),b.untransitioned().possiblyEvaluate(new o.X(0))}(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;let a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((f,g)=>{let y="data:image/png;base64,";if(!r||r.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let b=r;b.startsWith(y)||(b=y+b);let T="mapbox-reserved-lut",M=new Image;M.src=b,M.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},M.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void f();this._styleColorTheme.lutLoading=!1;let{width:C,height:P,data:L}=o.e.getImageData(M);if(P>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(C!==P*P)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(T)&&this.removeImage(T),this.addImage(T,{data:new o.i({width:C,height:P},L),pixelRatio:1,sdf:!1,version:0});let F=this.imageManager.getImage(T,this.scope);F?(this._styleColorTheme.lut={image:F.data,data:r},f()):g(new Error("Missing LUT image."))}})}getLut(r){let a=this._styleColorThemeForScope[r];return a?a.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(a,f,g){let y,b,T,M=o.e.devicePixelRatio>1?"@2x":"",C=o.g(f.transformRequest(f.normalizeSpriteURL(a,M,".json"),o.R.SpriteJSON),(F,N)=>{C=null,T||(T=F,y=N,L())}),P=o.h(f.transformRequest(f.normalizeSpriteURL(a,M,".png"),o.R.SpriteImage),(F,N)=>{P=null,T||(T=F,b=N,L())});function L(){if(T)g(T);else if(y&&b){let F=o.e.getImageData(b),N={};for(let j in y){let{width:U,height:G,x:$,y:Q,sdf:K,pixelRatio:J,stretchX:oe,stretchY:ie,content:ce}=y[j],q=new o.i({width:U,height:G});o.i.copy(F,q,{x:$,y:Q},{x:0,y:0},{width:U,height:G},null),N[j]={data:q,pixelRatio:J,sdf:K,stretchX:oe,stretchY:ie,content:ce}}g(null,N)}}return{cancel(){C&&(C.cancel(),C=null),P&&(P.cancel(),P=null)}}}(r,this.map._requestManager,(a,f)=>{if(this._spriteRequest=null,a)this.fire(new o.d(a));else if(f)for(let g in f)this.imageManager.addImage(g,this.scope,f[g]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.f("data",{dataType:"style"}))})}_validateLayer(r){let a=this.getOwnSource(r.source);if(!a)return;let f=r.sourceLayer;f&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(f)===-1)&&this.fire(new o.d(new Error(`Source layer "${f}" does not exist on source "${a.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,a)=>{let f=this.fragments[a];return f&&f.style&&(r.data=f.style.serialize()),r})}_serializeSources(){let r={};for(let a in this._sourceCaches){let f=this._sourceCaches[a].getSource();r[f.id]||(r[f.id]=f.serialize())}return r}_serializeLayers(r){let a=[];for(let f of r){let g=this._layers[f];g&&g.type!=="custom"&&a.push(g.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(let r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){let a=this.getOwnLayer(r);if(a)return a;this.fire(new o.d(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){let a=this.getOwnSource(r);if(a)return a;this.fire(new o.d(new Error(`The source '${r}' does not exist in the map's style.`)))}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);let a=this.calculateLightsBrightness();r.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a));let f=this._changes.isDirty(),g=!1;if(this._changes.isDirty()){let b=this._changes.getLayerUpdatesByScope();for(let T in b){let{updatedIds:M,removedIds:C}=b[T];(M||C)&&(this._updateWorkerLayers(T,M,C),g=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._changes.reset()}let y={};for(let b in this._mergedSourceCaches){let T=this._mergedSourceCaches[b];y[b]=T.used,T.used=!1,T.tileCoverLift=0}for(let b of this._mergedOrder){let T=this._mergedLayers[b];if(T.recalculate(r,this._availableImages),!T.isHidden(r.zoom)){let M=this.getLayerSourceCache(T);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,T.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let M=T.minzoom||0;M<(T.maxzoom||25.5);M++){let C=this.map.painter;if(C){let P=T.getProgramIds();if(!P)continue;for(let L of P){let F=T.getDefaultProgramParams(L,r.zoom,this._styleColorTheme.lut);F&&(C.style=this,this.fog&&(C._fogVisible=!0,F.overrideFog=!0,C.getOrCreateProgram(L,F)),C._fogVisible=!1,F.overrideFog=!1,C.getOrCreateProgram(L,F),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(F.overrideRtt=!0,C.getOrCreateProgram(L,F)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&g&&this.mergeLayers();for(let b in y){let T=this._mergedSourceCaches[b];y[b]!==T.used&&T.getSource().fire(new o.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new o.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){let r=this._changes.getUpdatedImages();if(r.length){for(let a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],r);this._changes.resetUpdatedImages()}}_updateWorkerLayers(r,a,f){let g=this.getFragmentStyle(r);g&&this.dispatcher.broadcast("updateLayers",{layers:a?g._serializeLayers(a):[],scope:r,removedIds:f||[],options:g.options})}setState(r,a){if(this._checkLoaded(),Vo(this,se(r)))return!1;(r=o.cT(r)).layers=Vp(r.layers);let f=function(b,T){if(!b)return[{command:Wt.setStyle,args:[T]}];let M=[];try{if(!k(b.version,T.version))return[{command:Wt.setStyle,args:[T]}];if(k(b.center,T.center)||M.push({command:Wt.setCenter,args:[T.center]}),k(b.zoom,T.zoom)||M.push({command:Wt.setZoom,args:[T.zoom]}),k(b.bearing,T.bearing)||M.push({command:Wt.setBearing,args:[T.bearing]}),k(b.pitch,T.pitch)||M.push({command:Wt.setPitch,args:[T.pitch]}),k(b.sprite,T.sprite)||M.push({command:Wt.setSprite,args:[T.sprite]}),k(b.glyphs,T.glyphs)||M.push({command:Wt.setGlyphs,args:[T.glyphs]}),k(b.imports,T.imports)||function(N=[],j=[],U){j=j||[];let G=(N=N||[]).map(Au),$=j.map(Au),Q=N.reduce(ec,{}),K=j.reduce(ec,{}),J=G.slice(),oe,ie,ce,q;for(oe=0,ie=0;oe<G.length;oe++)ce=G[oe],K.hasOwnProperty(ce)?ie++:(U.push({command:Wt.removeImport,args:[ce]}),J.splice(J.indexOf(ce,ie),1));for(oe=0,ie=0;oe<$.length;oe++)ce=$[$.length-1-oe],J[J.length-1-oe]!==ce&&(Q.hasOwnProperty(ce)?(U.push({command:Wt.removeImport,args:[ce]}),J.splice(J.lastIndexOf(ce,J.length-ie),1)):ie++,q=J[J.length-oe],U.push({command:Wt.addImport,args:[K[ce],q]}),J.splice(J.length-oe,0,ce));for(let ee of j){let he=Q[ee.id];he&&!k(he,ee)&&U.push({command:Wt.updateImport,args:[ee.id,ee]})}}(b.imports,T.imports,M),k(b.transition,T.transition)||M.push({command:Wt.setTransition,args:[T.transition]}),k(b.light,T.light)||M.push({command:Wt.setLight,args:[T.light]}),k(b.fog,T.fog)||M.push({command:Wt.setFog,args:[T.fog]}),k(b.projection,T.projection)||M.push({command:Wt.setProjection,args:[T.projection]}),k(b.lights,T.lights)||M.push({command:Wt.setLights,args:[T.lights]}),k(b.camera,T.camera)||M.push({command:Wt.setCamera,args:[T.camera]}),!k(b["color-theme"],T["color-theme"]))return[{command:Wt.setStyle,args:[T]}];let C={},P=[];(function(N,j,U,G){let $;for($ in j=j||{},N=N||{})N.hasOwnProperty($)&&(j.hasOwnProperty($)||Jl($,U,G));for($ in j){if(!j.hasOwnProperty($))continue;let Q=j[$];N.hasOwnProperty($)?k(N[$],Q)||(N[$].type==="geojson"&&Q.type==="geojson"&&ny(N,j,$)?U.push({command:Wt.setGeoJSONSourceData,args:[$,Q.data]}):Bo($,j,U,G)):Sd($,j,U)}})(b.sources,T.sources,P,C);let L=[];b.layers&&b.layers.forEach(N=>{N.source&&C[N.source]?M.push({command:Wt.removeLayer,args:[N.id]}):L.push(N)});let F=b.terrain;F&&C[F.source]&&(M.push({command:Wt.setTerrain,args:[void 0]}),F=void 0),M=M.concat(P),k(F,T.terrain)||M.push({command:Wt.setTerrain,args:[T.terrain]}),function(N,j,U){j=j||[];let G=(N=N||[]).map(Au),$=j.map(Au),Q=N.reduce(ec,{}),K=j.reduce(ec,{}),J=G.slice(),oe=Object.create(null),ie,ce,q,ee,he,we,pe;for(ie=0,ce=0;ie<G.length;ie++)q=G[ie],K.hasOwnProperty(q)?ce++:(U.push({command:Wt.removeLayer,args:[q]}),J.splice(J.indexOf(q,ce),1));for(ie=0,ce=0;ie<$.length;ie++)q=$[$.length-1-ie],J[J.length-1-ie]!==q&&(Q.hasOwnProperty(q)?(U.push({command:Wt.removeLayer,args:[q]}),J.splice(J.lastIndexOf(q,J.length-ce),1)):ce++,we=J[J.length-ie],U.push({command:Wt.addLayer,args:[K[q],we]}),J.splice(J.length-ie,0,q),oe[q]=!0);for(ie=0;ie<$.length;ie++)if(q=$[ie],ee=Q[q],he=K[q],!oe[q]&&!k(ee,he))if(k(ee.source,he.source)&&k(ee["source-layer"],he["source-layer"])&&k(ee.type,he.type)){for(pe in Su(ee.layout,he.layout,U,q,null,Wt.setLayoutProperty),Su(ee.paint,he.paint,U,q,null,Wt.setPaintProperty),k(ee.slot,he.slot)||U.push({command:Wt.setSlot,args:[q,he.slot]}),k(ee.filter,he.filter)||U.push({command:Wt.setFilter,args:[q,he.filter]}),k(ee.minzoom,he.minzoom)&&k(ee.maxzoom,he.maxzoom)||U.push({command:Wt.setLayerZoomRange,args:[q,he.minzoom,he.maxzoom]}),ee)ee.hasOwnProperty(pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&pe!=="slot"&&(pe.indexOf("paint.")===0?Su(ee[pe],he[pe],U,q,pe.slice(6),Wt.setPaintProperty):k(ee[pe],he[pe])||U.push({command:Wt.setLayerProperty,args:[q,pe,he[pe]]}));for(pe in he)he.hasOwnProperty(pe)&&!ee.hasOwnProperty(pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&pe!=="slot"&&(pe.indexOf("paint.")===0?Su(ee[pe],he[pe],U,q,pe.slice(6),Wt.setPaintProperty):k(ee[pe],he[pe])||U.push({command:Wt.setLayerProperty,args:[q,pe,he[pe]]}))}else U.push({command:Wt.removeLayer,args:[q]}),we=J[J.lastIndexOf(q)+1],U.push({command:Wt.addLayer,args:[he,we]})}(L,T.layers,M)}catch(C){console.warn("Unable to compute style diff:",C),M=[{command:Wt.setStyle,args:[T]}]}return M}(this.serialize(),r).filter(b=>!(b.command in Fd));if(f.length===0)return!1;let g=f.filter(b=>!(b.command in Wp));if(g.length>0)throw new Error(`Unimplemented: ${g.map(b=>b.command).join(", ")}.`);let y=[];return f.forEach(b=>{y.push(this[b.command].apply(this,b.args))}),a&&Promise.all(y).then(a),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(r,a){return this.getImage(r)?this.fire(new o.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,this.scope,a),this._afterImageUpdated(r),this)}updateImage(r,a){this.imageManager.updateImage(r,this.scope,a)}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._afterImageUpdated(r),this):this.fire(new o.d(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(r),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new o.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(r,a,f={}){return this._checkLoaded(),this._validate(Ft,`models.${r}`,a,null,f)||(this.modelManager.addModel(r,a,this.scope),this._changes.setDirty()),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope),this):this.fire(new o.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,a,f={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(le,`sources.${r}`,a,null,f))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);let g=_r(r,a,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));let y=b=>{let T=(b?"symbol:":"other:")+g.id,M=o.al(T,this.scope),C=this._sourceCaches[T]=new o.bv(M,g,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=C,C.onAdd(this.map)};y(!1),a.type!=="vector"&&a.type!=="geojson"||y(!0),g.onAdd&&g.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();let a=this.getOwnSource(r);if(!a)throw new Error("There is no source with this ID");for(let g in this._layers)if(this._layers[g].source===r)return this.fire(new o.d(new Error(`Source "${r}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new o.d(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));let f=this.getOwnSourceCaches(r);for(let g of f){let y=o.cU(g.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(g.id),g.fire(new o.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,a){this._checkLoaded(),this.getOwnSource(r).setData(a),this._changes.setDirty()}getOwnSource(r){let a=this.getOwnSourceCache(r);return a&&a.getSource()}getOwnSources(){let r=[];for(let a in this._otherSourceCaches){let f=this.getOwnSourceCache(a);f&&r.push(f.getSource())}return r}areTilesLoaded(){let r=this._mergedSourceCaches;for(let a in r){let f=r[a]._tiles;for(let g in f){let y=f[g];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;let a=this._getTransitionParameters();for(let g of r){if(this._validate(Ie,"lights",g))return;switch(g.type){case"ambient":if(this.ambientLight){let y=this.ambientLight;y.set(g),y.updateTransitions(a)}else this.ambientLight=new Cl(g,Ot,this.scope,this.options);break;case"directional":if(this.directionalLight){let y=this.directionalLight;y.set(g),y.updateTransitions(a)}else this.directionalLight=new Cl(g,Uh,this.scope,this.options)}}let f=new o.X(this.z||0,a);this.ambientLight&&this.ambientLight.recalculate(f),this.directionalLight&&this.directionalLight.recalculate(f),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let r=this.directionalLight,a=this.ambientLight;if(!r||!a)return;let f=L=>.2126*(L[0]<=.03928?L[0]/12.92:Math.pow((L[0]+.055)/1.055,2.4))+.7152*(L[1]<=.03928?L[1]/12.92:Math.pow((L[1]+.055)/1.055,2.4))+.0722*(L[2]<=.03928?L[2]/12.92:Math.pow((L[2]+.055)/1.055,2.4)),g=r.properties.get("color").toRenderColor(null).toArray01(),y=r.properties.get("intensity"),b=r.properties.get("direction"),T=1-o.ac(b.x,b.y,b.z)[2]/90,M=f(g)*y*T,C=a.properties.get("color").toRenderColor(null).toArray01(),P=a.properties.get("intensity");return(M+f(C)*P)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(!r)return this;if(o.cV(r)){let a=o.cW(r),f=this.fragments.find(({id:y})=>y===a);if(!f)throw new Error(`Style import not found: ${r}`);let g=o.cU(r);return f.style.getFragmentStyle(g)}{let a=this.fragments.find(({id:f})=>f===r);if(!a)throw new Error(`Style import not found: ${r}`);return a.style}}getConfigProperty(r,a){let f=this.getFragmentStyle(r);if(!f)return null;let g=o.al(a,f.scope),y=f.options.get(g),b=y?y.value||y.default:null;return b?b.serialize():null}setConfigProperty(r,a,f){let g=this.getFragmentStyle(r);if(!g)return;let y=g.stylesheet.schema;if(!y||!y[a])return;let b=o.y(f);if(b.result!=="success")return void Vo(this,b.value);let T=b.value.expression,M=o.al(a,g.scope),C=g.options.get(M);if(!C)return;let P,{minValue:L,maxValue:F,stepValue:N,type:j,values:U}=y[a],G=o.y(y[a].default);G.result==="success"&&(P=G.value.expression),P?(this.options.set(M,il(Br({},C),{value:T,default:P,minValue:L,maxValue:F,stepValue:N,type:j,values:U})),this.updateConfigDependencies()):this.fire(new o.d(new Error(`No schema defined for the config option "${a}" in the "${r}" fragment.`)))}getConfig(r){let a=this.getFragmentStyle(r);if(!a)return null;let f=a.stylesheet.schema;if(!f)return null;let g={};for(let y in f){let b=o.al(y,a.scope),T=a.options.get(b),M=T?T.value||T.default:null;g[y]=M?M.serialize():null}return g}setConfig(r,a){let f=this.getFragmentStyle(r);f&&(f.updateConfig(a,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){let a=this.getFragmentStyle(r);return a?a.stylesheet.schema:null}setSchema(r,a){let f=this.getFragmentStyle(r);f&&(f.stylesheet.schema=a,f.updateConfig(f._config,a),this.updateConfigDependencies())}updateConfig(r,a){if(this._config=r,r||a)if(a)for(let f in a){let g,y,b=o.y(a[f].default);if(b.result==="success"&&(g=b.value.expression),r&&r[f]!==void 0){let F=o.y(r[f]);F.result==="success"&&(y=F.value.expression)}let{minValue:T,maxValue:M,stepValue:C,type:P,values:L}=a[f];if(g){let F=o.al(f,this.scope);this.options.set(F,{default:g,value:y,minValue:T,maxValue:M,stepValue:C,type:P,values:L})}else this.fire(new o.d(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new o.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let r of this._configDependentLayers){let a=this.getLayer(r);a&&(a.possiblyEvaluateVisibility(),this._updateLayer(a))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(r=>{if(r._styleColorTheme.colorTheme){let a=r._evaluateColorThemeData(r._styleColorTheme.colorTheme);(!r._styleColorTheme.lut||r._styleColorTheme.lut&&a!==r._styleColorTheme.lut.data)&&r.setColorTheme(r._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(r,a,f={}){this._checkLoaded();let g=r.id;if(this._layers[g])return void this.fire(new o.d(new Error(`Layer with id "${g}" already exists on this map`)));let y;if(r.type==="custom"){if(Vo(this,o.cX(r)))return;y=o.cY(r,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof r.source=="object"&&(this.addSource(g,r.source),r=o.cT(r),r=o.W(r,{source:g})),this._validate(Xe,`layers.${g}`,r,{arrayIndex:-1},f))return;y=o.cY(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:g}}),this._serializedLayers[y.id]=y.serialize()}y.isConfigDependent&&this._configDependentLayers.add(y.fqid);let b=this._order.length;if(a){let P=this._order.indexOf(a);if(P===-1)return void this.fire(new o.d(new Error(`Layer with id "${a}" does not exist on this map.`)));y.slot===this._layers[a].slot?b=P:o.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,g),this._layerOrderChanged=!0,this._layers[g]=y;let T=this.getOwnLayerSourceCache(y),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();T&&y.canCastShadows()&&M&&(T.castsShadows=!0);let C=this._changes.getRemovedLayer(y);if(C&&y.source&&T&&y.type!=="custom"){this._changes.discardLayerRemoval(y);let P=o.al(y.source,y.scope);C.type!==y.type?this._changes.updateSourceCache(P,"clear"):(this._changes.updateSourceCache(P,"reload"),T.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(r,a){this._checkLoaded();let f=this._checkLayer(r);if(!f||r===a)return;let g=this._order.indexOf(r);this._order.splice(g,1);let y=this._order.length;if(a){let b=this._order.indexOf(a);if(b===-1)return void this.fire(new o.d(new Error(`Layer with id "${a}" does not exist on this map.`)));f.slot===this._layers[a].slot?y=b:o.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();let a=this._checkLayer(r);if(!a)return;a.setEventedParent(null);let f=this._order.indexOf(r);this._order.splice(f,1),delete this._layers[r],delete this._serializedLayers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);let g=this.getOwnLayerSourceCache(a);if(g&&g.castsShadows){let y=!1;for(let b in this._layers)if(this._layers[b].source===a.source&&this._layers[b].canCastShadows()){y=!0;break}g.castsShadows=y}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(let a in this._layers)if(this._layers[a].type===r)return!0;return!1}setLayerZoomRange(r,a,f){this._checkLoaded();let g=this._checkLayer(r);g&&(g.minzoom===a&&g.maxzoom===f||(a!=null&&(g.minzoom=a),f!=null&&(g.maxzoom=f),this._updateLayer(g)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,a){this._checkLoaded();let f=this._checkLayer(r);f&&f.slot!==a&&(f.slot=a,this._updateLayer(f))}setFilter(r,a,f={}){this._checkLoaded();let g=this._checkLayer(r);if(g&&!k(g.filter,a))return a==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate($e,`layers.${g.id}.filter`,a,{layerType:g.type},f)||(g.filter=o.cT(a),this._updateLayer(g)))}getFilter(r){let a=this._checkLayer(r);if(a)return o.cT(a.filter)}setLayoutProperty(r,a,f,g={}){this._checkLoaded();let y=this._checkLayer(r);if(y&&!k(y.getLayoutProperty(a),f)){if(f!=null&&(!g||g.validate!==!1)&&Vo(y,yt.call(se,{key:`layers.${r}.layout.${a}`,layerType:y.type,objectKey:a,value:f,styleSpec:o.L,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(a,f),y.isConfigDependent&&this._configDependentLayers.add(y.fqid),this._updateLayer(y)}}getLayoutProperty(r,a){let f=this._checkLayer(r);if(f)return f.getLayoutProperty(a)}setPaintProperty(r,a,f,g={}){this._checkLoaded();let y=this._checkLayer(r);if(!y||k(y.getPaintProperty(a),f)||f!=null&&(!g||g.validate!==!1)&&Vo(y,ut.call(se,{key:`layers.${r}.paint.${a}`,layerType:y.type,objectKey:a,value:f,styleSpec:o.L})))return;let b=y.setPaintProperty(a,f);y.isConfigDependent&&this._configDependentLayers.add(y.fqid),b&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(r,a){let f=this._checkLayer(r);if(f)return f.getPaintProperty(a)}setFeatureState(r,a){this._checkLoaded();let f=r.source,g=r.sourceLayer,y=this._checkSource(f);if(!y)return;let b=y.type;if(b==="geojson"&&g)return void this.fire(new o.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!g)return void this.fire(new o.d(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.d(new Error("The feature id parameter must be provided.")));let T=this.getOwnSourceCaches(f);for(let M of T)M.setFeatureState(g,r.id,a)}removeFeatureState(r,a){this._checkLoaded();let f=r.source,g=this._checkSource(f);if(!g)return;let y=g.type,b=y==="vector"?r.sourceLayer:void 0;if(y==="vector"&&!b)return void this.fire(new o.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.d(new Error("A feature id is required to remove its specific state property.")));let T=this.getOwnSourceCaches(f);for(let M of T)M.removeFeatureState(b,r.id,a)}getFeatureState(r){this._checkLoaded();let a=r.source,f=r.sourceLayer,g=this._checkSource(a);if(g){if(g.type!=="vector"||f)return r.id===void 0&&this.fire(new o.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(f,r.id);this.fire(new o.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=o.W({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return o.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();let r=this.getTerrain(),a=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return o.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateLayer(r){this._changes.updateLayer(r);let a=this.getLayerSourceCache(r),f=o.al(r.source,r.scope),g=this._changes.getUpdatedSourceCaches();r.source&&!g[f]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),a.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){let a=T=>this._mergedLayers[T].type==="fill-extrusion"||this._mergedLayers[T].type==="model",f=this.order,g={},y=[];for(let T=f.length-1;T>=0;T--){let M=f[T];if(a(M)){g[M]=T;for(let C of r){let P=C[M];if(P)for(let L of P)y.push(L)}}}y.sort((T,M)=>M.intersectionZ-T.intersectionZ);let b=[];for(let T=f.length-1;T>=0;T--){let M=f[T];if(a(M))for(let C=y.length-1;C>=0;C--){let P=y[C].feature;if(P.layer&&g[P.layer.id]<T)break;b.push(P),y.pop()}else for(let C of r){let P=C[M];if(P)for(let L of P)b.push(L.feature)}}return b}queryRenderedFeatures(r,a,f){a&&a.filter&&this._validate($e,"queryRenderedFeatures.filter",a.filter,null,a),a.scope=this.scope,a.availableImages=this._availableImages,a.serializedLayers=this._serializedLayers;let g={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new o.d(new Error("parameters.layers must be an Array."))),[];for(let C of a.layers){let P=this._mergedLayers[C];if(!P)return this.fire(new o.d(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];g[P.source]=!0}}let y=[],b=a.serializedLayers||{},T=a&&a.layers?a.layers.some(C=>{let P=this.getLayer(C);return P&&P.is3D()}):this.has3DLayers(),M=Cu.createFromScreenPoints(r,f);for(let C in this._mergedSourceCaches){let P=this._mergedSourceCaches[C].getSource();if(!P||P.scope!==a.scope)continue;let L=this._mergedSourceCaches[C].getSource().id;a.layers&&!g[L]||y.push(Yl(this._mergedSourceCaches[C],this._mergedLayers,b,M,a,f,T,!!this.map._showQueryGeometry))}return this.placement&&y.push(function(C,P,L,F,N,j,U){let G={},$=j.queryRenderedSymbols(F),Q=[];for(let K of Object.keys($).map(Number))Q.push(U[K]);Q.sort(Bp);for(let K of Q){let J=K.featureIndex.lookupSymbolFeatures($[K.bucketInstanceId],P,K.bucketIndex,K.sourceLayerIndex,N.filter,N.layers,N.availableImages,C);for(let oe in J){let ie=G[oe]=G[oe]||[],ce=J[oe];ce.sort((q,ee)=>{let he=K.featureSortOrder;if(he){let we=he.indexOf(q.featureIndex);return he.indexOf(ee.featureIndex)-we}return ee.featureIndex-q.featureIndex});for(let q of ce)ie.push(q)}}for(let K in G)G[K].forEach(J=>{let oe=J.feature,ie=L(C[K]);if(!ie)return;let ce=ie.getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=ce});return G}(this._mergedLayers,b,this.getLayerSourceCache.bind(this),M.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(r,a){a&&a.filter&&this._validate($e,"querySourceFeatures.filter",a.filter,null,a);let f=this.getOwnSourceCaches(r),g=[];for(let y of f)g=g.concat(ty(y,a));return g}addSourceType(r,a,f){return Si.getSourceType(r)?f(new Error(`A source type called "${r}" already exists.`)):(Si.setSourceType(r,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:a.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,a,f={}){this._checkLoaded();let g=this.light.getLight(),y=!1;for(let T in r)if(!k(r[T],g[T])){y=!0;break}if(!y)return;let b=this._getTransitionParameters();this.light.setLight(r,a,f),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,a=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()&&a!==0||delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=r,g=r.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof f.source=="object"){let T="terrain-dem-src";this.addSource(T,f.source),f=o.cT(f),f=o.W(f,{source:T})}let y=o.W({},f),b={};if(this.terrain&&g){y.source=this.terrain.get().source;let T=this.terrain?this.getFragmentStyle(this.terrain.scope):null;T&&(b.style=T.serialize())}if(this._validate(ge,"terrain",y,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&a!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,a),this.fire(new o.f("data",{dataType:"style"}))}else{let y=this.terrain,b=y.get();for(let T of Object.keys(o.L.terrain))!f.hasOwnProperty(T)&&o.L.terrain[T].default&&(f[T]=o.L.terrain[T].default);for(let T in r)if(!k(r[T],b[T])){y.set(r,this.options),this.stylesheet.terrain=r;let M=this._getTransitionParameters({duration:0});y.updateTransitions(M),this.fire(new o.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){let a=this.fog=new gp(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();let f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let a=this.fog;if(!k(a.get(),r)){a.set(r,this.options),this.stylesheet.fog=a.get();let f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}}else this._createFog(r);this._markersNeedUpdate=!0}setColorTheme(r){this._checkLoaded();let a=()=>{for(let g in this._layers)this._layers[g].lut=this._styleColorTheme.lut;for(let g in this._sourceCaches)this._sourceCaches[g].clearTiles()};if(this._styleColorTheme.colorTheme=r,!r)return this._styleColorTheme.lut=null,void a();let f=this._evaluateColorThemeData(r);this._loadColorTheme(f).then(()=>{this.fire(new o.f("colorthemeset")),a()}).catch(g=>{o.w(`Couldn't set color theme: ${g}`)})}_getTransitionParameters(r){return{now:o.e.now(),transition:o.W(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;let r=[],a=[];for(let f in this._mergedLayers)this.isLayerDraped(this._mergedLayers[f])?r.push(f):a.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...a)}_createTerrain(r,a){let f=this.terrain=new mn(r,a,this.scope,this.options);a===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let g=this._getTransitionParameters({duration:0});f.updateTransitions(g)}_force3DLayerUpdate(){for(let r in this._layers){let a=this._layers[r];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(let r in this._layers){let a=this._layers[r];a.type==="symbol"&&this._updateLayer(a)}}_validate(r,a,f,g,y={}){if(y&&y.validate===!1)return!1;let b=o.W({},this.serialize());return Vo(this,r.call(se,o.W({key:a,style:b,value:f,styleSpec:o.L},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(let r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(let r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(r){let a=this.getSourceCaches(r);for(let f of a)f.clearTiles()}clearSources(){for(let r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}reloadSource(r){let a=this.getSourceCaches(r);for(let f of a)f.resume(),f.reload()}reloadSources(){for(let r of this.getSources())r.reload&&r.reload()}updateSources(r){let a;this.directionalLight&&(a=hu(this.directionalLight));for(let f in this._mergedSourceCaches)this._mergedSourceCaches[f].update(r,void 0,void 0,a)}_generateCollisionBoxes(){for(let r in this._sourceCaches){let a=this._sourceCaches[r];a.resume(),a.reload()}}_updatePlacement(r,a,f,g,y,b,T=!1){let M=!1,C=!1,P={},L={};for(let N of this._mergedOrder){let j=this._mergedLayers[N];if(j.type!=="symbol")continue;let U=o.al(j.source,j.scope),G=P[U];if(!G){let Q=this.getLayerSourceCache(j);if(!Q)continue;let K=Q.getRenderableIds(!0).map(J=>Q.getTileByID(J));L[U]=K.slice(),G=P[U]=K.sort((J,oe)=>oe.tileID.overscaledZ-J.tileID.overscaledZ||(J.tileID.isLessThan(oe.tileID)?-1:1))}let $=this.crossTileSymbolIndex.addLayer(j,G,a.center.lng,a.projection);M=M||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),T=T||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new o.f("neworder")),(T||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.e.now(),a.zoom))&&(this.pauseablePlacement=new Ts(a,this._mergedOrder,T,f,g,y,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,P,L),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.e.now()),C=!0),M&&this.pauseablePlacement.placement.setStale()),C||M){this._buildingIndex.onNewFrame(a.zoom);for(let N=0;N<this._mergedOrder.length;N++){let j=this._mergedLayers[this._mergedOrder[N]];if(j.type!=="symbol")continue;let U=this.isLayerClipped(j)&&this._clipLayerIndices.some(G=>N<G);this.placement.updateLayerOpacities(j,P[o.al(j.source,j.scope)],N,U?b:null)}}let F=!1;for(let N of this._mergedOrder){let j=this._mergedLayers[N];if(j.type!=="symbol")continue;let U=P[o.al(j.source,j.scope)];for(let G of U){let $=G.getBucket(j);$&&G.latestFeatureIndex&&j.fqid===$.layerIds[0]&&(F=$.updateOcclusionOpacities(r.context,r.symbolParams,r._dt)||F)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.e.now())||F,occlusionQueryBasedOpacityChanged:F}}_releaseSymbolFadeTiles(){for(let r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,a){this._checkLoaded();let f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:y})=>y===r.id)!==-1)return void this.fire(new o.d(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!a)return f.push(r),this._loadImports([r],!0);let g=f.findIndex(({id:y})=>y===a);return g===-1&&this.fire(new o.d(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,g).concat(r).concat(f.slice(g)),this._loadImports([r],!0,a)}updateImport(r,a){this._checkLoaded();let f=this.stylesheet.imports||[],g=this.getImportIndex(r);return g===-1?this:typeof a=="string"?(this.setImportUrl(r,a),this):(a.url&&a.url!==f[g].url&&this.setImportUrl(r,a.url),k(a.config,f[g].config)||this.setImportConfig(r,a.config),k(a.data,f[g].data)||this.setImportData(r,a.data),this)}moveImport(r,a){this._checkLoaded();let f=this.stylesheet.imports||[],g=this.getImportIndex(r);if(g===-1)return this;let y=this.getImportIndex(a);if(y===-1)return this;let b=f[g],T=this.fragments[g];return f=f.filter(({id:M})=>M!==r),this.fragments=this.fragments.filter(({id:M})=>M!==r),this.stylesheet.imports=f.slice(0,y).concat(b).concat(f.slice(y)),this.fragments=this.fragments.slice(0,y).concat(T).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(r,a){this._checkLoaded();let f=this.stylesheet.imports||[],g=this.getImportIndex(r);if(g===-1)return this;f[g].url=a;let y=this.fragments[g];return y.style=this._createFragmentStyle(f[g]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(a),this}setImportData(r,a){this._checkLoaded();let f=this.getImportIndex(r),g=this.stylesheet.imports||[];return f===-1?this:a?(this.fragments[f].style.setState(a),this._reloadImports(),this):(delete g[f].data,this.setImportUrl(r,g[f].url))}setImportConfig(r,a){this._checkLoaded();let f=this.getImportIndex(r),g=this.stylesheet.imports||[];if(f===-1)return this;a?g[f].config=a:delete g[f].config;let y=this.fragments[f],b=y.style.stylesheet&&y.style.stylesheet.schema;return y.config=a,y.style.updateConfig(a,b),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();let a=this.stylesheet.imports||[],f=this.getImportIndex(r);f!==-1&&(a.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(r){let a=(this.stylesheet.imports||[]).findIndex(f=>f.id===r);return a===-1&&this.fire(new o.d(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),a}getLayer(r){return this._mergedLayers[r]}getSources(){let r=[];for(let a in this._mergedOtherSourceCaches){let f=this._mergedOtherSourceCaches[a];f&&r.push(f.getSource())}return r}getSource(r,a){let f=this.getSourceCache(r,a);return f&&f.getSource()}getLayerSource(r){let a=this.getLayerSourceCache(r);return a&&a.getSource()}getSourceCache(r,a){let f=o.al(r,a);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(r){let a=o.al(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(r){if(r==null)return Object.values(this._mergedSourceCaches);let a=[];return this._mergedOtherSourceCaches[r]&&a.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&a.push(this._mergedSymbolSourceCaches[r]),a}updateSourceCaches(){let r=this._changes.getUpdatedSourceCaches();for(let a in r){let f=r[a];f==="reload"?this.reloadSource(a):f==="clear"&&this.clearSource(a)}}updateLayers(r){let a=this._changes.getUpdatedPaintProperties();for(let f of a){let g=this.getLayer(f);g&&g.updateTransitions(r)}}getImages(r,a,f){this.imageManager.getImages(a.icons,a.scope,f),this._updateTilesForChangedImages();let g=y=>{y&&y.setDependencies(a.tileID.key,a.type,a.icons)};g(this._otherSourceCaches[a.source]),g(this._symbolSourceCaches[a.source])}getGlyphs(r,a,f){this.glyphManager.getGlyphs(a.stacks,a.scope,f)}getResource(r,a,f){return o.c$(a,f)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){let a=[];return this._otherSourceCaches[r]&&a.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&a.push(this._symbolSourceCaches[r]),a}_isSourceCacheLoaded(r){let a=this.getOwnSourceCaches(r);return a.length===0?(this.fire(new o.d(new Error(`There is no source with ID '${r}'`))),!1):a.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,a){if(this._clipLayerIndices.length===0&&r.type!=="fill-extrusion")return!1;let f=r.type==="fill-extrusion"&&r.sourceLayer==="building",g=0;if(r.is3D()){if(f||a&&a.type==="batched-model")return!0;r.type==="model"&&(g=o.cu.Model)}else r.type==="symbol"&&(g=o.cu.Symbol);for(let y of this._clipLayerIndices){let b=this._mergedLayers[this._mergedOrder[y]];if(!b)continue;let T=[];for(let M of b.layout.get("clip-layer-types"))T.push(M==="model"?o.cu.Model:M==="symbol"?o.cu.Symbol:o.cu.FillExtrusion);for(let M of T)if(g&M)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Yp(u,r){let a=!1,f=null,g=()=>{f=null,a&&(u(),f=setTimeout(g,r),a=!1)};return()=>(a=!0,f||g(),f)}Si.getSourceType=function(u){return pu[u]},Si.setSourceType=function(u,r){pu[u]=r},Si.registerForPluginStateChange=o.cL;class Qp{constructor(r){this._hashName=r&&encodeURIComponent(r),o.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Yp(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let r=this._map;if(!r)return"";let a=Kp(r);if(this._hashName){let f=this._hashName,g=!1,y=location.hash.slice(1).split("&").map(b=>{let T=b.split("=")[0];return T===f?(g=!0,`${T}=${a}`):b}).filter(b=>b);return g||y.push(`${f}=${a}`),`#${y.join("&")}`}return`#${a}`}_getCurrentHash(){let r=location.hash.replace("#","");if(this._hashName){let a;return r.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(a=f)}),(a&&a[1]||"").split("/")}return r.split("/")}_onHashChange(){let r=this._map;if(!r)return!1;let a=this._getCurrentHash();if(a.length>=3&&!a.some(f=>isNaN(f))){let f=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(a[3]||0):r.getBearing();return r.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:f,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Kp(u,r){let a=u.getCenter(),f=Math.round(100*u.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,g),b=Math.round(a.lng*y)/y,T=Math.round(a.lat*y)/y,M=u.getBearing(),C=u.getPitch(),P=r?`/${b}/${T}/${f}`:`${f}/${T}/${b}`;return(M||C)&&(P+="/"+Math.round(10*M)/10),C&&(P+=`/${Math.round(C)}`),P}let Es={linearity:.3,easing:o.d0(0,0,.3,1)},ay=o.W({deceleration:2500,maxSpeed:1400},Es),Jp=o.W({deceleration:20,maxSpeed:1400},Es),Nd=o.W({deceleration:1e3,maxSpeed:360},Es),Lu=o.W({deceleration:1e3,maxSpeed:90},Es);class zd{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.e.now(),settings:r})}_drainInertiaBuffer(){let r=this._inertiaBuffer,a=o.e.now();for(;r.length>0&&a-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let a={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:y}of this._inertiaBuffer)a.zoom+=y.zoomDelta||0,a.bearing+=y.bearingDelta||0,a.pitch+=y.pitchDelta||0,y.panDelta&&a.pan._add(y.panDelta),y.around&&(a.around=y.around),y.pinchAround&&(a.pinchAround=y.pinchAround);let f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(a.pan.mag()){let y=Ma(a.pan.mag(),f,o.W({},ay,r||{}));g.offset=a.pan.mult(y.amount/a.pan.mag()),g.center=this._map.transform.center,Hi(g,y)}if(a.zoom){let y=Ma(a.zoom,f,Jp);g.zoom=this._map.transform.zoom+y.amount,Hi(g,y)}if(a.bearing){let y=Ma(a.bearing,f,Nd);g.bearing=this._map.transform.bearing+o.at(y.amount,-179,179),Hi(g,y)}if(a.pitch){let y=Ma(a.pitch,f,Lu);g.pitch=this._map.transform.pitch+y.amount,Hi(g,y)}if(g.zoom||g.bearing){let y=a.pinchAround===void 0?a.around:a.pinchAround;g.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function Hi(u,r){(!u.duration||u.duration<r.duration)&&(u.duration=r.duration,u.easing=r.easing)}function Ma(u,r,a){let{maxSpeed:f,linearity:g,deceleration:y}=a,b=o.at(u*g/(r/1e3),-f,f),T=Math.abs(b)/(y*g);return{easing:a.easing,duration:1e3*T,amount:b*(T/2)}}class Wr extends o.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,a,f,g={}){let y=Ut(a.getCanvasContainer(),f),b=a.unproject(y);super(r,o.W({point:y,lngLat:b,originalEvent:f},g)),this._defaultPrevented=!1,this.target=a}}class so extends o.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,a,f){let g=r==="touchend"?f.changedTouches:f.touches,y=pn(a.getCanvasContainer(),g),b=y.map(M=>a.unproject(M)),T=y.reduce((M,C,P,L)=>M.add(C.div(L.length)),new o.P(0,0));super(r,{points:y,point:T,lngLats:b,lngLat:a.unproject(T),originalEvent:f}),this._defaultPrevented=!1}}class nc extends o.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class Ou{constructor(r,a){this._map=r,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new nc(this._map,r))}mousedown(r,a){return this._mousedownPos=a,this._firePreventable(new Wr(r.type,this._map,r))}mouseup(r){this._map.fire(new Wr(r.type,this._map,r))}preclick(r){let a=o.W({},r);a.type="preclick",this._map.fire(new Wr(a.type,this._map,a))}click(r,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Wr(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Wr(r.type,this._map,r))}mouseover(r){this._map.fire(new Wr(r.type,this._map,r))}mouseout(r){this._map.fire(new Wr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new so(r.type,this._map,r))}touchmove(r){this._map.fire(new so(r.type,this._map,r))}touchend(r){this._map.fire(new so(r.type,this._map,r))}touchcancel(r){this._map.fire(new so(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bd{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Wr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Wr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Wr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class rc{constructor(r,a){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,a){this.isEnabled()&&r.shiftKey&&r.button===0&&(Zt(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(r,a){if(!this._active)return;let f=a,g=this._startPos,y=this._lastPos;if(!g||!y||y.equals(f)||!this._box&&f.dist(g)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=ye("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));let b=Math.min(g.x,f.x),T=Math.max(g.x,f.x),M=Math.min(g.y,f.y),C=Math.max(g.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${M}px)`,this._box.style.width=T-b+"px",this._box.style.height=C-M+"px")})}mouseupWindow(r,a){if(!this._active)return;let f=this._startPos,g=a;if(f&&r.button===0){if(this.reset(),an(),f.x!==g.x||f.y!==g.y)return this._map.fire(new o.f("boxzoomend",{originalEvent:r})),{cameraAnimation:y=>y.fitScreenCoordinates(f,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),jt(),delete this._startPos,delete this._lastPos}_fireEvent(r,a){return this._map.fire(new o.f(r,{originalEvent:a}))}}function Ca(u,r){let a={};for(let f=0;f<u.length;f++)a[u[f].identifier]=r[f];return a}class Vd{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,a,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),f.length===this.numTouches&&(this.centroid=function(g){let y=new o.P(0,0);for(let b of g)y._add(b);return y.div(g.length)}(a),this.touches=Ca(f,a)))}touchmove(r,a,f){if(this.aborted||!this.centroid)return;let g=Ca(f,a);for(let y in this.touches){let b=g[y];(!b||b.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(r,a,f){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){let g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class ku{constructor(r){this.singleTap=new Vd(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,a,f){this.singleTap.touchstart(r,a,f)}touchmove(r,a,f){this.singleTap.touchmove(r,a,f)}touchend(r,a,f){let g=this.singleTap.touchend(r,a,f);if(g){let y=r.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(g)<30;if(y&&b||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class jd{constructor(){this._zoomIn=new ku({numTouches:1,numTaps:2}),this._zoomOut=new ku({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,a,f){this._zoomIn.touchstart(r,a,f),this._zoomOut.touchstart(r,a,f)}touchmove(r,a,f){this._zoomIn.touchmove(r,a,f),this._zoomOut.touchmove(r,a,f)}touchend(r,a,f){let g=this._zoomIn.touchend(r,a,f),y=this._zoomOut.touchend(r,a,f);return g?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(g)},{originalEvent:r})}):y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(y)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Fu={0:1,2:2};class Is{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,a){return!1}_move(r,a){return{}}mousedown(r,a){if(this._lastPoint)return;let f=mr(r);this._correctButton(r,f)&&(this._lastPoint=a,this._eventButton=f)}mousemoveWindow(r,a){let f=this._lastPoint;if(f){if(r.preventDefault(),this._eventButton!=null&&function(g,y){let b=Fu[y];return g.buttons===void 0||(g.buttons&b)!==b}(r,this._eventButton))this.reset();else if(this._moved||!(a.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(f,a)}}mouseupWindow(r){this._lastPoint&&mr(r)===this._eventButton&&(this._moved&&an(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class em extends Is{mousedown(r,a){super.mousedown(r,a),this._lastPoint&&(this._active=!0)}_correctButton(r,a){return a===0&&!r.ctrlKey}_move(r,a){return{around:a,panDelta:a.sub(r)}}}class Ud extends Is{_correctButton(r,a){return a===0&&r.ctrlKey||a===2}_move(r,a){let f=.8*(a.x-r.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(r){r.preventDefault()}}class Gd extends Is{_correctButton(r,a){return a===0&&r.ctrlKey||a===2}_move(r,a){let f=-.5*(a.y-r.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(r){r.preventDefault()}}class Sa{constructor(r,a){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),o.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(r,a,f){return this._calculateTransform(r,a,f)}touchmove(r,a,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!o.d1())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,a,f)}}touchend(r,a,f){this._calculateTransform(r,a,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,a,f){f.length>0&&(this._active=!0);let g=Ca(f,a),y=new o.P(0,0),b=new o.P(0,0),T=0;for(let C in g){let P=g[C],L=this._touches[C];L&&(y._add(P),b._add(P.sub(L)),T++,g[C]=P)}if(this._touches=g,T<this._minTouches||!b.mag())return;let M=b.div(T);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(T),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ye("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Nu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,a,f){return{}}touchstart(r,a,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([a[0],a[1]]))}touchmove(r,a,f){let g=this._firstTwoTouches;if(!g)return;r.preventDefault();let[y,b]=g,T=zu(f,a,y),M=zu(f,a,b);if(!T||!M)return;let C=this._aroundCenter?null:T.add(M).div(2);return this._move([T,M],C,r)}touchend(r,a,f){if(!this._firstTwoTouches)return;let[g,y]=this._firstTwoTouches,b=zu(f,a,g),T=zu(f,a,y);b&&T||(this._active&&an(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function zu(u,r,a){for(let f=0;f<u.length;f++)if(u[f].identifier===a)return r[f]}function tm(u,r){return Math.log(u/r)/Math.LN2}class ly extends Nu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,a){let f=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(tm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:tm(this._distance,f),pinchAround:a}}}function Bu(u,r){return 180*u.angleWith(r)/Math.PI}class $d extends Nu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,a){let f=this._vector;if(this._vector=r[0].sub(r[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Bu(this._vector,f),pinchAround:a}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());let a=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;let g=Bu(r,f);return Math.abs(g)<a}}function ic(u){return Math.abs(u.y)>Math.abs(u.x)}class Hd extends Nu{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,ic(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,a,f){let g=this._lastPoints;if(!g)return;let y=r[0].sub(g[0]),b=r[1].sub(g[1]);return this._map._cooperativeGestures&&!o.d1()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(y,b,f.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(y.y+b.y)/2*-.5})}gestureBeginsVertically(r,a,f){if(this._valid!==void 0)return this._valid;let g=r.mag()>=2,y=a.mag()>=2;if(!g&&!y)return;if(!g||!y)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;let b=r.y>0==a.y>0;return ic(r)&&ic(a)&&b}}let nm={panStep:100,bearingStep:15,pitchStep:10};class rm{constructor(){let r=nm;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let a=0,f=0,g=0,y=0,b=0;switch(r.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:r.shiftKey?f=-1:(r.preventDefault(),y=-1);break;case 39:r.shiftKey?f=1:(r.preventDefault(),y=1);break;case 38:r.shiftKey?g=1:(r.preventDefault(),b=-1);break;case 40:r.shiftKey?g=-1:(r.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(f=0,g=0),{cameraAnimation:T=>{let M=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:cy,zoom:a?Math.round(M)+a*(r.shiftKey?2:1):M,bearing:T.getBearing()+f*this._bearingStep,pitch:T.getPitch()+g*this._pitchStep,offset:[-y*this._panStep,-b*this._panStep],center:T.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function cy(u){return u*(2-u)}let Aa=4.000244140625,oc=1/450;class im{constructor(r,a){this._map=r,this._el=r.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=oc,o.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.d1()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY,f=o.e.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,a!==0&&a%Aa==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(g*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),r.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=r,this._delta-=a,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let a=Ut(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let a=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){let C=this._type==="wheel"&&Math.abs(this._delta)>Aa?this._wheelZoomRate:this._defaultZoomRate,P=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&P!==0&&(P=1/P);let L=a(),F=Math.pow(2,L),N=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(N*P))),this._type==="wheel"&&(this._startZoom=L,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let f=typeof this._targetZoom=="number"?this._targetZoom:a(),g=this._startZoom,y=this._easing,b,T=!1;if(this._type==="wheel"&&g&&y){let C=Math.min((o.e.now()-this._lastWheelEventTime)/200,1),P=y(C);b=o.a2(g,f,P),C<1?this._frameId||(this._frameId=!0):T=!0}else b=f,T=!0;this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let M=b-a();return M*this._lastDelta<0&&(M=0),{noInertia:!0,needsRenderFrame:!T,zoomDelta:M,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let a=o.d2;if(this._prevEase){let f=this._prevEase,g=(o.e.now()-f.start)/f.duration,y=f.easing(g+.01)-f.easing(g),b=.27/Math.sqrt(y*y+1e-4)*.01,T=Math.sqrt(.0729-b*b);a=o.d0(b,T,.25,1)}return this._prevEase={start:o.e.now(),duration:r,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ye("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class ni{constructor(r,a){this._clickZoom=r,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,a){return r.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(r.shiftKey?-1:1),around:f.unproject(a)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vu{constructor(){this._tap=new ku({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,a,f){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=a[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(r,a,f))}touchmove(r,a,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;let g=a[0],y=g.y-this._swipePoint.y;return this._swipePoint=g,r.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(r,a,f)}touchend(r,a,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(r,a,f)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ju{constructor(r,a,f){this._el=r,this._mousePan=a,this._touchPan=f}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Wd{constructor(r,a,f){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=a,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Zd{constructor(r,a,f,g){this._el=r,this._touchZoom=a,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Ds=u=>u.zoom||u.drag||u.pitch||u.rotate;class Xd extends o.f{}class Yd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,a){let f=o._.sub([],a,r);this.radius=o._.length(f[2]<0?o._.div([],f,this.constants):[f[0],f[1],0])}projectRay(r){o._.div(r,r,this.constants),o._.normalize(r,r),o._.mul(r,r,this.constants);let a=o._.scale([],r,this.radius);if(a[2]>0){let f=o._.scale([],[0,0,1],o._.dot(a,[0,0,1])),g=o._.scale([],o._.normalize([],[a[0],a[1],0]),this.radius),y=o._.add([],a,o._.scale([],o._.sub([],o._.add([],g,f),a),2));a[0]=y[0],a[1]=y[1]}return a}}function Ms(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class om{constructor(r,a){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new zd(r),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Yd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),o.bp(["handleEvent","handleWindowEvent"],this);let f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(let[g,y,b]of this._listeners){let T=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(y,T,b)}}destroy(){for(let[r,a,f]of this._listeners){let g=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(a,g,f)}}_addDefaultHandlers(r){let a=this._map,f=a.getCanvasContainer();this._add("mapEvent",new Ou(a,r));let g=a.boxZoom=new rc(a,r);this._add("boxZoom",g);let y=new jd,b=new qd;a.doubleClickZoom=new ni(b,y),this._add("tapZoom",y),this._add("clickZoom",b);let T=new Vu;this._add("tapDragZoom",T);let M=a.touchPitch=new Hd(a);this._add("touchPitch",M);let C=new Ud(r),P=new Gd(r);a.dragRotate=new Wd(r,C,P),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);let L=new em(r),F=new Sa(a,r);a.dragPan=new ju(f,L,F),this._add("mousePan",L),this._add("touchPan",F,["touchZoom","touchRotate"]);let N=new $d,j=new ly;a.touchZoomRotate=new Zd(f,j,N,T),this._add("touchRotate",N,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Bd(a));let U=a.scrollZoom=new im(a,this);this._add("scrollZoom",U,["mousePan"]);let G=a.keyboard=new rm;this._add("keyboard",G);for(let $ of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[$]&&a[$].enable(r[$])}_add(r,a,f){this._handlers.push({handlerName:r,handler:a,allowed:f}),this._handlersById[r]=a}stop(r){if(!this._updatingCamera){for(let{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ds(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,a,f){for(let g in r)if(g!==f&&(!a||a.indexOf(g)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){let a=[];for(let f of r)this._el.contains(f.target)&&a.push(f);return a}handleEvent(r,a){this._updatingCamera=!0;let f=r.type==="renderFrame",g=f?void 0:r,y={needsRenderFrame:!1},b={},T={},M=r.touches?this._getMapTouches(r.touches):void 0,C=M?pn(this._el,M):f?void 0:Ut(this._el,r);for(let{handlerName:F,handler:N,allowed:j}of this._handlers){if(!N.isEnabled())continue;let U;this._blockedByActive(T,j,F)?N.reset():N[a||r.type]&&(U=N[a||r.type](r,C,M),this.mergeHandlerResult(y,b,U,F,g),U&&U.needsRenderFrame&&this._triggerRenderFrame()),(U||N.isActive())&&(T[F]=N)}let P={};for(let F in this._previousActiveHandlers)T[F]||(P[F]=g);this._previousActiveHandlers=T,(Object.keys(P).length||Ms(y))&&(this._changes.push([y,b,P]),this._triggerRenderFrame()),(Object.keys(T).length||Ms(y))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:L}=y;L&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],L(this._map))}mergeHandlerResult(r,a,f,g,y){if(!f)return;o.W(r,f);let b={handlerName:g,originalEvent:f.originalEvent||y};f.zoomDelta!==void 0&&(a.zoom=b),f.panDelta!==void 0&&(a.drag=b),f.pitchDelta!==void 0&&(a.pitch=b),f.bearingDelta!==void 0&&(a.rotate=b)}_applyChanges(){let r={},a={},f={};for(let[g,y,b]of this._changes)g.panDelta&&(r.panDelta=(r.panDelta||new o.P(0,0))._add(g.panDelta)),g.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(r.around=g.around),g.aroundCoord!==void 0&&(r.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(r.pinchAround=g.pinchAround),g.noInertia&&(r.noInertia=g.noInertia),o.W(a,y),o.W(f,b);this._updateMapTransform(r,a,f),this._changes=[]}_updateMapTransform(r,a,f){let g=this._map,y=g.transform,b=Q=>[Q.x,Q.y,Q.z];if((Q=>{let K=this._eventsInProgress.drag;return K&&!this._handlersById[K.handlerName].isActive()})()&&!Ms(r)){let Q=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),Q!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&g._stop(!0),!Ms(r))return void this._fireEvents(a,f,!0);let{panDelta:T,zoomDelta:M,bearingDelta:C,pitchDelta:P,around:L,aroundCoord:F,pinchAround:N}=r;y._isCameraConstrained&&(M>0&&(M=0),y._isCameraConstrained=!1),N!==void 0&&(L=N),(M||(Q=>a[Q]&&!this._eventsInProgress[Q])("drag"))&&L&&(this._dragOrigin=b(y.pointCoordinate3D(L)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",g._stop(!0),L=L||g.transform.centerPoint,C&&(y.bearing+=C),P&&(y.pitch+=P),y._updateCameraState();let j=[0,0,0];if(T)if(y.projection.name==="mercator"){let Q=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(L).dir),K=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(L.sub(T)).dir);j[0]=K[0]-Q[0],j[1]=K[1]-Q[1]}else{let Q=y.pointCoordinate(L);if(y.projection.name==="globe"){T=T.rotate(-y.angle);let K=y._pixelsPerMercatorPixel/y.worldSize;j[0]=-T.x*o.d3(o.ay(Q.y))*K,j[1]=-T.y*o.d3(y.center.lat)*K}else{let K=y.pointCoordinate(L.sub(T));Q&&K&&(j[0]=K.x-Q.x,j[1]=K.y-Q.y)}}let U=y.zoom,G=[0,0,0];if(M){let Q=b(F||y.pointCoordinate3D(L)),K={dir:o._.normalize([],o._.sub([],Q,y._camera.position))};if(K.dir[2]<0){let J=y.zoomDeltaToMovement(Q,M);o._.scale(G,K.dir,J)}}let $=o._.add(j,j,G);y._translateCameraConstrained($),M&&Math.abs(y.zoom-U)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(a,f,!0)}_fireEvents(r,a,f){let g=Ds(this._eventsInProgress),y=Ds(r),b={};for(let P in r){let{originalEvent:L}=r[P];this._eventsInProgress[P]||(b[`${P}start`]=L),this._eventsInProgress[P]=r[P]}!g&&y&&this._fireEvent("movestart",y.originalEvent);for(let P in b)this._fireEvent(P,b[P]);y&&this._fireEvent("move",y.originalEvent);for(let P in r){let{originalEvent:L}=r[P];this._fireEvent(P,L)}let T={},M;for(let P in this._eventsInProgress){let{handlerName:L,originalEvent:F}=this._eventsInProgress[P];this._handlersById[L].isActive()||(delete this._eventsInProgress[P],M=a[L]||F,T[`${P}end`]=M)}for(let P in T)this._fireEvent(P,T[P]);let C=Ds(this._eventsInProgress);if(f&&(g||y)&&!C){this._updatingCamera=!0;let P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;P?(L(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:M})):(this._map.fire(new o.f("moveend",{originalEvent:M})),L(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,a){this._map.fire(new o.f(r,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Xd("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Qd="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Pa extends o.E{constructor(r,a){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,o.bp(["_renderFrameCallback"],this)}getCenter(){return new o.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(r,a){return this.jumpTo({center:r},a)}panBy(r,a,f){return r=o.P.convert(r).mult(-1),this.panTo(this.transform.center,o.W({offset:r},a),f)}panTo(r,a,f){return this.easeTo(o.W({center:r},a),f)}getZoom(){return this.transform.zoom}setZoom(r,a){return this.jumpTo({zoom:r},a),this}zoomTo(r,a,f){return this.easeTo(o.W({zoom:r},a),f)}zoomIn(r,a){return this.zoomTo(this.getZoom()+1,r,a),this}zoomOut(r,a){return this.zoomTo(this.getZoom()-1,r,a),this}getBearing(){return this.transform.bearing}setBearing(r,a){return this.jumpTo({bearing:r},a),this}getPadding(){return this.transform.padding}setPadding(r,a){return this.jumpTo({padding:r},a),this}rotateTo(r,a,f){return this.easeTo(o.W({bearing:r},a),f)}resetNorth(r,a){return this.rotateTo(0,o.W({duration:1e3},r),a),this}resetNorthPitch(r,a){return this.easeTo(o.W({bearing:0,pitch:0,duration:1e3},r),a),this}snapToNorth(r,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,a):this}getPitch(){return this.transform.pitch}setPitch(r,a){return this.jumpTo({pitch:r},a),this}cameraForBounds(r,a){r=o.ai.convert(r);let f=a&&a.bearing||0,g=a&&a.pitch||0,y=r.getNorthWest(),b=r.getSouthEast();return this._cameraForBounds(this.transform,y,b,f,g,a)}_extendPadding(r){let a={top:0,right:0,bottom:0,left:0};return r==null?o.W({},a,this.transform.padding):typeof r=="number"?{top:r,bottom:r,right:r,left:r}:o.W({},a,r)}_extendCameraOptions(r){return(r=o.W({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,a){let f=a.max[0]-a.min[0],g=a.max[1]-a.min[1];return f/g>r.aspect?f/(2*Math.tan(.5*r.fovX)*r.aspect):g/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,a,f,g,y,b){let T=r.clone(),M=this._extendCameraOptions(b);T.bearing=g,T.pitch=y;let C=o.aI.convert(a),P=o.aI.convert(f),L=.5*(C.lat+P.lat),F=.5*(C.lng+P.lng),N=o.d4(L,F),j=o._.normalize([],N),U=o._.normalize([],o._.cross([],j,[0,1,0])),G=o._.cross([],U,j),$=[U[0],U[1],U[2],0,G[0],G[1],G[2],0,j[0],j[1],j[2],0,0,0,0,1],Q=[N,o.d4(C.lat,C.lng),o.d4(P.lat,C.lng),o.d4(P.lat,P.lng),o.d4(C.lat,P.lng),o.d4(L,C.lng),o.d4(L,P.lng),o.d4(C.lat,F),o.d4(P.lat,F)],K=o.b6.fromPoints(Q.map(Re=>[o._.dot(U,Re),o._.dot(G,Re),o._.dot(j,Re)])),J=o._.transformMat4([],K.center,$);o._.squaredLength(J)===0&&o._.set(J,0,0,1),o._.normalize(J,J),o._.scale(J,J,o.cD),T.center=o.d5(J);let oe=T.getWorldToCameraMatrix(),ie=o.ad.invert(new Float64Array(16),oe);K=o.b6.applyTransform(K,o.ad.multiply([],oe,$));let ce=this._extendAABB(K,T,M,g);if(!ce)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");K=ce,o._.transformMat4(J,J,oe);let q=.5*(K.max[2]-K.min[2]),ee=this._minimumAABBFrustumDistance(T,K),he=o._.scale([],[0,0,1],q),we=o._.add(he,J,he),pe=ee+(T.pitch===0?0:o._.distance(J,we)),ae=T.globeCenterInViewSpace,Ee=o._.sub([],J,[ae[0],ae[1],ae[2]]);o._.normalize(Ee,Ee),o._.scale(Ee,Ee,pe);let Fe=o._.add([],J,Ee);o._.transformMat4(Fe,Fe,ie);let ze=o.d7/o.cD,ke=o._.length(Fe),_e=o.ax(Math.max(ke*ze-o.d7,Number.EPSILON),0),De=Math.min(T.zoomFromMercatorZAdjusted(_e),M.maxZoom);return De>.5*(o.b1+o.aU)?(T.setProjection({name:"mercator"}),T.zoom=De,this._cameraForBounds(T,a,f,g,y,b)):{center:T.center,zoom:De,bearing:g,pitch:y}}_extendAABB(r,a,f,g){let y=.5*((f.padding.left||0)+(f.padding.right||0)),b=.5*((f.padding.top||0)+(f.padding.bottom||0)),T=b,M=y,C=y,P=b,L=a.width-(M+C),F=a.height-(T+P),N=o._.sub([],r.max,r.min),j=Math.min(L/N[0],F/N[1]),U=Math.min(a.scaleZoom(a.scale*j),f.maxZoom);if(isNaN(U))return null;let G=a.scale/a.zoomScale(U),$=new o.b6([r.min[0]-M*G,r.min[1]-P*G,r.min[2]],[r.max[0]+C*G,r.max[1]+T*G,r.max[2]]),Q=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new o.P(f.offset.x,f.offset.y):o.P.convert(f.offset)).rotate(-o.ab(g));return $.center[0]-=Q.x*G,$.center[1]+=Q.y*G,$}queryTerrainElevation(r,a){let f=this.transform.elevation;return f?(a=o.W({},{exaggerated:!0},a),f.getAtPoint(o.Y.fromLngLat(r),null,a.exaggerated)):null}_cameraForBounds(r,a,f,g,y,b){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,a,f,g,y,b);let T=r.clone(),M=this._extendCameraOptions(b);T.bearing=g,T.pitch=y;let C=o.aI.convert(a),P=o.aI.convert(f),L=new o.aI(C.lng,P.lat),F=new o.aI(P.lng,C.lat),N=T.project(C),j=T.project(P),U=this.queryTerrainElevation(C),G=this.queryTerrainElevation(P),$=this.queryTerrainElevation(L),Q=this.queryTerrainElevation(F),K=[[N.x,N.y,Math.min(U||0,G||0,$||0,Q||0)],[j.x,j.y,Math.max(U||0,G||0,$||0,Q||0)]],J=o.b6.fromPoints(K),oe=T.getWorldToCameraMatrix(),ie=o.ad.invert(new Float64Array(16),oe);J=o.b6.applyTransform(J,oe);let ce=this._extendAABB(J,T,M,g);if(!ce)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");J=ce;let q=.5*o._.sub([],J.max,J.min)[2],ee=this._minimumAABBFrustumDistance(T,J),he=[0,0,1,0];o.aA.transformMat4(he,he,oe),o.aA.normalize(he,he);let we=o._.scale([],he,ee+q),pe=o._.add([],J.center,we);o._.transformMat4(J.center,J.center,ie),o._.transformMat4(pe,pe,ie);let ae=[J.center[0],J.center[1],pe[2]*T.pixelsPerMeter];o._.scale(ae,ae,1/T.worldSize);let Ee=o.d6(ae[0]),Fe=o.ay(ae[1]),ze=Math.min(T._zoomFromMercatorZ(ae[2]),M.maxZoom),ke=new o.aI(Ee,Fe);return T.mercatorFromTransition&&ze<.5*(o.b1+o.aU)?(T.setProjection({name:"globe"}),T.zoom=ze,this._cameraForBounds(T,a,f,g,y,b)):{center:ke,zoom:ze,bearing:g,pitch:y}}fitBounds(r,a,f){let g=this.cameraForBounds(r,a);return this._fitInternal(g,a,f)}fitScreenCoordinates(r,a,f,g,y){let b=o.P.convert(r),T=o.P.convert(a),M=new o.P(Math.min(b.x,T.x),Math.min(b.y,T.y)),C=new o.P(Math.max(b.x,T.x),Math.max(b.y,T.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,T))return this;let P=this.transform.pointLocation3D(M),L=this.transform.pointLocation3D(C),F=this.transform.pointLocation3D(new o.P(M.x,C.y)),N=this.transform.pointLocation3D(new o.P(C.x,M.y)),j=[Math.min(P.lng,L.lng,F.lng,N.lng),Math.min(P.lat,L.lat,F.lat,N.lat)],U=[Math.max(P.lng,L.lng,F.lng,N.lng),Math.max(P.lat,L.lat,F.lat,N.lat)],G=g&&g.pitch?g.pitch:this.getPitch(),$=this._cameraForBounds(this.transform,j,U,f,G,g);return this._fitInternal($,g,y)}_fitInternal(r,a,f){return r?(a=o.W(r,a)).linear?this.easeTo(a,f):this.flyTo(a,f):this}jumpTo(r,a){this.stop();let f=r.preloadOnly?this.transform.clone():this.transform,g=!1,y=!1,b=!1;if("zoom"in r&&f.zoom!==+r.zoom&&(g=!0,f.zoom=+r.zoom),r.center!==void 0&&(f.center=o.aI.convert(r.center)),"bearing"in r&&f.bearing!==+r.bearing&&(y=!0,f.bearing=+r.bearing),"pitch"in r&&f.pitch!==+r.pitch&&(b=!0,f.pitch=+r.pitch),r.padding!=null){let T=typeof r.padding=="number"?this._extendPadding(r.padding):r.padding;f.isPaddingEqual(T)||(f.padding=T)}return r.preloadOnly?(this._preloadTiles(f),this):(this.fire(new o.f("movestart",a)).fire(new o.f("move",a)),g&&this.fire(new o.f("zoomstart",a)).fire(new o.f("zoom",a)).fire(new o.f("zoomend",a)),y&&this.fire(new o.f("rotatestart",a)).fire(new o.f("rotate",a)).fire(new o.f("rotateend",a)),b&&this.fire(new o.f("pitchstart",a)).fire(new o.f("pitch",a)).fire(new o.f("pitchend",a)),this.fire(new o.f("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Qd),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,a){let f=this.transform;if(!f.projection.supportsFreeCamera)return o.w(Qd),this;this.stop();let g=f.zoom,y=f.pitch,b=f.bearing;f.setFreeCameraOptions(r);let T=g!==f.zoom,M=y!==f.pitch,C=b!==f.bearing;return this.fire(new o.f("movestart",a)).fire(new o.f("move",a)),T&&this.fire(new o.f("zoomstart",a)).fire(new o.f("zoom",a)).fire(new o.f("zoomend",a)),C&&this.fire(new o.f("rotatestart",a)).fire(new o.f("rotate",a)).fire(new o.f("rotateend",a)),M&&this.fire(new o.f("pitchstart",a)).fire(new o.f("pitch",a)).fire(new o.f("pitchend",a)),this.fire(new o.f("moveend",a)),this}easeTo(r,a){this._stop(!1,r.easeId),((r=o.W({offset:[0,0],duration:500,easing:o.d2},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);let f=this.transform,g=this.getZoom(),y=this.getBearing(),b=this.getPitch(),T=this.getPadding(),M="zoom"in r?+r.zoom:g,C="bearing"in r?this._normalizeBearing(r.bearing,y):y,P="pitch"in r?+r.pitch:b,L=this._extendPadding(r.padding),F=o.P.convert(r.offset),N,j,U;if(f.projection.name==="globe"){let ee=o.Y.fromLngLat(f.center),he=F.rotate(-f.angle);ee.x+=he.x/f.worldSize,ee.y+=he.y/f.worldSize;let we=ee.toLngLat(),pe=o.aI.convert(r.center||we);this._normalizeCenter(pe),N=f.centerPoint.add(he),j=new o.P(ee.x,ee.y).mult(f.worldSize),U=new o.P(o.aj(pe.lng),o.ak(pe.lat)).mult(f.worldSize).sub(j)}else{N=f.centerPoint.add(F);let ee=f.pointLocation(N),he=o.aI.convert(r.center||ee);this._normalizeCenter(he),j=f.project(ee),U=f.project(he).sub(j)}let G=f.zoomScale(M-g),$,Q;r.around&&($=o.aI.convert(r.around),Q=f.locationPoint($));let K=this._zooming||M!==g,J=this._rotating||y!==C,oe=this._pitching||P!==b,ie=!f.isPaddingEqual(L),ce=ee=>he=>{if(K&&(ee.zoom=o.a2(g,M,he)),J&&(ee.bearing=o.a2(y,C,he)),oe&&(ee.pitch=o.a2(b,P,he)),ie&&(ee.interpolatePadding(T,L,he),N=ee.centerPoint.add(F)),$)ee.setLocationAtPoint($,Q);else{let we=ee.zoomScale(ee.zoom-g),pe=M>g?Math.min(2,G):Math.max(.5,G),ae=Math.pow(pe,1-he),Ee=ee.unproject(j.add(U.mult(he*ae)).mult(we));ee.setLocationAtPoint(ee.renderWorldCopies?Ee.wrap():Ee,N)}return r.preloadOnly||this._fireMoveEvents(a),ee};if(r.preloadOnly){let ee=this._emulate(ce,r.duration,f);return this._preloadTiles(ee),this}let q={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=K,this._rotating=J,this._pitching=oe,this._padding=ie,this._easeId=r.easeId,this._prepareEase(a,r.noMoveStart,q),this._ease(ce(f),ee=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(a,ee)},r),this}_prepareEase(r,a,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||f.moving||this.fire(new o.f("movestart",r)),this._zooming&&!f.zooming&&this.fire(new o.f("zoomstart",r)),this._rotating&&!f.rotating&&this.fire(new o.f("rotatestart",r)),this._pitching&&!f.pitching&&this.fire(new o.f("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.f("move",r)),this._zooming&&this.fire(new o.f("zoom",r)),this._rotating&&this.fire(new o.f("rotate",r)),this._pitching&&this.fire(new o.f("pitch",r))}_afterEase(r,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let f=this._zooming,g=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new o.f("zoomend",r)),g&&this.fire(new o.f("rotateend",r)),y&&this.fire(new o.f("pitchend",r)),this.fire(new o.f("moveend",r))}flyTo(r,a){if(this._prefersReducedMotion(r)){let De=o.ah(r,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(De,a)}this.stop(),r=o.W({offset:[0,0],speed:1.2,curve:1.42,easing:o.d2},r);let f=this.transform,g=this.getZoom(),y=this.getBearing(),b=this.getPitch(),T=this.getPadding(),M="zoom"in r?o.at(+r.zoom,f.minZoom,f.maxZoom):g,C="bearing"in r?this._normalizeBearing(r.bearing,y):y,P="pitch"in r?+r.pitch:b,L=this._extendPadding(r.padding),F=f.zoomScale(M-g),N=o.P.convert(r.offset),j=f.centerPoint.add(N),U=f.pointLocation(j),G=o.aI.convert(r.center||U);this._normalizeCenter(G);let $=f.project(U),Q=f.project(G).sub($),K=r.curve,J=Math.max(f.width,f.height),oe=J/F,ie=Q.mag();if("minZoom"in r){let De=o.at(Math.min(r.minZoom,g,M),f.minZoom,f.maxZoom),Re=J/f.zoomScale(De-g);K=Math.sqrt(Re/ie*2)}let ce=K*K;function q(De){let Re=(oe*oe-J*J+(De?-1:1)*ce*ce*ie*ie)/(2*(De?oe:J)*ce*ie);return Math.log(Math.sqrt(Re*Re+1)-Re)}function ee(De){return(Math.exp(De)-Math.exp(-De))/2}function he(De){return(Math.exp(De)+Math.exp(-De))/2}let we=q(0),pe=function(De){return he(we)/he(we+K*De)},ae=function(De){return J*((he(we)*(ee(Re=we+K*De)/he(Re))-ee(we))/ce)/ie;var Re},Ee=(q(1)-we)/K;if(Math.abs(ie)<1e-6||!isFinite(Ee)){if(Math.abs(J-oe)<1e-6)return this.easeTo(r,a);let De=oe<J?-1:1;Ee=Math.abs(Math.log(oe/J))/K,ae=function(){return 0},pe=function(Re){return Math.exp(De*K*Re)}}r.duration="duration"in r?+r.duration:1e3*Ee/("screenSpeed"in r?+r.screenSpeed/K:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);let Fe=y!==C,ze=P!==b,ke=!f.isPaddingEqual(L),_e=De=>Re=>{let Qe=Re*Ee,Ke=1/pe(Qe);De.zoom=Re===1?M:g+De.scaleZoom(Ke),Fe&&(De.bearing=o.a2(y,C,Re)),ze&&(De.pitch=o.a2(b,P,Re)),ke&&(De.interpolatePadding(T,L,Re),j=De.centerPoint.add(N));let nt=Re===1?G:De.unproject($.add(Q.mult(ae(Qe))).mult(Ke));return De.setLocationAtPoint(De.renderWorldCopies?nt.wrap():nt,j),De._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(a),De};if(r.preloadOnly){let De=this._emulate(_e,r.duration,f);return this._preloadTiles(De),this}return this._zooming=!0,this._rotating=Fe,this._pitching=ze,this._padding=ke,this._prepareEase(a,!1),this._ease(_e(f),()=>this._afterEase(a),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,a)}if(!r){let f=this.handlers;f&&f.stop(!1)}return this}_ease(r,a,f){f.animate===!1||f.duration===0?(r(1),a()):(this._easeStart=o.e.now(),this._easeOptions=f,this._onEaseFrame=r,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let r=Math.min((o.e.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,a){r=o.au(r,-180,180);let f=Math.abs(r-a);return Math.abs(r-360-a)<f&&(r-=360),Math.abs(r+360-a)<f&&(r+=360),r}_normalizeCenter(r){let a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;let f=r.lng-a.center.lng;r.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&o.e.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,a,f){let g=Math.ceil(15*a/1e3),y=[],b=r(f.clone());for(let T=0;T<=g;T++){let M=b(T/g);y.push(M.clone())}return y}_preloadTiles(r,a){}}class sm{constructor(r={}){this.options=r,o.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){let a=this.options&&this.options.compact;return this._map=r,this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ye("button","mapboxgl-ctrl-attrib-button",this._container),ye("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ye("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,a){let f=this._map._getUIString(`AttributionControl.${a}`);r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",f)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));let a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.d8.ACCESS_TOKEN}];if(r){let f=a.reduce((g,y,b)=>(y.value&&(g+=`${y.key}=${y.value}${b<a.length-1?"&":""}`),g),"?");r.href=`${o.d8.FEEDBACK_URL}/${f}#${Kp(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){let g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}let a=this._map.style._mergedSourceCaches;for(let g in a){let y=a[g];if(y.used){let b=y.getSource();b.attribution&&r.indexOf(b.attribution)<0&&r.push(b.attribution)}}r.sort((g,y)=>g.length-y.length),r=r.filter((g,y)=>{for(let b=y+1;b<r.length;b++)if(r[b].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));let f=r.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,r.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class am{constructor(){o.bp(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=ye("div","mapboxgl-ctrl");let a=ye("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(let a in r){let f=r[a].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){let r=this._container.children;if(r.length){let a=r[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class lm{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){let a=++this._id;return this._queue.push({callback:r,id:a,cancelled:!1}),a}remove(r){let a=this._currentlyRunning,f=a?this._queue.concat(a):this._queue;for(let g of f)if(g.id===r)return void(g.cancelled=!0)}run(r=0){let a=this._currentlyRunning=this._queue;this._queue=[];for(let f of a)if(!f.cancelled&&(f.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function cm(u,r,a){if(u=new o.aI(u.lng,u.lat),r){let f=new o.aI(u.lng-360,u.lat),g=new o.aI(u.lng+360,u.lat),y=360*Math.ceil(Math.abs(u.lng-a.center.lng)/360),b=a.locationPoint(u).distSqr(r),T=r.x<0||r.y<0||r.x>a.width||r.y>a.height;a.locationPoint(f).distSqr(r)<b&&(T||Math.abs(f.lng-a.center.lng)<y)?u=f:a.locationPoint(g).distSqr(r)<b&&(T||Math.abs(g.lng-a.center.lng)<y)&&(u=g)}for(;Math.abs(u.lng-a.center.lng)>180;){let f=a.locationPoint(u);if(f.x>=0&&f.y>=0&&f.x<=a.width&&f.y<=a.height)break;u.lng>a.center.lng?u.lng-=360:u.lng+=360}return u}let Kd={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Jd extends o.E{constructor(r,a){if(super(),(r instanceof HTMLElement||a)&&(r=o.W({element:r},a)),o.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=o.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=ye("div");let y=41,b=27,T=Ne("svg",{display:"block",height:y*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${y}`},this._element),M=Ne("radialGradient",{id:"shadowGradient"},Ne("defs",{},T));Ne("stop",{offset:"10%","stop-opacity":.4},M),Ne("stop",{offset:"100%","stop-opacity":.05},M),Ne("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),Ne("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),Ne("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),Ne("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=o.P.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});let f=this._element.classList;for(let y in Kd)f.remove(`mapboxgl-marker-anchor-${y}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`);let g=r&&r.className?r.className.trim().split(/\s+/):[];f.add(...g),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){let r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.aI.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){let g=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){let a=r.code,f=r.charCode||r.keyCode;a!=="Space"&&a!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(r){let a=r.originalEvent.target,f=this._element;this._popup&&(a===f||f.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let r=this._map,a=this._pos;if(!r||!a)return!1;let f=r.unproject(a),g=r.getFreeCameraOptions();if(!g.position)return!1;let y=g.position.toLngLat();return y.distanceTo(f)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){let r=this._map;if(!r)return;let a=this._pos;if(!a||a.x<0||a.x>r.transform.width||a.y<0||a.y>r.transform.height)return void this._clearFadeTimer();let f=r.unproject(a),g;r._showingGlobe()&&o.d9(r.transform,this._lngLat)?g=0:(g=1-r._queryFogOpacity(f),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let r=this._pos;if(!r||!this._map)return;let a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${Kd[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){let r=this._pos,a=this._map,f=this.getPitchAlignment();if(!a||!r||f!=="map")return"";if(!a._showingGlobe()){let M=a.getPitch();return M?`rotateX(${M}deg)`:""}let g=o.b0(o.da(a.transform,this._lngLat)),y=r.sub(o.db(a.transform)),b=Math.abs(y.x)+Math.abs(y.y);if(b===0)return"";let T=g/b;return`rotateX(${-y.y*T}deg) rotateY(${y.x*T}deg)`}_calculateZTransform(){let r=this._pos,a=this._map;if(!a||!r)return"";let f=0,g=this.getRotationAlignment();if(g==="map")if(a._showingGlobe()){let y=a.project(new o.aI(this._lngLat.lng,this._lngLat.lat+.001)),b=a.project(new o.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(y);f=o.b0(Math.atan2(b.y,b.x))-90}else f=-a.getBearing();else if(g==="horizon"){let y=o.$(4,6,a.getZoom()),b=o.db(a.transform);b.y+=y*a.transform.height;let T=r.sub(b),M=o.b0(Math.atan2(T.y,T.x));f=(M>90?M-270:M+90)*(1-y)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);let a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=cm(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){let a=this._map;if(!a)return;let f=this._pointerdownPos,g=this._positionDelta;if(f&&g){if(!this._isDragging){let y=this._clickTolerance||a._clickTolerance;if(r.point.dist(f)<y)return;this._isDragging=!0}this._pos=r.point.sub(g),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.f("dragstart"))),this.fire(new o.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.f("dragend")),this._state="inactive"}_addDragHandler(r){let a=this._map,f=this._pos;a&&f&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(f),this._pointerdownPos=r.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;let a=this._map;return a&&(r?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let ef={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},tf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function nf(u=new o.P(0,0),r="bottom"){if(typeof u=="number"){let a=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(r){case"top":return new o.P(0,u);case"top-left":return new o.P(a,a);case"top-right":return new o.P(-a,a);case"bottom":return new o.P(0,-u);case"bottom-left":return new o.P(a,-a);case"bottom-right":return new o.P(-a,-a);case"left":return new o.P(u,0);case"right":return new o.P(-u,0)}return new o.P(0,0)}return u instanceof o.P||Array.isArray(u)?o.P.convert(u):o.P.convert(u[r]||[0,0])}class Ra{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;let a=o.b9((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,a,f){this._start=this.getValue(a),this._end=r,this._startTime=a,this._endTime=a+f}}let um={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class hm{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let dm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},rf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Cs{constructor(r,a,f=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Ud({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,f&&(this.mousePitch=new Gd({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(r,a){this.mouseRotate.mousedown(r,a),this.mousePitch&&this.mousePitch.mousedown(r,a),Zt()}move(r,a){let f=this.map,g=this.mouseRotate.mousemoveWindow(r,a),y=g&&g.bearingDelta;if(y&&f.setBearing(f.getBearing()+y),this.mousePitch){let b=this.mousePitch.mousemoveWindow(r,a),T=b&&b.pitchDelta;T&&f.setPitch(f.getPitch()+T)}}off(){let r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){jt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(o.W({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Ut(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Ut(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=pn(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=pn(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let fm={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ss={maxWidth:100,unit:"metric"},pm={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:o.dt,supported:V,setRTLTextPlugin:o.dv,getRTLTextPluginStatus:o.dw,Map:class extends Pa{constructor(u){o.dc.mark(o.dd.create);let r=u;if((u=o.W({},dm,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&o.de(window)&&(u.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Qn(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._repaint=!!u.repaint,this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new lm,this._domRenderTaskQueue=new lm,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.df(),this._locale=o.W({},um,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._tessellationStep=u.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Ra(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new o.dg(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,this._contextCreateOptions=u.contextCreateOptions?Br({},u.contextCreateOptions):{},typeof u.container=="string"){let a=document.getElementById(u.container);if(!a)throw new Error(`Container '${u.container.toString()}' not found.`);this._container=a}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),o.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new hm),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new om(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,(u.style||!u.testMode)&&this.setStyle(u.style||o.d8.DEFAULT_STYLE,{config:u.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),u.hash&&(this._hash=new Qp(typeof u.hash=="string"&&u.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch});let a=u.bounds;a&&(this.resize(),this.fitBounds(a,o.W({},u.fitBoundsOptions,{duration:0})))}this.resize(),u.attributionControl&&this.addControl(new sm({customAttribution:u.customAttribution})),this._logoControl=new am,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new o.f(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new o.f(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(u,r){if(r===void 0&&(r=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new o.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let a=u.onAdd(this);this._controls.push(u);let f=this._controlPositions[r];return r.indexOf("bottom")!==-1?f.insertBefore(a,f.firstChild):f.appendChild(a),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new o.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let r=this._controls.indexOf(u);return r>-1&&this._controls.splice(r,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let r=!this._moving;return r&&this.fire(new o.f("movestart",u)).fire(new o.f("move",u)),this.fire(new o.f("resize",u)),r&&this.fire(new o.f("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(o.ai.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new o.f("zoomstart")).fire(new o.f("zoom")).fire(new o.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new o.f("zoomstart")).fire(new o.f("zoom")).fire(new o.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new o.f("pitchstart")).fire(new o.f("pitch")).fire(new o.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new o.f("pitchstart")).fire(new o.f("pitch")).fire(new o.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(r=>r==="auto"?navigator.language:r):u}setLanguage(u){let r=this._parseLanguage(u);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(let a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let u=this.transform,r=u.projection.name,a;r==="globe"&&u.zoom>=o.aU?(u.setMercatorFromTransition(),a=!0):r==="mercator"&&u.zoom<o.aU&&(u.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(u,r){return this._updateProjection(u||r||{name:"mercator"})}_updateProjection(u){let r;return r=u.name==="globe"&&this.transform.zoom>=o.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(u){return this.transform.locationPoint3D(o.aI.convert(u))}unproject(u){return this.transform.pointLocation3D(o.P.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,r,a){if(u==="mouseenter"||u==="mouseover"){let f=!1,g=b=>{let T=r.filter(C=>this.getLayer(C)),M=T.length?this.queryRenderedFeatures(b.point,{layers:T}):[];M.length?f||(f=!0,a.call(this,new Wr(u,this,b.originalEvent,{features:M}))):f=!1},y=()=>{f=!1};return{layers:new Set(r),listener:a,delegates:{mousemove:g,mouseout:y}}}if(u==="mouseleave"||u==="mouseout"){let f=!1,g=b=>{let T=r.filter(M=>this.getLayer(M));(T.length?this.queryRenderedFeatures(b.point,{layers:T}):[]).length?f=!0:f&&(f=!1,a.call(this,new Wr(u,this,b.originalEvent)))},y=b=>{f&&(f=!1,a.call(this,new Wr(u,this,b.originalEvent)))};return{layers:new Set(r),listener:a,delegates:{mousemove:g,mouseout:y}}}{let f=g=>{let y=r.filter(T=>this.getLayer(T)),b=y.length?this.queryRenderedFeatures(g.point,{layers:y}):[];b.length&&(g.features=b,a.call(this,g),delete g.features)};return{layers:new Set(r),listener:a,delegates:{[u]:f}}}}on(u,r,a){if(typeof r=="function"||a===void 0)return super.on(u,r);if(Array.isArray(r)||(r=[r]),r){for(let g of r)if(!this._isValidId(g))return this}let f=this._createDelegatedListener(u,r,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(f);for(let g in f.delegates)this.on(g,f.delegates[g]);return this}once(u,r,a){if(typeof r=="function"||a===void 0)return super.once(u,r);if(Array.isArray(r)||(r=[r]),r){for(let g of r)if(!this._isValidId(g))return this}let f=this._createDelegatedListener(u,r,a);for(let g in f.delegates)this.once(g,f.delegates[g]);return this}off(u,r,a){if(typeof r=="function"||a===void 0)return super.off(u,r);let f=new Set(Array.isArray(r)?r:[r]);for(let b of f)if(!this._isValidId(b))return this;let g=(b,T)=>{if(b.size!==T.size)return!1;for(let M of b)if(!T.has(M))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[u]:void 0;return y&&(b=>{for(let T=0;T<b.length;T++){let M=b[T];if(M.listener===a&&g(M.layers,f)){for(let C in M.delegates)this.off(C,M.delegates[C]);return b.splice(T,1),this}}})(y),this}queryRenderedFeatures(u,r){if(!this.style)return[];if(r!==void 0||u===void 0||u instanceof o.P||Array.isArray(u)||(r=u,u=void 0),u=u||[[0,0],[this.transform.width,this.transform.height]],(r=r||{}).layers&&Array.isArray(r.layers)){for(let a of r.layers)if(!this._isValidId(a))return[]}return this.style.queryRenderedFeatures(u,r,this.transform)}querySourceFeatures(u,r){return this._isValidId(u)?this.style.querySourceFeatures(u,r):[]}isPointOnSurface(u){let{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&o.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(u))}setStyle(u,r){return r=o.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&u&&r.diff!==!1&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(u,(a,f)=>{a?(o.w(`Unable to perform style diff: ${String(a.message||a.error||a)}. Rebuilding the style from scratch.`),this._updateStyle(u,r)):f&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(u,r))}_getUIString(u){let r=this._locale[u];if(r==null)throw new Error(`Missing UI string '${u}'`);return r}_updateStyle(u,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u){let a=o.W({},r);r&&r.config&&(a.initialConfig=r.config,delete a.config),this.style=new Si(this,a).load(u),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Si(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(u){return u==null?(this.fire(new o.d(new Error("IDs can't be empty."))),!1):!o.cV(u)||(this.fire(new o.d(new Error(`IDs can't contain special symbols: "${u}".`))),!1)}addSource(u,r){return this._isValidId(u)?(this._lazyInitEmptyStyle(),this.style.addSource(u,r),this._update(!0)):this}isSourceLoaded(u){return!!this._isValidId(u)&&!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(u,r,a){this._lazyInitEmptyStyle(),this.style.addSourceType(u,r,a)}removeSource(u){return this._isValidId(u)?(this.style.removeSource(u),this._updateTerrain(),this._update(!0)):this}getSource(u){return this._isValidId(u)?this.style.getOwnSource(u):null}addImage(u,r,{pixelRatio:a=1,sdf:f=!1,stretchX:g,stretchY:y,content:b}={}){if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){let{width:T,height:M,data:C}=o.e.getImageData(r);this.style.addImage(u,{data:new o.i({width:T,height:M},C),pixelRatio:a,stretchX:g,stretchY:y,content:b,sdf:f,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new o.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:T,height:M}=r,C=r;this.style.addImage(u,{data:new o.i({width:T,height:M},new Uint8Array(C.data)),pixelRatio:a,stretchX:g,stretchY:y,content:b,sdf:f,version:0,userImage:C}),C.onAdd&&C.onAdd(this,u)}}updateImage(u,r){this._lazyInitEmptyStyle();let a=this.style.getImage(u);if(!a)return void this.fire(new o.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let f=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?o.e.getImageData(r):r,{width:g,height:y,data:b}=f;if(g===void 0||y===void 0)return void this.fire(new o.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==a.data.width||y!==a.data.height)return void this.fire(new o.d(new Error(`The width and height of the updated image (${g}, ${y})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`)));let T=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);a.data.replace(b,T),this.style.updateImage(u,a)}hasImage(u){return u?!!this.style&&!!this.style.getImage(u):(this.fire(new o.d(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,r){o.h(this._requestManager.transformRequest(u,o.R.Image),(a,f)=>{r(a,f instanceof HTMLImageElement?o.e.getImageData(f):f)})}listImages(){return this.style.listImages()}addModel(u,r){this._lazyInitEmptyStyle(),this.style.addModel(u,r)}hasModel(u){return u?this.style.hasModel(u):(this.fire(new o.d(new Error("Missing required model id"))),!1)}removeModel(u){this.style.removeModel(u)}listModels(){return this.style.listModels()}addLayer(u,r){return this._isValidId(u.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(u,r),this._update(!0)):this}getSlot(u){let r=this.getLayer(u);return r&&r.slot||null}setSlot(u,r){return this.style.setSlot(u,r),this.style.mergeLayers(),this._update(!0)}addImport(u,r){return this.style.addImport(u,r),this}updateImport(u,r){return typeof r!="string"&&r.id!==u?(this.removeImport(u),this.addImport(r)):(this.style.updateImport(u,r),this._update(!0))}removeImport(u){return this.style.removeImport(u),this}moveImport(u,r){return this.style.moveImport(u,r),this._update(!0)}moveLayer(u,r){return this._isValidId(u)?(this.style.moveLayer(u,r),this._update(!0)):this}removeLayer(u){return this._isValidId(u)?(this.style.removeLayer(u),this._update(!0)):this}getLayer(u){if(!this._isValidId(u))return null;let r=this.style.getOwnLayer(u);return r?r.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(u,r,a){return this._isValidId(u)?(this.style.setLayerZoomRange(u,r,a),this._update(!0)):this}setFilter(u,r,a={}){return this._isValidId(u)?(this.style.setFilter(u,r,a),this._update(!0)):this}getFilter(u){return this._isValidId(u)?this.style.getFilter(u):null}setPaintProperty(u,r,a,f={}){return this._isValidId(u)?(this.style.setPaintProperty(u,r,a,f),this._update(!0)):this}getPaintProperty(u,r){return this._isValidId(u)?this.style.getPaintProperty(u,r):null}setLayoutProperty(u,r,a,f={}){return this._isValidId(u)?(this.style.setLayoutProperty(u,r,a,f),this._update(!0)):this}getLayoutProperty(u,r){return this._isValidId(u)?this.style.getLayoutProperty(u,r):null}getSchema(u){return this.style.getSchema(u)}setSchema(u,r){return this.style.setSchema(u,r),this._update(!0)}getConfig(u){return this.style.getConfig(u)}setConfig(u,r){return this.style.setConfig(u,r),this._update(!0)}getConfigProperty(u,r){return this.style.getConfigProperty(u,r)}setConfigProperty(u,r,a){return this.style.setConfigProperty(u,r,a),this._update(!0)}setLights(u){if(this._lazyInitEmptyStyle(),u&&u.length===1&&u[0].type==="flat"){let r=u[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(u),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let u=this.style.getLights()||[];return u.length===0&&u.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),u}setLight(u,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:u}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(u){return this._lazyInitEmptyStyle(),this.style.setColorTheme(u),this._update(!0)}setCamera(u){return this.style.setCamera(u),this._triggerCameraUpdate(u)}_triggerCameraUpdate(u){return this._update(this.transform.setOrthographicProjectionAtLowPitch(u["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.aI.convert(u),this.transform):0}setFeatureState(u,r){return this._isValidId(u.source)?(this.style.setFeatureState(u,r),this._update()):this}removeFeatureState(u,r){return this._isValidId(u.source)?(this.style.removeFeatureState(u,r),this._update()):this}getFeatureState(u){return this._isValidId(u.source)?this.style.getFeatureState(u):null}_updateContainerDimensions(){if(!this._container)return;let u=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300,a,f,g,y=this._container;for(;y&&(!f||!g);){let b=window.getComputedStyle(y).transform;b&&b!=="none"&&(a=b.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(f=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(g=a[3])),y=y.parentElement}this._containerWidth=f?Math.abs(u/f):u,this._containerHeight=g?Math.abs(r/g):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=ye("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();let r=this._canvasContainer=ye("div","mapboxgl-canvas-container",u);this._canvas=ye("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let a=this._controlContainer=ye("div","mapboxgl-control-container",u),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{f[g]=ye("div",`mapboxgl-ctrl-${g}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,r){let a=o.e.devicePixelRatio||1;this._canvas.width=a*Math.ceil(u),this._canvas.height=a*Math.ceil(r),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${r}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){let r=this._markers.indexOf(u);r!==-1&&this._markers.splice(r,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){let r=this._popups.indexOf(u);r!==-1&&this._popups.splice(r,1)}_setupPainter(){let u=o.W({},V.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",u);r?(o.dh(r,!0),this.painter=new ey(r,this._contextCreateOptions,this.transform,this._tp),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.di.testSupport(r)):this.fire(new o.d(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.f("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.resize(),this._update(),this.fire(new o.f("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let r;this.fire(new o.f("renderstart")),++this._frameId;let a=this.painter.context.extTimerQuery,f=o.e.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=g.createQuery(),g.beginQuery(a.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();let y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let C=this.transform.zoom,P=this.transform.pitch,L=o.e.now(),F=new o.X(C,{now:L,fadeDuration:y,pitch:P,transition:this.style.transition});this.style.update(F)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(f),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(f);let T=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource);if(T&&(this._placementDirty=T.needsRerender,this._occlusionOpacityChanged=T.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.dc.mark(o.dd.load),this.fire(new o.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){let C=o.e.now()-f;g.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{let P=g.getQueryParameter(r,g.QUERY_RESULT)/1e6;g.deleteQuery(r),this.fire(new o.f("gpu-timing-frame",{cpuTime:C,gpuTime:P}))},50)}if(this.listens("gpu-timing-layer")){let C=this.painter.collectGpuTimers();setTimeout(()=>{let P=this.painter.queryGpuTimers(C);this.fire(new o.f("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){let C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let P=this.painter.queryGpuTimeDeferredRender(C);this.fire(new o.f("gpu-timing-deferred-render",{gpuTime:P}))},50)}let M=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||b;if((this._sourcesDirty||this._styleDirty||b||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),M||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{let C=!this.isMoving()&&this.loaded();if(C&&(b=this._updateAverageElevation(f,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new o.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let P=this._calculateSpeedIndex();this.fire(new o.f("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!M&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,o.dc.mark(o.dd.fullLoad),this._performanceMetricsCollection&&o.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(let r of this._markers)u&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(let r of this._popups)!u||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(u,r=!1){let a=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);let f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(r||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){let g=this.transform.averageElevation,y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=u;let b=Math.abs(g-y);if(b>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(y),a(y);this._averageElevation.easeTo(y,u,300)}else if(b>1e-4)return this._averageElevation.jumpTo(y),a(y)}return!!this._averageElevation.isEasing(u)&&a(this._averageElevation.getValue(u))}_authenticate(){o.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===o.dl||u.status===401)){let r=this.painter.context.gl;o.dh(r,!1),this._logoControl instanceof am&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&o.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){let u=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());let a=this.painter.context.gl,f=a.createFramebuffer();function g(y){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,y,0);let b=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,b),b}return a.bindFramebuffer(a.FRAMEBUFFER,f),this._canvasPixelComparison(g(u),r.canvasCopies.map(g),r.timeStamps)}_canvasPixelComparison(u,r,a){let f=a[1]-a[0],g=u.length/4;for(let y=0;y<r.length;y++){let b=r[y],T=0;for(let M=0;M<b.length;M+=4)b[M]===u[M]&&b[M+1]===u[M+1]&&b[M+2]===u[M+2]&&b[M+3]===u[M+3]&&(T+=1);f+=(a[y+2]-a[y+1])*(1-T/g)}return f}remove(){this._hash&&this._hash.remove();for(let r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.dp(this.painter.context.gl),o.dq.remove(),o.dr.remove(),this._removed=!0,this.fire(new o.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=o.e.frame(r=>{let a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(r)}))}_preloadTiles(u){let r=this.style?this.style.getSourceCaches():[];return o.ds(r,(a,f)=>a._preloadTiles(u,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(u){this._showParseStatus!==u&&(this._showParseStatus=u,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(u){this._showLayers2DWireframe!==u&&(this._showLayers2DWireframe=u,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(u){this._showLayers3DWireframe!==u&&(this._showLayers3DWireframe=u,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,this._tp.refreshUI(),u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,this._tp.refreshUI(),u&&this._update())}_setCacheLimits(u,r){o.du(u,r)}_occlusionCriteriaSatisfied(){let u=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&u&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return o.dt}},NavigationControl:class{constructor(u={}){this.options=o.W({},rf,u),this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),ye("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),ye("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{let a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:r}):a.resetNorth({},{originalEvent:r}))}),this._compassIcon=ye("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let u=this._map;if(!u)return;let r=u.getZoom(),a=r===u.getMaxZoom(),f=r===u.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){let u=this._map;if(!u)return;let r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cs(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){let u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,r){let a=ye("button",u,this._container);return a.type="button",a.addEventListener("click",r),a}_setButtonTitle(u,r){if(!this._map)return;let a=this._map._getUIString(`NavigationControl.${r}`);u.setAttribute("aria-label",a),u.firstElementChild&&u.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends o.E{constructor(u={}){super();let r=navigator.geolocation;this.options=o.W({geolocation:r},fm,u),o.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Yp(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){let r=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,u(a)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>r(a.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(u){let r=this._map.getMaxBounds(),a=u.coords;return!!r&&(a.longitude<r.getWest()||a.longitude>r.getEast()||a.latitude<r.getSouth()||a.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new o.f("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.f("geolocate",u)),this._finish()}}_updateCamera(u){let r=new o.aI(u.coords.longitude,u.coords.latitude),a=u.coords.accuracy,f=this._map.getBearing(),g=o.W({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(a),g,{geolocateSource:!0})}_updateMarker(u){if(u){let r=new o.aI(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let u=this._map.transform,r=o.ax(1,u._center.lat)*u.worldSize,a=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.f("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=ye("button","mapboxgl-ctrl-geolocate",this._container),ye("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{let r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ye("div","mapboxgl-user-location"),this._dotElement.appendChild(ye("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ye("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Jd({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ye("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Jd({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.f("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let u=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:sm,ScaleControl:class{constructor(u={}){this.options=o.W({},Ss,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let u=this.options.maxWidth||100,r=this._map,a=r._containerHeight/2,f=r._containerWidth/2-u/2,g=r.unproject([f,a]),y=r.unproject([f+u,a]),b=g.distanceTo(y);if(this.options.unit==="imperial"){let T=3.2808*b;T>5280?this._setScale(u,T/5280,"mile"):this._setScale(u,T,"foot")}else this.options.unit==="nautical"?this._setScale(u,b/1852,"nautical-mile"):b>=1e3?this._setScale(u,b/1e3,"kilometer"):this._setScale(u,b,"meter")}_setScale(u,r,a){this._map._requestDomTask(()=>{let f=function(y){let b=Math.pow(10,`${Math.floor(y)}`.length-1),T=y/b;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(M){let C=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*C)/C}(T),b*T}(r),g=f/r;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(f):`${f}&nbsp;${pm[a]}`,this._container.style.width=u*g+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u={}){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:o.w("Full screen control 'container' must be a DOM element.")),o.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let u=this._fullscreenButton=ye("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ye("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(u){super(),this.options=o.W(Object.create(ef),u),o.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new o.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new o.f("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=o.aI.convert(u),this._pos=null,this._trackPointer=!1,this._update();let r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){let r=document.createDocumentFragment(),a=document.createElement("body"),f;for(a.innerHTML=u;f=a.firstChild,f;)r.appendChild(f);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=ye("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(u),this.options.closeButton){let a=this._closeButton=ye("button","mapboxgl-popup-close-button",r);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let r;return this._classList.delete(u)?r=!1:(this._classList.add(u),r=!0),this._updateClassList(),r}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;let r=this._map,a=this._container,f=this._pos;if(!r||!a||!f)return"bottom";let g=a.offsetWidth,y=a.offsetHeight,b=f.x<g/2,T=f.x>r.transform.width-g/2;if(f.y+u<y)return b?"top-left":T?"top-right":"top";if(f.y>r.transform.height-y){if(b)return"bottom-left";if(T)return"bottom-right"}return b?"left":T?"right":"bottom"}_updateClassList(){let u=this._container;if(!u)return;let r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),u.className=r.join(" ")}_update(u){let r=this._map,a=this._content;if(!r||!this._lngLat&&!this._trackPointer||!a)return;let f=this._container;if(f||(f=this._container=ye("div","mapboxgl-popup",r.getContainer()),this._tip=ye("div","mapboxgl-popup-tip",f),f.appendChild(a)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=cm(this._lngLat,this._pos,r.transform)),!this._trackPointer||u){let g=this._pos=this._trackPointer&&u instanceof o.P?u:r.project(this._lngLat),y=nf(this.options.offset),b=this._anchor=this._getAnchor(y.y),T=nf(this.options.offset,b),M=g.add(T).round();r._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${Kd[b]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&r._showingGlobe()){let g=o.d9(r.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let u=this._container.querySelector(tf);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:Jd,Style:Si,LngLat:o.aI,LngLatBounds:o.ai,Point:o.P,MercatorCoordinate:o.Y,FreeCameraOptions:bp,Evented:o.E,config:o.d8,prewarm:o.dx,clearPrewarmedResources:o.dy,get accessToken(){return o.d8.ACCESS_TOKEN},set accessToken(u){o.d8.ACCESS_TOKEN=u},get baseApiUrl(){return o.d8.API_URL},set baseApiUrl(u){o.d8.API_URL=u},get workerCount(){return o.dz.workerCount},set workerCount(u){o.dz.workerCount=u},get maxParallelImageRequests(){return o.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){o.d8.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){o.dA(u)},get workerUrl(){return o.dB.workerUrl},set workerUrl(u){o.dB.workerUrl=u},get workerClass(){return o.dB.workerClass},set workerClass(u){o.dB.workerClass=u},get workerParams(){return o.dB.workerParams},set workerParams(u){o.dB.workerParams=u},get dracoUrl(){return o.dC()},set dracoUrl(u){o.dD(u)},get meshoptUrl(){return o.dE()},set meshoptUrl(u){o.dF(u)},setNow:o.e.setNow,restoreNow:o.e.restoreNow}});var I=_;return I})});var tx=null;var ex=1,dE=Symbol("SIGNAL");function Gn(h){let d=tx;return tx=h,d}function fE(){return tx}var nx={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function SP(h){if(!(ax(h)&&!h.dirty)&&!(!h.dirty&&h.lastCleanEpoch===ex)){if(!h.producerMustRecompute(h)&&!ix(h)){h.dirty=!1,h.lastCleanEpoch=ex;return}h.producerRecomputeValue(h),h.dirty=!1,h.lastCleanEpoch=ex}}function rx(h){return h&&(h.nextProducerIndex=0),Gn(h)}function pE(h,d){if(Gn(d),!(!h||h.producerNode===void 0||h.producerIndexOfThis===void 0||h.producerLastReadVersion===void 0)){if(ax(h))for(let _=h.nextProducerIndex;_<h.producerNode.length;_++)sx(h.producerNode[_],h.producerIndexOfThis[_]);for(;h.producerNode.length>h.nextProducerIndex;)h.producerNode.pop(),h.producerLastReadVersion.pop(),h.producerIndexOfThis.pop()}}function ix(h){lx(h);for(let d=0;d<h.producerNode.length;d++){let _=h.producerNode[d],v=h.producerLastReadVersion[d];if(v!==_.version||(SP(_),v!==_.version))return!0}return!1}function ox(h){if(lx(h),ax(h))for(let d=0;d<h.producerNode.length;d++)sx(h.producerNode[d],h.producerIndexOfThis[d]);h.producerNode.length=h.producerLastReadVersion.length=h.producerIndexOfThis.length=0,h.liveConsumerNode&&(h.liveConsumerNode.length=h.liveConsumerIndexOfThis.length=0)}function sx(h,d){if(AP(h),h.liveConsumerNode.length===1&&PP(h))for(let v=0;v<h.producerNode.length;v++)sx(h.producerNode[v],h.producerIndexOfThis[v]);let _=h.liveConsumerNode.length-1;if(h.liveConsumerNode[d]=h.liveConsumerNode[_],h.liveConsumerIndexOfThis[d]=h.liveConsumerIndexOfThis[_],h.liveConsumerNode.length--,h.liveConsumerIndexOfThis.length--,d<h.liveConsumerNode.length){let v=h.liveConsumerIndexOfThis[d],I=h.liveConsumerNode[d];lx(I),I.producerIndexOfThis[v]=d}}function ax(h){return h.consumerIsAlwaysLive||(h?.liveConsumerNode?.length??0)>0}function lx(h){h.producerNode??=[],h.producerIndexOfThis??=[],h.producerLastReadVersion??=[]}function AP(h){h.liveConsumerNode??=[],h.liveConsumerIndexOfThis??=[]}function PP(h){return h.producerNode!==void 0}function RP(){throw new Error}var LP=RP;function mE(h){LP=h}function hn(h){return typeof h=="function"}function gh(h){let _=h(v=>{Error.call(v),v.stack=new Error().stack});return _.prototype=Object.create(Error.prototype),_.prototype.constructor=_,_}var Tg=gh(h=>function(_){h(this),this.message=_?`${_.length} errors occurred during unsubscription:
${_.map((v,I)=>`${I+1}) ${v.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=_});function Gf(h,d){if(h){let _=h.indexOf(d);0<=_&&h.splice(_,1)}}var Nr=class h{constructor(d){this.initialTeardown=d,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let d;if(!this.closed){this.closed=!0;let{_parentage:_}=this;if(_)if(this._parentage=null,Array.isArray(_))for(let o of _)o.remove(this);else _.remove(this);let{initialTeardown:v}=this;if(hn(v))try{v()}catch(o){d=o instanceof Tg?o.errors:[o]}let{_finalizers:I}=this;if(I){this._finalizers=null;for(let o of I)try{gE(o)}catch(k){d=d??[],k instanceof Tg?d=[...d,...k.errors]:d.push(k)}}if(d)throw new Tg(d)}}add(d){var _;if(d&&d!==this)if(this.closed)gE(d);else{if(d instanceof h){if(d.closed||d._hasParent(this))return;d._addParent(this)}(this._finalizers=(_=this._finalizers)!==null&&_!==void 0?_:[]).push(d)}}_hasParent(d){let{_parentage:_}=this;return _===d||Array.isArray(_)&&_.includes(d)}_addParent(d){let{_parentage:_}=this;this._parentage=Array.isArray(_)?(_.push(d),_):_?[_,d]:d}_removeParent(d){let{_parentage:_}=this;_===d?this._parentage=null:Array.isArray(_)&&Gf(_,d)}remove(d){let{_finalizers:_}=this;_&&Gf(_,d),d instanceof h&&d._removeParent(this)}};Nr.EMPTY=(()=>{let h=new Nr;return h.closed=!0,h})();var cx=Nr.EMPTY;function Eg(h){return h instanceof Nr||h&&"closed"in h&&hn(h.remove)&&hn(h.add)&&hn(h.unsubscribe)}function gE(h){hn(h)?h():h.unsubscribe()}var xo={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var _h={setTimeout(h,d,..._){let{delegate:v}=_h;return v?.setTimeout?v.setTimeout(h,d,..._):setTimeout(h,d,..._)},clearTimeout(h){let{delegate:d}=_h;return(d?.clearTimeout||clearTimeout)(h)},delegate:void 0};function Ig(h){_h.setTimeout(()=>{let{onUnhandledError:d}=xo;if(d)d(h);else throw h})}function $f(){}var _E=ux("C",void 0,void 0);function yE(h){return ux("E",void 0,h)}function xE(h){return ux("N",h,void 0)}function ux(h,d,_){return{kind:h,value:d,error:_}}var Tc=null;function yh(h){if(xo.useDeprecatedSynchronousErrorHandling){let d=!Tc;if(d&&(Tc={errorThrown:!1,error:null}),h(),d){let{errorThrown:_,error:v}=Tc;if(Tc=null,_)throw v}}else h()}function vE(h){xo.useDeprecatedSynchronousErrorHandling&&Tc&&(Tc.errorThrown=!0,Tc.error=h)}var Ec=class extends Nr{constructor(d){super(),this.isStopped=!1,d?(this.destination=d,Eg(d)&&d.add(this)):this.destination=FP}static create(d,_,v){return new xh(d,_,v)}next(d){this.isStopped?dx(xE(d),this):this._next(d)}error(d){this.isStopped?dx(yE(d),this):(this.isStopped=!0,this._error(d))}complete(){this.isStopped?dx(_E,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(d){this.destination.next(d)}_error(d){try{this.destination.error(d)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},OP=Function.prototype.bind;function hx(h,d){return OP.call(h,d)}var fx=class{constructor(d){this.partialObserver=d}next(d){let{partialObserver:_}=this;if(_.next)try{_.next(d)}catch(v){Dg(v)}}error(d){let{partialObserver:_}=this;if(_.error)try{_.error(d)}catch(v){Dg(v)}else Dg(d)}complete(){let{partialObserver:d}=this;if(d.complete)try{d.complete()}catch(_){Dg(_)}}},xh=class extends Ec{constructor(d,_,v){super();let I;if(hn(d)||!d)I={next:d??void 0,error:_??void 0,complete:v??void 0};else{let o;this&&xo.useDeprecatedNextContext?(o=Object.create(d),o.unsubscribe=()=>this.unsubscribe(),I={next:d.next&&hx(d.next,o),error:d.error&&hx(d.error,o),complete:d.complete&&hx(d.complete,o)}):I=d}this.destination=new fx(I)}};function Dg(h){xo.useDeprecatedSynchronousErrorHandling?vE(h):Ig(h)}function kP(h){throw h}function dx(h,d){let{onStoppedNotification:_}=xo;_&&_h.setTimeout(()=>_(h,d))}var FP={closed:!0,next:$f,error:kP,complete:$f};var vh=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Oi(h){return h}function NP(...h){return px(h)}function px(h){return h.length===0?Oi:h.length===1?h[0]:function(_){return h.reduce((v,I)=>I(v),_)}}var On=(()=>{class h{constructor(_){_&&(this._subscribe=_)}lift(_){let v=new h;return v.source=this,v.operator=_,v}subscribe(_,v,I){let o=BP(_)?_:new xh(_,v,I);return yh(()=>{let{operator:k,source:V}=this;o.add(k?k.call(o,V):V?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(_){try{return this._subscribe(_)}catch(v){_.error(v)}}forEach(_,v){return v=bE(v),new v((I,o)=>{let k=new xh({next:V=>{try{_(V)}catch(Z){o(Z),k.unsubscribe()}},error:o,complete:I});this.subscribe(k)})}_subscribe(_){var v;return(v=this.source)===null||v===void 0?void 0:v.subscribe(_)}[vh](){return this}pipe(..._){return px(_)(this)}toPromise(_){return _=bE(_),new _((v,I)=>{let o;this.subscribe(k=>o=k,k=>I(k),()=>v(o))})}}return h.create=d=>new h(d),h})();function bE(h){var d;return(d=h??xo.Promise)!==null&&d!==void 0?d:Promise}function zP(h){return h&&hn(h.next)&&hn(h.error)&&hn(h.complete)}function BP(h){return h&&h instanceof Ec||zP(h)&&Eg(h)}function mx(h){return hn(h?.lift)}function Pn(h){return d=>{if(mx(d))return d.lift(function(_){try{return h(_,this)}catch(v){this.error(v)}});throw new TypeError("Unable to lift unknown Observable type")}}function Rn(h,d,_,v,I){return new gx(h,d,_,v,I)}var gx=class extends Ec{constructor(d,_,v,I,o,k){super(d),this.onFinalize=o,this.shouldUnsubscribe=k,this._next=_?function(V){try{_(V)}catch(Z){d.error(Z)}}:super._next,this._error=I?function(V){try{I(V)}catch(Z){d.error(Z)}finally{this.unsubscribe()}}:super._error,this._complete=v?function(){try{v()}catch(V){d.error(V)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var d;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:_}=this;super.unsubscribe(),!_&&((d=this.onFinalize)===null||d===void 0||d.call(this))}}};function _x(){return Pn((h,d)=>{let _=null;h._refCount++;let v=Rn(d,void 0,void 0,void 0,()=>{if(!h||h._refCount<=0||0<--h._refCount){_=null;return}let I=h._connection,o=_;_=null,I&&(!o||I===o)&&I.unsubscribe(),d.unsubscribe()});h.subscribe(v),v.closed||(_=h.connect())})}var yx=class extends On{constructor(d,_){super(),this.source=d,this.subjectFactory=_,this._subject=null,this._refCount=0,this._connection=null,mx(d)&&(this.lift=d.lift)}_subscribe(d){return this.getSubject().subscribe(d)}getSubject(){let d=this._subject;return(!d||d.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:d}=this;this._subject=this._connection=null,d?.unsubscribe()}connect(){let d=this._connection;if(!d){d=this._connection=new Nr;let _=this.getSubject();d.add(this.source.subscribe(Rn(_,void 0,()=>{this._teardown(),_.complete()},v=>{this._teardown(),_.error(v)},()=>this._teardown()))),d.closed&&(this._connection=null,d=Nr.EMPTY)}return d}refCount(){return _x()(this)}};var wE=gh(h=>function(){h(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var ol=(()=>{class h extends On{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(_){let v=new Mg(this,this);return v.operator=_,v}_throwIfClosed(){if(this.closed)throw new wE}next(_){yh(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let v of this.currentObservers)v.next(_)}})}error(_){yh(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=_;let{observers:v}=this;for(;v.length;)v.shift().error(_)}})}complete(){yh(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:_}=this;for(;_.length;)_.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var _;return((_=this.observers)===null||_===void 0?void 0:_.length)>0}_trySubscribe(_){return this._throwIfClosed(),super._trySubscribe(_)}_subscribe(_){return this._throwIfClosed(),this._checkFinalizedStatuses(_),this._innerSubscribe(_)}_innerSubscribe(_){let{hasError:v,isStopped:I,observers:o}=this;return v||I?cx:(this.currentObservers=null,o.push(_),new Nr(()=>{this.currentObservers=null,Gf(o,_)}))}_checkFinalizedStatuses(_){let{hasError:v,thrownError:I,isStopped:o}=this;v?_.error(I):o&&_.complete()}asObservable(){let _=new On;return _.source=this,_}}return h.create=(d,_)=>new Mg(d,_),h})(),Mg=class extends ol{constructor(d,_){super(),this.destination=d,this.source=_}next(d){var _,v;(v=(_=this.destination)===null||_===void 0?void 0:_.next)===null||v===void 0||v.call(_,d)}error(d){var _,v;(v=(_=this.destination)===null||_===void 0?void 0:_.error)===null||v===void 0||v.call(_,d)}complete(){var d,_;(_=(d=this.destination)===null||d===void 0?void 0:d.complete)===null||_===void 0||_.call(d)}_subscribe(d){var _,v;return(v=(_=this.source)===null||_===void 0?void 0:_.subscribe(d))!==null&&v!==void 0?v:cx}};var Hf=class extends ol{constructor(d){super(),this._value=d}get value(){return this.getValue()}_subscribe(d){let _=super._subscribe(d);return!_.closed&&d.next(this._value),_}getValue(){let{hasError:d,thrownError:_,_value:v}=this;if(d)throw _;return this._throwIfClosed(),v}next(d){super.next(this._value=d)}};var qf=new On(h=>h.complete());function TE(h){return h&&hn(h.schedule)}function EE(h){return h[h.length-1]}function IE(h){return hn(EE(h))?h.pop():void 0}function sl(h){return TE(EE(h))?h.pop():void 0}function ME(h,d,_,v){function I(o){return o instanceof _?o:new _(function(k){k(o)})}return new(_||(_=Promise))(function(o,k){function V(ye){try{me(v.next(ye))}catch(Ne){k(Ne)}}function Z(ye){try{me(v.throw(ye))}catch(Ne){k(Ne)}}function me(ye){ye.done?o(ye.value):I(ye.value).then(V,Z)}me((v=v.apply(h,d||[])).next())})}function DE(h){var d=typeof Symbol=="function"&&Symbol.iterator,_=d&&h[d],v=0;if(_)return _.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&v>=h.length&&(h=void 0),{value:h&&h[v++],done:!h}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ic(h){return this instanceof Ic?(this.v=h,this):new Ic(h)}function CE(h,d,_){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var v=_.apply(h,d||[]),I,o=[];return I={},V("next"),V("throw"),V("return",k),I[Symbol.asyncIterator]=function(){return this},I;function k(et){return function(mt){return Promise.resolve(mt).then(et,Ne)}}function V(et,mt){v[et]&&(I[et]=function(Zt){return new Promise(function(jt,Rt){o.push([et,Zt,jt,Rt])>1||Z(et,Zt)})},mt&&(I[et]=mt(I[et])))}function Z(et,mt){try{me(v[et](mt))}catch(Zt){ot(o[0][3],Zt)}}function me(et){et.value instanceof Ic?Promise.resolve(et.value.v).then(ye,Ne):ot(o[0][2],et)}function ye(et){Z("next",et)}function Ne(et){Z("throw",et)}function ot(et,mt){et(mt),o.shift(),o.length&&Z(o[0][0],o[0][1])}}function SE(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var d=h[Symbol.asyncIterator],_;return d?d.call(h):(h=typeof DE=="function"?DE(h):h[Symbol.iterator](),_={},v("next"),v("throw"),v("return"),_[Symbol.asyncIterator]=function(){return this},_);function v(o){_[o]=h[o]&&function(k){return new Promise(function(V,Z){k=h[o](k),I(V,Z,k.done,k.value)})}}function I(o,k,V,Z){Promise.resolve(Z).then(function(me){o({value:me,done:V})},k)}}var Cg=h=>h&&typeof h.length=="number"&&typeof h!="function";function Sg(h){return hn(h?.then)}function Ag(h){return hn(h[vh])}function Pg(h){return Symbol.asyncIterator&&hn(h?.[Symbol.asyncIterator])}function Rg(h){return new TypeError(`You provided ${h!==null&&typeof h=="object"?"an invalid object":`'${h}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function VP(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Lg=VP();function Og(h){return hn(h?.[Lg])}function kg(h){return CE(this,arguments,function*(){let _=h.getReader();try{for(;;){let{value:v,done:I}=yield Ic(_.read());if(I)return yield Ic(void 0);yield yield Ic(v)}}finally{_.releaseLock()}})}function Fg(h){return hn(h?.getReader)}function zr(h){if(h instanceof On)return h;if(h!=null){if(Ag(h))return jP(h);if(Cg(h))return UP(h);if(Sg(h))return GP(h);if(Pg(h))return AE(h);if(Og(h))return $P(h);if(Fg(h))return HP(h)}throw Rg(h)}function jP(h){return new On(d=>{let _=h[vh]();if(hn(_.subscribe))return _.subscribe(d);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function UP(h){return new On(d=>{for(let _=0;_<h.length&&!d.closed;_++)d.next(h[_]);d.complete()})}function GP(h){return new On(d=>{h.then(_=>{d.closed||(d.next(_),d.complete())},_=>d.error(_)).then(null,Ig)})}function $P(h){return new On(d=>{for(let _ of h)if(d.next(_),d.closed)return;d.complete()})}function AE(h){return new On(d=>{qP(h,d).catch(_=>d.error(_))})}function HP(h){return AE(kg(h))}function qP(h,d){var _,v,I,o;return ME(this,void 0,void 0,function*(){try{for(_=SE(h);v=yield _.next(),!v.done;){let k=v.value;if(d.next(k),d.closed)return}}catch(k){I={error:k}}finally{try{v&&!v.done&&(o=_.return)&&(yield o.call(_))}finally{if(I)throw I.error}}d.complete()})}function gi(h,d,_,v=0,I=!1){let o=d.schedule(function(){_(),I?h.add(this.schedule(null,v)):this.unsubscribe()},v);if(h.add(o),!I)return o}function Ng(h,d=0){return Pn((_,v)=>{_.subscribe(Rn(v,I=>gi(v,h,()=>v.next(I),d),()=>gi(v,h,()=>v.complete(),d),I=>gi(v,h,()=>v.error(I),d)))})}function zg(h,d=0){return Pn((_,v)=>{v.add(h.schedule(()=>_.subscribe(v),d))})}function PE(h,d){return zr(h).pipe(zg(d),Ng(d))}function RE(h,d){return zr(h).pipe(zg(d),Ng(d))}function LE(h,d){return new On(_=>{let v=0;return d.schedule(function(){v===h.length?_.complete():(_.next(h[v++]),_.closed||this.schedule())})})}function OE(h,d){return new On(_=>{let v;return gi(_,d,()=>{v=h[Lg](),gi(_,d,()=>{let I,o;try{({value:I,done:o}=v.next())}catch(k){_.error(k);return}o?_.complete():_.next(I)},0,!0)}),()=>hn(v?.return)&&v.return()})}function Bg(h,d){if(!h)throw new Error("Iterable cannot be null");return new On(_=>{gi(_,d,()=>{let v=h[Symbol.asyncIterator]();gi(_,d,()=>{v.next().then(I=>{I.done?_.complete():_.next(I.value)})},0,!0)})})}function kE(h,d){return Bg(kg(h),d)}function FE(h,d){if(h!=null){if(Ag(h))return PE(h,d);if(Cg(h))return LE(h,d);if(Sg(h))return RE(h,d);if(Pg(h))return Bg(h,d);if(Og(h))return OE(h,d);if(Fg(h))return kE(h,d)}throw Rg(h)}function Qo(h,d){return d?FE(h,d):zr(h)}function Vg(...h){let d=sl(h);return Qo(h,d)}function WP(h,d){let _=hn(h)?h:()=>h,v=I=>I.error(_());return new On(d?I=>d.schedule(v,0,I):v)}function ZP(h){return!!h&&(h instanceof On||hn(h.lift)&&hn(h.subscribe))}var Dc=gh(h=>function(){h(this),this.name="EmptyError",this.message="no elements in sequence"});function _i(h,d){return Pn((_,v)=>{let I=0;_.subscribe(Rn(v,o=>{v.next(h.call(d,o,I++))}))})}var{isArray:XP}=Array;function YP(h,d){return XP(d)?h(...d):h(d)}function NE(h){return _i(d=>YP(h,d))}var{isArray:QP}=Array,{getPrototypeOf:KP,prototype:JP,keys:eR}=Object;function zE(h){if(h.length===1){let d=h[0];if(QP(d))return{args:d,keys:null};if(tR(d)){let _=eR(d);return{args:_.map(v=>d[v]),keys:_}}}return{args:h,keys:null}}function tR(h){return h&&typeof h=="object"&&KP(h)===JP}function BE(h,d){return h.reduce((_,v,I)=>(_[v]=d[I],_),{})}function nR(...h){let d=sl(h),_=IE(h),{args:v,keys:I}=zE(h);if(v.length===0)return Qo([],d);let o=new On(rR(v,d,I?k=>BE(I,k):Oi));return _?o.pipe(NE(_)):o}function rR(h,d,_=Oi){return v=>{VE(d,()=>{let{length:I}=h,o=new Array(I),k=I,V=I;for(let Z=0;Z<I;Z++)VE(d,()=>{let me=Qo(h[Z],d),ye=!1;me.subscribe(Rn(v,Ne=>{o[Z]=Ne,ye||(ye=!0,V--),V||v.next(_(o.slice()))},()=>{--k||v.complete()}))},v)},v)}}function VE(h,d,_){h?gi(_,h,d):d()}function jE(h,d,_,v,I,o,k,V){let Z=[],me=0,ye=0,Ne=!1,ot=()=>{Ne&&!Z.length&&!me&&d.complete()},et=Zt=>me<v?mt(Zt):Z.push(Zt),mt=Zt=>{o&&d.next(Zt),me++;let jt=!1;zr(_(Zt,ye++)).subscribe(Rn(d,Rt=>{I?.(Rt),o?et(Rt):d.next(Rt)},()=>{jt=!0},void 0,()=>{if(jt)try{for(me--;Z.length&&me<v;){let Rt=Z.shift();k?gi(d,k,()=>mt(Rt)):mt(Rt)}ot()}catch(Rt){d.error(Rt)}}))};return h.subscribe(Rn(d,et,()=>{Ne=!0,ot()})),()=>{V?.()}}function Mc(h,d,_=1/0){return hn(d)?Mc((v,I)=>_i((o,k)=>d(v,o,I,k))(zr(h(v,I))),_):(typeof d=="number"&&(_=d),Pn((v,I)=>jE(v,I,h,_)))}function UE(h=1/0){return Mc(Oi,h)}function GE(){return UE(1)}function jg(...h){return GE()(Qo(h,sl(h)))}function iR(h){return new On(d=>{zr(h()).subscribe(d)})}function Cc(h,d){return Pn((_,v)=>{let I=0;_.subscribe(Rn(v,o=>h.call(d,o,I++)&&v.next(o)))})}function $E(h){return Pn((d,_)=>{let v=null,I=!1,o;v=d.subscribe(Rn(_,void 0,void 0,k=>{o=zr(h(k,$E(h)(d))),v?(v.unsubscribe(),v=null,o.subscribe(_)):I=!0})),I&&(v.unsubscribe(),v=null,o.subscribe(_))})}function HE(h,d,_,v,I){return(o,k)=>{let V=_,Z=d,me=0;o.subscribe(Rn(k,ye=>{let Ne=me++;Z=V?h(Z,ye,Ne):(V=!0,ye),v&&k.next(Z)},I&&(()=>{V&&k.next(Z),k.complete()})))}}function xx(h,d){return hn(d)?Mc(h,d,1):Mc(h,1)}function Wf(h){return Pn((d,_)=>{let v=!1;d.subscribe(Rn(_,I=>{v=!0,_.next(I)},()=>{v||_.next(h),_.complete()}))})}function vx(h){return h<=0?()=>qf:Pn((d,_)=>{let v=0;d.subscribe(Rn(_,I=>{++v<=h&&(_.next(I),h<=v&&_.complete())}))})}function oR(h){return _i(()=>h)}function Ug(h=sR){return Pn((d,_)=>{let v=!1;d.subscribe(Rn(_,I=>{v=!0,_.next(I)},()=>v?_.complete():_.error(h())))})}function sR(){return new Dc}function Gg(h){return Pn((d,_)=>{try{d.subscribe(_)}finally{_.add(h)}})}function qE(h,d){let _=arguments.length>=2;return v=>v.pipe(h?Cc((I,o)=>h(I,o,v)):Oi,vx(1),_?Wf(d):Ug(()=>new Dc))}function bx(h){return h<=0?()=>qf:Pn((d,_)=>{let v=[];d.subscribe(Rn(_,I=>{v.push(I),h<v.length&&v.shift()},()=>{for(let I of v)_.next(I);_.complete()},void 0,()=>{v=null}))})}function aR(h,d){let _=arguments.length>=2;return v=>v.pipe(h?Cc((I,o)=>h(I,o,v)):Oi,bx(1),_?Wf(d):Ug(()=>new Dc))}function lR(h,d){return Pn(HE(h,d,arguments.length>=2,!0))}function cR(...h){let d=sl(h);return Pn((_,v)=>{(d?jg(h,_,d):jg(h,_)).subscribe(v)})}function wx(h,d){return Pn((_,v)=>{let I=null,o=0,k=!1,V=()=>k&&!I&&v.complete();_.subscribe(Rn(v,Z=>{I?.unsubscribe();let me=0,ye=o++;zr(h(Z,ye)).subscribe(I=Rn(v,Ne=>v.next(d?d(Z,Ne,ye,me++):Ne),()=>{I=null,V()}))},()=>{k=!0,V()}))})}function uR(h){return Pn((d,_)=>{zr(h).subscribe(Rn(_,()=>_.complete(),$f)),!_.closed&&d.subscribe(_)})}function WE(h,d,_){let v=hn(h)||d||_?{next:h,error:d,complete:_}:h;return v?Pn((I,o)=>{var k;(k=v.subscribe)===null||k===void 0||k.call(v);let V=!0;I.subscribe(Rn(o,Z=>{var me;(me=v.next)===null||me===void 0||me.call(v,Z),o.next(Z)},()=>{var Z;V=!1,(Z=v.complete)===null||Z===void 0||Z.call(v),o.complete()},Z=>{var me;V=!1,(me=v.error)===null||me===void 0||me.call(v,Z),o.error(Z)},()=>{var Z,me;V&&((Z=v.unsubscribe)===null||Z===void 0||Z.call(v)),(me=v.finalize)===null||me===void 0||me.call(v)}))}):Oi}var hR="https://g.co/ng/security#xss",kn=class extends Error{constructor(d,_){super(Av(d,_)),this.code=d}};function Av(h,d){return`${`NG0${Math.abs(h)}`}${d?": "+d:""}`}function ip(h){return{toString:h}.toString()}var $g="__parameters__";function dR(h){return function(..._){if(h){let v=h(..._);for(let I in v)this[I]=v[I]}}}function OI(h,d,_){return ip(()=>{let v=dR(d);function I(...o){if(this instanceof I)return v.apply(this,o),this;let k=new I(...o);return V.annotation=k,V;function V(Z,me,ye){let Ne=Z.hasOwnProperty($g)?Z[$g]:Object.defineProperty(Z,$g,{value:[]})[$g];for(;Ne.length<=ye;)Ne.push(null);return(Ne[ye]=Ne[ye]||[]).push(k),Z}}return _&&(I.prototype=Object.create(_.prototype)),I.prototype.ngMetadataName=h,I.annotationCls=I,I})}var ZE=globalThis;function Jn(h){for(let d in h)if(h[d]===Jn)return d;throw Error("Could not find renamed property on target object.")}function oi(h){if(typeof h=="string")return h;if(Array.isArray(h))return"["+h.map(oi).join(", ")+"]";if(h==null)return""+h;if(h.overriddenName)return`${h.overriddenName}`;if(h.name)return`${h.name}`;let d=h.toString();if(d==null)return""+d;let _=d.indexOf(`
`);return _===-1?d:d.substring(0,_)}function XE(h,d){return h==null||h===""?d===null?"":d:d==null||d===""?h:h+" "+d}var fR=Jn({__forward_ref__:Jn});function kI(h){return h.__forward_ref__=kI,h.toString=function(){return oi(this())},h}function Ji(h){return FI(h)?h():h}function FI(h){return typeof h=="function"&&h.hasOwnProperty(fR)&&h.__forward_ref__===kI}function Sn(h){return{token:h.token,providedIn:h.providedIn||null,factory:h.factory,value:void 0}}function Pv(h){return{providers:h.providers||[],imports:h.imports||[]}}function v_(h){return YE(h,NI)||YE(h,zI)}function $V(h){return v_(h)!==null}function YE(h,d){return h.hasOwnProperty(d)?h[d]:null}function pR(h){let d=h&&(h[NI]||h[zI]);return d||null}function QE(h){return h&&(h.hasOwnProperty(KE)||h.hasOwnProperty(mR))?h[KE]:null}var NI=Jn({\u0275prov:Jn}),KE=Jn({\u0275inj:Jn}),zI=Jn({ngInjectableDef:Jn}),mR=Jn({ngInjectorDef:Jn}),In=class{constructor(d,_){this._desc=d,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof _=="number"?this.__NG_ELEMENT_ID__=_:_!==void 0&&(this.\u0275prov=Sn({token:this,providedIn:_.providedIn||"root",factory:_.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function BI(h){return h&&!!h.\u0275providers}var gR=Jn({\u0275cmp:Jn}),_R=Jn({\u0275dir:Jn}),yR=Jn({\u0275pipe:Jn}),xR=Jn({\u0275mod:Jn}),Kg=Jn({\u0275fac:Jn}),Zf=Jn({__NG_ELEMENT_ID__:Jn}),JE=Jn({__NG_ENV_ID__:Jn});function VI(h){return typeof h=="string"?h:h==null?"":String(h)}function vR(h){return typeof h=="function"?h.name||h.toString():typeof h=="object"&&h!=null&&typeof h.type=="function"?h.type.name||h.type.toString():VI(h)}function bR(h,d){let _=d?`. Dependency path: ${d.join(" > ")} > ${h}`:"";throw new kn(-200,h)}function Rv(h,d){throw new kn(-201,!1)}var En=function(h){return h[h.Default=0]="Default",h[h.Host=1]="Host",h[h.Self=2]="Self",h[h.SkipSelf=4]="SkipSelf",h[h.Optional=8]="Optional",h}(En||{}),kx;function jI(){return kx}function Ki(h){let d=kx;return kx=h,d}function UI(h,d,_){let v=v_(h);if(v&&v.providedIn=="root")return v.value===void 0?v.value=v.factory():v.value;if(_&En.Optional)return null;if(d!==void 0)return d;Rv(h,"Injector")}var wR={},Xf=wR,Fx="__NG_DI_FLAG__",Jg="ngTempTokenPath",TR="ngTokenPath",ER=/\n/gm,IR="\u0275",eI="__source",Eh;function DR(){return Eh}function al(h){let d=Eh;return Eh=h,d}function MR(h,d=En.Default){if(Eh===void 0)throw new kn(-203,!1);return Eh===null?UI(h,void 0,d):Eh.get(h,d&En.Optional?null:void 0,d)}function Wn(h,d=En.Default){return(jI()||MR)(Ji(h),d)}function Mt(h,d=En.Default){return Wn(h,b_(d))}function b_(h){return typeof h>"u"||typeof h=="number"?h:0|(h.optional&&8)|(h.host&&1)|(h.self&&2)|(h.skipSelf&&4)}function Nx(h){let d=[];for(let _=0;_<h.length;_++){let v=Ji(h[_]);if(Array.isArray(v)){if(v.length===0)throw new kn(900,!1);let I,o=En.Default;for(let k=0;k<v.length;k++){let V=v[k],Z=CR(V);typeof Z=="number"?Z===-1?I=V.token:o|=Z:I=V}d.push(Wn(I,o))}else d.push(Wn(v))}return d}function GI(h,d){return h[Fx]=d,h.prototype[Fx]=d,h}function CR(h){return h[Fx]}function SR(h,d,_,v){let I=h[Jg];throw d[eI]&&I.unshift(d[eI]),h.message=AR(`
`+h.message,I,_,v),h[TR]=I,h[Jg]=null,h}function AR(h,d,_,v=null){h=h&&h.charAt(0)===`
`&&h.charAt(1)==IR?h.slice(2):h;let I=oi(d);if(Array.isArray(d))I=d.map(oi).join(" -> ");else if(typeof d=="object"){let o=[];for(let k in d)if(d.hasOwnProperty(k)){let V=d[k];o.push(k+":"+(typeof V=="string"?JSON.stringify(V):oi(V)))}I=`{${o.join(", ")}}`}return`${_}${v?"("+v+")":""}[${I}]: ${h.replace(ER,`
  `)}`}var PR=GI(OI("Optional"),8);var RR=GI(OI("SkipSelf"),4);function Dh(h,d){let _=h.hasOwnProperty(Kg);return _?h[Kg]:null}function LR(h,d,_){if(h.length!==d.length)return!1;for(let v=0;v<h.length;v++){let I=h[v],o=d[v];if(_&&(I=_(I),o=_(o)),o!==I)return!1}return!0}function OR(h){return h.flat(Number.POSITIVE_INFINITY)}function Lv(h,d){h.forEach(_=>Array.isArray(_)?Lv(_,d):d(_))}function $I(h,d,_){d>=h.length?h.push(_):h.splice(d,0,_)}function e_(h,d){return d>=h.length-1?h.pop():h.splice(d,1)[0]}function kR(h,d,_,v){let I=h.length;if(I==d)h.push(_,v);else if(I===1)h.push(v,h[0]),h[0]=_;else{for(I--,h.push(h[I-1],h[I]);I>d;){let o=I-2;h[I]=h[o],I--}h[d]=_,h[d+1]=v}}function FR(h,d,_){let v=op(h,d);return v>=0?h[v|1]=_:(v=~v,kR(h,v,d,_)),v}function Tx(h,d){let _=op(h,d);if(_>=0)return h[_|1]}function op(h,d){return NR(h,d,1)}function NR(h,d,_){let v=0,I=h.length>>_;for(;I!==v;){let o=v+(I-v>>1),k=h[o<<_];if(d===k)return o<<_;k>d?I=o:v=o+1}return~(I<<_)}var Yf={},bo=[],t_=new In(""),HI=new In("",-1),qI=new In(""),n_=class{get(d,_=Xf){if(_===Xf){let v=new Error(`NullInjectorError: No provider for ${oi(d)}!`);throw v.name="NullInjectorError",v}return _}},WI=function(h){return h[h.OnPush=0]="OnPush",h[h.Default=1]="Default",h}(WI||{}),Qf=function(h){return h[h.Emulated=0]="Emulated",h[h.None=2]="None",h[h.ShadowDom=3]="ShadowDom",h}(Qf||{}),ul=function(h){return h[h.None=0]="None",h[h.SignalBased=1]="SignalBased",h[h.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",h}(ul||{});function zR(h,d,_){let v=h.length;for(;;){let I=h.indexOf(d,_);if(I===-1)return I;if(I===0||h.charCodeAt(I-1)<=32){let o=d.length;if(I+o===v||h.charCodeAt(I+o)<=32)return I}_=I+1}}function zx(h,d,_){let v=0;for(;v<_.length;){let I=_[v];if(typeof I=="number"){if(I!==0)break;v++;let o=_[v++],k=_[v++],V=_[v++];h.setAttribute(d,k,V,o)}else{let o=I,k=_[++v];VR(o)?h.setProperty(d,o,k):h.setAttribute(d,o,k),v++}}return v}function BR(h){return h===3||h===4||h===6}function VR(h){return h.charCodeAt(0)===64}function Ov(h,d){if(!(d===null||d.length===0))if(h===null||h.length===0)h=d.slice();else{let _=-1;for(let v=0;v<d.length;v++){let I=d[v];typeof I=="number"?_=I:_===0||(_===-1||_===2?tI(h,_,I,null,d[++v]):tI(h,_,I,null,null))}}return h}function tI(h,d,_,v,I){let o=0,k=h.length;if(d===-1)k=-1;else for(;o<h.length;){let V=h[o++];if(typeof V=="number"){if(V===d){k=-1;break}else if(V>d){k=o-1;break}}}for(;o<h.length;){let V=h[o];if(typeof V=="number")break;if(V===_){if(v===null){I!==null&&(h[o+1]=I);return}else if(v===h[o+1]){h[o+2]=I;return}}o++,v!==null&&o++,I!==null&&o++}k!==-1&&(h.splice(k,0,d),o=k+1),h.splice(o++,0,_),v!==null&&h.splice(o++,0,v),I!==null&&h.splice(o++,0,I)}var ZI="ng-template";function jR(h,d,_,v){let I=0;if(v){for(;I<d.length&&typeof d[I]=="string";I+=2)if(d[I]==="class"&&zR(d[I+1].toLowerCase(),_,0)!==-1)return!0}else if(kv(h))return!1;if(I=d.indexOf(1,I),I>-1){let o;for(;++I<d.length&&typeof(o=d[I])=="string";)if(o.toLowerCase()===_)return!0}return!1}function kv(h){return h.type===4&&h.value!==ZI}function UR(h,d,_){let v=h.type===4&&!_?ZI:h.value;return d===v}function GR(h,d,_){let v=4,I=h.attrs,o=I!==null?qR(I):0,k=!1;for(let V=0;V<d.length;V++){let Z=d[V];if(typeof Z=="number"){if(!k&&!vo(v)&&!vo(Z))return!1;if(k&&vo(Z))continue;k=!1,v=Z|v&1;continue}if(!k)if(v&4){if(v=2|v&1,Z!==""&&!UR(h,Z,_)||Z===""&&d.length===1){if(vo(v))return!1;k=!0}}else if(v&8){if(I===null||!jR(h,I,Z,_)){if(vo(v))return!1;k=!0}}else{let me=d[++V],ye=$R(Z,I,kv(h),_);if(ye===-1){if(vo(v))return!1;k=!0;continue}if(me!==""){let Ne;if(ye>o?Ne="":Ne=I[ye+1].toLowerCase(),v&2&&me!==Ne){if(vo(v))return!1;k=!0}}}}return vo(v)||k}function vo(h){return(h&1)===0}function $R(h,d,_,v){if(d===null)return-1;let I=0;if(v||!_){let o=!1;for(;I<d.length;){let k=d[I];if(k===h)return I;if(k===3||k===6)o=!0;else if(k===1||k===2){let V=d[++I];for(;typeof V=="string";)V=d[++I];continue}else{if(k===4)break;if(k===0){I+=4;continue}}I+=o?1:2}return-1}else return WR(d,h)}function HR(h,d,_=!1){for(let v=0;v<d.length;v++)if(GR(h,d[v],_))return!0;return!1}function qR(h){for(let d=0;d<h.length;d++){let _=h[d];if(BR(_))return d}return h.length}function WR(h,d){let _=h.indexOf(4);if(_>-1)for(_++;_<h.length;){let v=h[_];if(typeof v=="number")return-1;if(v===d)return _;_++}return-1}function nI(h,d){return h?":not("+d.trim()+")":d}function ZR(h){let d=h[0],_=1,v=2,I="",o=!1;for(;_<h.length;){let k=h[_];if(typeof k=="string")if(v&2){let V=h[++_];I+="["+k+(V.length>0?'="'+V+'"':"")+"]"}else v&8?I+="."+k:v&4&&(I+=" "+k);else I!==""&&!vo(k)&&(d+=nI(o,I),I=""),v=k,o=o||!vo(v);_++}return I!==""&&(d+=nI(o,I)),d}function XR(h){return h.map(ZR).join(",")}function YR(h){let d=[],_=[],v=1,I=2;for(;v<h.length;){let o=h[v];if(typeof o=="string")I===2?o!==""&&d.push(o,h[++v]):I===8&&_.push(o);else{if(!vo(I))break;I=o}v++}return{attrs:d,classes:_}}function xi(h){return ip(()=>{let d=KI(h),_=il(Br({},d),{decls:h.decls,vars:h.vars,template:h.template,consts:h.consts||null,ngContentSelectors:h.ngContentSelectors,onPush:h.changeDetection===WI.OnPush,directiveDefs:null,pipeDefs:null,dependencies:d.standalone&&h.dependencies||null,getStandaloneInjector:null,signals:h.signals??!1,data:h.data||{},encapsulation:h.encapsulation||Qf.Emulated,styles:h.styles||bo,_:null,schemas:h.schemas||null,tView:null,id:""});JI(_);let v=h.dependencies;return _.directiveDefs=iI(v,!1),_.pipeDefs=iI(v,!0),_.id=eL(_),_})}function QR(h){return Pc(h)||XI(h)}function KR(h){return h!==null}function Fv(h){return ip(()=>({type:h.type,bootstrap:h.bootstrap||bo,declarations:h.declarations||bo,imports:h.imports||bo,exports:h.exports||bo,transitiveCompileScopes:null,schemas:h.schemas||null,id:h.id||null}))}function rI(h,d){if(h==null)return Yf;let _={};for(let v in h)if(h.hasOwnProperty(v)){let I=h[v],o,k,V=ul.None;Array.isArray(I)?(V=I[0],o=I[1],k=I[2]??o):(o=I,k=I),d?(_[o]=V!==ul.None?[v,V]:v,d[o]=k):_[o]=v}return _}function w_(h){return ip(()=>{let d=KI(h);return JI(d),d})}function Pc(h){return h[gR]||null}function XI(h){return h[_R]||null}function YI(h){return h[yR]||null}function JR(h){let d=Pc(h)||XI(h)||YI(h);return d!==null?d.standalone:!1}function QI(h,d){let _=h[xR]||null;if(!_&&d===!0)throw new Error(`Type ${oi(h)} does not have '\u0275mod' property.`);return _}function KI(h){let d={};return{type:h.type,providersResolver:null,factory:null,hostBindings:h.hostBindings||null,hostVars:h.hostVars||0,hostAttrs:h.hostAttrs||null,contentQueries:h.contentQueries||null,declaredInputs:d,inputTransforms:null,inputConfig:h.inputs||Yf,exportAs:h.exportAs||null,standalone:h.standalone===!0,signals:h.signals===!0,selectors:h.selectors||bo,viewQuery:h.viewQuery||null,features:h.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:rI(h.inputs,d),outputs:rI(h.outputs),debugInfo:null}}function JI(h){h.features?.forEach(d=>d(h))}function iI(h,d){if(!h)return null;let _=d?YI:QR;return()=>(typeof h=="function"?h():h).map(v=>_(v)).filter(KR)}function eL(h){let d=0,_=[h.selectors,h.ngContentSelectors,h.hostVars,h.hostAttrs,h.consts,h.vars,h.decls,h.encapsulation,h.standalone,h.signals,h.exportAs,JSON.stringify(h.inputs),JSON.stringify(h.outputs),Object.getOwnPropertyNames(h.type.prototype),!!h.contentQueries,!!h.viewQuery].join("|");for(let I of _)d=Math.imul(31,d)+I.charCodeAt(0)<<0;return d+=2147483648,"c"+d}function Nv(h){return{\u0275providers:h}}function tL(...h){return{\u0275providers:eD(!0,h),\u0275fromNgModule:!0}}function eD(h,...d){let _=[],v=new Set,I,o=k=>{_.push(k)};return Lv(d,k=>{let V=k;Bx(V,o,[],v)&&(I||=[],I.push(V))}),I!==void 0&&tD(I,o),_}function tD(h,d){for(let _=0;_<h.length;_++){let{ngModule:v,providers:I}=h[_];zv(I,o=>{d(o,v)})}}function Bx(h,d,_,v){if(h=Ji(h),!h)return!1;let I=null,o=QE(h),k=!o&&Pc(h);if(!o&&!k){let Z=h.ngModule;if(o=QE(Z),o)I=Z;else return!1}else{if(k&&!k.standalone)return!1;I=h}let V=v.has(I);if(k){if(V)return!1;if(v.add(I),k.dependencies){let Z=typeof k.dependencies=="function"?k.dependencies():k.dependencies;for(let me of Z)Bx(me,d,_,v)}}else if(o){if(o.imports!=null&&!V){v.add(I);let me;try{Lv(o.imports,ye=>{Bx(ye,d,_,v)&&(me||=[],me.push(ye))})}finally{}me!==void 0&&tD(me,d)}if(!V){let me=Dh(I)||(()=>new I);d({provide:I,useFactory:me,deps:bo},I),d({provide:qI,useValue:I,multi:!0},I),d({provide:t_,useValue:()=>Wn(I),multi:!0},I)}let Z=o.providers;if(Z!=null&&!V){let me=h;zv(Z,ye=>{d(ye,me)})}}else return!1;return I!==h&&h.providers!==void 0}function zv(h,d){for(let _ of h)BI(_)&&(_=_.\u0275providers),Array.isArray(_)?zv(_,d):d(_)}var nL=Jn({provide:String,useValue:Jn});function nD(h){return h!==null&&typeof h=="object"&&nL in h}function rL(h){return!!(h&&h.useExisting)}function iL(h){return!!(h&&h.useFactory)}function Vx(h){return typeof h=="function"}var rD=new In(""),qg={},oL={},Ex;function Bv(){return Ex===void 0&&(Ex=new n_),Ex}var es=class{},Kf=class extends es{get destroyed(){return this._destroyed}constructor(d,_,v,I){super(),this.parent=_,this.source=v,this.scopes=I,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Ux(d,k=>this.processProvider(k)),this.records.set(HI,bh(void 0,this)),I.has("environment")&&this.records.set(es,bh(void 0,this));let o=this.records.get(rD);o!=null&&typeof o.value=="string"&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(qI,bo,En.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let d=Gn(null);try{for(let v of this._ngOnDestroyHooks)v.ngOnDestroy();let _=this._onDestroyHooks;this._onDestroyHooks=[];for(let v of _)v()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Gn(d)}}onDestroy(d){return this.assertNotDestroyed(),this._onDestroyHooks.push(d),()=>this.removeOnDestroy(d)}runInContext(d){this.assertNotDestroyed();let _=al(this),v=Ki(void 0),I;try{return d()}finally{al(_),Ki(v)}}get(d,_=Xf,v=En.Default){if(this.assertNotDestroyed(),d.hasOwnProperty(JE))return d[JE](this);v=b_(v);let I,o=al(this),k=Ki(void 0);try{if(!(v&En.SkipSelf)){let Z=this.records.get(d);if(Z===void 0){let me=hL(d)&&v_(d);me&&this.injectableDefInScope(me)?Z=bh(jx(d),qg):Z=null,this.records.set(d,Z)}if(Z!=null)return this.hydrate(d,Z)}let V=v&En.Self?Bv():this.parent;return _=v&En.Optional&&_===Xf?null:_,V.get(d,_)}catch(V){if(V.name==="NullInjectorError"){if((V[Jg]=V[Jg]||[]).unshift(oi(d)),o)throw V;return SR(V,d,"R3InjectorError",this.source)}else throw V}finally{Ki(k),al(o)}}resolveInjectorInitializers(){let d=Gn(null),_=al(this),v=Ki(void 0),I;try{let o=this.get(t_,bo,En.Self);for(let k of o)k()}finally{al(_),Ki(v),Gn(d)}}toString(){let d=[],_=this.records;for(let v of _.keys())d.push(oi(v));return`R3Injector[${d.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new kn(205,!1)}processProvider(d){d=Ji(d);let _=Vx(d)?d:Ji(d&&d.provide),v=aL(d);if(!Vx(d)&&d.multi===!0){let I=this.records.get(_);I||(I=bh(void 0,qg,!0),I.factory=()=>Nx(I.multi),this.records.set(_,I)),_=d,I.multi.push(d)}this.records.set(_,v)}hydrate(d,_){let v=Gn(null);try{return _.value===qg&&(_.value=oL,_.value=_.factory()),typeof _.value=="object"&&_.value&&uL(_.value)&&this._ngOnDestroyHooks.add(_.value),_.value}finally{Gn(v)}}injectableDefInScope(d){if(!d.providedIn)return!1;let _=Ji(d.providedIn);return typeof _=="string"?_==="any"||this.scopes.has(_):this.injectorDefTypes.has(_)}removeOnDestroy(d){let _=this._onDestroyHooks.indexOf(d);_!==-1&&this._onDestroyHooks.splice(_,1)}};function jx(h){let d=v_(h),_=d!==null?d.factory:Dh(h);if(_!==null)return _;if(h instanceof In)throw new kn(204,!1);if(h instanceof Function)return sL(h);throw new kn(204,!1)}function sL(h){if(h.length>0)throw new kn(204,!1);let _=pR(h);return _!==null?()=>_.factory(h):()=>new h}function aL(h){if(nD(h))return bh(void 0,h.useValue);{let d=lL(h);return bh(d,qg)}}function lL(h,d,_){let v;if(Vx(h)){let I=Ji(h);return Dh(I)||jx(I)}else if(nD(h))v=()=>Ji(h.useValue);else if(iL(h))v=()=>h.useFactory(...Nx(h.deps||[]));else if(rL(h))v=()=>Wn(Ji(h.useExisting));else{let I=Ji(h&&(h.useClass||h.provide));if(cL(h))v=()=>new I(...Nx(h.deps));else return Dh(I)||jx(I)}return v}function bh(h,d,_=!1){return{factory:h,value:d,multi:_?[]:void 0}}function cL(h){return!!h.deps}function uL(h){return h!==null&&typeof h=="object"&&typeof h.ngOnDestroy=="function"}function hL(h){return typeof h=="function"||typeof h=="object"&&h instanceof In}function Ux(h,d){for(let _ of h)Array.isArray(_)?Ux(_,d):_&&BI(_)?Ux(_.\u0275providers,d):d(_)}function Vv(h,d){h instanceof Kf&&h.assertNotDestroyed();let _,v=al(h),I=Ki(void 0);try{return d()}finally{al(v),Ki(I)}}function iD(){return jI()!==void 0||DR()!=null}function dL(h){if(!iD())throw new kn(-203,!1)}function fL(h){return typeof h=="function"}var $s=0,yn=1,tn=2,Kr=3,To=4,Io=5,r_=6,i_=7,Eo=8,Mh=9,js=10,Jr=11,Jf=12,oI=13,Lh=14,ts=15,Rc=16,wh=17,Us=18,T_=19,oD=20,ll=21,Ix=22,eo=23,Gs=25,sD=1;var Lc=7,o_=8,Ch=9,ki=10,s_=function(h){return h[h.None=0]="None",h[h.HasTransplantedViews=2]="HasTransplantedViews",h}(s_||{});function cl(h){return Array.isArray(h)&&typeof h[sD]=="object"}function Hs(h){return Array.isArray(h)&&h[sD]===!0}function aD(h){return(h.flags&4)!==0}function E_(h){return h.componentOffset>-1}function jv(h){return(h.flags&1)===1}function sp(h){return!!h.template}function Gx(h){return(h[tn]&512)!==0}var $x=class{constructor(d,_,v){this.previousValue=d,this.currentValue=_,this.firstChange=v}isFirstChange(){return this.firstChange}};function lD(h,d,_,v){d!==null?d.applyValueToInputSignal(d,v):h[_]=v}function cD(){return uD}function uD(h){return h.type.prototype.ngOnChanges&&(h.setInput=mL),pL}cD.ngInherit=!0;function pL(){let h=dD(this),d=h?.current;if(d){let _=h.previous;if(_===Yf)h.previous=d;else for(let v in d)_[v]=d[v];h.current=null,this.ngOnChanges(d)}}function mL(h,d,_,v,I){let o=this.declaredInputs[v],k=dD(h)||gL(h,{previous:Yf,current:null}),V=k.current||(k.current={}),Z=k.previous,me=Z[o];V[o]=new $x(me&&me.currentValue,_,Z===Yf),lD(h,d,I,_)}var hD="__ngSimpleChanges__";function dD(h){return h[hD]||null}function gL(h,d){return h[hD]=d}var sI=null;var Ko=function(h,d,_){sI?.(h,d,_)},_L="svg",yL="math";function ns(h){for(;Array.isArray(h);)h=h[$s];return h}function fD(h,d){return ns(d[h])}function Do(h,d){return ns(d[h.index])}function pD(h,d){return h.data[d]}function xL(h,d){return h[d]}function dl(h,d){let _=d[h];return cl(_)?_:_[$s]}function vL(h){return(h[tn]&4)===4}function Uv(h){return(h[tn]&128)===128}function bL(h){return Hs(h[Kr])}function a_(h,d){return d==null?null:h[d]}function mD(h){h[wh]=0}function gD(h){h[tn]&1024||(h[tn]|=1024,Uv(h)&&I_(h))}function wL(h,d){for(;h>0;)d=d[Lh],h--;return d}function ep(h){return!!(h[tn]&9216||h[eo]?.dirty)}function Hx(h){h[js].changeDetectionScheduler?.notify(7),h[tn]&64&&(h[tn]|=1024),ep(h)&&I_(h)}function I_(h){h[js].changeDetectionScheduler?.notify(0);let d=Oc(h);for(;d!==null&&!(d[tn]&8192||(d[tn]|=8192,!Uv(d)));)d=Oc(d)}function _D(h,d){if((h[tn]&256)===256)throw new kn(911,!1);h[ll]===null&&(h[ll]=[]),h[ll].push(d)}function TL(h,d){if(h[ll]===null)return;let _=h[ll].indexOf(d);_!==-1&&h[ll].splice(_,1)}function Oc(h){let d=h[Kr];return Hs(d)?d[Kr]:d}var vn={lFrame:MD(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var yD=!1;function EL(){return vn.lFrame.elementDepthCount}function IL(){vn.lFrame.elementDepthCount++}function DL(){vn.lFrame.elementDepthCount--}function xD(){return vn.bindingsEnabled}function ML(){return vn.skipHydrationRootTNode!==null}function CL(h){return vn.skipHydrationRootTNode===h}function SL(){vn.skipHydrationRootTNode=null}function ur(){return vn.lFrame.lView}function rs(){return vn.lFrame.tView}function ap(h){return vn.lFrame.contextLView=h,h[Eo]}function lp(h){return vn.lFrame.contextLView=null,h}function to(){let h=vD();for(;h!==null&&h.type===64;)h=h.parent;return h}function vD(){return vn.lFrame.currentTNode}function AL(){let h=vn.lFrame,d=h.currentTNode;return h.isParent?d:d.parent}function cp(h,d){let _=vn.lFrame;_.currentTNode=h,_.isParent=d}function bD(){return vn.lFrame.isParent}function PL(){vn.lFrame.isParent=!1}function RL(){return vn.lFrame.contextLView}function wD(){return yD}function aI(h){yD=h}function LL(h){return vn.lFrame.bindingIndex=h}function TD(){return vn.lFrame.bindingIndex++}function OL(h){let d=vn.lFrame,_=d.bindingIndex;return d.bindingIndex=d.bindingIndex+h,_}function kL(){return vn.lFrame.inI18n}function FL(h,d){let _=vn.lFrame;_.bindingIndex=_.bindingRootIndex=h,qx(d)}function NL(){return vn.lFrame.currentDirectiveIndex}function qx(h){vn.lFrame.currentDirectiveIndex=h}function zL(h){let d=vn.lFrame.currentDirectiveIndex;return d===-1?null:h[d]}function ED(){return vn.lFrame.currentQueryIndex}function Gv(h){vn.lFrame.currentQueryIndex=h}function BL(h){let d=h[yn];return d.type===2?d.declTNode:d.type===1?h[Io]:null}function ID(h,d,_){if(_&En.SkipSelf){let I=d,o=h;for(;I=I.parent,I===null&&!(_&En.Host);)if(I=BL(o),I===null||(o=o[Lh],I.type&10))break;if(I===null)return!1;d=I,h=o}let v=vn.lFrame=DD();return v.currentTNode=d,v.lView=h,!0}function $v(h){let d=DD(),_=h[yn];vn.lFrame=d,d.currentTNode=_.firstChild,d.lView=h,d.tView=_,d.contextLView=h,d.bindingIndex=_.bindingStartIndex,d.inI18n=!1}function DD(){let h=vn.lFrame,d=h===null?null:h.child;return d===null?MD(h):d}function MD(h){let d={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:h,child:null,inI18n:!1};return h!==null&&(h.child=d),d}function CD(){let h=vn.lFrame;return vn.lFrame=h.parent,h.currentTNode=null,h.lView=null,h}var SD=CD;function Hv(){let h=CD();h.isParent=!0,h.tView=null,h.selectedIndex=-1,h.contextLView=null,h.elementDepthCount=0,h.currentDirectiveIndex=-1,h.currentNamespace=null,h.bindingRootIndex=-1,h.bindingIndex=-1,h.currentQueryIndex=0}function VL(h){return(vn.lFrame.contextLView=wL(h,vn.lFrame.contextLView))[Eo]}function Oh(){return vn.lFrame.selectedIndex}function kc(h){vn.lFrame.selectedIndex=h}function jL(){let h=vn.lFrame;return pD(h.tView,h.selectedIndex)}function UL(){return vn.lFrame.currentNamespace}var AD=!0;function qv(){return AD}function Wv(h){AD=h}function GL(h,d,_){let{ngOnChanges:v,ngOnInit:I,ngDoCheck:o}=d.type.prototype;if(v){let k=uD(d);(_.preOrderHooks??=[]).push(h,k),(_.preOrderCheckHooks??=[]).push(h,k)}I&&(_.preOrderHooks??=[]).push(0-h,I),o&&((_.preOrderHooks??=[]).push(h,o),(_.preOrderCheckHooks??=[]).push(h,o))}function Zv(h,d){for(let _=d.directiveStart,v=d.directiveEnd;_<v;_++){let o=h.data[_].type.prototype,{ngAfterContentInit:k,ngAfterContentChecked:V,ngAfterViewInit:Z,ngAfterViewChecked:me,ngOnDestroy:ye}=o;k&&(h.contentHooks??=[]).push(-_,k),V&&((h.contentHooks??=[]).push(_,V),(h.contentCheckHooks??=[]).push(_,V)),Z&&(h.viewHooks??=[]).push(-_,Z),me&&((h.viewHooks??=[]).push(_,me),(h.viewCheckHooks??=[]).push(_,me)),ye!=null&&(h.destroyHooks??=[]).push(_,ye)}}function Wg(h,d,_){PD(h,d,3,_)}function Zg(h,d,_,v){(h[tn]&3)===_&&PD(h,d,_,v)}function Dx(h,d){let _=h[tn];(_&3)===d&&(_&=16383,_+=1,h[tn]=_)}function PD(h,d,_,v){let I=v!==void 0?h[wh]&65535:0,o=v??-1,k=d.length-1,V=0;for(let Z=I;Z<k;Z++)if(typeof d[Z+1]=="number"){if(V=d[Z],v!=null&&V>=v)break}else d[Z]<0&&(h[wh]+=65536),(V<o||o==-1)&&($L(h,_,d,Z),h[wh]=(h[wh]&4294901760)+Z+2),Z++}function lI(h,d){Ko(4,h,d);let _=Gn(null);try{d.call(h)}finally{Gn(_),Ko(5,h,d)}}function $L(h,d,_,v){let I=_[v]<0,o=_[v+1],k=I?-_[v]:_[v],V=h[k];I?h[tn]>>14<h[wh]>>16&&(h[tn]&3)===d&&(h[tn]+=16384,lI(V,o)):lI(V,o)}var Ih=-1,tp=class{constructor(d,_,v){this.factory=d,this.resolving=!1,this.canSeeViewProviders=_,this.injectImpl=v}};function HL(h){return h instanceof tp}function qL(h){return(h.flags&8)!==0}function WL(h){return(h.flags&16)!==0}var Mx={},Wx=class{constructor(d,_){this.injector=d,this.parentInjector=_}get(d,_,v){v=b_(v);let I=this.injector.get(d,Mx,v);return I!==Mx||_===Mx?I:this.parentInjector.get(d,_,v)}};function RD(h){return h!==Ih}function l_(h){return h&32767}function ZL(h){return h>>16}function c_(h,d){let _=ZL(h),v=d;for(;_>0;)v=v[Lh],_--;return v}var Zx=!0;function cI(h){let d=Zx;return Zx=h,d}var XL=256,LD=XL-1,OD=5,YL=0,Jo={};function QL(h,d,_){let v;typeof _=="string"?v=_.charCodeAt(0)||0:_.hasOwnProperty(Zf)&&(v=_[Zf]),v==null&&(v=_[Zf]=YL++);let I=v&LD,o=1<<I;d.data[h+(I>>OD)]|=o}function kD(h,d){let _=FD(h,d);if(_!==-1)return _;let v=d[yn];v.firstCreatePass&&(h.injectorIndex=d.length,Cx(v.data,h),Cx(d,null),Cx(v.blueprint,null));let I=Xv(h,d),o=h.injectorIndex;if(RD(I)){let k=l_(I),V=c_(I,d),Z=V[yn].data;for(let me=0;me<8;me++)d[o+me]=V[k+me]|Z[k+me]}return d[o+8]=I,o}function Cx(h,d){h.push(0,0,0,0,0,0,0,0,d)}function FD(h,d){return h.injectorIndex===-1||h.parent&&h.parent.injectorIndex===h.injectorIndex||d[h.injectorIndex+8]===null?-1:h.injectorIndex}function Xv(h,d){if(h.parent&&h.parent.injectorIndex!==-1)return h.parent.injectorIndex;let _=0,v=null,I=d;for(;I!==null;){if(v=jD(I),v===null)return Ih;if(_++,I=I[Lh],v.injectorIndex!==-1)return v.injectorIndex|_<<16}return Ih}function KL(h,d,_){QL(h,d,_)}function ND(h,d,_){if(_&En.Optional||h!==void 0)return h;Rv(d,"NodeInjector")}function zD(h,d,_,v){if(_&En.Optional&&v===void 0&&(v=null),!(_&(En.Self|En.Host))){let I=h[Mh],o=Ki(void 0);try{return I?I.get(d,v,_&En.Optional):UI(d,v,_&En.Optional)}finally{Ki(o)}}return ND(v,d,_)}function BD(h,d,_,v=En.Default,I){if(h!==null){if(d[tn]&2048&&!(v&En.Self)){let k=nO(h,d,_,v,Jo);if(k!==Jo)return k}let o=VD(h,d,_,v,Jo);if(o!==Jo)return o}return zD(d,_,v,I)}function VD(h,d,_,v,I){let o=eO(_);if(typeof o=="function"){if(!ID(d,h,v))return v&En.Host?ND(I,_,v):zD(d,_,v,I);try{let k;if(k=o(v),k==null&&!(v&En.Optional))Rv(_);else return k}finally{SD()}}else if(typeof o=="number"){let k=null,V=FD(h,d),Z=Ih,me=v&En.Host?d[ts][Io]:null;for((V===-1||v&En.SkipSelf)&&(Z=V===-1?Xv(h,d):d[V+8],Z===Ih||!hI(v,!1)?V=-1:(k=d[yn],V=l_(Z),d=c_(Z,d)));V!==-1;){let ye=d[yn];if(uI(o,V,ye.data)){let Ne=JL(V,d,_,k,v,me);if(Ne!==Jo)return Ne}Z=d[V+8],Z!==Ih&&hI(v,d[yn].data[V+8]===me)&&uI(o,V,d)?(k=ye,V=l_(Z),d=c_(Z,d)):V=-1}}return I}function JL(h,d,_,v,I,o){let k=d[yn],V=k.data[h+8],Z=v==null?E_(V)&&Zx:v!=k&&(V.type&3)!==0,me=I&En.Host&&o===V,ye=Xg(V,k,_,Z,me);return ye!==null?Sh(d,k,ye,V):Jo}function Xg(h,d,_,v,I){let o=h.providerIndexes,k=d.data,V=o&1048575,Z=h.directiveStart,me=h.directiveEnd,ye=o>>20,Ne=v?V:V+ye,ot=I?V+ye:me;for(let et=Ne;et<ot;et++){let mt=k[et];if(et<Z&&_===mt||et>=Z&&mt.type===_)return et}if(I){let et=k[Z];if(et&&sp(et)&&et.type===_)return Z}return null}function Sh(h,d,_,v){let I=h[_],o=d.data;if(HL(I)){let k=I;k.resolving&&bR(vR(o[_]));let V=cI(k.canSeeViewProviders);k.resolving=!0;let Z,me=k.injectImpl?Ki(k.injectImpl):null,ye=ID(h,v,En.Default);try{I=h[_]=k.factory(void 0,o,h,v),d.firstCreatePass&&_>=v.directiveStart&&GL(_,o[_],d)}finally{me!==null&&Ki(me),cI(V),k.resolving=!1,SD()}}return I}function eO(h){if(typeof h=="string")return h.charCodeAt(0)||0;let d=h.hasOwnProperty(Zf)?h[Zf]:void 0;return typeof d=="number"?d>=0?d&LD:tO:d}function uI(h,d,_){let v=1<<h;return!!(_[d+(h>>OD)]&v)}function hI(h,d){return!(h&En.Self)&&!(h&En.Host&&d)}var Ac=class{constructor(d,_){this._tNode=d,this._lView=_}get(d,_,v){return BD(this._tNode,this._lView,d,b_(v),_)}};function tO(){return new Ac(to(),ur())}function HV(h){return ip(()=>{let d=h.prototype.constructor,_=d[Kg]||Xx(d),v=Object.prototype,I=Object.getPrototypeOf(h.prototype).constructor;for(;I&&I!==v;){let o=I[Kg]||Xx(I);if(o&&o!==_)return o;I=Object.getPrototypeOf(I)}return o=>new o})}function Xx(h){return FI(h)?()=>{let d=Xx(Ji(h));return d&&d()}:Dh(h)}function nO(h,d,_,v,I){let o=h,k=d;for(;o!==null&&k!==null&&k[tn]&2048&&!(k[tn]&512);){let V=VD(o,k,_,v|En.Self,Jo);if(V!==Jo)return V;let Z=o.parent;if(!Z){let me=k[oD];if(me){let ye=me.get(_,Jo,v);if(ye!==Jo)return ye}Z=jD(k),k=k[Lh]}o=Z}return I}function jD(h){let d=h[yn],_=d.type;return _===2?d.declTNode:_===1?h[Io]:null}function dI(h,d=null,_=null,v){let I=UD(h,d,_,v);return I.resolveInjectorInitializers(),I}function UD(h,d=null,_=null,v,I=new Set){let o=[_||bo,tL(h)];return v=v||(typeof h=="object"?void 0:oi(h)),new Kf(o,d||Bv(),v||null,I)}var Sc=class Sc{static create(d,_){if(Array.isArray(d))return dI({name:""},_,d,"");{let v=d.name??"";return dI({name:v},d.parent,d.providers,v)}}};Sc.THROW_IF_NOT_FOUND=Xf,Sc.NULL=new n_,Sc.\u0275prov=Sn({token:Sc,providedIn:"any",factory:()=>Wn(HI)}),Sc.__NG_ELEMENT_ID__=-1;var Fc=Sc;var rO=new In("");rO.__NG_ELEMENT_ID__=h=>{let d=to();if(d===null)throw new kn(204,!1);if(d.type&2)return d.value;if(h&En.Optional)return null;throw new kn(204,!1)};var iO="ngOriginalError";function Sx(h){return h[iO]}var Nc=class{constructor(){this._console=console}handleError(d){let _=this._findOriginalError(d);this._console.error("ERROR",d),_&&this._console.error("ORIGINAL ERROR",_)}_findOriginalError(d){let _=d&&Sx(d);for(;_&&Sx(_);)_=Sx(_);return _||null}},GD=new In("",{providedIn:"root",factory:()=>Mt(Nc).handleError.bind(void 0)}),Yv=(()=>{let d=class d{};d.__NG_ELEMENT_ID__=oO,d.__NG_ENV_ID__=v=>v;let h=d;return h})(),Yx=class extends Yv{constructor(d){super(),this._lView=d}onDestroy(d){return _D(this._lView,d),()=>TL(this._lView,d)}};function oO(){return new Yx(ur())}function sO(){return kh(to(),ur())}function kh(h,d){return new Uc(Do(h,d))}var Uc=(()=>{let d=class d{constructor(v){this.nativeElement=v}};d.__NG_ELEMENT_ID__=sO;let h=d;return h})();function aO(h){return h instanceof Uc?h.nativeElement:h}var Gc=(()=>{let d=class d{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Hf(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let v=this.taskId++;return this.pendingTasks.add(v),v}remove(v){this.pendingTasks.delete(v),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};d.\u0275prov=Sn({token:d,providedIn:"root",factory:()=>new d});let h=d;return h})();var Qx=class extends ol{constructor(d=!1){super(),this.destroyRef=void 0,this.pendingTasks=void 0,this.__isAsync=d,iD()&&(this.destroyRef=Mt(Yv,{optional:!0})??void 0,this.pendingTasks=Mt(Gc,{optional:!0})??void 0)}emit(d){let _=Gn(null);try{super.next(d)}finally{Gn(_)}}subscribe(d,_,v){let I=d,o=_||(()=>null),k=v;if(d&&typeof d=="object"){let Z=d;I=Z.next?.bind(Z),o=Z.error?.bind(Z),k=Z.complete?.bind(Z)}this.__isAsync&&(o=this.wrapInTimeout(o),I&&(I=this.wrapInTimeout(I)),k&&(k=this.wrapInTimeout(k)));let V=super.subscribe({next:I,error:o,complete:k});return d instanceof Nr&&d.add(V),V}wrapInTimeout(d){return _=>{let v=this.pendingTasks?.add();setTimeout(()=>{d(_),v!==void 0&&this.pendingTasks?.remove(v)})}}},wo=Qx;function lO(){return this._results[Symbol.iterator]()}var Kx=class h{get changes(){return this._changes??=new wo}constructor(d=!1){this._emitDistinctChangesOnly=d,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let _=h.prototype;_[Symbol.iterator]||(_[Symbol.iterator]=lO)}get(d){return this._results[d]}map(d){return this._results.map(d)}filter(d){return this._results.filter(d)}find(d){return this._results.find(d)}reduce(d,_){return this._results.reduce(d,_)}forEach(d){this._results.forEach(d)}some(d){return this._results.some(d)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(d,_){this.dirty=!1;let v=OR(d);(this._changesDetected=!LR(this._results,v,_))&&(this._results=v,this.length=v.length,this.last=v[this.length-1],this.first=v[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(d){this._onDirty=d}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}};function $D(h){return(h.flags&128)===128}var HD=new Map,cO=0;function uO(){return cO++}function hO(h){HD.set(h[T_],h)}function dO(h){HD.delete(h[T_])}var fI="__ngContext__";function zc(h,d){cl(d)?(h[fI]=d[T_],hO(d)):h[fI]=d}function qD(h){return ZD(h[Jf])}function WD(h){return ZD(h[To])}function ZD(h){for(;h!==null&&!Hs(h);)h=h[To];return h}var Jx;function qV(h){Jx=h}function fO(){if(Jx!==void 0)return Jx;if(typeof document<"u")return document;throw new kn(210,!1)}var WV=new In("",{providedIn:"root",factory:()=>pO}),pO="ng",mO=new In(""),D_=new In("",{providedIn:"platform",factory:()=>"unknown"});var ZV=new In("",{providedIn:"root",factory:()=>fO().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var gO="h",_O="b";var yO=()=>null;function Qv(h,d,_=!1){return yO(h,d,_)}var XD=!1,xO=new In("",{providedIn:"root",factory:()=>XD});var ev=class{constructor(d){this.changingThisBreaksApplicationSecurity=d}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${hR})`}};function YD(h){return h instanceof ev?h.changingThisBreaksApplicationSecurity:h}function QD(h){return h instanceof Function?h():h}function vO(h){return(h??Mt(Fc)).get(D_)==="browser"}var u_=function(h){return h[h.Important=1]="Important",h[h.DashCase=2]="DashCase",h}(u_||{}),bO;function Kv(h,d){return bO(h,d)}function Th(h,d,_,v,I){if(v!=null){let o,k=!1;Hs(v)?o=v:cl(v)&&(k=!0,v=v[$s]);let V=ns(v);h===0&&_!==null?I==null?nM(d,_,V):h_(d,_,V,I||null,!0):h===1&&_!==null?h_(d,_,V,I||null,!0):h===2?NO(d,V,k):h===3&&d.destroyNode(V),o!=null&&BO(d,h,o,_,I)}}function wO(h,d){return h.createText(d)}function TO(h,d,_){h.setValue(d,_)}function KD(h,d,_){return h.createElement(d,_)}function EO(h,d){JD(h,d),d[$s]=null,d[Io]=null}function IO(h,d,_,v,I,o){v[$s]=I,v[Io]=d,M_(h,v,_,1,I,o)}function JD(h,d){d[js].changeDetectionScheduler?.notify(8),M_(h,d,d[Jr],2,null,null)}function DO(h){let d=h[Jf];if(!d)return Ax(h[yn],h);for(;d;){let _=null;if(cl(d))_=d[Jf];else{let v=d[ki];v&&(_=v)}if(!_){for(;d&&!d[To]&&d!==h;)cl(d)&&Ax(d[yn],d),d=d[Kr];d===null&&(d=h),cl(d)&&Ax(d[yn],d),_=d&&d[To]}d=_}}function MO(h,d,_,v){let I=ki+v,o=_.length;v>0&&(_[I-1][To]=d),v<o-ki?(d[To]=_[I],$I(_,ki+v,d)):(_.push(d),d[To]=null),d[Kr]=_;let k=d[Rc];k!==null&&_!==k&&eM(k,d);let V=d[Us];V!==null&&V.insertView(h),Hx(d),d[tn]|=128}function eM(h,d){let _=h[Ch],v=d[Kr];if(cl(v))h[tn]|=s_.HasTransplantedViews;else{let I=v[Kr][ts];d[ts]!==I&&(h[tn]|=s_.HasTransplantedViews)}_===null?h[Ch]=[d]:_.push(d)}function Jv(h,d){let _=h[Ch],v=_.indexOf(d);_.splice(v,1)}function tv(h,d){if(h.length<=ki)return;let _=ki+d,v=h[_];if(v){let I=v[Rc];I!==null&&I!==h&&Jv(I,v),d>0&&(h[_-1][To]=v[To]);let o=e_(h,ki+d);EO(v[yn],v);let k=o[Us];k!==null&&k.detachView(o[yn]),v[Kr]=null,v[To]=null,v[tn]&=-129}return v}function tM(h,d){if(!(d[tn]&256)){let _=d[Jr];_.destroyNode&&M_(h,d,_,3,null,null),DO(d)}}function Ax(h,d){if(d[tn]&256)return;let _=Gn(null);try{d[tn]&=-129,d[tn]|=256,d[eo]&&ox(d[eo]),SO(h,d),CO(h,d),d[yn].type===1&&d[Jr].destroy();let v=d[Rc];if(v!==null&&Hs(d[Kr])){v!==d[Kr]&&Jv(v,d);let I=d[Us];I!==null&&I.detachView(h)}dO(d)}finally{Gn(_)}}function CO(h,d){let _=h.cleanup,v=d[i_];if(_!==null)for(let o=0;o<_.length-1;o+=2)if(typeof _[o]=="string"){let k=_[o+3];k>=0?v[k]():v[-k].unsubscribe(),o+=2}else{let k=v[_[o+1]];_[o].call(k)}v!==null&&(d[i_]=null);let I=d[ll];if(I!==null){d[ll]=null;for(let o=0;o<I.length;o++){let k=I[o];k()}}}function SO(h,d){let _;if(h!=null&&(_=h.destroyHooks)!=null)for(let v=0;v<_.length;v+=2){let I=d[_[v]];if(!(I instanceof tp)){let o=_[v+1];if(Array.isArray(o))for(let k=0;k<o.length;k+=2){let V=I[o[k]],Z=o[k+1];Ko(4,V,Z);try{Z.call(V)}finally{Ko(5,V,Z)}}else{Ko(4,I,o);try{o.call(I)}finally{Ko(5,I,o)}}}}}function AO(h,d,_){return PO(h,d.parent,_)}function PO(h,d,_){let v=d;for(;v!==null&&v.type&168;)d=v,v=d.parent;if(v===null)return _[$s];{let{componentOffset:I}=v;if(I>-1){let{encapsulation:o}=h.data[v.directiveStart+I];if(o===Qf.None||o===Qf.Emulated)return null}return Do(v,_)}}function h_(h,d,_,v,I){h.insertBefore(d,_,v,I)}function nM(h,d,_){h.appendChild(d,_)}function pI(h,d,_,v,I){v!==null?h_(h,d,_,v,I):nM(h,d,_)}function RO(h,d,_,v){h.removeChild(d,_,v)}function e1(h,d){return h.parentNode(d)}function LO(h,d){return h.nextSibling(d)}function OO(h,d,_){return FO(h,d,_)}function kO(h,d,_){return h.type&40?Do(h,_):null}var FO=kO,mI;function t1(h,d,_,v){let I=AO(h,v,d),o=d[Jr],k=v.parent||d[Io],V=OO(k,v,d);if(I!=null)if(Array.isArray(_))for(let Z=0;Z<_.length;Z++)pI(o,I,_[Z],V,!1);else pI(o,I,_,V,!1);mI!==void 0&&mI(o,v,d,_,I)}function Yg(h,d){if(d!==null){let _=d.type;if(_&3)return Do(d,h);if(_&4)return nv(-1,h[d.index]);if(_&8){let v=d.child;if(v!==null)return Yg(h,v);{let I=h[d.index];return Hs(I)?nv(-1,I):ns(I)}}else{if(_&32)return Kv(d,h)()||ns(h[d.index]);{let v=rM(h,d);if(v!==null){if(Array.isArray(v))return v[0];let I=Oc(h[ts]);return Yg(I,v)}else return Yg(h,d.next)}}}return null}function rM(h,d){if(d!==null){let v=h[ts][Io],I=d.projection;return v.projection[I]}return null}function nv(h,d){let _=ki+h+1;if(_<d.length){let v=d[_],I=v[yn].firstChild;if(I!==null)return Yg(v,I)}return d[Lc]}function NO(h,d,_){let v=e1(h,d);v&&RO(h,v,d,_)}function n1(h,d,_,v,I,o,k){for(;_!=null;){if(_.type===128){_=_.next;continue}let V=v[_.index],Z=_.type;if(k&&d===0&&(V&&zc(ns(V),v),_.flags|=2),(_.flags&32)!==32)if(Z&8)n1(h,d,_.child,v,I,o,!1),Th(d,h,I,V,o);else if(Z&32){let me=Kv(_,v),ye;for(;ye=me();)Th(d,h,I,ye,o);Th(d,h,I,V,o)}else Z&16?zO(h,d,v,_,I,o):Th(d,h,I,V,o);_=k?_.projectionNext:_.next}}function M_(h,d,_,v,I,o){n1(_,v,h.firstChild,d,I,o,!1)}function zO(h,d,_,v,I,o){let k=_[ts],Z=k[Io].projection[v.projection];if(Array.isArray(Z))for(let me=0;me<Z.length;me++){let ye=Z[me];Th(d,h,I,ye,o)}else{let me=Z,ye=k[Kr];$D(v)&&(me.flags|=128),n1(h,d,me,ye,I,o,!0)}}function BO(h,d,_,v,I){let o=_[Lc],k=ns(_);o!==k&&Th(d,h,v,o,I);for(let V=ki;V<_.length;V++){let Z=_[V];M_(Z[yn],Z,h,d,v,o)}}function VO(h,d,_,v,I){if(d)I?h.addClass(_,v):h.removeClass(_,v);else{let o=v.indexOf("-")===-1?void 0:u_.DashCase;I==null?h.removeStyle(_,v,o):(typeof I=="string"&&I.endsWith("!important")&&(I=I.slice(0,-10),o|=u_.Important),h.setStyle(_,v,I,o))}}function jO(h,d,_){h.setAttribute(d,"style",_)}function iM(h,d,_){_===""?h.removeAttribute(d,"class"):h.setAttribute(d,"class",_)}function oM(h,d,_){let{mergedAttrs:v,classes:I,styles:o}=_;v!==null&&zx(h,d,v),I!==null&&iM(h,d,I),o!==null&&jO(h,d,o)}var Fh={};function Nh(h=1){sM(rs(),ur(),Oh()+h,!1)}function sM(h,d,_,v){if(!v)if((d[tn]&3)===3){let o=h.preOrderCheckHooks;o!==null&&Wg(d,o,_)}else{let o=h.preOrderHooks;o!==null&&Zg(d,o,0,_)}kc(_)}function qs(h,d=En.Default){let _=ur();if(_===null)return Wn(h,d);let v=to();return BD(v,_,Ji(h),d)}function aM(h,d,_,v,I,o){let k=Gn(null);try{let V=null;I&ul.SignalBased&&(V=d[v][dE]),V!==null&&V.transformFn!==void 0&&(o=V.transformFn(o)),I&ul.HasDecoratorInputTransform&&(o=h.inputTransforms[v].call(d,o)),h.setInput!==null?h.setInput(d,V,o,_,v):lD(d,V,v,o)}finally{Gn(k)}}function UO(h,d){let _=h.hostBindingOpCodes;if(_!==null)try{for(let v=0;v<_.length;v++){let I=_[v];if(I<0)kc(~I);else{let o=I,k=_[++v],V=_[++v];FL(k,o);let Z=d[o];V(2,Z)}}}finally{kc(-1)}}function C_(h,d,_,v,I,o,k,V,Z,me,ye){let Ne=d.blueprint.slice();return Ne[$s]=I,Ne[tn]=v|4|128|8|64,(me!==null||h&&h[tn]&2048)&&(Ne[tn]|=2048),mD(Ne),Ne[Kr]=Ne[Lh]=h,Ne[Eo]=_,Ne[js]=k||h&&h[js],Ne[Jr]=V||h&&h[Jr],Ne[Mh]=Z||h&&h[Mh]||null,Ne[Io]=o,Ne[T_]=uO(),Ne[r_]=ye,Ne[oD]=me,Ne[ts]=d.type==2?h[ts]:Ne,Ne}function S_(h,d,_,v,I){let o=h.data[d];if(o===null)o=GO(h,d,_,v,I),kL()&&(o.flags|=32);else if(o.type&64){o.type=_,o.value=v,o.attrs=I;let k=AL();o.injectorIndex=k===null?-1:k.injectorIndex}return cp(o,!0),o}function GO(h,d,_,v,I){let o=vD(),k=bD(),V=k?o:o&&o.parent,Z=h.data[d]=XO(h,V,_,d,v,I);return h.firstChild===null&&(h.firstChild=Z),o!==null&&(k?o.child==null&&Z.parent!==null&&(o.child=Z):o.next===null&&(o.next=Z,Z.prev=o)),Z}function lM(h,d,_,v){if(_===0)return-1;let I=d.length;for(let o=0;o<_;o++)d.push(v),h.blueprint.push(v),h.data.push(null);return I}function cM(h,d,_,v,I){let o=Oh(),k=v&2;try{kc(-1),k&&d.length>Gs&&sM(h,d,Gs,!1),Ko(k?2:0,I),_(v,I)}finally{kc(o),Ko(k?3:1,I)}}function uM(h,d,_){if(aD(d)){let v=Gn(null);try{let I=d.directiveStart,o=d.directiveEnd;for(let k=I;k<o;k++){let V=h.data[k];if(V.contentQueries){let Z=_[k];V.contentQueries(1,Z,k)}}}finally{Gn(v)}}}function hM(h,d,_){xD()&&(nk(h,d,_,Do(_,d)),(_.flags&64)===64&&gM(h,d,_))}function dM(h,d,_=Do){let v=d.localNames;if(v!==null){let I=d.index+1;for(let o=0;o<v.length;o+=2){let k=v[o+1],V=k===-1?_(d,h):h[k];h[I++]=V}}}function fM(h){let d=h.tView;return d===null||d.incompleteFirstPass?h.tView=r1(1,null,h.template,h.decls,h.vars,h.directiveDefs,h.pipeDefs,h.viewQuery,h.schemas,h.consts,h.id):d}function r1(h,d,_,v,I,o,k,V,Z,me,ye){let Ne=Gs+v,ot=Ne+I,et=$O(Ne,ot),mt=typeof me=="function"?me():me;return et[yn]={type:h,blueprint:et,template:_,queries:null,viewQuery:V,declTNode:d,data:et.slice().fill(null,Ne),bindingStartIndex:Ne,expandoStartIndex:ot,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof o=="function"?o():o,pipeRegistry:typeof k=="function"?k():k,firstChild:null,schemas:Z,consts:mt,incompleteFirstPass:!1,ssrId:ye}}function $O(h,d){let _=[];for(let v=0;v<d;v++)_.push(v<h?null:Fh);return _}function HO(h,d,_,v){let o=v.get(xO,XD)||_===Qf.ShadowDom,k=h.selectRootElement(d,o);return qO(k),k}function qO(h){WO(h)}var WO=()=>null;function ZO(h,d,_,v){let I=xM(d);I.push(_),h.firstCreatePass&&vM(h).push(v,I.length-1)}function XO(h,d,_,v,I,o){let k=d?d.injectorIndex:-1,V=0;return ML()&&(V|=128),{type:_,index:v,insertBeforeIndex:null,injectorIndex:k,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:V,providerIndexes:0,value:I,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:d,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function gI(h,d,_,v,I){for(let o in d){if(!d.hasOwnProperty(o))continue;let k=d[o];if(k===void 0)continue;v??={};let V,Z=ul.None;Array.isArray(k)?(V=k[0],Z=k[1]):V=k;let me=o;if(I!==null){if(!I.hasOwnProperty(o))continue;me=I[o]}h===0?_I(v,_,me,V,Z):_I(v,_,me,V)}return v}function _I(h,d,_,v,I){let o;h.hasOwnProperty(_)?(o=h[_]).push(d,v):o=h[_]=[d,v],I!==void 0&&o.push(I)}function YO(h,d,_){let v=d.directiveStart,I=d.directiveEnd,o=h.data,k=d.attrs,V=[],Z=null,me=null;for(let ye=v;ye<I;ye++){let Ne=o[ye],ot=_?_.get(Ne):null,et=ot?ot.inputs:null,mt=ot?ot.outputs:null;Z=gI(0,Ne.inputs,ye,Z,et),me=gI(1,Ne.outputs,ye,me,mt);let Zt=Z!==null&&k!==null&&!kv(d)?hk(Z,ye,k):null;V.push(Zt)}Z!==null&&(Z.hasOwnProperty("class")&&(d.flags|=8),Z.hasOwnProperty("style")&&(d.flags|=16)),d.initialInputs=V,d.inputs=Z,d.outputs=me}function QO(h){return h==="class"?"className":h==="for"?"htmlFor":h==="formaction"?"formAction":h==="innerHtml"?"innerHTML":h==="readonly"?"readOnly":h==="tabindex"?"tabIndex":h}function KO(h,d,_,v,I,o,k,V){let Z=Do(d,_),me=d.inputs,ye;!V&&me!=null&&(ye=me[v])?(i1(h,_,ye,v,I),E_(d)&&JO(_,d.index)):d.type&3?(v=QO(v),I=k!=null?k(I,d.value||"",v):I,o.setProperty(Z,v,I)):d.type&12}function JO(h,d){let _=dl(d,h);_[tn]&16||(_[tn]|=64)}function pM(h,d,_,v){if(xD()){let I=v===null?null:{"":-1},o=ik(h,_),k,V;o===null?k=V=null:[k,V]=o,k!==null&&mM(h,d,_,k,I,V),I&&ok(_,v,I)}_.mergedAttrs=Ov(_.mergedAttrs,_.attrs)}function mM(h,d,_,v,I,o){for(let me=0;me<v.length;me++)KL(kD(_,d),h,v[me].type);ak(_,h.data.length,v.length);for(let me=0;me<v.length;me++){let ye=v[me];ye.providersResolver&&ye.providersResolver(ye)}let k=!1,V=!1,Z=lM(h,d,v.length,null);for(let me=0;me<v.length;me++){let ye=v[me];_.mergedAttrs=Ov(_.mergedAttrs,ye.hostAttrs),lk(h,_,d,Z,ye),sk(Z,ye,I),ye.contentQueries!==null&&(_.flags|=4),(ye.hostBindings!==null||ye.hostAttrs!==null||ye.hostVars!==0)&&(_.flags|=64);let Ne=ye.type.prototype;!k&&(Ne.ngOnChanges||Ne.ngOnInit||Ne.ngDoCheck)&&((h.preOrderHooks??=[]).push(_.index),k=!0),!V&&(Ne.ngOnChanges||Ne.ngDoCheck)&&((h.preOrderCheckHooks??=[]).push(_.index),V=!0),Z++}YO(h,_,o)}function ek(h,d,_,v,I){let o=I.hostBindings;if(o){let k=h.hostBindingOpCodes;k===null&&(k=h.hostBindingOpCodes=[]);let V=~d.index;tk(k)!=V&&k.push(V),k.push(_,v,o)}}function tk(h){let d=h.length;for(;d>0;){let _=h[--d];if(typeof _=="number"&&_<0)return _}return 0}function nk(h,d,_,v){let I=_.directiveStart,o=_.directiveEnd;E_(_)&&ck(d,_,h.data[I+_.componentOffset]),h.firstCreatePass||kD(_,d),zc(v,d);let k=_.initialInputs;for(let V=I;V<o;V++){let Z=h.data[V],me=Sh(d,h,V,_);if(zc(me,d),k!==null&&uk(d,V-I,me,Z,_,k),sp(Z)){let ye=dl(_.index,d);ye[Eo]=Sh(d,h,V,_)}}}function gM(h,d,_){let v=_.directiveStart,I=_.directiveEnd,o=_.index,k=NL();try{kc(o);for(let V=v;V<I;V++){let Z=h.data[V],me=d[V];qx(V),(Z.hostBindings!==null||Z.hostVars!==0||Z.hostAttrs!==null)&&rk(Z,me)}}finally{kc(-1),qx(k)}}function rk(h,d){h.hostBindings!==null&&h.hostBindings(1,d)}function ik(h,d){let _=h.directiveRegistry,v=null,I=null;if(_)for(let o=0;o<_.length;o++){let k=_[o];if(HR(d,k.selectors,!1))if(v||(v=[]),sp(k))if(k.findHostDirectiveDefs!==null){let V=[];I=I||new Map,k.findHostDirectiveDefs(k,V,I),v.unshift(...V,k);let Z=V.length;rv(h,d,Z)}else v.unshift(k),rv(h,d,0);else I=I||new Map,k.findHostDirectiveDefs?.(k,v,I),v.push(k)}return v===null?null:[v,I]}function rv(h,d,_){d.componentOffset=_,(h.components??=[]).push(d.index)}function ok(h,d,_){if(d){let v=h.localNames=[];for(let I=0;I<d.length;I+=2){let o=_[d[I+1]];if(o==null)throw new kn(-301,!1);v.push(d[I],o)}}}function sk(h,d,_){if(_){if(d.exportAs)for(let v=0;v<d.exportAs.length;v++)_[d.exportAs[v]]=h;sp(d)&&(_[""]=h)}}function ak(h,d,_){h.flags|=1,h.directiveStart=d,h.directiveEnd=d+_,h.providerIndexes=d}function lk(h,d,_,v,I){h.data[v]=I;let o=I.factory||(I.factory=Dh(I.type,!0)),k=new tp(o,sp(I),qs);h.blueprint[v]=k,_[v]=k,ek(h,d,v,lM(h,_,I.hostVars,Fh),I)}function ck(h,d,_){let v=Do(d,h),I=fM(_),o=h[js].rendererFactory,k=16;_.signals?k=4096:_.onPush&&(k=64);let V=A_(h,C_(h,I,null,k,v,d,null,o.createRenderer(v,_),null,null,null));h[d.index]=V}function uk(h,d,_,v,I,o){let k=o[d];if(k!==null)for(let V=0;V<k.length;){let Z=k[V++],me=k[V++],ye=k[V++],Ne=k[V++];aM(v,_,Z,me,ye,Ne)}}function hk(h,d,_){let v=null,I=0;for(;I<_.length;){let o=_[I];if(o===0){I+=4;continue}else if(o===5){I+=2;continue}if(typeof o=="number")break;if(h.hasOwnProperty(o)){v===null&&(v=[]);let k=h[o];for(let V=0;V<k.length;V+=3)if(k[V]===d){v.push(o,k[V+1],k[V+2],_[I+1]);break}}I+=2}return v}function _M(h,d,_,v){return[h,!0,0,d,null,v,null,_,null,null]}function yM(h,d){let _=h.contentQueries;if(_!==null){let v=Gn(null);try{for(let I=0;I<_.length;I+=2){let o=_[I],k=_[I+1];if(k!==-1){let V=h.data[k];Gv(o),V.contentQueries(2,d[k],k)}}}finally{Gn(v)}}}function A_(h,d){return h[Jf]?h[oI][To]=d:h[Jf]=d,h[oI]=d,d}function iv(h,d,_){Gv(0);let v=Gn(null);try{d(h,_)}finally{Gn(v)}}function xM(h){return h[i_]??=[]}function vM(h){return h.cleanup??=[]}function bM(h,d){let _=h[Mh],v=_?_.get(Nc,null):null;v&&v.handleError(d)}function i1(h,d,_,v,I){for(let o=0;o<_.length;){let k=_[o++],V=_[o++],Z=_[o++],me=d[k],ye=h.data[k];aM(ye,me,v,V,Z,I)}}function dk(h,d,_){let v=fD(d,h);TO(h[Jr],v,_)}function fk(h,d){let _=dl(d,h),v=_[yn];pk(v,_);let I=_[$s];I!==null&&_[r_]===null&&(_[r_]=Qv(I,_[Mh])),o1(v,_,_[Eo])}function pk(h,d){for(let _=d.length;_<h.blueprint.length;_++)d.push(h.blueprint[_])}function o1(h,d,_){$v(d);try{let v=h.viewQuery;v!==null&&iv(1,v,_);let I=h.template;I!==null&&cM(h,d,I,1,_),h.firstCreatePass&&(h.firstCreatePass=!1),d[Us]?.finishViewCreation(h),h.staticContentQueries&&yM(h,d),h.staticViewQueries&&iv(2,h.viewQuery,_);let o=h.components;o!==null&&mk(d,o)}catch(v){throw h.firstCreatePass&&(h.incompleteFirstPass=!0,h.firstCreatePass=!1),v}finally{d[tn]&=-5,Hv()}}function mk(h,d){for(let _=0;_<d.length;_++)fk(h,d[_])}function gk(h,d,_,v){let I=Gn(null);try{let o=d.tView,V=h[tn]&4096?4096:16,Z=C_(h,o,_,V,null,d,null,null,v?.injector??null,v?.embeddedViewInjector??null,v?.dehydratedView??null),me=h[d.index];Z[Rc]=me;let ye=h[Us];return ye!==null&&(Z[Us]=ye.createEmbeddedView(o)),o1(o,Z,_),Z}finally{Gn(I)}}function yI(h,d){return!d||d.firstChild===null||$D(h)}function _k(h,d,_,v=!0){let I=d[yn];if(MO(I,d,h,_),v){let k=nv(_,h),V=d[Jr],Z=e1(V,h[Lc]);Z!==null&&IO(I,h[Io],V,d,Z,k)}let o=d[r_];o!==null&&o.firstChild!==null&&(o.firstChild=null)}function d_(h,d,_,v,I=!1){for(;_!==null;){if(_.type===128){_=I?_.projectionNext:_.next;continue}let o=d[_.index];o!==null&&v.push(ns(o)),Hs(o)&&yk(o,v);let k=_.type;if(k&8)d_(h,d,_.child,v);else if(k&32){let V=Kv(_,d),Z;for(;Z=V();)v.push(Z)}else if(k&16){let V=rM(d,_);if(Array.isArray(V))v.push(...V);else{let Z=Oc(d[ts]);d_(Z[yn],Z,V,v,!0)}}_=I?_.projectionNext:_.next}return v}function yk(h,d){for(let _=ki;_<h.length;_++){let v=h[_],I=v[yn].firstChild;I!==null&&d_(v[yn],v,I,d)}h[Lc]!==h[$s]&&d.push(h[Lc])}var wM=[];function xk(h){return h[eo]??vk(h)}function vk(h){let d=wM.pop()??Object.create(wk);return d.lView=h,d}function bk(h){h.lView[eo]!==h&&(h.lView=null,wM.push(h))}var wk=il(Br({},nx),{consumerIsAlwaysLive:!0,consumerMarkedDirty:h=>{I_(h.lView)},consumerOnSignalRead(){this.lView[eo]=this}});function Tk(h){let d=h[eo]??Object.create(Ek);return d.lView=h,d}var Ek=il(Br({},nx),{consumerIsAlwaysLive:!0,consumerMarkedDirty:h=>{let d=Oc(h.lView);for(;d&&!TM(d[yn]);)d=Oc(d);d&&gD(d)},consumerOnSignalRead(){this.lView[eo]=this}});function TM(h){return h.type!==2}var Ik=100;function EM(h,d=!0,_=0){let v=h[js],I=v.rendererFactory,o=!1;o||I.begin?.();try{Dk(h,_)}catch(k){throw d&&bM(h,k),k}finally{o||(I.end?.(),v.inlineEffectRunner?.flush())}}function Dk(h,d){let _=wD();try{aI(!0),ov(h,d);let v=0;for(;ep(h);){if(v===Ik)throw new kn(103,!1);v++,ov(h,1)}}finally{aI(_)}}function Mk(h,d,_,v){let I=d[tn];if((I&256)===256)return;let o=!1,k=!1;!o&&d[js].inlineEffectRunner?.flush(),$v(d);let V=!0,Z=null,me=null;o||(TM(h)?(me=xk(d),Z=rx(me)):fE()===null?(V=!1,me=Tk(d),Z=rx(me)):d[eo]&&(ox(d[eo]),d[eo]=null));try{mD(d),LL(h.bindingStartIndex),_!==null&&cM(h,d,_,2,v);let ye=(I&3)===3;if(!o)if(ye){let et=h.preOrderCheckHooks;et!==null&&Wg(d,et,null)}else{let et=h.preOrderHooks;et!==null&&Zg(d,et,0,null),Dx(d,0)}if(k||Ck(d),IM(d,0),h.contentQueries!==null&&yM(h,d),!o)if(ye){let et=h.contentCheckHooks;et!==null&&Wg(d,et)}else{let et=h.contentHooks;et!==null&&Zg(d,et,1),Dx(d,1)}UO(h,d);let Ne=h.components;Ne!==null&&MM(d,Ne,0);let ot=h.viewQuery;if(ot!==null&&iv(2,ot,v),!o)if(ye){let et=h.viewCheckHooks;et!==null&&Wg(d,et)}else{let et=h.viewHooks;et!==null&&Zg(d,et,2),Dx(d,2)}if(h.firstUpdatePass===!0&&(h.firstUpdatePass=!1),d[Ix]){for(let et of d[Ix])et();d[Ix]=null}o||(d[tn]&=-73)}catch(ye){throw o||I_(d),ye}finally{me!==null&&(pE(me,Z),V&&bk(me)),Hv()}}function IM(h,d){for(let _=qD(h);_!==null;_=WD(_))for(let v=ki;v<_.length;v++){let I=_[v];DM(I,d)}}function Ck(h){for(let d=qD(h);d!==null;d=WD(d)){if(!(d[tn]&s_.HasTransplantedViews))continue;let _=d[Ch];for(let v=0;v<_.length;v++){let I=_[v];gD(I)}}}function Sk(h,d,_){let v=dl(d,h);DM(v,_)}function DM(h,d){Uv(h)&&ov(h,d)}function ov(h,d){let v=h[yn],I=h[tn],o=h[eo],k=!!(d===0&&I&16);if(k||=!!(I&64&&d===0),k||=!!(I&1024),k||=!!(o?.dirty&&ix(o)),k||=!1,o&&(o.dirty=!1),h[tn]&=-9217,k)Mk(v,h,v.template,h[Eo]);else if(I&8192){IM(h,1);let V=v.components;V!==null&&MM(h,V,1)}}function MM(h,d,_){for(let v=0;v<d.length;v++)Sk(h,d[v],_)}function s1(h,d){let _=wD()?64:1088;for(h[js].changeDetectionScheduler?.notify(d);h;){h[tn]|=_;let v=Oc(h);if(Gx(h)&&!v)return h;h=v}return null}var Bc=class{get rootNodes(){let d=this._lView,_=d[yn];return d_(_,d,_.firstChild,[])}constructor(d,_,v=!0){this._lView=d,this._cdRefInjectingView=_,this.notifyErrorHandler=v,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Eo]}set context(d){this._lView[Eo]=d}get destroyed(){return(this._lView[tn]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let d=this._lView[Kr];if(Hs(d)){let _=d[o_],v=_?_.indexOf(this):-1;v>-1&&(tv(d,v),e_(_,v))}this._attachedToViewContainer=!1}tM(this._lView[yn],this._lView)}onDestroy(d){_D(this._lView,d)}markForCheck(){s1(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[tn]&=-129}reattach(){Hx(this._lView),this._lView[tn]|=128}detectChanges(){this._lView[tn]|=1024,EM(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new kn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let d=Gx(this._lView),_=this._lView[Rc];_!==null&&!d&&Jv(_,this._lView),JD(this._lView[yn],this._lView)}attachToAppRef(d){if(this._attachedToViewContainer)throw new kn(902,!1);this._appRef=d;let _=Gx(this._lView),v=this._lView[Rc];v!==null&&!_&&eM(v,this._lView),Hx(this._lView)}},Vc=(()=>{let d=class d{};d.__NG_ELEMENT_ID__=Rk;let h=d;return h})(),Ak=Vc,Pk=class extends Ak{constructor(d,_,v){super(),this._declarationLView=d,this._declarationTContainer=_,this.elementRef=v}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(d,_){return this.createEmbeddedViewImpl(d,_)}createEmbeddedViewImpl(d,_,v){let I=gk(this._declarationLView,this._declarationTContainer,d,{embeddedViewInjector:_,dehydratedView:v});return new Bc(I)}};function Rk(){return P_(to(),ur())}function P_(h,d){return h.type&4?new Pk(d,h,kh(h,d)):null}var YV=new RegExp(`^(\\d+)*(${_O}|${gO})*(.*)`);var Lk=()=>null;function xI(h,d){return Lk(h,d)}var Ah=class{},a1=new In("",{providedIn:"root",factory:()=>!1});var CM=new In(""),sv=class{},f_=class{};function Ok(h){let d=Error(`No component factory found for ${oi(h)}.`);return d[kk]=h,d}var kk="ngComponent";var av=class{resolveComponentFactory(d){throw Ok(d)}},_1=class _1{};_1.NULL=new av;var Ph=_1,p_=class{},l1=(()=>{let d=class d{constructor(){this.destroyNode=null}};d.__NG_ELEMENT_ID__=()=>Fk();let h=d;return h})();function Fk(){let h=ur(),d=to(),_=dl(d.index,h);return(cl(_)?_:h)[Jr]}var Nk=(()=>{let d=class d{};d.\u0275prov=Sn({token:d,providedIn:"root",factory:()=>null});let h=d;return h})();var vI=new Set;function up(h){vI.has(h)||(vI.add(h),performance?.mark?.("mark_feature_usage",{detail:{feature:h}}))}function SM(h){let d=!0;return setTimeout(()=>{d&&(d=!1,h())}),typeof ZE.requestAnimationFrame=="function"&&ZE.requestAnimationFrame(()=>{d&&(d=!1,h())}),()=>{d=!1}}function bI(h){let d=!0;return queueMicrotask(()=>{d&&h()}),()=>{d=!1}}function wI(...h){}var Vr=class h{constructor({enableLongStackTrace:d=!1,shouldCoalesceEventChangeDetection:_=!1,shouldCoalesceRunChangeDetection:v=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new wo(!1),this.onMicrotaskEmpty=new wo(!1),this.onStable=new wo(!1),this.onError=new wo(!1),typeof Zone>"u")throw new kn(908,!1);Zone.assertZonePatched();let I=this;I._nesting=0,I._outer=I._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(I._inner=I._inner.fork(new Zone.TaskTrackingZoneSpec)),d&&Zone.longStackTraceZoneSpec&&(I._inner=I._inner.fork(Zone.longStackTraceZoneSpec)),I.shouldCoalesceEventChangeDetection=!v&&_,I.shouldCoalesceRunChangeDetection=v,I.callbackScheduled=!1,Vk(I)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!h.isInAngularZone())throw new kn(909,!1)}static assertNotInAngularZone(){if(h.isInAngularZone())throw new kn(909,!1)}run(d,_,v){return this._inner.run(d,_,v)}runTask(d,_,v,I){let o=this._inner,k=o.scheduleEventTask("NgZoneEvent: "+I,d,zk,wI,wI);try{return o.runTask(k,_,v)}finally{o.cancelTask(k)}}runGuarded(d,_,v){return this._inner.runGuarded(d,_,v)}runOutsideAngular(d){return this._outer.run(d)}},zk={};function c1(h){if(h._nesting==0&&!h.hasPendingMicrotasks&&!h.isStable)try{h._nesting++,h.onMicrotaskEmpty.emit(null)}finally{if(h._nesting--,!h.hasPendingMicrotasks)try{h.runOutsideAngular(()=>h.onStable.emit(null))}finally{h.isStable=!0}}}function Bk(h){h.isCheckStableRunning||h.callbackScheduled||(h.callbackScheduled=!0,Zone.root.run(()=>{SM(()=>{h.callbackScheduled=!1,lv(h),h.isCheckStableRunning=!0,c1(h),h.isCheckStableRunning=!1})}),lv(h))}function Vk(h){let d=()=>{Bk(h)};h._inner=h._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(_,v,I,o,k,V)=>{if(jk(V))return _.invokeTask(I,o,k,V);try{return TI(h),_.invokeTask(I,o,k,V)}finally{(h.shouldCoalesceEventChangeDetection&&o.type==="eventTask"||h.shouldCoalesceRunChangeDetection)&&d(),EI(h)}},onInvoke:(_,v,I,o,k,V,Z)=>{try{return TI(h),_.invoke(I,o,k,V,Z)}finally{h.shouldCoalesceRunChangeDetection&&!h.callbackScheduled&&!Uk(V)&&d(),EI(h)}},onHasTask:(_,v,I,o)=>{_.hasTask(I,o),v===I&&(o.change=="microTask"?(h._hasPendingMicrotasks=o.microTask,lv(h),c1(h)):o.change=="macroTask"&&(h.hasPendingMacrotasks=o.macroTask))},onHandleError:(_,v,I,o)=>(_.handleError(I,o),h.runOutsideAngular(()=>h.onError.emit(o)),!1)})}function lv(h){h._hasPendingMicrotasks||(h.shouldCoalesceEventChangeDetection||h.shouldCoalesceRunChangeDetection)&&h.callbackScheduled===!0?h.hasPendingMicrotasks=!0:h.hasPendingMicrotasks=!1}function TI(h){h._nesting++,h.isStable&&(h.isStable=!1,h.onUnstable.emit(null))}function EI(h){h._nesting--,c1(h)}var cv=class{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new wo,this.onMicrotaskEmpty=new wo,this.onStable=new wo,this.onError=new wo}run(d,_,v){return d.apply(_,v)}runGuarded(d,_,v){return d.apply(_,v)}runOutsideAngular(d){return d()}runTask(d,_,v,I){return d.apply(_,v)}};function jk(h){return AM(h,"__ignore_ng_zone__")}function Uk(h){return AM(h,"__scheduler_tick__")}function AM(h,d){return!Array.isArray(h)||h.length!==1?!1:h[0]?.data?.[d]===!0}var yi=function(h){return h[h.EarlyRead=0]="EarlyRead",h[h.Write=1]="Write",h[h.MixedReadWrite=2]="MixedReadWrite",h[h.Read=3]="Read",h}(yi||{}),Gk={destroy(){}};function $k(h,d){!d&&dL($k);let _=d?.injector??Mt(Fc);return vO(_)?(up("NgAfterNextRender"),qk(h,_,!0,d?.phase??yi.MixedReadWrite)):Gk}function Hk(h,d){if(h instanceof Function)switch(d){case yi.EarlyRead:return{earlyRead:h};case yi.Write:return{write:h};case yi.MixedReadWrite:return{mixedReadWrite:h};case yi.Read:return{read:h}}return h}function qk(h,d,_,v){let I=Hk(h,v),o=d.get(u1),k=o.handler??=new hv,V=[],Z=[],me=()=>{for(let et of Z)k.unregister(et);ye()},ye=d.get(Yv).onDestroy(me),Ne=0,ot=(et,mt)=>{if(!mt)return;let Zt=_?(...Rt)=>{Ne--,Ne<1&&me(),mt(...Rt)}:mt,jt=Vv(d,()=>new uv(et,V,Zt));k.register(jt),Z.push(jt),Ne++};return ot(yi.EarlyRead,I.earlyRead),ot(yi.Write,I.write),ot(yi.MixedReadWrite,I.mixedReadWrite),ot(yi.Read,I.read),{destroy:me}}var uv=class{constructor(d,_,v){this.phase=d,this.pipelinedArgs=_,this.callbackFn=v,this.zone=Mt(Vr),this.errorHandler=Mt(Nc,{optional:!0}),Mt(Ah,{optional:!0})?.notify(6)}invoke(){try{let d=this.zone.runOutsideAngular(()=>this.callbackFn.apply(null,this.pipelinedArgs));this.pipelinedArgs.splice(0,this.pipelinedArgs.length,d)}catch(d){this.errorHandler?.handleError(d)}}},hv=class{constructor(){this.executingCallbacks=!1,this.buckets={[yi.EarlyRead]:new Set,[yi.Write]:new Set,[yi.MixedReadWrite]:new Set,[yi.Read]:new Set},this.deferredCallbacks=new Set}register(d){(this.executingCallbacks?this.deferredCallbacks:this.buckets[d.phase]).add(d)}unregister(d){this.buckets[d.phase].delete(d),this.deferredCallbacks.delete(d)}execute(){this.executingCallbacks=!0;for(let d of Object.values(this.buckets))for(let _ of d)_.invoke();this.executingCallbacks=!1;for(let d of this.deferredCallbacks)this.buckets[d.phase].add(d);this.deferredCallbacks.clear()}destroy(){for(let d of Object.values(this.buckets))d.clear();this.deferredCallbacks.clear()}},u1=(()=>{let d=class d{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let v=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let I of v)I()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};d.\u0275prov=Sn({token:d,providedIn:"root",factory:()=>new d});let h=d;return h})();function dv(h,d,_){let v=_?h.styles:null,I=_?h.classes:null,o=0;if(d!==null)for(let k=0;k<d.length;k++){let V=d[k];if(typeof V=="number")o=V;else if(o==1)I=XE(I,V);else if(o==2){let Z=V,me=d[++k];v=XE(v,Z+": "+me+";")}}_?h.styles=v:h.stylesWithoutHost=v,_?h.classes=I:h.classesWithoutHost=I}var m_=class extends Ph{constructor(d){super(),this.ngModule=d}resolveComponentFactory(d){let _=Pc(d);return new np(_,this.ngModule)}};function II(h,d){let _=[];for(let v in h){if(!h.hasOwnProperty(v))continue;let I=h[v];if(I===void 0)continue;let o=Array.isArray(I),k=o?I[0]:I,V=o?I[1]:ul.None;d?_.push({propName:k,templateName:v,isSignal:(V&ul.SignalBased)!==0}):_.push({propName:k,templateName:v})}return _}function Wk(h){let d=h.toLowerCase();return d==="svg"?_L:d==="math"?yL:null}var np=class extends f_{get inputs(){let d=this.componentDef,_=d.inputTransforms,v=II(d.inputs,!0);if(_!==null)for(let I of v)_.hasOwnProperty(I.propName)&&(I.transform=_[I.propName]);return v}get outputs(){return II(this.componentDef.outputs,!1)}constructor(d,_){super(),this.componentDef=d,this.ngModule=_,this.componentType=d.type,this.selector=XR(d.selectors),this.ngContentSelectors=d.ngContentSelectors?d.ngContentSelectors:[],this.isBoundToModule=!!_}create(d,_,v,I){let o=Gn(null);try{I=I||this.ngModule;let k=I instanceof es?I:I?.injector;k&&this.componentDef.getStandaloneInjector!==null&&(k=this.componentDef.getStandaloneInjector(k)||k);let V=k?new Wx(d,k):d,Z=V.get(p_,null);if(Z===null)throw new kn(407,!1);let me=V.get(Nk,null),ye=V.get(u1,null),Ne=V.get(Ah,null),ot={rendererFactory:Z,sanitizer:me,inlineEffectRunner:null,afterRenderEventManager:ye,changeDetectionScheduler:Ne},et=Z.createRenderer(null,this.componentDef),mt=this.componentDef.selectors[0][0]||"div",Zt=v?HO(et,v,this.componentDef.encapsulation,V):KD(et,mt,Wk(mt)),jt=512;this.componentDef.signals?jt|=4096:this.componentDef.onPush||(jt|=16);let Rt=null;Zt!==null&&(Rt=Qv(Zt,V,!0));let an=r1(0,null,null,1,0,null,null,null,null,null,null),Ut=C_(null,an,null,jt,null,null,ot,et,V,null,Rt);$v(Ut);let pn,mr;try{let Yn=this.componentDef,Sr,cn=null;Yn.findHostDirectiveDefs?(Sr=[],cn=new Map,Yn.findHostDirectiveDefs(Yn,Sr,cn),Sr.push(Yn)):Sr=[Yn];let Ao=Zk(Ut,Zt),Qt=Xk(Ao,Zt,Yn,Sr,Ut,ot,et);mr=pD(an,Gs),Zt&&Kk(et,Yn,Zt,v),_!==void 0&&Jk(mr,this.ngContentSelectors,_),pn=Qk(Qt,Yn,Sr,cn,Ut,[eF]),o1(an,Ut,null)}finally{Hv()}return new fv(this.componentType,pn,kh(mr,Ut),Ut,mr)}finally{Gn(o)}}},fv=class extends sv{constructor(d,_,v,I,o){super(),this.location=v,this._rootLView=I,this._tNode=o,this.previousInputValues=null,this.instance=_,this.hostView=this.changeDetectorRef=new Bc(I,void 0,!1),this.componentType=d}setInput(d,_){let v=this._tNode.inputs,I;if(v!==null&&(I=v[d])){if(this.previousInputValues??=new Map,this.previousInputValues.has(d)&&Object.is(this.previousInputValues.get(d),_))return;let o=this._rootLView;i1(o[yn],o,I,d,_),this.previousInputValues.set(d,_);let k=dl(this._tNode.index,o);s1(k,1)}}get injector(){return new Ac(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(d){this.hostView.onDestroy(d)}};function Zk(h,d){let _=h[yn],v=Gs;return h[v]=d,S_(_,v,2,"#host",null)}function Xk(h,d,_,v,I,o,k){let V=I[yn];Yk(v,h,d,k);let Z=null;d!==null&&(Z=Qv(d,I[Mh]));let me=o.rendererFactory.createRenderer(d,_),ye=16;_.signals?ye=4096:_.onPush&&(ye=64);let Ne=C_(I,fM(_),null,ye,I[h.index],h,o,me,null,null,Z);return V.firstCreatePass&&rv(V,h,v.length-1),A_(I,Ne),I[h.index]=Ne}function Yk(h,d,_,v){for(let I of h)d.mergedAttrs=Ov(d.mergedAttrs,I.hostAttrs);d.mergedAttrs!==null&&(dv(d,d.mergedAttrs,!0),_!==null&&oM(v,_,d))}function Qk(h,d,_,v,I,o){let k=to(),V=I[yn],Z=Do(k,I);mM(V,I,k,_,null,v);for(let ye=0;ye<_.length;ye++){let Ne=k.directiveStart+ye,ot=Sh(I,V,Ne,k);zc(ot,I)}gM(V,I,k),Z&&zc(Z,I);let me=Sh(I,V,k.directiveStart+k.componentOffset,k);if(h[Eo]=I[Eo]=me,o!==null)for(let ye of o)ye(me,d);return uM(V,k,I),me}function Kk(h,d,_,v){if(v)zx(h,_,["ng-version","18.1.1"]);else{let{attrs:I,classes:o}=YR(d.selectors[0]);I&&zx(h,_,I),o&&o.length>0&&iM(h,_,o.join(" "))}}function Jk(h,d,_){let v=h.projection=[];for(let I=0;I<d.length;I++){let o=_[I];v.push(o!=null?Array.from(o):null)}}function eF(){let h=to();Zv(ur()[yn],h)}var zh=(()=>{let d=class d{};d.__NG_ELEMENT_ID__=tF;let h=d;return h})();function tF(){let h=to();return RM(h,ur())}var nF=zh,PM=class extends nF{constructor(d,_,v){super(),this._lContainer=d,this._hostTNode=_,this._hostLView=v}get element(){return kh(this._hostTNode,this._hostLView)}get injector(){return new Ac(this._hostTNode,this._hostLView)}get parentInjector(){let d=Xv(this._hostTNode,this._hostLView);if(RD(d)){let _=c_(d,this._hostLView),v=l_(d),I=_[yn].data[v+8];return new Ac(I,_)}else return new Ac(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(d){let _=DI(this._lContainer);return _!==null&&_[d]||null}get length(){return this._lContainer.length-ki}createEmbeddedView(d,_,v){let I,o;typeof v=="number"?I=v:v!=null&&(I=v.index,o=v.injector);let k=xI(this._lContainer,d.ssrId),V=d.createEmbeddedViewImpl(_||{},o,k);return this.insertImpl(V,I,yI(this._hostTNode,k)),V}createComponent(d,_,v,I,o){let k=d&&!fL(d),V;if(k)V=_;else{let mt=_||{};V=mt.index,v=mt.injector,I=mt.projectableNodes,o=mt.environmentInjector||mt.ngModuleRef}let Z=k?d:new np(Pc(d)),me=v||this.parentInjector;if(!o&&Z.ngModule==null){let Zt=(k?me:this.parentInjector).get(es,null);Zt&&(o=Zt)}let ye=Pc(Z.componentType??{}),Ne=xI(this._lContainer,ye?.id??null),ot=Ne?.firstChild??null,et=Z.create(me,I,ot,o);return this.insertImpl(et.hostView,V,yI(this._hostTNode,Ne)),et}insert(d,_){return this.insertImpl(d,_,!0)}insertImpl(d,_,v){let I=d._lView;if(bL(I)){let V=this.indexOf(d);if(V!==-1)this.detach(V);else{let Z=I[Kr],me=new PM(Z,Z[Io],Z[Kr]);me.detach(me.indexOf(d))}}let o=this._adjustIndex(_),k=this._lContainer;return _k(k,I,o,v),d.attachToViewContainerRef(),$I(Px(k),o,d),d}move(d,_){return this.insert(d,_)}indexOf(d){let _=DI(this._lContainer);return _!==null?_.indexOf(d):-1}remove(d){let _=this._adjustIndex(d,-1),v=tv(this._lContainer,_);v&&(e_(Px(this._lContainer),_),tM(v[yn],v))}detach(d){let _=this._adjustIndex(d,-1),v=tv(this._lContainer,_);return v&&e_(Px(this._lContainer),_)!=null?new Bc(v):null}_adjustIndex(d,_=0){return d??this.length+_}};function DI(h){return h[o_]}function Px(h){return h[o_]||(h[o_]=[])}function RM(h,d){let _,v=d[h.index];return Hs(v)?_=v:(_=_M(v,d,null,h),d[h.index]=_,A_(d,_)),iF(_,d,h,v),new PM(_,h,d)}function rF(h,d){let _=h[Jr],v=_.createComment(""),I=Do(d,h),o=e1(_,I);return h_(_,o,v,LO(_,I),!1),v}var iF=aF,oF=()=>!1;function sF(h,d,_){return oF(h,d,_)}function aF(h,d,_,v){if(h[Lc])return;let I;_.type&8?I=ns(v):I=rF(d,_),h[Lc]=I}var pv=class h{constructor(d){this.queryList=d,this.matches=null}clone(){return new h(this.queryList)}setDirty(){this.queryList.setDirty()}},mv=class h{constructor(d=[]){this.queries=d}createEmbeddedView(d){let _=d.queries;if(_!==null){let v=d.contentQueries!==null?d.contentQueries[0]:_.length,I=[];for(let o=0;o<v;o++){let k=_.getByIndex(o),V=this.queries[k.indexInDeclarationView];I.push(V.clone())}return new h(I)}return null}insertView(d){this.dirtyQueriesWithMatches(d)}detachView(d){this.dirtyQueriesWithMatches(d)}finishViewCreation(d){this.dirtyQueriesWithMatches(d)}dirtyQueriesWithMatches(d){for(let _=0;_<this.queries.length;_++)h1(d,_).matches!==null&&this.queries[_].setDirty()}},gv=class{constructor(d,_,v=null){this.flags=_,this.read=v,typeof d=="string"?this.predicate=mF(d):this.predicate=d}},_v=class h{constructor(d=[]){this.queries=d}elementStart(d,_){for(let v=0;v<this.queries.length;v++)this.queries[v].elementStart(d,_)}elementEnd(d){for(let _=0;_<this.queries.length;_++)this.queries[_].elementEnd(d)}embeddedTView(d){let _=null;for(let v=0;v<this.length;v++){let I=_!==null?_.length:0,o=this.getByIndex(v).embeddedTView(d,I);o&&(o.indexInDeclarationView=v,_!==null?_.push(o):_=[o])}return _!==null?new h(_):null}template(d,_){for(let v=0;v<this.queries.length;v++)this.queries[v].template(d,_)}getByIndex(d){return this.queries[d]}get length(){return this.queries.length}track(d){this.queries.push(d)}},yv=class h{constructor(d,_=-1){this.metadata=d,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=_}elementStart(d,_){this.isApplyingToNode(_)&&this.matchTNode(d,_)}elementEnd(d){this._declarationNodeIndex===d.index&&(this._appliesToNextNode=!1)}template(d,_){this.elementStart(d,_)}embeddedTView(d,_){return this.isApplyingToNode(d)?(this.crossesNgTemplate=!0,this.addMatch(-d.index,_),new h(this.metadata)):null}isApplyingToNode(d){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let _=this._declarationNodeIndex,v=d.parent;for(;v!==null&&v.type&8&&v.index!==_;)v=v.parent;return _===(v!==null?v.index:-1)}return this._appliesToNextNode}matchTNode(d,_){let v=this.metadata.predicate;if(Array.isArray(v))for(let I=0;I<v.length;I++){let o=v[I];this.matchTNodeWithReadOption(d,_,lF(_,o)),this.matchTNodeWithReadOption(d,_,Xg(_,d,o,!1,!1))}else v===Vc?_.type&4&&this.matchTNodeWithReadOption(d,_,-1):this.matchTNodeWithReadOption(d,_,Xg(_,d,v,!1,!1))}matchTNodeWithReadOption(d,_,v){if(v!==null){let I=this.metadata.read;if(I!==null)if(I===Uc||I===zh||I===Vc&&_.type&4)this.addMatch(_.index,-2);else{let o=Xg(_,d,I,!1,!1);o!==null&&this.addMatch(_.index,o)}else this.addMatch(_.index,v)}}addMatch(d,_){this.matches===null?this.matches=[d,_]:this.matches.push(d,_)}};function lF(h,d){let _=h.localNames;if(_!==null){for(let v=0;v<_.length;v+=2)if(_[v]===d)return _[v+1]}return null}function cF(h,d){return h.type&11?kh(h,d):h.type&4?P_(h,d):null}function uF(h,d,_,v){return _===-1?cF(d,h):_===-2?hF(h,d,v):Sh(h,h[yn],_,d)}function hF(h,d,_){if(_===Uc)return kh(d,h);if(_===Vc)return P_(d,h);if(_===zh)return RM(d,h)}function LM(h,d,_,v){let I=d[Us].queries[v];if(I.matches===null){let o=h.data,k=_.matches,V=[];for(let Z=0;k!==null&&Z<k.length;Z+=2){let me=k[Z];if(me<0)V.push(null);else{let ye=o[me];V.push(uF(d,ye,k[Z+1],_.metadata.read))}}I.matches=V}return I.matches}function xv(h,d,_,v){let I=h.queries.getByIndex(_),o=I.matches;if(o!==null){let k=LM(h,d,I,_);for(let V=0;V<o.length;V+=2){let Z=o[V];if(Z>0)v.push(k[V/2]);else{let me=o[V+1],ye=d[-Z];for(let Ne=ki;Ne<ye.length;Ne++){let ot=ye[Ne];ot[Rc]===ot[Kr]&&xv(ot[yn],ot,me,v)}if(ye[Ch]!==null){let Ne=ye[Ch];for(let ot=0;ot<Ne.length;ot++){let et=Ne[ot];xv(et[yn],et,me,v)}}}}}return v}function dF(h,d){return h[Us].queries[d].queryList}function fF(h,d,_){let v=new Kx((_&4)===4);return ZO(h,d,v,v.destroy),(d[Us]??=new mv).queries.push(new pv(v))-1}function pF(h,d,_){let v=rs();return v.firstCreatePass&&(gF(v,new gv(h,d,_),-1),(d&2)===2&&(v.staticViewQueries=!0)),fF(v,ur(),d)}function mF(h){return h.split(",").map(d=>d.trim())}function gF(h,d,_){h.queries===null&&(h.queries=new _v),h.queries.track(new yv(d,_))}function h1(h,d){return h.queries.getByIndex(d)}function _F(h,d){let _=h[yn],v=h1(_,d);return v.crossesNgTemplate?xv(_,h,d,[]):LM(_,h,v,d)}var hl=class{},vv=class{};var bv=class extends hl{constructor(d,_,v){super(),this._parent=_,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new m_(this);let I=QI(d);this._bootstrapComponents=QD(I.bootstrap),this._r3Injector=UD(d,_,[{provide:hl,useValue:this},{provide:Ph,useValue:this.componentFactoryResolver},...v],oi(d),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(d)}get injector(){return this._r3Injector}destroy(){let d=this._r3Injector;!d.destroyed&&d.destroy(),this.destroyCbs.forEach(_=>_()),this.destroyCbs=null}onDestroy(d){this.destroyCbs.push(d)}},wv=class extends vv{constructor(d){super(),this.moduleType=d}create(d){return new bv(this.moduleType,d,[])}};var g_=class extends hl{constructor(d){super(),this.componentFactoryResolver=new m_(this),this.instance=null;let _=new Kf([...d.providers,{provide:hl,useValue:this},{provide:Ph,useValue:this.componentFactoryResolver}],d.parent||Bv(),d.debugName,new Set(["environment"]));this.injector=_,d.runEnvironmentInitializers&&_.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(d){this.injector.onDestroy(d)}};function yF(h,d,_=null){return new g_({providers:h,parent:d,debugName:_,runEnvironmentInitializers:!0}).injector}function OM(h){return vF(h)?Array.isArray(h)||!(h instanceof Map)&&Symbol.iterator in h:!1}function xF(h,d){if(Array.isArray(h))for(let _=0;_<h.length;_++)d(h[_]);else{let _=h[Symbol.iterator](),v;for(;!(v=_.next()).done;)d(v.value)}}function vF(h){return h!==null&&(typeof h=="function"||typeof h=="object")}function d1(h,d,_){let v=h[d];return Object.is(v,_)?!1:(h[d]=_,!0)}function bF(h){return(h.flags&32)===32}function wF(h,d,_,v,I,o,k,V,Z){let me=d.consts,ye=S_(d,h,4,k||null,V||null);pM(d,_,ye,a_(me,Z)),Zv(d,ye);let Ne=ye.tView=r1(2,ye,v,I,o,d.directiveRegistry,d.pipeRegistry,null,d.schemas,me,null);return d.queries!==null&&(d.queries.template(d,ye),Ne.queries=d.queries.embeddedTView(ye)),ye}function TF(h,d,_,v,I,o,k,V,Z,me){let ye=_+Gs,Ne=d.firstCreatePass?wF(ye,d,h,v,I,o,k,V,Z):d.data[ye];cp(Ne,!1);let ot=EF(d,h,Ne,_);qv()&&t1(d,h,ot,Ne),zc(ot,h);let et=_M(ot,h,ot,Ne);return h[ye]=et,A_(h,et),sF(et,Ne,h),jv(Ne)&&hM(d,h,Ne),Z!=null&&dM(h,Ne,me),Ne}function Bh(h,d,_,v,I,o,k,V){let Z=ur(),me=rs(),ye=a_(me.consts,o);return TF(Z,me,h,d,_,v,I,ye,k,V),Bh}var EF=IF;function IF(h,d,_,v){return Wv(!0),d[Jr].createComment("")}function DF(h,d,_,v){return d1(h,TD(),_)?d+VI(_)+v:Fh}function Hg(h,d){return h<<17|d<<2}function jc(h){return h>>17&32767}function MF(h){return(h&2)==2}function CF(h,d){return h&131071|d<<17}function Tv(h){return h|2}function Rh(h){return(h&131068)>>2}function Rx(h,d){return h&-131069|d<<2}function SF(h){return(h&1)===1}function Ev(h){return h|1}function AF(h,d,_,v,I,o){let k=o?d.classBindings:d.styleBindings,V=jc(k),Z=Rh(k);h[v]=_;let me=!1,ye;if(Array.isArray(_)){let Ne=_;ye=Ne[1],(ye===null||op(Ne,ye)>0)&&(me=!0)}else ye=_;if(I)if(Z!==0){let ot=jc(h[V+1]);h[v+1]=Hg(ot,V),ot!==0&&(h[ot+1]=Rx(h[ot+1],v)),h[V+1]=CF(h[V+1],v)}else h[v+1]=Hg(V,0),V!==0&&(h[V+1]=Rx(h[V+1],v)),V=v;else h[v+1]=Hg(Z,0),V===0?V=v:h[Z+1]=Rx(h[Z+1],v),Z=v;me&&(h[v+1]=Tv(h[v+1])),MI(h,ye,v,!0),MI(h,ye,v,!1),PF(d,ye,h,v,o),k=Hg(V,Z),o?d.classBindings=k:d.styleBindings=k}function PF(h,d,_,v,I){let o=I?h.residualClasses:h.residualStyles;o!=null&&typeof d=="string"&&op(o,d)>=0&&(_[v+1]=Ev(_[v+1]))}function MI(h,d,_,v){let I=h[_+1],o=d===null,k=v?jc(I):Rh(I),V=!1;for(;k!==0&&(V===!1||o);){let Z=h[k],me=h[k+1];RF(Z,d)&&(V=!0,h[k+1]=v?Ev(me):Tv(me)),k=v?jc(me):Rh(me)}V&&(h[_+1]=v?Tv(I):Ev(I))}function RF(h,d){return h===null||d==null||(Array.isArray(h)?h[1]:h)===d?!0:Array.isArray(h)&&typeof d=="string"?op(h,d)>=0:!1}function fl(h,d,_){let v=ur(),I=TD();if(d1(v,I,d)){let o=rs(),k=jL();KO(o,k,v,h,d,v[Jr],_,!1)}return fl}function CI(h,d,_,v,I){let o=d.inputs,k=I?"class":"style";i1(h,_,o[k],k,v)}function f1(h,d){return LF(h,d,null,!0),f1}function LF(h,d,_,v){let I=ur(),o=rs(),k=OL(2);if(o.firstUpdatePass&&kF(o,h,k,v),d!==Fh&&d1(I,k,d)){let V=o.data[Oh()];VF(o,V,I,I[Jr],h,I[k+1]=jF(d,_),v,k)}}function OF(h,d){return d>=h.expandoStartIndex}function kF(h,d,_,v){let I=h.data;if(I[_+1]===null){let o=I[Oh()],k=OF(h,_);UF(o,v)&&d===null&&!k&&(d=!1),d=FF(I,o,d,v),AF(I,o,d,_,k,v)}}function FF(h,d,_,v){let I=zL(h),o=v?d.residualClasses:d.residualStyles;if(I===null)(v?d.classBindings:d.styleBindings)===0&&(_=Lx(null,h,d,_,v),_=rp(_,d.attrs,v),o=null);else{let k=d.directiveStylingLast;if(k===-1||h[k]!==I)if(_=Lx(I,h,d,_,v),o===null){let Z=NF(h,d,v);Z!==void 0&&Array.isArray(Z)&&(Z=Lx(null,h,d,Z[1],v),Z=rp(Z,d.attrs,v),zF(h,d,v,Z))}else o=BF(h,d,v)}return o!==void 0&&(v?d.residualClasses=o:d.residualStyles=o),_}function NF(h,d,_){let v=_?d.classBindings:d.styleBindings;if(Rh(v)!==0)return h[jc(v)]}function zF(h,d,_,v){let I=_?d.classBindings:d.styleBindings;h[jc(I)]=v}function BF(h,d,_){let v,I=d.directiveEnd;for(let o=1+d.directiveStylingLast;o<I;o++){let k=h[o].hostAttrs;v=rp(v,k,_)}return rp(v,d.attrs,_)}function Lx(h,d,_,v,I){let o=null,k=_.directiveEnd,V=_.directiveStylingLast;for(V===-1?V=_.directiveStart:V++;V<k&&(o=d[V],v=rp(v,o.hostAttrs,I),o!==h);)V++;return h!==null&&(_.directiveStylingLast=V),v}function rp(h,d,_){let v=_?1:2,I=-1;if(d!==null)for(let o=0;o<d.length;o++){let k=d[o];typeof k=="number"?I=k:I===v&&(Array.isArray(h)||(h=h===void 0?[]:["",h]),FR(h,k,_?!0:d[++o]))}return h===void 0?null:h}function VF(h,d,_,v,I,o,k,V){if(!(d.type&3))return;let Z=h.data,me=Z[V+1],ye=SF(me)?SI(Z,d,_,I,Rh(me),k):void 0;if(!__(ye)){__(o)||MF(me)&&(o=SI(Z,null,_,I,V,k));let Ne=fD(Oh(),_);VO(v,k,Ne,I,o)}}function SI(h,d,_,v,I,o){let k=d===null,V;for(;I>0;){let Z=h[I],me=Array.isArray(Z),ye=me?Z[1]:Z,Ne=ye===null,ot=_[I+1];ot===Fh&&(ot=Ne?bo:void 0);let et=Ne?Tx(ot,v):ye===v?ot:void 0;if(me&&!__(et)&&(et=Tx(Z,v)),__(et)&&(V=et,k))return V;let mt=h[I+1];I=k?jc(mt):Rh(mt)}if(d!==null){let Z=o?d.residualClasses:d.residualStyles;Z!=null&&(V=Tx(Z,v))}return V}function __(h){return h!==void 0}function jF(h,d){return h==null||h===""||(typeof d=="string"?h=h+d:typeof h=="object"&&(h=oi(YD(h)))),h}function UF(h,d){return(h.flags&(d?8:16))!==0}function GF(h,d,_,v,I,o){let k=d.consts,V=a_(k,I),Z=S_(d,h,2,v,V);return pM(d,_,Z,a_(k,o)),Z.attrs!==null&&dv(Z,Z.attrs,!1),Z.mergedAttrs!==null&&dv(Z,Z.mergedAttrs,!0),d.queries!==null&&d.queries.elementStart(d,Z),Z}function jr(h,d,_,v){let I=ur(),o=rs(),k=Gs+h,V=I[Jr],Z=o.firstCreatePass?GF(k,o,I,d,_,v):o.data[k],me=$F(o,I,Z,V,d,h);I[k]=me;let ye=jv(Z);return cp(Z,!0),oM(V,me,Z),!bF(Z)&&qv()&&t1(o,I,me,Z),EL()===0&&zc(me,I),IL(),ye&&(hM(o,I,Z),uM(o,Z,I)),v!==null&&dM(I,Z),jr}function Ur(){let h=to();bD()?PL():(h=h.parent,cp(h,!1));let d=h;CL(d)&&SL(),DL();let _=rs();return _.firstCreatePass&&(Zv(_,h),aD(h)&&_.queries.elementEnd(h)),d.classesWithoutHost!=null&&qL(d)&&CI(_,d,ur(),d.classesWithoutHost,!0),d.stylesWithoutHost!=null&&WL(d)&&CI(_,d,ur(),d.stylesWithoutHost,!1),Ur}function Mo(h,d,_,v){return jr(h,d,_,v),Ur(),Mo}var $F=(h,d,_,v,I,o)=>(Wv(!0),KD(v,I,UL()));function R_(){return ur()}var y_="en-US";var HF=y_;function qF(h){typeof h=="string"&&(HF=h.toLowerCase().replace(/_/g,"-"))}var WF=(h,d,_)=>{};function pl(h,d,_,v){let I=ur(),o=rs(),k=to();return XF(o,I,I[Jr],k,h,d,v),pl}function ZF(h,d,_,v){let I=h.cleanup;if(I!=null)for(let o=0;o<I.length-1;o+=2){let k=I[o];if(k===_&&I[o+1]===v){let V=d[i_],Z=I[o+2];return V.length>Z?V[Z]:null}typeof k=="string"&&(o+=2)}return null}function XF(h,d,_,v,I,o,k){let V=jv(v),me=h.firstCreatePass&&vM(h),ye=d[Eo],Ne=xM(d),ot=!0;if(v.type&3||k){let Zt=Do(v,d),jt=k?k(Zt):Zt,Rt=Ne.length,an=k?pn=>k(ns(pn[v.index])):v.index,Ut=null;if(!k&&V&&(Ut=ZF(h,d,I,v.index)),Ut!==null){let pn=Ut.__ngLastListenerFn__||Ut;pn.__ngNextListenerFn__=o,Ut.__ngLastListenerFn__=o,ot=!1}else{o=PI(v,d,ye,o),WF(Zt,I,o);let pn=_.listen(jt,I,o);Ne.push(o,pn),me&&me.push(I,an,Rt,Rt+1)}}else o=PI(v,d,ye,o);let et=v.outputs,mt;if(ot&&et!==null&&(mt=et[I])){let Zt=mt.length;if(Zt)for(let jt=0;jt<Zt;jt+=2){let Rt=mt[jt],an=mt[jt+1],mr=d[Rt][an].subscribe(o),Yn=Ne.length;Ne.push(o,mr),me&&me.push(I,v.index,Yn,-(Yn+1))}}}function AI(h,d,_,v){let I=Gn(null);try{return Ko(6,d,_),_(v)!==!1}catch(o){return bM(h,o),!1}finally{Ko(7,d,_),Gn(I)}}function PI(h,d,_,v){return function I(o){if(o===Function)return v;let k=h.componentOffset>-1?dl(h.index,d):d;s1(k,5);let V=AI(d,_,v,o),Z=I.__ngNextListenerFn__;for(;Z;)V=AI(d,_,Z,o)&&V,Z=Z.__ngNextListenerFn__;return V}}function hp(h=1){return VL(h)}function kM(h,d,_){pF(h,d,_)}function FM(h){let d=ur(),_=rs(),v=ED();Gv(v+1);let I=h1(_,v);if(h.dirty&&vL(d)===((I.metadata.flags&2)===2)){if(I.matches===null)h.reset([]);else{let o=_F(d,v);h.reset(o,aO),h.notifyOnChanges()}return!0}return!1}function NM(){return dF(ur(),ED())}function L_(h){let d=RL();return xL(d,Gs+h)}function Co(h,d=""){let _=ur(),v=rs(),I=h+Gs,o=v.firstCreatePass?S_(v,I,1,d,null):v.data[I],k=YF(v,_,o,d,h);_[I]=k,qv()&&t1(v,_,k,o),cp(o,!1)}var YF=(h,d,_,v,I)=>(Wv(!0),wO(d[Jr],v));function O_(h){return zM("",h,""),O_}function zM(h,d,_){let v=ur(),I=DF(v,h,d,_);return I!==Fh&&dk(v,Oh(),I),zM}var QF=(()=>{let d=class d{constructor(v){this._injector=v,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(v){if(!v.standalone)return null;if(!this.cachedInjectors.has(v)){let I=eD(!1,v.type),o=I.length>0?yF([I],this._injector,`Standalone[${v.type.name}]`):null;this.cachedInjectors.set(v,o)}return this.cachedInjectors.get(v)}ngOnDestroy(){try{for(let v of this.cachedInjectors.values())v!==null&&v.destroy()}finally{this.cachedInjectors.clear()}}};d.\u0275prov=Sn({token:d,providedIn:"environment",factory:()=>new d(Wn(es))});let h=d;return h})();function vi(h){up("NgStandalone"),h.getStandaloneInjector=d=>d.get(QF).getOrCreateStandaloneInjector(h)}function BM(h,d){return P_(h,d)}var KV=(()=>{let d=class d{log(v){console.log(v)}warn(v){console.warn(v)}};d.\u0275fac=function(I){return new(I||d)},d.\u0275prov=Sn({token:d,factory:d.\u0275fac,providedIn:"platform"});let h=d;return h})();var KF=new In("");function p1(h){return!!h&&typeof h.then=="function"}function VM(h){return!!h&&typeof h.subscribe=="function"}var JF=new In(""),jM=(()=>{let d=class d{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((v,I)=>{this.resolve=v,this.reject=I}),this.appInits=Mt(JF,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let v=[];for(let o of this.appInits){let k=o();if(p1(k))v.push(k);else if(VM(k)){let V=new Promise((Z,me)=>{k.subscribe({complete:Z,error:me})});v.push(V)}}let I=()=>{this.done=!0,this.resolve()};Promise.all(v).then(()=>{I()}).catch(o=>{this.reject(o)}),v.length===0&&I(),this.initialized=!0}};d.\u0275fac=function(I){return new(I||d)},d.\u0275prov=Sn({token:d,factory:d.\u0275fac,providedIn:"root"});let h=d;return h})(),UM=new In("");function eN(){mE(()=>{throw new kn(600,!1)})}function tN(h){return h.isBoundToModule}var nN=10;function rN(h,d,_){try{let v=_();return p1(v)?v.catch(I=>{throw d.runOutsideAngular(()=>h.handleError(I)),I}):v}catch(v){throw d.runOutsideAngular(()=>h.handleError(v)),v}}var k_=(()=>{let d=class d{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Mt(GD),this.afterRenderEffectManager=Mt(u1),this.zonelessEnabled=Mt(a1),this.externalTestViews=new Set,this.beforeRender=new ol,this.afterTick=new ol,this.componentTypes=[],this.components=[],this.isStable=Mt(Gc).hasPendingTasks.pipe(_i(v=>!v)),this._injector=Mt(es)}get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(v,I){let o=v instanceof f_;if(!this._injector.get(jM).done){let et=!o&&JR(v),mt=!1;throw new kn(405,mt)}let V;o?V=v:V=this._injector.get(Ph).resolveComponentFactory(v),this.componentTypes.push(V.componentType);let Z=tN(V)?void 0:this._injector.get(hl),me=I||V.selector,ye=V.create(Fc.NULL,[],me,Z),Ne=ye.location.nativeElement,ot=ye.injector.get(KF,null);return ot?.registerApplication(Ne),ye.onDestroy(()=>{this.detachView(ye.hostView),Ox(this.components,ye),ot?.unregisterApplication(Ne)}),this._loadComponent(ye),ye}tick(){this._tick(!0)}_tick(v){if(this._runningTick)throw new kn(101,!1);let I=Gn(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(v)}catch(o){this.internalErrorHandler(o)}finally{this._runningTick=!1,Gn(I),this.afterTick.next()}}detectChangesInAttachedViews(v){let I=null;this._injector.destroyed||(I=this._injector.get(p_,null,{optional:!0}));let o=0,k=this.afterRenderEffectManager;for(;o<nN;){let V=o===0;if(v||!V){this.beforeRender.next(V);for(let{_lView:Z,notifyErrorHandler:me}of this._views)iN(Z,me,V,this.zonelessEnabled)}else I?.begin?.(),I?.end?.();if(o++,k.executeInternalCallbacks(),!this.allViews.some(({_lView:Z})=>ep(Z))&&(k.execute(),!this.allViews.some(({_lView:Z})=>ep(Z))))break}}attachView(v){let I=v;this._views.push(I),I.attachToAppRef(this)}detachView(v){let I=v;Ox(this._views,I),I.detachFromAppRef()}_loadComponent(v){this.attachView(v.hostView),this.tick(),this.components.push(v);let I=this._injector.get(UM,[]);[...this._bootstrapListeners,...I].forEach(o=>o(v))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(v=>v()),this._views.slice().forEach(v=>v.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(v){return this._destroyListeners.push(v),()=>Ox(this._destroyListeners,v)}destroy(){if(this._destroyed)throw new kn(406,!1);let v=this._injector;v.destroy&&!v.destroyed&&v.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};d.\u0275fac=function(I){return new(I||d)},d.\u0275prov=Sn({token:d,factory:d.\u0275fac,providedIn:"root"});let h=d;return h})();function Ox(h,d){let _=h.indexOf(d);_>-1&&h.splice(_,1)}function iN(h,d,_,v){if(!_&&!ep(h))return;EM(h,d,_&&!v?0:1)}var Iv=class{constructor(d,_){this.ngModuleFactory=d,this.componentFactories=_}},JV=(()=>{let d=class d{compileModuleSync(v){return new wv(v)}compileModuleAsync(v){return Promise.resolve(this.compileModuleSync(v))}compileModuleAndAllComponentsSync(v){let I=this.compileModuleSync(v),o=QI(v),k=QD(o.declarations).reduce((V,Z)=>{let me=Pc(Z);return me&&V.push(new np(me)),V},[]);return new Iv(I,k)}compileModuleAndAllComponentsAsync(v){return Promise.resolve(this.compileModuleAndAllComponentsSync(v))}clearCache(){}clearCacheFor(v){}getModuleId(v){}};d.\u0275fac=function(I){return new(I||d)},d.\u0275prov=Sn({token:d,factory:d.\u0275fac,providedIn:"root"});let h=d;return h})();var oN=(()=>{let d=class d{constructor(){this.zone=Mt(Vr),this.changeDetectionScheduler=Mt(Ah),this.applicationRef=Mt(k_)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};d.\u0275fac=function(I){return new(I||d)},d.\u0275prov=Sn({token:d,factory:d.\u0275fac,providedIn:"root"});let h=d;return h})(),sN=new In("",{factory:()=>!1});function GM({ngZoneFactory:h,ignoreChangesOutsideZone:d}){return h??=()=>new Vr($M()),[{provide:Vr,useFactory:h},{provide:t_,multi:!0,useFactory:()=>{let _=Mt(oN,{optional:!0});return()=>_.initialize()}},{provide:t_,multi:!0,useFactory:()=>{let _=Mt(lN);return()=>{_.initialize()}}},{provide:GD,useFactory:aN},d===!0?{provide:CM,useValue:!0}:[]]}function aN(){let h=Mt(Vr),d=Mt(Nc);return _=>h.runOutsideAngular(()=>d.handleError(_))}function ej(h){let d=h?.ignoreChangesOutsideZone,_=GM({ngZoneFactory:()=>{let v=$M(h);return v.shouldCoalesceEventChangeDetection&&up("NgZone_CoalesceEvent"),new Vr(v)},ignoreChangesOutsideZone:d});return Nv([{provide:sN,useValue:!0},{provide:a1,useValue:!1},_])}function $M(h){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:h?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:h?.runCoalescing??!1}}var lN=(()=>{let d=class d{constructor(){this.subscription=new Nr,this.initialized=!1,this.zone=Mt(Vr),this.pendingTasks=Mt(Gc)}initialize(){if(this.initialized)return;this.initialized=!0;let v=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(v=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Vr.assertNotInAngularZone(),queueMicrotask(()=>{v!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(v),v=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Vr.assertInAngularZone(),v??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};d.\u0275fac=function(I){return new(I||d)},d.\u0275prov=Sn({token:d,factory:d.\u0275fac,providedIn:"root"});let h=d;return h})();var cN=(()=>{let d=class d{constructor(){this.appRef=Mt(k_),this.taskService=Mt(Gc),this.ngZone=Mt(Vr),this.zonelessEnabled=Mt(a1),this.disableScheduling=Mt(CM,{optional:!0})??!1,this.zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run,this.schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}],this.subscriptions=new Nr,this.cancelScheduledCallback=null,this.shouldRefreshViews=!1,this.useMicrotaskScheduler=!1,this.runningTick=!1,this.pendingRenderTaskId=null,this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof cv||!this.zoneIsDefined)}notify(v){if(!this.zonelessEnabled&&v===5)return;switch(v){case 3:case 2:case 0:case 4:case 5:case 1:{this.shouldRefreshViews=!0;break}case 8:case 7:case 6:case 9:default:}if(!this.shouldScheduleTick())return;let I=this.useMicrotaskScheduler?bI:SM;this.pendingRenderTaskId=this.taskService.add(),this.zoneIsDefined?Zone.root.run(()=>{this.cancelScheduledCallback=I(()=>{this.tick(this.shouldRefreshViews)})}):this.cancelScheduledCallback=I(()=>{this.tick(this.shouldRefreshViews)})}shouldScheduleTick(){return!(this.disableScheduling||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Vr.isInAngularZone())}tick(v){if(this.runningTick||this.appRef.destroyed)return;let I=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick(v)},void 0,this.schedulerTickApplyArgs)}catch(o){throw this.taskService.remove(I),o}finally{this.cleanup()}this.useMicrotaskScheduler=!0,bI(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(I)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.shouldRefreshViews=!1,this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let v=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(v)}}};d.\u0275fac=function(I){return new(I||d)},d.\u0275prov=Sn({token:d,factory:d.\u0275fac,providedIn:"root"});let h=d;return h})();function uN(){return typeof $localize<"u"&&$localize.locale||y_}var m1=new In("",{providedIn:"root",factory:()=>Mt(m1,En.Optional|En.SkipSelf)||uN()});var HM=new In("");var Qg=null;function hN(h=[],d){return Fc.create({name:d,providers:[{provide:rD,useValue:"platform"},{provide:HM,useValue:new Set([()=>Qg=null])},...h]})}function dN(h=[]){if(Qg)return Qg;let d=hN(h);return Qg=d,eN(),fN(d),d}function fN(h){h.get(mO,null)?.forEach(_=>_())}var qM=(()=>{let d=class d{};d.__NG_ELEMENT_ID__=pN;let h=d;return h})();function pN(h){return mN(to(),ur(),(h&16)===16)}function mN(h,d,_){if(E_(h)&&!_){let v=dl(h.index,d);return new Bc(v,v)}else if(h.type&175){let v=d[ts];return new Bc(v,d)}return null}var Dv=class{constructor(){}supports(d){return OM(d)}create(d){return new Mv(d)}},gN=(h,d)=>d,Mv=class{constructor(d){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=d||gN}forEachItem(d){let _;for(_=this._itHead;_!==null;_=_._next)d(_)}forEachOperation(d){let _=this._itHead,v=this._removalsHead,I=0,o=null;for(;_||v;){let k=!v||_&&_.currentIndex<RI(v,I,o)?_:v,V=RI(k,I,o),Z=k.currentIndex;if(k===v)I--,v=v._nextRemoved;else if(_=_._next,k.previousIndex==null)I++;else{o||(o=[]);let me=V-I,ye=Z-I;if(me!=ye){for(let ot=0;ot<me;ot++){let et=ot<o.length?o[ot]:o[ot]=0,mt=et+ot;ye<=mt&&mt<me&&(o[ot]=et+1)}let Ne=k.previousIndex;o[Ne]=ye-me}}V!==Z&&d(k,V,Z)}}forEachPreviousItem(d){let _;for(_=this._previousItHead;_!==null;_=_._nextPrevious)d(_)}forEachAddedItem(d){let _;for(_=this._additionsHead;_!==null;_=_._nextAdded)d(_)}forEachMovedItem(d){let _;for(_=this._movesHead;_!==null;_=_._nextMoved)d(_)}forEachRemovedItem(d){let _;for(_=this._removalsHead;_!==null;_=_._nextRemoved)d(_)}forEachIdentityChange(d){let _;for(_=this._identityChangesHead;_!==null;_=_._nextIdentityChange)d(_)}diff(d){if(d==null&&(d=[]),!OM(d))throw new kn(900,!1);return this.check(d)?this:null}onDestroy(){}check(d){this._reset();let _=this._itHead,v=!1,I,o,k;if(Array.isArray(d)){this.length=d.length;for(let V=0;V<this.length;V++)o=d[V],k=this._trackByFn(V,o),_===null||!Object.is(_.trackById,k)?(_=this._mismatch(_,o,k,V),v=!0):(v&&(_=this._verifyReinsertion(_,o,k,V)),Object.is(_.item,o)||this._addIdentityChange(_,o)),_=_._next}else I=0,xF(d,V=>{k=this._trackByFn(I,V),_===null||!Object.is(_.trackById,k)?(_=this._mismatch(_,V,k,I),v=!0):(v&&(_=this._verifyReinsertion(_,V,k,I)),Object.is(_.item,V)||this._addIdentityChange(_,V)),_=_._next,I++}),this.length=I;return this._truncate(_),this.collection=d,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let d;for(d=this._previousItHead=this._itHead;d!==null;d=d._next)d._nextPrevious=d._next;for(d=this._additionsHead;d!==null;d=d._nextAdded)d.previousIndex=d.currentIndex;for(this._additionsHead=this._additionsTail=null,d=this._movesHead;d!==null;d=d._nextMoved)d.previousIndex=d.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(d,_,v,I){let o;return d===null?o=this._itTail:(o=d._prev,this._remove(d)),d=this._unlinkedRecords===null?null:this._unlinkedRecords.get(v,null),d!==null?(Object.is(d.item,_)||this._addIdentityChange(d,_),this._reinsertAfter(d,o,I)):(d=this._linkedRecords===null?null:this._linkedRecords.get(v,I),d!==null?(Object.is(d.item,_)||this._addIdentityChange(d,_),this._moveAfter(d,o,I)):d=this._addAfter(new Cv(_,v),o,I)),d}_verifyReinsertion(d,_,v,I){let o=this._unlinkedRecords===null?null:this._unlinkedRecords.get(v,null);return o!==null?d=this._reinsertAfter(o,d._prev,I):d.currentIndex!=I&&(d.currentIndex=I,this._addToMoves(d,I)),d}_truncate(d){for(;d!==null;){let _=d._next;this._addToRemovals(this._unlink(d)),d=_}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(d,_,v){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(d);let I=d._prevRemoved,o=d._nextRemoved;return I===null?this._removalsHead=o:I._nextRemoved=o,o===null?this._removalsTail=I:o._prevRemoved=I,this._insertAfter(d,_,v),this._addToMoves(d,v),d}_moveAfter(d,_,v){return this._unlink(d),this._insertAfter(d,_,v),this._addToMoves(d,v),d}_addAfter(d,_,v){return this._insertAfter(d,_,v),this._additionsTail===null?this._additionsTail=this._additionsHead=d:this._additionsTail=this._additionsTail._nextAdded=d,d}_insertAfter(d,_,v){let I=_===null?this._itHead:_._next;return d._next=I,d._prev=_,I===null?this._itTail=d:I._prev=d,_===null?this._itHead=d:_._next=d,this._linkedRecords===null&&(this._linkedRecords=new x_),this._linkedRecords.put(d),d.currentIndex=v,d}_remove(d){return this._addToRemovals(this._unlink(d))}_unlink(d){this._linkedRecords!==null&&this._linkedRecords.remove(d);let _=d._prev,v=d._next;return _===null?this._itHead=v:_._next=v,v===null?this._itTail=_:v._prev=_,d}_addToMoves(d,_){return d.previousIndex===_||(this._movesTail===null?this._movesTail=this._movesHead=d:this._movesTail=this._movesTail._nextMoved=d),d}_addToRemovals(d){return this._unlinkedRecords===null&&(this._unlinkedRecords=new x_),this._unlinkedRecords.put(d),d.currentIndex=null,d._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=d,d._prevRemoved=null):(d._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=d),d}_addIdentityChange(d,_){return d.item=_,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=d:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=d,d}},Cv=class{constructor(d,_){this.item=d,this.trackById=_,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},Sv=class{constructor(){this._head=null,this._tail=null}add(d){this._head===null?(this._head=this._tail=d,d._nextDup=null,d._prevDup=null):(this._tail._nextDup=d,d._prevDup=this._tail,d._nextDup=null,this._tail=d)}get(d,_){let v;for(v=this._head;v!==null;v=v._nextDup)if((_===null||_<=v.currentIndex)&&Object.is(v.trackById,d))return v;return null}remove(d){let _=d._prevDup,v=d._nextDup;return _===null?this._head=v:_._nextDup=v,v===null?this._tail=_:v._prevDup=_,this._head===null}},x_=class{constructor(){this.map=new Map}put(d){let _=d.trackById,v=this.map.get(_);v||(v=new Sv,this.map.set(_,v)),v.add(d)}get(d,_){let v=d,I=this.map.get(v);return I?I.get(d,_):null}remove(d){let _=d.trackById;return this.map.get(_).remove(d)&&this.map.delete(_),d}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function RI(h,d,_){let v=h.previousIndex;if(v===null)return v;let I=0;return _&&v<_.length&&(I=_[v]),v+d+I}function LI(){return new g1([new Dv])}var g1=(()=>{let d=class d{constructor(v){this.factories=v}static create(v,I){if(I!=null){let o=I.factories.slice();v=v.concat(o)}return new d(v)}static extend(v){return{provide:d,useFactory:I=>d.create(v,I||LI()),deps:[[d,new RR,new PR]]}}find(v){let I=this.factories.find(o=>o.supports(v));if(I!=null)return I;throw new kn(901,!1)}};d.\u0275prov=Sn({token:d,providedIn:"root",factory:LI});let h=d;return h})();function tj(h){try{let{rootComponent:d,appProviders:_,platformProviders:v}=h,I=dN(v),o=[GM({}),{provide:Ah,useExisting:cN},..._||[]],V=new g_({providers:o,parent:I,debugName:"",runEnvironmentInitializers:!1}).injector,Z=V.get(Vr);return Z.run(()=>{V.resolveInjectorInitializers();let me=V.get(Nc,null),ye;Z.runOutsideAngular(()=>{ye=Z.onError.subscribe({next:et=>{me.handleError(et)}})});let Ne=()=>V.destroy(),ot=I.get(HM);return ot.add(Ne),V.onDestroy(()=>{ye.unsubscribe(),ot.delete(Ne)}),rN(me,Z,()=>{let et=V.get(jM);return et.runInitializers(),et.donePromise.then(()=>{let mt=V.get(m1,y_);qF(mt||y_);let Zt=V.get(k_);return d!==void 0&&Zt.bootstrap(d),Zt})})})}catch(d){return Promise.reject(d)}}var nj=new In("");var Hc=hE(v1());var eC=null;function b1(){return eC}function SU(h){eC??=h}var ZM=class{};var N_=new In(""),tC=(()=>{let d=class d{historyGo(v){throw new Error("")}};d.\u0275fac=function(I){return new(I||d)},d.\u0275prov=Sn({token:d,factory:()=>Mt(yN),providedIn:"platform"});let h=d;return h})();var yN=(()=>{let d=class d extends tC{constructor(){super(),this._doc=Mt(N_),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return b1().getBaseHref(this._doc)}onPopState(v){let I=b1().getGlobalEventTarget(this._doc,"window");return I.addEventListener("popstate",v,!1),()=>I.removeEventListener("popstate",v)}onHashChange(v){let I=b1().getGlobalEventTarget(this._doc,"window");return I.addEventListener("hashchange",v,!1),()=>I.removeEventListener("hashchange",v)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(v){this._location.pathname=v}pushState(v,I,o){this._history.pushState(v,I,o)}replaceState(v,I,o){this._history.replaceState(v,I,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(v=0){this._history.go(v)}getState(){return this._history.state}};d.\u0275fac=function(I){return new(I||d)},d.\u0275prov=Sn({token:d,factory:()=>new d,providedIn:"platform"});let h=d;return h})();function nC(h,d){if(h.length==0)return d;if(d.length==0)return h;let _=0;return h.endsWith("/")&&_++,d.startsWith("/")&&_++,_==2?h+d.substring(1):_==1?h+d:h+"/"+d}function XM(h){let d=h.match(/#|\?|$/),_=d&&d.index||h.length,v=_-(h[_-1]==="/"?1:0);return h.slice(0,v)+h.slice(_)}function $c(h){return h&&h[0]!=="?"?"?"+h:h}var I1=(()=>{let d=class d{historyGo(v){throw new Error("")}};d.\u0275fac=function(I){return new(I||d)},d.\u0275prov=Sn({token:d,factory:()=>Mt(vN),providedIn:"root"});let h=d;return h})(),xN=new In(""),vN=(()=>{let d=class d extends I1{constructor(v,I){super(),this._platformLocation=v,this._removeListenerFns=[],this._baseHref=I??this._platformLocation.getBaseHrefFromDOM()??Mt(N_).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(v){this._removeListenerFns.push(this._platformLocation.onPopState(v),this._platformLocation.onHashChange(v))}getBaseHref(){return this._baseHref}prepareExternalUrl(v){return nC(this._baseHref,v)}path(v=!1){let I=this._platformLocation.pathname+$c(this._platformLocation.search),o=this._platformLocation.hash;return o&&v?`${I}${o}`:I}pushState(v,I,o,k){let V=this.prepareExternalUrl(o+$c(k));this._platformLocation.pushState(v,I,V)}replaceState(v,I,o,k){let V=this.prepareExternalUrl(o+$c(k));this._platformLocation.replaceState(v,I,V)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(v=0){this._platformLocation.historyGo?.(v)}};d.\u0275fac=function(I){return new(I||d)(Wn(tC),Wn(xN,8))},d.\u0275prov=Sn({token:d,factory:d.\u0275fac,providedIn:"root"});let h=d;return h})();var bN=(()=>{let d=class d{constructor(v){this._subject=new wo,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=v;let I=this._locationStrategy.getBaseHref();this._basePath=EN(XM(YM(I))),this._locationStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(v=!1){return this.normalize(this._locationStrategy.path(v))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(v,I=""){return this.path()==this.normalize(v+$c(I))}normalize(v){return d.stripTrailingSlash(TN(this._basePath,YM(v)))}prepareExternalUrl(v){return v&&v[0]!=="/"&&(v="/"+v),this._locationStrategy.prepareExternalUrl(v)}go(v,I="",o=null){this._locationStrategy.pushState(o,"",v,I),this._notifyUrlChangeListeners(this.prepareExternalUrl(v+$c(I)),o)}replaceState(v,I="",o=null){this._locationStrategy.replaceState(o,"",v,I),this._notifyUrlChangeListeners(this.prepareExternalUrl(v+$c(I)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(v=0){this._locationStrategy.historyGo?.(v)}onUrlChange(v){return this._urlChangeListeners.push(v),this._urlChangeSubscription??=this.subscribe(I=>{this._notifyUrlChangeListeners(I.url,I.state)}),()=>{let I=this._urlChangeListeners.indexOf(v);this._urlChangeListeners.splice(I,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(v="",I){this._urlChangeListeners.forEach(o=>o(v,I))}subscribe(v,I,o){return this._subject.subscribe({next:v,error:I,complete:o})}};d.normalizeQueryParams=$c,d.joinWithSlash=nC,d.stripTrailingSlash=XM,d.\u0275fac=function(I){return new(I||d)(Wn(I1))},d.\u0275prov=Sn({token:d,factory:()=>wN(),providedIn:"root"});let h=d;return h})();function wN(){return new bN(Wn(I1))}function TN(h,d){if(!h||!d.startsWith(h))return d;let _=d.substring(h.length);return _===""||["/",";","?","#"].includes(_[0])?_:d}function YM(h){return h.replace(/\/index.html$/,"")}function EN(h){if(new RegExp("^(https?:)?//").test(h)){let[,_]=h.split(/\/\/[^\/]+/);return _}return h}function rC(h,d){d=encodeURIComponent(d);for(let _ of h.split(";")){let v=_.indexOf("="),[I,o]=v==-1?[_,""]:[_.slice(0,v),_.slice(v+1)];if(I.trim()===d)return decodeURIComponent(o)}return null}var w1=/\s+/,QM=[],iC=(()=>{let d=class d{constructor(v,I){this._ngEl=v,this._renderer=I,this.initialClasses=QM,this.stateMap=new Map}set klass(v){this.initialClasses=v!=null?v.trim().split(w1):QM}set ngClass(v){this.rawClass=typeof v=="string"?v.trim().split(w1):v}ngDoCheck(){for(let I of this.initialClasses)this._updateState(I,!0);let v=this.rawClass;if(Array.isArray(v)||v instanceof Set)for(let I of v)this._updateState(I,!0);else if(v!=null)for(let I of Object.keys(v))this._updateState(I,!!v[I]);this._applyStateDiff()}_updateState(v,I){let o=this.stateMap.get(v);o!==void 0?(o.enabled!==I&&(o.changed=!0,o.enabled=I),o.touched=!0):this.stateMap.set(v,{enabled:I,changed:!0,touched:!0})}_applyStateDiff(){for(let v of this.stateMap){let I=v[0],o=v[1];o.changed?(this._toggleClass(I,o.enabled),o.changed=!1):o.touched||(o.enabled&&this._toggleClass(I,!1),this.stateMap.delete(I)),o.touched=!1}}_toggleClass(v,I){v=v.trim(),v.length>0&&v.split(w1).forEach(o=>{I?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}};d.\u0275fac=function(I){return new(I||d)(qs(Uc),qs(l1))},d.\u0275dir=w_({type:d,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"},standalone:!0});let h=d;return h})();var T1=class{constructor(d,_,v,I){this.$implicit=d,this.ngForOf=_,this.index=v,this.count=I}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},oC=(()=>{let d=class d{set ngForOf(v){this._ngForOf=v,this._ngForOfDirty=!0}set ngForTrackBy(v){this._trackByFn=v}get ngForTrackBy(){return this._trackByFn}constructor(v,I,o){this._viewContainer=v,this._template=I,this._differs=o,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(v){v&&(this._template=v)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let v=this._ngForOf;if(!this._differ&&v)if(0)try{}catch{}else this._differ=this._differs.find(v).create(this.ngForTrackBy)}if(this._differ){let v=this._differ.diff(this._ngForOf);v&&this._applyChanges(v)}}_applyChanges(v){let I=this._viewContainer;v.forEachOperation((o,k,V)=>{if(o.previousIndex==null)I.createEmbeddedView(this._template,new T1(o.item,this._ngForOf,-1,-1),V===null?void 0:V);else if(V==null)I.remove(k===null?void 0:k);else if(k!==null){let Z=I.get(k);I.move(Z,V),KM(Z,o)}});for(let o=0,k=I.length;o<k;o++){let Z=I.get(o).context;Z.index=o,Z.count=k,Z.ngForOf=this._ngForOf}v.forEachIdentityChange(o=>{let k=I.get(o.currentIndex);KM(k,o)})}static ngTemplateContextGuard(v,I){return!0}};d.\u0275fac=function(I){return new(I||d)(qs(zh),qs(Vc),qs(g1))},d.\u0275dir=w_({type:d,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0});let h=d;return h})();function KM(h,d){h.context.$implicit=d.item}var z_=(()=>{let d=class d{constructor(v,I){this._viewContainer=v,this._context=new E1,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=I}set ngIf(v){this._context.$implicit=this._context.ngIf=v,this._updateView()}set ngIfThen(v){JM("ngIfThen",v),this._thenTemplateRef=v,this._thenViewRef=null,this._updateView()}set ngIfElse(v){JM("ngIfElse",v),this._elseTemplateRef=v,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(v,I){return!0}};d.\u0275fac=function(I){return new(I||d)(qs(zh),qs(Vc))},d.\u0275dir=w_({type:d,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let h=d;return h})(),E1=class{constructor(){this.$implicit=null,this.ngIf=null}};function JM(h,d){if(!!!(!d||d.createEmbeddedView))throw new Error(`${h} must be a TemplateRef, but received '${oi(d)}'.`)}var B_=(()=>{let d=class d{};d.\u0275fac=function(I){return new(I||d)},d.\u0275mod=Fv({type:d}),d.\u0275inj=Pv({});let h=d;return h})(),AU="browser",IN="server";function DN(h){return h===IN}var F_=class{};var Ws=class{},j_=class{},Zs=class h{constructor(d){this.normalizedNames=new Map,this.lazyUpdate=null,d?typeof d=="string"?this.lazyInit=()=>{this.headers=new Map,d.split(`
`).forEach(_=>{let v=_.indexOf(":");if(v>0){let I=_.slice(0,v),o=I.toLowerCase(),k=_.slice(v+1).trim();this.maybeSetNormalizedName(I,o),this.headers.has(o)?this.headers.get(o).push(k):this.headers.set(o,[k])}})}:typeof Headers<"u"&&d instanceof Headers?(this.headers=new Map,d.forEach((_,v)=>{this.setHeaderEntries(v,_)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(d).forEach(([_,v])=>{this.setHeaderEntries(_,v)})}:this.headers=new Map}has(d){return this.init(),this.headers.has(d.toLowerCase())}get(d){this.init();let _=this.headers.get(d.toLowerCase());return _&&_.length>0?_[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(d){return this.init(),this.headers.get(d.toLowerCase())||null}append(d,_){return this.clone({name:d,value:_,op:"a"})}set(d,_){return this.clone({name:d,value:_,op:"s"})}delete(d,_){return this.clone({name:d,value:_,op:"d"})}maybeSetNormalizedName(d,_){this.normalizedNames.has(_)||this.normalizedNames.set(_,d)}init(){this.lazyInit&&(this.lazyInit instanceof h?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(d=>this.applyUpdate(d)),this.lazyUpdate=null))}copyFrom(d){d.init(),Array.from(d.headers.keys()).forEach(_=>{this.headers.set(_,d.headers.get(_)),this.normalizedNames.set(_,d.normalizedNames.get(_))})}clone(d){let _=new h;return _.lazyInit=this.lazyInit&&this.lazyInit instanceof h?this.lazyInit:this,_.lazyUpdate=(this.lazyUpdate||[]).concat([d]),_}applyUpdate(d){let _=d.name.toLowerCase();switch(d.op){case"a":case"s":let v=d.value;if(typeof v=="string"&&(v=[v]),v.length===0)return;this.maybeSetNormalizedName(d.name,_);let I=(d.op==="a"?this.headers.get(_):void 0)||[];I.push(...v),this.headers.set(_,I);break;case"d":let o=d.value;if(!o)this.headers.delete(_),this.normalizedNames.delete(_);else{let k=this.headers.get(_);if(!k)return;k=k.filter(V=>o.indexOf(V)===-1),k.length===0?(this.headers.delete(_),this.normalizedNames.delete(_)):this.headers.set(_,k)}break}}setHeaderEntries(d,_){let v=(Array.isArray(_)?_:[_]).map(o=>o.toString()),I=d.toLowerCase();this.headers.set(I,v),this.maybeSetNormalizedName(d,I)}forEach(d){this.init(),Array.from(this.normalizedNames.keys()).forEach(_=>d(this.normalizedNames.get(_),this.headers.get(_)))}};var C1=class{encodeKey(d){return sC(d)}encodeValue(d){return sC(d)}decodeKey(d){return decodeURIComponent(d)}decodeValue(d){return decodeURIComponent(d)}};function MN(h,d){let _=new Map;return h.length>0&&h.replace(/^\?/,"").split("&").forEach(I=>{let o=I.indexOf("="),[k,V]=o==-1?[d.decodeKey(I),""]:[d.decodeKey(I.slice(0,o)),d.decodeValue(I.slice(o+1))],Z=_.get(k)||[];Z.push(V),_.set(k,Z)}),_}var CN=/%(\d[a-f0-9])/gi,SN={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function sC(h){return encodeURIComponent(h).replace(CN,(d,_)=>SN[_]??d)}function V_(h){return`${h}`}var gl=class h{constructor(d={}){if(this.updates=null,this.cloneFrom=null,this.encoder=d.encoder||new C1,d.fromString){if(d.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=MN(d.fromString,this.encoder)}else d.fromObject?(this.map=new Map,Object.keys(d.fromObject).forEach(_=>{let v=d.fromObject[_],I=Array.isArray(v)?v.map(V_):[V_(v)];this.map.set(_,I)})):this.map=null}has(d){return this.init(),this.map.has(d)}get(d){this.init();let _=this.map.get(d);return _?_[0]:null}getAll(d){return this.init(),this.map.get(d)||null}keys(){return this.init(),Array.from(this.map.keys())}append(d,_){return this.clone({param:d,value:_,op:"a"})}appendAll(d){let _=[];return Object.keys(d).forEach(v=>{let I=d[v];Array.isArray(I)?I.forEach(o=>{_.push({param:v,value:o,op:"a"})}):_.push({param:v,value:I,op:"a"})}),this.clone(_)}set(d,_){return this.clone({param:d,value:_,op:"s"})}delete(d,_){return this.clone({param:d,value:_,op:"d"})}toString(){return this.init(),this.keys().map(d=>{let _=this.encoder.encodeKey(d);return this.map.get(d).map(v=>_+"="+this.encoder.encodeValue(v)).join("&")}).filter(d=>d!=="").join("&")}clone(d){let _=new h({encoder:this.encoder});return _.cloneFrom=this.cloneFrom||this,_.updates=(this.updates||[]).concat(d),_}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(d=>this.map.set(d,this.cloneFrom.map.get(d))),this.updates.forEach(d=>{switch(d.op){case"a":case"s":let _=(d.op==="a"?this.map.get(d.param):void 0)||[];_.push(V_(d.value)),this.map.set(d.param,_);break;case"d":if(d.value!==void 0){let v=this.map.get(d.param)||[],I=v.indexOf(V_(d.value));I!==-1&&v.splice(I,1),v.length>0?this.map.set(d.param,v):this.map.delete(d.param)}else{this.map.delete(d.param);break}}}),this.cloneFrom=this.updates=null)}};var S1=class{constructor(){this.map=new Map}set(d,_){return this.map.set(d,_),this}get(d){return this.map.has(d)||this.map.set(d,d.defaultValue()),this.map.get(d)}delete(d){return this.map.delete(d),this}has(d){return this.map.has(d)}keys(){return this.map.keys()}};function AN(h){switch(h){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function aC(h){return typeof ArrayBuffer<"u"&&h instanceof ArrayBuffer}function lC(h){return typeof Blob<"u"&&h instanceof Blob}function cC(h){return typeof FormData<"u"&&h instanceof FormData}function PN(h){return typeof URLSearchParams<"u"&&h instanceof URLSearchParams}var dp=class h{constructor(d,_,v,I){this.url=_,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=d.toUpperCase();let o;if(AN(this.method)||I?(this.body=v!==void 0?v:null,o=I):o=v,o&&(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=o.headers),o.context&&(this.context=o.context),o.params&&(this.params=o.params),this.transferCache=o.transferCache),this.headers??=new Zs,this.context??=new S1,!this.params)this.params=new gl,this.urlWithParams=_;else{let k=this.params.toString();if(k.length===0)this.urlWithParams=_;else{let V=_.indexOf("?"),Z=V===-1?"?":V<_.length-1?"&":"";this.urlWithParams=_+Z+k}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||aC(this.body)||lC(this.body)||cC(this.body)||PN(this.body)?this.body:this.body instanceof gl?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||cC(this.body)?null:lC(this.body)?this.body.type||null:aC(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof gl?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(d={}){let _=d.method||this.method,v=d.url||this.url,I=d.responseType||this.responseType,o=d.transferCache??this.transferCache,k=d.body!==void 0?d.body:this.body,V=d.withCredentials??this.withCredentials,Z=d.reportProgress??this.reportProgress,me=d.headers||this.headers,ye=d.params||this.params,Ne=d.context??this.context;return d.setHeaders!==void 0&&(me=Object.keys(d.setHeaders).reduce((ot,et)=>ot.set(et,d.setHeaders[et]),me)),d.setParams&&(ye=Object.keys(d.setParams).reduce((ot,et)=>ot.set(et,d.setParams[et]),ye)),new h(_,v,k,{params:ye,headers:me,context:Ne,reportProgress:Z,responseType:I,withCredentials:V,transferCache:o})}},_l=function(h){return h[h.Sent=0]="Sent",h[h.UploadProgress=1]="UploadProgress",h[h.ResponseHeader=2]="ResponseHeader",h[h.DownloadProgress=3]="DownloadProgress",h[h.Response=4]="Response",h[h.User=5]="User",h}(_l||{}),fp=class{constructor(d,_=200,v="OK"){this.headers=d.headers||new Zs,this.status=d.status!==void 0?d.status:_,this.statusText=d.statusText||v,this.url=d.url||null,this.ok=this.status>=200&&this.status<300}},U_=class h extends fp{constructor(d={}){super(d),this.type=_l.ResponseHeader}clone(d={}){return new h({headers:d.headers||this.headers,status:d.status!==void 0?d.status:this.status,statusText:d.statusText||this.statusText,url:d.url||this.url||void 0})}},pp=class h extends fp{constructor(d={}){super(d),this.type=_l.Response,this.body=d.body!==void 0?d.body:null}clone(d={}){return new h({body:d.body!==void 0?d.body:this.body,headers:d.headers||this.headers,status:d.status!==void 0?d.status:this.status,statusText:d.statusText||this.statusText,url:d.url||this.url||void 0})}},ml=class extends fp{constructor(d){super(d,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${d.url||"(unknown url)"}`:this.message=`Http failure response for ${d.url||"(unknown url)"}: ${d.status} ${d.statusText}`,this.error=d.error||null}},pC=200,RN=204;function M1(h,d){return{body:d,headers:h.headers,context:h.context,observe:h.observe,params:h.params,reportProgress:h.reportProgress,responseType:h.responseType,withCredentials:h.withCredentials,transferCache:h.transferCache}}var mp=(()=>{let d=class d{constructor(v){this.handler=v}request(v,I,o={}){let k;if(v instanceof dp)k=v;else{let me;o.headers instanceof Zs?me=o.headers:me=new Zs(o.headers);let ye;o.params&&(o.params instanceof gl?ye=o.params:ye=new gl({fromObject:o.params})),k=new dp(v,I,o.body!==void 0?o.body:null,{headers:me,context:o.context,params:ye,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials,transferCache:o.transferCache})}let V=Vg(k).pipe(xx(me=>this.handler.handle(me)));if(v instanceof dp||o.observe==="events")return V;let Z=V.pipe(Cc(me=>me instanceof pp));switch(o.observe||"body"){case"body":switch(k.responseType){case"arraybuffer":return Z.pipe(_i(me=>{if(me.body!==null&&!(me.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return me.body}));case"blob":return Z.pipe(_i(me=>{if(me.body!==null&&!(me.body instanceof Blob))throw new Error("Response is not a Blob.");return me.body}));case"text":return Z.pipe(_i(me=>{if(me.body!==null&&typeof me.body!="string")throw new Error("Response is not a string.");return me.body}));case"json":default:return Z.pipe(_i(me=>me.body))}case"response":return Z;default:throw new Error(`Unreachable: unhandled observe type ${o.observe}}`)}}delete(v,I={}){return this.request("DELETE",v,I)}get(v,I={}){return this.request("GET",v,I)}head(v,I={}){return this.request("HEAD",v,I)}jsonp(v,I){return this.request("JSONP",v,{params:new gl().append(I,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(v,I={}){return this.request("OPTIONS",v,I)}patch(v,I,o={}){return this.request("PATCH",v,M1(o,I))}post(v,I,o={}){return this.request("POST",v,M1(o,I))}put(v,I,o={}){return this.request("PUT",v,M1(o,I))}};d.\u0275fac=function(I){return new(I||d)(Wn(Ws))},d.\u0275prov=Sn({token:d,factory:d.\u0275fac});let h=d;return h})(),LN=/^\)\]\}',?\n/,ON="X-Request-URL";function uC(h){if(h.url)return h.url;let d=ON.toLocaleLowerCase();return h.headers.get(d)}var kN=(()=>{let d=class d{constructor(){this.fetchImpl=Mt(A1,{optional:!0})?.fetch??fetch.bind(globalThis),this.ngZone=Mt(Vr)}handle(v){return new On(I=>{let o=new AbortController;return this.doRequest(v,o.signal,I).then(P1,k=>I.error(new ml({error:k}))),()=>o.abort()})}doRequest(v,I,o){return wg(this,null,function*(){let k=this.createRequestInit(v),V;try{let mt=this.ngZone.runOutsideAngular(()=>this.fetchImpl(v.urlWithParams,Br({signal:I},k)));FN(mt),o.next({type:_l.Sent}),V=yield mt}catch(mt){o.error(new ml({error:mt,status:mt.status??0,statusText:mt.statusText,url:v.urlWithParams,headers:mt.headers}));return}let Z=new Zs(V.headers),me=V.statusText,ye=uC(V)??v.urlWithParams,Ne=V.status,ot=null;if(v.reportProgress&&o.next(new U_({headers:Z,status:Ne,statusText:me,url:ye})),V.body){let mt=V.headers.get("content-length"),Zt=[],jt=V.body.getReader(),Rt=0,an,Ut,pn=typeof Zone<"u"&&Zone.current;yield this.ngZone.runOutsideAngular(()=>wg(this,null,function*(){for(;;){let{done:Yn,value:Sr}=yield jt.read();if(Yn)break;if(Zt.push(Sr),Rt+=Sr.length,v.reportProgress){Ut=v.responseType==="text"?(Ut??"")+(an??=new TextDecoder).decode(Sr,{stream:!0}):void 0;let cn=()=>o.next({type:_l.DownloadProgress,total:mt?+mt:void 0,loaded:Rt,partialText:Ut});pn?pn.run(cn):cn()}}}));let mr=this.concatChunks(Zt,Rt);try{let Yn=V.headers.get("Content-Type")??"";ot=this.parseBody(v,mr,Yn)}catch(Yn){o.error(new ml({error:Yn,headers:new Zs(V.headers),status:V.status,statusText:V.statusText,url:uC(V)??v.urlWithParams}));return}}Ne===0&&(Ne=ot?pC:0),Ne>=200&&Ne<300?(o.next(new pp({body:ot,headers:Z,status:Ne,statusText:me,url:ye})),o.complete()):o.error(new ml({error:ot,headers:Z,status:Ne,statusText:me,url:ye}))})}parseBody(v,I,o){switch(v.responseType){case"json":let k=new TextDecoder().decode(I).replace(LN,"");return k===""?null:JSON.parse(k);case"text":return new TextDecoder().decode(I);case"blob":return new Blob([I],{type:o});case"arraybuffer":return I.buffer}}createRequestInit(v){let I={},o=v.withCredentials?"include":void 0;if(v.headers.forEach((k,V)=>I[k]=V.join(",")),v.headers.has("Accept")||(I.Accept="application/json, text/plain, */*"),!v.headers.has("Content-Type")){let k=v.detectContentTypeHeader();k!==null&&(I["Content-Type"]=k)}return{body:v.serializeBody(),method:v.method,headers:I,credentials:o}}concatChunks(v,I){let o=new Uint8Array(I),k=0;for(let V of v)o.set(V,k),k+=V.length;return o}};d.\u0275fac=function(I){return new(I||d)},d.\u0275prov=Sn({token:d,factory:d.\u0275fac});let h=d;return h})(),A1=class{};function P1(){}function FN(h){h.then(P1,P1)}function mC(h,d){return d(h)}function NN(h,d){return(_,v)=>d.intercept(_,{handle:I=>h(I,v)})}function zN(h,d,_){return(v,I)=>Vv(_,()=>d(v,o=>h(o,I)))}var BN=new In(""),R1=new In(""),VN=new In(""),gC=new In("",{providedIn:"root",factory:()=>!0});function jN(){let h=null;return(d,_)=>{h===null&&(h=(Mt(BN,{optional:!0})??[]).reduceRight(NN,mC));let v=Mt(Gc);if(Mt(gC)){let o=v.add();return h(d,_).pipe(Gg(()=>v.remove(o)))}else return h(d,_)}}var hC=(()=>{let d=class d extends Ws{constructor(v,I){super(),this.backend=v,this.injector=I,this.chain=null,this.pendingTasks=Mt(Gc),this.contributeToStability=Mt(gC)}handle(v){if(this.chain===null){let I=Array.from(new Set([...this.injector.get(R1),...this.injector.get(VN,[])]));this.chain=I.reduceRight((o,k)=>zN(o,k,this.injector),mC)}if(this.contributeToStability){let I=this.pendingTasks.add();return this.chain(v,o=>this.backend.handle(o)).pipe(Gg(()=>this.pendingTasks.remove(I)))}else return this.chain(v,I=>this.backend.handle(I))}};d.\u0275fac=function(I){return new(I||d)(Wn(j_),Wn(es))},d.\u0275prov=Sn({token:d,factory:d.\u0275fac});let h=d;return h})();var UN=/^\)\]\}',?\n/;function GN(h){return"responseURL"in h&&h.responseURL?h.responseURL:/^X-Request-URL:/m.test(h.getAllResponseHeaders())?h.getResponseHeader("X-Request-URL"):null}var dC=(()=>{let d=class d{constructor(v){this.xhrFactory=v}handle(v){if(v.method==="JSONP")throw new kn(-2800,!1);let I=this.xhrFactory;return(I.\u0275loadImpl?Qo(I.\u0275loadImpl()):Vg(null)).pipe(wx(()=>new On(k=>{let V=I.build();if(V.open(v.method,v.urlWithParams),v.withCredentials&&(V.withCredentials=!0),v.headers.forEach((jt,Rt)=>V.setRequestHeader(jt,Rt.join(","))),v.headers.has("Accept")||V.setRequestHeader("Accept","application/json, text/plain, */*"),!v.headers.has("Content-Type")){let jt=v.detectContentTypeHeader();jt!==null&&V.setRequestHeader("Content-Type",jt)}if(v.responseType){let jt=v.responseType.toLowerCase();V.responseType=jt!=="json"?jt:"text"}let Z=v.serializeBody(),me=null,ye=()=>{if(me!==null)return me;let jt=V.statusText||"OK",Rt=new Zs(V.getAllResponseHeaders()),an=GN(V)||v.url;return me=new U_({headers:Rt,status:V.status,statusText:jt,url:an}),me},Ne=()=>{let{headers:jt,status:Rt,statusText:an,url:Ut}=ye(),pn=null;Rt!==RN&&(pn=typeof V.response>"u"?V.responseText:V.response),Rt===0&&(Rt=pn?pC:0);let mr=Rt>=200&&Rt<300;if(v.responseType==="json"&&typeof pn=="string"){let Yn=pn;pn=pn.replace(UN,"");try{pn=pn!==""?JSON.parse(pn):null}catch(Sr){pn=Yn,mr&&(mr=!1,pn={error:Sr,text:pn})}}mr?(k.next(new pp({body:pn,headers:jt,status:Rt,statusText:an,url:Ut||void 0})),k.complete()):k.error(new ml({error:pn,headers:jt,status:Rt,statusText:an,url:Ut||void 0}))},ot=jt=>{let{url:Rt}=ye(),an=new ml({error:jt,status:V.status||0,statusText:V.statusText||"Unknown Error",url:Rt||void 0});k.error(an)},et=!1,mt=jt=>{et||(k.next(ye()),et=!0);let Rt={type:_l.DownloadProgress,loaded:jt.loaded};jt.lengthComputable&&(Rt.total=jt.total),v.responseType==="text"&&V.responseText&&(Rt.partialText=V.responseText),k.next(Rt)},Zt=jt=>{let Rt={type:_l.UploadProgress,loaded:jt.loaded};jt.lengthComputable&&(Rt.total=jt.total),k.next(Rt)};return V.addEventListener("load",Ne),V.addEventListener("error",ot),V.addEventListener("timeout",ot),V.addEventListener("abort",ot),v.reportProgress&&(V.addEventListener("progress",mt),Z!==null&&V.upload&&V.upload.addEventListener("progress",Zt)),V.send(Z),k.next({type:_l.Sent}),()=>{V.removeEventListener("error",ot),V.removeEventListener("abort",ot),V.removeEventListener("load",Ne),V.removeEventListener("timeout",ot),v.reportProgress&&(V.removeEventListener("progress",mt),Z!==null&&V.upload&&V.upload.removeEventListener("progress",Zt)),V.readyState!==V.DONE&&V.abort()}})))}};d.\u0275fac=function(I){return new(I||d)(Wn(F_))},d.\u0275prov=Sn({token:d,factory:d.\u0275fac});let h=d;return h})(),_C=new In(""),$N="XSRF-TOKEN",HN=new In("",{providedIn:"root",factory:()=>$N}),qN="X-XSRF-TOKEN",WN=new In("",{providedIn:"root",factory:()=>qN}),G_=class{},ZN=(()=>{let d=class d{constructor(v,I,o){this.doc=v,this.platform=I,this.cookieName=o,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let v=this.doc.cookie||"";return v!==this.lastCookieString&&(this.parseCount++,this.lastToken=rC(v,this.cookieName),this.lastCookieString=v),this.lastToken}};d.\u0275fac=function(I){return new(I||d)(Wn(N_),Wn(D_),Wn(HN))},d.\u0275prov=Sn({token:d,factory:d.\u0275fac});let h=d;return h})();function XN(h,d){let _=h.url.toLowerCase();if(!Mt(_C)||h.method==="GET"||h.method==="HEAD"||_.startsWith("http://")||_.startsWith("https://"))return d(h);let v=Mt(G_).getToken(),I=Mt(WN);return v!=null&&!h.headers.has(I)&&(h=h.clone({headers:h.headers.set(I,v)})),d(h)}var yC=function(h){return h[h.Interceptors=0]="Interceptors",h[h.LegacyInterceptors=1]="LegacyInterceptors",h[h.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",h[h.NoXsrfProtection=3]="NoXsrfProtection",h[h.JsonpSupport=4]="JsonpSupport",h[h.RequestsMadeViaParent=5]="RequestsMadeViaParent",h[h.Fetch=6]="Fetch",h}(yC||{});function YN(h,d){return{\u0275kind:h,\u0275providers:d}}function GU(...h){let d=[mp,dC,hC,{provide:Ws,useExisting:hC},{provide:j_,useFactory:()=>Mt(kN,{optional:!0})??Mt(dC)},{provide:R1,useValue:XN,multi:!0},{provide:_C,useValue:!0},{provide:G_,useClass:ZN}];for(let _ of h)d.push(..._.\u0275providers);return Nv(d)}var fC=new In("");function $U(){return YN(yC.LegacyInterceptors,[{provide:fC,useFactory:jN},{provide:R1,useExisting:fC,multi:!0}])}var $_={production:!1,apiKey:"pk.eyJ1Ijoid2FjaGltaXJvIiwiYSI6ImNseWoxNjRoZjBsODYycW9tZDZqNGcxdXkifQ.WhbOpeFml-jIjGjTTTJFzw"};var vC=(()=>{class h extends mp{baseUrl="https://api.mapbox.com/directions/v5/mapbox/driving";constructor(_){super(_)}get(_){return _=this.baseUrl+_,super.get(_,{params:{alternatives:!1,geometries:"geojson",language:"es",overview:"simplified",steps:!1,access_token:$_.apiKey}})}static \u0275fac=function(v){return new(v||h)(Wn(Ws))};static \u0275prov=Sn({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})();var Xs=(()=>{class h{map;markers=[];get isMapReady(){return!!this.map}directionsApi=Mt(vC);setMap(_){this.map=_}flyTo(_){if(!this.isMapReady)throw Error("El mapa no esta inicializado");this.map?.flyTo({zoom:14,center:_})}createMarkersFromPlaces(_,v){if(!this.map)throw Error("Mapa no inicializado.");this.markers.forEach(k=>k.remove());let I=[];for(let k of _){let[V,Z]=k.center,me=new Hc.Popup().setHTML(`
          <h6>${k.text}</h6>
          <span>${k.place_name}</span>
        `),ye=new Hc.Marker().setLngLat([V,Z]).setPopup(me).addTo(this.map);I.push(ye)}if(this.markers=I,_.length===0)return;let o=new Hc.LngLatBounds;I.forEach(k=>o.extend(k.getLngLat())),o.extend(v),this.map.fitBounds(o,{padding:200})}getRouteBetweenPoints(_,v){this.directionsApi.get(`/${_.join(",")};${v.join(",")}`).subscribe(I=>this.drawPolyline(I.routes[0]))}drawPolyline(_){if(!this.map)throw Error("Mapa no inicializado.");let v=_.geometry.coordinates,I=new Hc.LngLatBounds;v.forEach(([k,V])=>{I.extend([k,V])}),this.map.fitBounds(I,{padding:200});let o={type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:v}}]}};this.map.getLayer("RouteString")&&(this.map.removeLayer("RouteString"),this.map.removeSource("RouteString")),this.map.addSource("RouteString",o),this.map.addLayer({id:"RouteString",type:"line",source:"RouteString",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"black","line-width":3}})}static \u0275fac=function(v){return new(v||h)};static \u0275prov=Sn({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})();var bC=(()=>{class h extends mp{baseUrl="https://api.mapbox.com/geocoding/v5/mapbox.places";constructor(_){super(_)}get(_,v){return _=this.baseUrl+_,super.get(_,{params:Br({limit:5,language:"es",access_token:$_.apiKey},v.params)})}static \u0275fac=function(v){return new(v||h)(Wn(Ws))};static \u0275prov=Sn({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})();var So=(()=>{class h{placesApi;mapService;userLocation;isLoadingPlaces=!1;places=[];get isUserLocationReady(){return!!this.userLocation}constructor(_,v){this.placesApi=_,this.mapService=v,this.getUserLocation()}getUserLocation(){return new Promise((_,v)=>{navigator.geolocation.getCurrentPosition(({coords:I})=>{this.userLocation=[I.longitude,I.latitude],_(this.userLocation)},I=>{alert("No se pudo obtener la geolocalizaci\xF3n."),console.log(I),v()})})}getPlacesByQuery(_=""){if(_.length===0){this.isLoadingPlaces=!1,this.places=[];return}if(!this.userLocation)throw Error("No hay UserLocation.");this.isLoadingPlaces=!0,this.placesApi.get(`/${_}.json`,{params:{proximity:this.userLocation.join(",")}}).subscribe(v=>{this.isLoadingPlaces=!1,this.places=v.features,this.mapService.createMarkersFromPlaces(this.places,this.userLocation)})}deletePlaces(){this.places=[]}static \u0275fac=function(v){return new(v||h)(Wn(bC),Wn(Xs))};static \u0275prov=Sn({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})();var Vh=hE(v1());var JN=["mapDiv"],wC=(()=>{class h{placesService=Mt(So);mapService=Mt(Xs);mapDivElement;ngAfterViewInit(){if(!this.placesService.userLocation)throw Error("No hay placesService.useLocation");let _=new Vh.Map({container:this.mapDivElement.nativeElement,style:"mapbox://styles/mapbox/streets-v12",center:this.placesService.userLocation,zoom:14}),v=new Vh.Popup().setHTML(`
        <h6>Aqu\xED estoy.</h6>
        <span>Estoy en este lugar del mundo.</span>
      `);new Vh.Marker({color:"red"}).setLngLat(this.placesService.userLocation).setPopup(v).addTo(_),this.mapService.setMap(_)}static \u0275fac=function(v){return new(v||h)};static \u0275cmp=xi({type:h,selectors:[["app-map-view"]],viewQuery:function(v,I){if(v&1&&kM(JN,5),v&2){let o;FM(o=NM())&&(I.mapDivElement=o.first)}},standalone:!0,features:[vi],decls:2,vars:0,consts:[["mapDiv",""],[1,"map-container"]],template:function(v,I){v&1&&Mo(0,"div",1,0)},styles:[".map-container[_ngcontent-%COMP%]{position:fixed;top:0;right:0;width:100vw;height:100vh}"]})}return h})();var TC=(()=>{class h{static \u0275fac=function(v){return new(v||h)};static \u0275cmp=xi({type:h,selectors:[["app-loading"]],standalone:!0,features:[vi],decls:6,vars:0,consts:[[1,"loading-map","d-flex","justify-content-center","align-items-center"],[1,"text-center"]],template:function(v,I){v&1&&(jr(0,"div",0)(1,"div",1)(2,"h3"),Co(3,"Wait please ..."),Ur(),jr(4,"span"),Co(5,"Locating..."),Ur()()())},styles:[".loading-map[_ngcontent-%COMP%]{background-color:#000c;color:#fff;height:100vh;position:fixed;right:0;top:0;width:100vw}"]})}return h})();var EC=(()=>{class h{static \u0275fac=function(v){return new(v||h)};static \u0275cmp=xi({type:h,selectors:[["app-angular-logo"]],standalone:!0,features:[vi],decls:1,vars:0,consts:[["width","100","alt","Angular Logo","src","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTAgMjUwIj4KICAgIDxwYXRoIGZpbGw9IiNERDAwMzEiIGQ9Ik0xMjUgMzBMMzEuOSA2My4ybDE0LjIgMTIzLjFMMTI1IDIzMGw3OC45LTQzLjcgMTQuMi0xMjMuMXoiIC8+CiAgICA8cGF0aCBmaWxsPSIjQzMwMDJGIiBkPSJNMTI1IDMwdjIyLjItLjFWMjMwbDc4LjktNDMuNyAxNC4yLTEyMy4xTDEyNSAzMHoiIC8+CiAgICA8cGF0aCAgZmlsbD0iI0ZGRkZGRiIgZD0iTTEyNSA1Mi4xTDY2LjggMTgyLjZoMjEuN2wxMS43LTI5LjJoNDkuNGwxMS43IDI5LjJIMTgzTDEyNSA1Mi4xem0xNyA4My4zaC0zNGwxNy00MC45IDE3IDQwLjl6IiAvPgogIDwvc3ZnPg=="]],template:function(v,I){v&1&&Mo(0,"img",0)},styles:["img[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;z-index:999}"]})}return h})();var IC=(()=>{class h{mapService=Mt(Xs);placesService=Mt(So);goToMyLocation(){if(!this.placesService.isUserLocationReady)throw Error("No hay ubicaci\xF3n de usuario.");if(!this.mapService.isMapReady)throw Error("No hay mapa disponible.");this.mapService.flyTo(this.placesService.userLocation)}static \u0275fac=function(v){return new(v||h)};static \u0275cmp=xi({type:h,selectors:[["app-btn-my-location"]],standalone:!0,features:[vi],decls:2,vars:0,consts:[[1,"btn","btn-primary",3,"click"]],template:function(v,I){v&1&&(jr(0,"button",0),pl("click",function(){return I.goToMyLocation()}),Co(1,"Mi ubicaci\xF3n"),Ur())},styles:["button[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px}"]})}return h})();function e3(h,d){h&1&&(jr(0,"div",2)(1,"h6"),Co(2,"Cargando"),Ur(),jr(3,"span"),Co(4,"Espere por favor..."),Ur()())}function t3(h,d){if(h&1){let _=R_();jr(0,"li",5),pl("click",function(){let I=ap(_).$implicit,o=hp(2);return lp(o.flyTo(I))}),jr(1,"h6"),Co(2),Ur(),jr(3,"p"),Co(4),Ur(),jr(5,"button",6),pl("click",function(){let I=ap(_).$implicit,o=hp(2);return lp(o.getDirections(I))}),Co(6,"Direcciones"),Ur()()}if(h&2){let _=d.$implicit,v=hp(2);f1("active",_.id===v.selectedId),Nh(2),O_(_.text_es),Nh(2),O_(_.place_name),Nh(),fl("ngClass",_.id===v.selectedId?"btn-outline-light":"btn-outline-primary")}}function n3(h,d){if(h&1&&(jr(0,"ul",3),Bh(1,t3,7,5,"li",4),Ur()),h&2){let _=hp();Nh(),fl("ngForOf",_.places)}}var DC=(()=>{class h{placesService=Mt(So);mapService=Mt(Xs);selectedId="";get isLoadingPlaces(){return this.placesService.isLoadingPlaces}get places(){return this.placesService.places}flyTo(_){this.selectedId=_.id;let[v,I]=_.center;this.mapService.flyTo([v,I])}getDirections(_){if(!this.placesService.userLocation)throw Error("No hay userLocation");this.placesService.deletePlaces();let v=this.placesService.userLocation,I=_.center;this.mapService.getRouteBetweenPoints(v,I)}static \u0275fac=function(v){return new(v||h)};static \u0275cmp=xi({type:h,selectors:[["app-search-results"]],standalone:!0,features:[vi],decls:2,vars:2,consts:[["class","alert alert-primary mt-2 text-center",4,"ngIf"],["class","list-group mt-2",4,"ngIf"],[1,"alert","alert-primary","mt-2","text-center"],[1,"list-group","mt-2"],["class","list-group-item list-group-item-action pointer",3,"active","click",4,"ngFor","ngForOf"],[1,"list-group-item","list-group-item-action","pointer",3,"click"],[1,"btn","btn-sm",3,"click","ngClass"]],template:function(v,I){v&1&&Bh(0,e3,5,0,"div",0)(1,n3,2,1,"ul",1),v&2&&(fl("ngIf",I.isLoadingPlaces),Nh(),fl("ngIf",I.places.length>0))},dependencies:[B_,iC,oC,z_],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}p[_ngcontent-%COMP%]{font-size:12px}"]})}return h})();var MC=(()=>{class h{placesService=Mt(So);debounceTimer;onQueryChanged(_=""){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.placesService.getPlacesByQuery(_)},350)}static \u0275fac=function(v){return new(v||h)};static \u0275cmp=xi({type:h,selectors:[["app-search-bar"]],standalone:!0,features:[vi],decls:4,vars:0,consts:[["txtQuery",""],[1,"search-container"],["type","text","placeholder","Search place...",1,"form-control",3,"keyup"]],template:function(v,I){if(v&1){let o=R_();jr(0,"div",1)(1,"input",2,0),pl("keyup",function(){ap(o);let V=L_(2);return lp(I.onQueryChanged(V.value))}),Ur(),Mo(3,"app-search-results"),Ur()}},dependencies:[DC],styles:[".search-container[_ngcontent-%COMP%]{position:fixed;top:20px;left:20px;width:250px;background-color:#fff;padding:5px;box-shadow:0 10px 10px #0000001a;border-radius:5px;border:1px solid rgba(0,0,0,.1)}"]})}return h})();function r3(h,d){h&1&&Mo(0,"app-loading")}function i3(h,d){h&1&&Mo(0,"app-map-view")(1,"app-btn-my-location")(2,"app-search-bar")}var F6=(()=>{class h{placesService=Mt(So);get isUserLocationReady(){return this.placesService.isUserLocationReady}static \u0275fac=function(v){return new(v||h)};static \u0275cmp=xi({type:h,selectors:[["screens-map-screen"]],standalone:!0,features:[vi],decls:4,vars:2,consts:[["mapReady",""],[4,"ngIf","ngIfElse"]],template:function(v,I){if(v&1&&(Bh(0,r3,1,0,"app-loading",1)(1,i3,3,0,"ng-template",null,0,BM),Mo(3,"app-angular-logo")),v&2){let o=L_(2);fl("ngIf",!I.isUserLocationReady)("ngIfElse",o)}},dependencies:[B_,z_,wC,TC,EC,IC,MC]})}return h})();export{Br as a,il as b,hE as c,Nr as d,NP as e,_x as f,yx as g,ol as h,Hf as i,qf as j,Qo as k,Vg as l,WP as m,ZP as n,Dc as o,_i as p,nR as q,Mc as r,jg as s,iR as t,Cc as u,$E as v,xx as w,Wf as x,vx as y,oR as z,Gg as A,qE as B,bx as C,aR as D,lR as E,cR as F,wx as G,uR as H,WE as I,kn as J,Sn as K,$V as L,In as M,En as N,Wn as O,Mt as P,Qf as Q,xi as R,w_ as S,Nv as T,rD as U,es as V,Vv as W,cD as X,HV as Y,Fc as Z,Nc as _,Gc as $,wo as aa,qV as ba,WV as ca,mO as da,D_ as ea,ZV as fa,u_ as ga,p_ as ha,Vr as ia,$k as ja,zh as ka,vv as la,yF as ma,Mo as na,vi as oa,KV as pa,p1 as qa,UM as ra,k_ as sa,JV as ta,ej as ua,qM as va,tj as wa,nj as xa,b1 as ya,SU as za,ZM as Aa,N_ as Ba,bN as Ca,rC as Da,AU as Ea,DN as Fa,F_ as Ga,GU as Ha,$U as Ia,v1 as Ja,F6 as Ka};
